!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("mapbox-gl"),require("maplibre-gl")):"function"==typeof define&&define.amd?define(["mapbox-gl","maplibre-gl"],t):"object"==typeof exports?exports.L7=t(require("mapbox-gl"),require("maplibre-gl")):e.L7=t(e.mapboxgl,e.maplibregl)}(self,(function(e,t){return function(){var n={8271:function(e,t,n){"use strict";n.d(t,{N:function(){return b},Z:function(){return b}});var r=n(8025),i=n.n(r),o=n(1133),a=n.n(o),s=n(1119),u=n.n(s),l=n(6413),c=n.n(l),f=n(5757),h=n.n(f),p=n(3491),d=n.n(p),v=n(2060),g=n.n(v),m=n(3769),y=n.n(m),_=n(7193),b=function(e){d()(n,e);var t=g()(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),y()(u()(e),"isDisable",!1),y()(u()(e),"button",void 0),y()(u()(e),"buttonText",void 0),y()(u()(e),"buttonIcon",void 0),e}return a()(n,[{key:"setIsDisable",value:function(e){var t,n;(this.isDisable=e,e)?null===(t=this.button)||void 0===t||t.setAttribute("disabled","true"):null===(n=this.button)||void 0===n||n.removeAttribute("disabled")}},{key:"createButton",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return _.SO.create("button","l7-button-control ".concat(e))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var e=this.controlOption,t=e.title,n=e.btnText,r=e.btnIcon;return this.setBtnTitle(t),this.setBtnText(n),this.setBtnIcon(r),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(e){var t=e.title,r=e.btnText,i=e.btnIcon;this.checkUpdateOption(e,["title"])&&this.setBtnTitle(t),this.checkUpdateOption(e,["btnIcon"])&&this.setBtnIcon(i),this.checkUpdateOption(e,["btnText"])&&this.setBtnText(r),c()(h()(n.prototype),"setOptions",this).call(this,e)}},{key:"setBtnTitle",value:function(e){var t;null===(t=this.button)||void 0===t||t.setAttribute("title",null!=e?e:"")}},{key:"setBtnIcon",value:function(e){if(this.buttonIcon&&_.SO.remove(this.buttonIcon),e){var t,n,r,i=null===(t=this.button)||void 0===t?void 0:t.firstChild;if(i)null===(n=this.button)||void 0===n||n.insertBefore(e,i);else null===(r=this.button)||void 0===r||r.appendChild(e);this.buttonIcon=e}}},{key:"setBtnText",value:function(e){if(this.button)if(_.SO.removeClass(this.button,"l7-button-control--row"),_.SO.removeClass(this.button,"l7-button-control--column"),e){var t,n=this.buttonText;if(!n)n=_.SO.create("div","l7-button-control__text"),null===(t=this.button)||void 0===t||t.appendChild(n),this.buttonText=n;n.innerText=e,_.SO.addClass(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!e&&this.buttonText&&(_.SO.remove(this.buttonText),this.buttonText=void 0)}}]),n}(n(5773).ZP)},5773:function(e,t,n){"use strict";n.d(t,{ZP:function(){return E},d:function(){return _.PositionType},oT:function(){return E}});var r=n(3420),i=n.n(r),o=n(4450),a=n.n(o),s=n(8025),u=n.n(s),l=n(1133),c=n.n(l),f=n(1119),h=n.n(f),p=n(3491),d=n.n(p),v=n(2060),g=n.n(v),m=n(3769),y=n.n(m),_=n(7033),b=n(7193),x=n(3262),E=function(e){d()(n,e);var t=g()(n);function n(e){var r;return u()(this,n),r=t.call(this),y()(h()(r),"controlOption",void 0),y()(h()(r),"container",void 0),y()(h()(r),"isShow",void 0),y()(h()(r),"sceneContainer",void 0),y()(h()(r),"scene",void 0),y()(h()(r),"mapsService",void 0),y()(h()(r),"renderService",void 0),y()(h()(r),"layerService",void 0),y()(h()(r),"controlService",void 0),y()(h()(r),"configService",void 0),n.controlCount++,r.controlOption=a()(a()({},r.getDefault(e)),e||{}),r}return c()(n,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(e){var t=this.getDefault(e);Object.entries(e).forEach((function(n){var r=i()(n,2),o=r[0];void 0===r[1]&&(e[o]=t[o])})),"position"in e&&this.setPosition(e.position),"className"in e&&this.setClassName(e.className),"style"in e&&this.setStyle(e.style),this.controlOption=a()(a()({},this.controlOption),e)}},{key:"addTo",value:function(e){this.mapsService=e.mapService,this.renderService=e.rendererService,this.layerService=e.layerService,this.controlService=e.controlService,this.configService=e.globalConfigService,this.scene=e.sceneService,this.sceneContainer=e,this.isShow=!0,this.container=this.onAdd(),b.SO.addClass(this.container,"l7-control");var t=this.controlOption,n=t.className,r=t.style;return n&&this.setClassName(n),r&&this.setStyle(r),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;b.SO.remove(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return b.SO.create("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var e=this.container;b.SO.removeClass(e,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var e=this.container;b.SO.addClass(e,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(e){return{position:_.PositionType.TOPRIGHT,name:"".concat(n.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(e){if(this.mapsService&&e&&e.screenX>0&&e.screenY>0){var t=this.mapsService.getContainer();null!==t&&t.focus()}}},{key:"setPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:_.PositionType.TOPLEFT,t=this.controlService;return t&&t.removeControl(this),this.controlOption.position=e,t&&t.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(e){var t=this.container,n=this.controlOption.className;n&&b.SO.removeClass(t,n),e&&b.SO.addClass(t,e)}},{key:"setStyle",value:function(e){var t=this.container;e?t.setAttribute("style",e):t.removeAttribute("style")}},{key:"insertContainer",value:function(){var e=this.controlOption.position,t=this.container;if(e instanceof Element)e.appendChild(t);else{var n=this.controlService.controlCorners[e];["bottomleft","bottomright","righttop","rightbottom"].includes(e)?n.insertBefore(t,n.firstChild):n.appendChild(t)}}},{key:"checkUpdateOption",value:function(e,t){return t.some((function(t){return t in e}))}}]),n}(n.n(x)());y()(E,"controlCount",0)},753:function(e,t,n){"use strict";n.d(t,{NA:function(){return r.N},Yw:function(){return a.Y},d:function(){return i.d},oT:function(){return i.oT},p4:function(){return o.p}});var r=n(8271),i=n(5773),o=n(3102),a=n(771)},3102:function(e,t,n){"use strict";n.d(t,{p:function(){return R}});var r=n(4450),i=n.n(r),o=n(8025),a=n.n(o),s=n(1133),u=n.n(s),l=n(1119),c=n.n(l),f=n(6413),h=n.n(f),p=n(5757),d=n.n(p),v=n(3491),g=n.n(v),m=n(2060),y=n.n(m),_=n(3769),b=n.n(_),x=n(3420),E=n.n(x),T=n(7193),A=function(e){g()(n,e);var t=y()(n);function n(e,r){var i;return a()(this,n),i=t.call(this),b()(c()(i),"popperDOM",void 0),b()(c()(i),"contentDOM",void 0),b()(c()(i),"button",void 0),b()(c()(i),"option",void 0),b()(c()(i),"isShow",!1),b()(c()(i),"content",void 0),b()(c()(i),"timeout",null),b()(c()(i),"show",(function(){return i.isShow||!i.contentDOM.innerHTML||(i.resetPopperPosition(),T.SO.removeClass(i.popperDOM,"l7-popper-hide"),i.isShow=!0,i.option.unique&&n.conflictPopperList.forEach((function(e){e!==c()(i)&&e.isShow&&e.hide()})),i.emit("show"),window.addEventListener("pointerdown",i.onPopperUnClick)),c()(i)})),b()(c()(i),"hide",(function(){return i.isShow?(T.SO.addClass(i.popperDOM,"l7-popper-hide"),i.isShow=!1,i.emit("hide"),window.removeEventListener("pointerdown",i.onPopperUnClick),c()(i)):c()(i)})),b()(c()(i),"setHideTimeout",(function(){i.timeout||(i.timeout=window.setTimeout((function(){i.isShow&&(i.hide(),i.timeout=null)}),300))})),b()(c()(i),"clearHideTimeout",(function(){i.timeout&&(window.clearTimeout(i.timeout),i.timeout=null)})),b()(c()(i),"onBtnClick",(function(){i.isShow?i.hide():i.show()})),b()(c()(i),"onPopperUnClick",(function(e){T.SO.findParentElement(e.target,[".l7-button-control",".l7-popper-content"])||i.hide()})),b()(c()(i),"onBtnMouseLeave",(function(){i.setHideTimeout()})),b()(c()(i),"onBtnMouseMove",(function(){i.clearHideTimeout(),i.isShow||i.show()})),i.button=e,i.option=r,i.init(),r.unique&&n.conflictPopperList.push(c()(i)),i}return u()(n,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(e){"string"==typeof e?this.contentDOM.innerHTML=e:e instanceof HTMLElement&&(T.SO.clearChildren(this.contentDOM),this.contentDOM.appendChild(e)),this.content=e}},{key:"init",value:function(){var e=this.option.trigger;this.popperDOM=this.createPopper(),"click"===e?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),T.SO.remove(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var e={},t=this.option,n=t.container,r=t.offset,i=void 0===r?[0,0]:r,o=t.placement,a=E()(i,2),s=a[0],u=a[1],l=this.button.getBoundingClientRect(),c=n.getBoundingClientRect(),f=T.SO.getDiffRect(l,c),h=f.left,p=f.right,d=f.top,v=f.bottom,g=!1,m=!1;/^(left|right)/.test(o)?(o.includes("left")?e.right="".concat(l.width+p,"px"):o.includes("right")&&(e.left="".concat(l.width+h,"px")),o.includes("start")?e.top="".concat(d,"px"):o.includes("end")?e.bottom="".concat(v,"px"):(e.top="".concat(d+l.height/2,"px"),m=!0,e.transform="translate(".concat(s,"px, calc(").concat(u,"px - 50%))"))):/^(top|bottom)/.test(o)&&(o.includes("top")?e.bottom="".concat(l.height+v,"px"):o.includes("bottom")&&(e.top="".concat(l.height+d,"px")),o.includes("start")?e.left="".concat(h,"px"):o.includes("end")?e.right="".concat(p,"px"):(e.left="".concat(h+l.width/2,"px"),g=!0,e.transform="translate(calc(".concat(s,"px - 50%), ").concat(u,"px)"))),e.transform="translate(calc(".concat(s,"px - ").concat(g?"50%":"0%","), calc(").concat(u,"px - ").concat(m?"50%":"0%",")");var y=o.split("-");y.length&&T.SO.addClass(this.popperDOM,y.map((function(e){return"l7-popper-".concat(e)})).join(" ")),T.SO.addStyle(this.popperDOM,T.SO.css2Style(e))}},{key:"createPopper",value:function(){var e=this.option,t=e.container,n=e.className,r=void 0===n?"":n,i=e.content,o=T.SO.create("div","l7-popper l7-popper-hide ".concat(r)),a=T.SO.create("div","l7-popper-content"),s=T.SO.create("div","l7-popper-arrow");return o.appendChild(a),o.appendChild(s),t.appendChild(o),this.popperDOM=o,this.contentDOM=a,i&&this.setContent(i),o}}]),n}(n(3262).EventEmitter);b()(A,"conflictPopperList",[]);var S=n(8271),C={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},R=function(e){g()(n,e);var t=y()(n);function n(){var e;a()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),b()(c()(e),"popper",void 0),e}return u()(n,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),h()(d()(n.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(e){var t,r=h()(d()(n.prototype),"getDefault",this).call(this,e),o=null!==(t=null==e?void 0:e.position)&&void 0!==t?t:r.position;return i()(i()({},h()(d()(n.prototype),"getDefault",this).call(this,e)),{},{popperPlacement:o instanceof Element?"bottom":C[o],popperTrigger:"click"})}},{key:"onAdd",value:function(){var e=h()(d()(n.prototype),"onAdd",this).call(this);return this.initPopper(),e}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var e=this,t=this.controlOption,n=t.popperClassName,r=t.popperPlacement,i=t.popperTrigger,o=this.mapsService.getMapContainer();return this.popper=new A(this.button,{className:n,placement:r,trigger:i,container:o,unique:!0}),this.popper.on("show",(function(){e.emit("popperShow",e)})).on("hide",(function(){e.emit("popperHide",e)})),this.popper}},{key:"setOptions",value:function(e){if(h()(d()(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["popperPlacement","popperTrigger","popperClassName"])){var t=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(t)}}}]),n}(S.Z)},771:function(e,t,n){"use strict";n.d(t,{Y:function(){return A},Z:function(){return A}});var r=n(2786),i=n.n(r),o=n(8025),a=n.n(o),s=n(1133),u=n.n(s),l=n(1119),c=n.n(l),f=n(6413),h=n.n(f),p=n(5757),d=n.n(p),v=n(3491),g=n.n(v),m=n(2060),y=n.n(m),_=n(3769),b=n.n(_),x=n(7193),E=n(3102),T=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(T||{}),A=function(e){g()(n,e);var t=y()(n);function n(){var e;a()(this,n);for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return e=t.call.apply(t,[this].concat(o)),b()(c()(e),"selectValue",[]),b()(c()(e),"optionDOMList",void 0),b()(c()(e),"createNormalOption",(function(t){var n=e.selectValue.includes(t.value),r=x.SO.create("div","l7-select-control-item ".concat(n?T.ActiveOptionClassName:""));e.getIsMultiple()?r.appendChild(e.createCheckbox(n)):r.appendChild(e.createRadio(n)),t.icon&&r.appendChild(t.icon);var i=x.SO.create("span");return i.innerText=t.text,r.appendChild(i),r})),b()(c()(e),"onItemClick",(function(t){if(e.getIsMultiple()){var n=e.selectValue.findIndex((function(e){return e===t.value}));n>-1?e.selectValue.splice(n,1):e.selectValue=[].concat(i()(e.selectValue),[t.value])}else e.selectValue=[t.value];e.setSelectValue(e.selectValue)})),e}return u()(n,[{key:"setOptions",value:function(e){h()(d()(n.prototype),"setOptions",this).call(this,e);var t=e.options;t&&this.popper.setContent(this.getPopperContent(t))}},{key:"onAdd",value:function(){var e=h()(d()(n.prototype),"onAdd",this).call(this),t=this.controlOption.defaultValue;return t&&(this.selectValue=this.transSelectValue(t)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),e}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=this.transSelectValue(e);this.optionDOMList.forEach((function(e){var t=e.getAttribute(T.OptionValueAttrKey),r=e.querySelector("input[type=checkbox]"),i=e.querySelector("input[type=radio]"),o=n.includes(t),a=function(t,n){x.SO.toggleClass(e,T.ActiveOptionClassName,n),t&&x.SO.setChecked(t,n)};a(r,o),a(i,o)})),this.selectValue=n,t&&this.emit("selectChange",this.getIsMultiple()?n:n[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(e){var t=this,n=this.isImageOptions(),r=x.SO.create("div",n?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&x.SO.addClass(r,"l7-select-control--multiple");var o=e.map((function(e,r){var i=n?t.createImageOption(e):t.createNormalOption(e);return i.setAttribute(T.OptionValueAttrKey,e.value),i.setAttribute(T.OptionIndexAttrKey,window.String(r)),i.addEventListener("click",t.onItemClick.bind(t,e)),i}));return r.append.apply(r,i()(o)),this.optionDOMList=o,r}},{key:"createImageOption",value:function(e){var t=this.selectValue.includes(e.value),n=x.SO.create("div","l7-select-control-item ".concat(t?T.ActiveOptionClassName:"")),r=x.SO.create("img");r.setAttribute("src",e.img),x.SO.setUnDraggable(r),n.appendChild(r);var i=x.SO.create("div","l7-select-control-item-row");this.getIsMultiple()&&n.appendChild(this.createCheckbox(t));var o=x.SO.create("span");return o.innerText=e.text,i.appendChild(o),n.appendChild(i),n}},{key:"createCheckbox",value:function(e){var t=x.SO.create("input");return t.setAttribute("type","checkbox"),e&&x.SO.setChecked(t,!0),t}},{key:"createRadio",value:function(e){var t=x.SO.create("input");return t.setAttribute("type","radio"),e&&x.SO.setChecked(t,!0),t}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find((function(e){return e.img}))}},{key:"transSelectValue",value:function(e){return Array.isArray(e)?e:[e]}}]),n}(E.p)},4940:function(e,t,n){"use strict";n.d(t,{d:function(){return w}});var r=n(2786),i=n.n(r),o=n(4450),a=n.n(o),s=n(6502),u=n.n(s),l=n(4351),c=n.n(l),f=n(8025),h=n.n(f),p=n(1133),d=n.n(p),v=n(1119),g=n.n(v),m=n(6413),y=n.n(m),_=n(5757),b=n.n(_),x=n(3491),E=n.n(x),T=n(2060),A=n.n(T),S=n(3769),C=n.n(S),R=n(8542),w=function(e){E()(r,e);var t,n=A()(r);function r(){var e;h()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),C()(g()(e),"onClick",c()(u()().mark((function t(){var n;return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.controlOption.onExport,t.t0=null==n,t.t0){t.next=8;break}return t.t1=n,t.next=6,e.getImage();case 6:t.t2=t.sent,(0,t.t1)(t.t2);case 8:case"end":return t.stop()}}),t)})))),C()(g()(e),"mergeImage",c()(u()().mark((function t(){var n,r,i,o,a,s,l,c,f,h,p,d,v,g=arguments;return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(i=e.controlOption.imageType,o=null!==(n=null===(r=e.mapsService.getContainer())||void 0===r?void 0:r.getBoundingClientRect())&&void 0!==n?n:{},a=o.width,s=void 0===a?0:a,l=o.height,c=void 0===l?0:l,(f=document.createElement("canvas")).width=s,f.height=c,h=f.getContext("2d"),p=g.length,d=new Array(p),v=0;v<p;v++)d[v]=g[v];return t.next=9,Promise.all(d.map((function(e){return new Promise((function(t){var n=new Image;n.onload=function(){t(n)},n.src=e}))})));case 9:return t.sent.forEach((function(e){null==h||h.drawImage(e,0,0,s,c)})),t.abrupt("return",f.toDataURL("image/".concat(i)));case 12:case"end":return t.stop()}}),t)})))),e}return d()(r,[{key:"onAdd",value:function(){var e=y()(b()(r.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),e}},{key:"getDefault",value:function(e){return a()(a()({},y()(b()(r.prototype),"getDefault",this).call(this,e)),{},{title:"导出图片",btnIcon:(0,R.Q)("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:(t=c()(u()().mark((function e(){var t,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.mapsService.exportMap("png");case 2:return t=e.sent,e.next=5,this.scene.exportPng("png");case 5:return n=e.sent,e.abrupt("return",this.mergeImage.apply(this,i()([t,n].filter((function(e){return e})))));case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),r}(n(8271).Z)},5038:function(e,t,n){"use strict";n.d(t,{i:function(){return B}});var r=n(4450),i=n.n(r),o=n(6502),a=n.n(o),s=n(4351),u=n.n(s),l=n(8025),c=n.n(l),f=n(1133),h=n.n(f),p=n(1119),d=n.n(p),v=n(6413),g=n.n(v),m=n(5757),y=n.n(m),_=n(3491),b=n.n(_),x=n(2060),E=n.n(x),T=n(3769),A=n.n(T),S=n(7193),C=n(8542),R=n(3420),w=n.n(R),M=n(2729),k=n.n(M),L=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],O=function(){if("undefined"==typeof document)return!1;for(var e=L[0],t={},n=0,r=L;n<r.length;n++){var i=r[n];if((null==i?void 0:i[1])in document){var o,a=k()(i.entries());try{for(a.s();!(o=a.n()).done;){var s=w()(o.value,2),u=s[0],l=s[1];t[e[u]]=l}}catch(e){a.e(e)}finally{a.f()}return t}}return!1}(),I={change:O.fullscreenchange,error:O.fullscreenerror},P={request:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise((function(n,r){var i=function e(){P.off("change",e),n()};P.on("change",i);var o=e[O.requestFullscreen](t);o instanceof Promise&&o.then(i).catch(r)}))},exit:function(){return new Promise((function(e,t){if(P.isFullscreen){var n=function t(){P.off("change",t),e()};P.on("change",n);var r=document[O.exitFullscreen]();r instanceof Promise&&r.then(n).catch(t)}else e()}))},toggle:function(e,t){return P.isFullscreen?P.exit():P.request(e,t)},onchange:function(e){P.on("change",e)},onerror:function(e){P.on("error",e)},on:function(e,t){var n=I[e];n&&document.addEventListener(n,t,!1)},off:function(e,t){var n=I[e];n&&document.removeEventListener(n,t,!1)},raw:O};Object.defineProperties(P,{isFullscreen:{get:function(){return Boolean(document[O.fullscreenElement])}},element:{enumerable:!0,get:function(){var e;return null!==(e=document[O.fullscreenElement])&&void 0!==e?e:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[O.fullscreenEnabled])}}}),O||(P={isEnabled:!1});var N=P,B=function(e){b()(n,e);var t=E()(n);function n(e){var r;return c()(this,n),r=t.call(this,e),A()(d()(r),"isFullscreen",!1),A()(d()(r),"mapContainer",void 0),A()(d()(r),"toggleFullscreen",u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!N.isEnabled){e.next=3;break}return e.next=3,N.toggle(r.mapContainer);case 3:case"end":return e.stop()}}),e)})))),A()(d()(r),"onClick",(function(){r.toggleFullscreen()})),A()(d()(r),"onFullscreenChange",(function(){r.isFullscreen=!!document.fullscreenElement;var e=r.controlOption,t=e.btnText,n=e.btnIcon,i=e.title,o=e.exitBtnText,a=e.exitBtnIcon,s=e.exitTitle;r.isFullscreen?(r.setBtnTitle(s),r.setBtnText(o),r.setBtnIcon(a)):(r.setBtnTitle(i),r.setBtnText(t),r.setBtnIcon(n)),r.emit("fullscreenChange",r.isFullscreen)})),N.isEnabled||console.warn("当前浏览器环境不支持对地图全屏化"),r}return h()(n,[{key:"setOptions",value:function(e){var t=e.exitBtnText,r=e.exitBtnIcon,i=e.exitTitle;this.isFullscreen&&(this.checkUpdateOption(e,["exitBtnIcon"])&&this.setBtnIcon(r),this.checkUpdateOption(e,["exitBtnText"])&&this.setBtnText(t),this.checkUpdateOption(e,["exitTitle"])&&this.setBtnTitle(i)),g()(y()(n.prototype),"setOptions",this).call(this,e)}},{key:"onAdd",value:function(){var e=g()(y()(n.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),this.mapContainer=S.SO.getContainer(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),e}},{key:"onRemove",value:function(){g()(y()(n.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(e){return i()(i()({},g()(y()(n.prototype),"getDefault",this).call(this,e)),{},{title:"全屏",btnIcon:(0,C.Q)("l7-icon-fullscreen"),exitTitle:"退出全屏",exitBtnIcon:(0,C.Q)("l7-icon-exit-fullscreen")})}}]),n}(n(8271).Z)},7170:function(e,t,n){"use strict";n.d(t,{v:function(){return C}});var r=n(4450),i=n.n(r),o=n(6502),a=n.n(o),s=n(4351),u=n.n(s),l=n(8025),c=n.n(l),f=n(1133),h=n.n(f),p=n(1119),d=n.n(p),v=n(6413),g=n.n(v),m=n(5757),y=n.n(m),_=n(3491),b=n.n(_),x=n(2060),E=n.n(x),T=n(3769),A=n.n(T),S=n(8542),C=function(e){b()(n,e);var t=E()(n);function n(e){var r;return c()(this,n),r=t.call(this,e),A()(d()(r),"getGeoLocation",(function(){return new Promise((function(e,t){window.navigator.geolocation.getCurrentPosition((function(n){var r=n.coords,i=null!=r?r:{},o=i.longitude,a=i.latitude;isNaN(o)||isNaN(a)?t():e([o,a])}),(function(e){t(e)}))}))})),A()(d()(r),"onClick",u()(a()().mark((function e(){var t,n,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(window.navigator.geolocation){e.next=2;break}return e.abrupt("return");case 2:return t=r.controlOption.transform,e.next=5,r.getGeoLocation();case 5:if(n=e.sent,i=r.mapsService.getZoom(),e.t0=r.mapsService,e.t1=i>15?i:15,!t){e.next=15;break}return e.next=12,t(n);case 12:e.t2=e.sent,e.next=16;break;case 15:e.t2=n;case 16:e.t3=e.t2,e.t0.setZoomAndCenter.call(e.t0,e.t1,e.t3);case 18:case"end":return e.stop()}}),e)})))),window.navigator.geolocation||console.warn("当前浏览器环境不支持获取地理定位"),r}return h()(n,[{key:"getDefault",value:function(e){return i()(i()({},g()(y()(n.prototype),"getDefault",this).call(this,e)),{},{title:"定位",btnIcon:(0,S.Q)("l7-icon-reposition")})}},{key:"onAdd",value:function(){var e=g()(y()(n.prototype),"onAdd",this).call(this);return e.addEventListener("click",this.onClick),e}}]),n}(n(8271).Z)},2960:function(e,t,n){"use strict";n.d(t,{F:function(){return T}});var r=n(4450),i=n.n(r),o=n(8025),a=n.n(o),s=n(1133),u=n.n(s),l=n(1119),c=n.n(l),f=n(6413),h=n.n(f),p=n(5757),d=n.n(p),v=n(3491),g=n.n(v),m=n(2060),y=n.n(m),_=n(3769),b=n.n(_),x=n(8542);function E(e){return Object.keys(null!=e?e:{}).every((function(e){return["layer","name","img"].includes(e)}))}var T=function(e){g()(n,e);var t=y()(n);function n(){var e;a()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),b()(c()(e),"onLayerChange",(function(){var t;null!==(t=e.controlOption.layers)&&void 0!==t&&t.length||(e.selectValue=e.getLayerVisible(),e.setOptions({options:e.getLayerOptions()}))})),b()(c()(e),"onLayerVisibleChane",(function(){e.setSelectValue(e.getLayerVisible())})),b()(c()(e),"onSelectChange",(function(){e.layers.forEach((function(t){var n=e.selectValue.includes(t.name),r=t.isVisible();n&&!r&&t.show(),!n&&r&&t.hide()}))})),e}return u()(n,[{key:"layers",get:function(){var e=this.layerService,t=this.controlOption.layers;if(Array.isArray(t)&&t.length){var n=[];return t.forEach((function(t){if(t instanceof Object&&(E(t)?n.push(t.layer):n.push(t)),"string"==typeof t){var r=e.getLayer(t)||e.getLayerByName(t);r&&n.push(r)}})),n}return e.getLayers()||[]}},{key:"getDefault",value:function(e){var t;return i()(i()({},h()(d()(n.prototype),"getDefault",this).call(this,e)),{},{title:"图层控制",btnIcon:(0,x.Q)("l7-icon-layer"),options:[],multiple:null===(t=null==e?void 0:e.multiple)||void 0===t||t})}},{key:"getLayerVisible",value:function(){return this.layers.filter((function(e){return e.isVisible()})).map((function(e){return e.name}))}},{key:"getLayerOptions",value:function(){var e=this,t=this.controlOption.layers,n=null==t?void 0:t.every((function(e){return e.img}));return t?null==t?void 0:t.map((function(t){if(E(t))return{text:t.name||t.layer.name,value:t.layer.name,img:n?t.img:void 0};if("string"==typeof t){var r=e.layerService.getLayer(t)||e.layerService.getLayerByName(t);return{text:null==r?void 0:r.name,value:null==r?void 0:r.name}}return{text:t.name,value:t.name}})):this.layers.map((function(e){return{text:e.name,value:e.name}}))}},{key:"setOptions",value:function(e){var t=this.checkUpdateOption(e,["layers","multiple"]);h()(d()(n.prototype),"setOptions",this).call(this,e),t&&(!1===this.controlOption.multiple&&this.handleSingleSelection(),this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"handleSingleSelection",value:function(){this.layers.forEach((function(e,t){0===t?e.show():e.hide()}))}},{key:"onAdd",value:function(){var e;return!1===this.controlOption.multiple&&this.handleSingleSelection(),null!==(e=this.controlOption.options)&&void 0!==e&&e.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),h()(d()(n.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return this.controlOption.multiple}}]),n}(n(771).Z)},8976:function(e,t,n){"use strict";n.d(t,{T:function(){return m}});var r=n(8025),i=n.n(r),o=n(1133),a=n.n(o),s=n(6413),u=n.n(s),l=n(5757),c=n.n(l),f=n(3491),h=n.n(f),p=n(2060),d=n.n(p),v=n(7193),g=n(753),m=function(e){h()(n,e);var t=d()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getDefault",value:function(){return{position:g.d.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var e=v.SO.create("div","l7-control-logo");return this.setLogoContent(e),e}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(e){u()(c()(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["img","href"])&&(v.SO.clearChildren(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(e){var t=this.controlOption,n=t.href,r=t.img,i=v.SO.create("img");if(i.setAttribute("src",r),i.setAttribute("aria-label","AntV logo"),v.SO.setUnDraggable(i),n){var o=v.SO.create("a","l7-control-logo-link");o.target="_blank",o.href=n,o.rel="noopener nofollow",o.setAttribute("rel","noopener nofollow"),o.appendChild(i),e.appendChild(o)}else e.appendChild(i)}}]),n}(g.oT)},2330:function(e,t,n){"use strict";n.d(t,{Y:function(){return C}});var r=n(3420),i=n.n(r),o=n(4450),a=n.n(o),s=n(8025),u=n.n(s),l=n(1133),c=n.n(l),f=n(1119),h=n.n(f),p=n(6413),d=n.n(p),v=n(5757),g=n.n(v),m=n(3491),y=n.n(m),_=n(2060),b=n.n(_),x=n(3769),E=n.n(x),T={normal:{text:"标准",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"月光银",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"幻影黑",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"草色青",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"雅士灰",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"涂鸦",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"马卡龙",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"极夜蓝",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"酱籽",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},A={normal:{text:"标准",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"亮",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"暗",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"卫星",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"户外",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}},S=n(8542),C=function(e){y()(n,e);var t=b()(n);function n(){var e;u()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),E()(h()(e),"onMapThemeChange",(function(){e.mapsService.setMapStyle(e.selectValue[0])})),e}return c()(n,[{key:"getDefault",value:function(e){return a()(a()({},d()(g()(n.prototype),"getDefault",this).call(this,e)),{},{title:"地图样式",btnIcon:(0,S.Q)("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var e="mapbox"===this.mapsService.getType()?A:T;return Object.entries(this.mapsService.getMapStyleConfig()).filter((function(e){var t=i()(e,2),n=t[0];return"string"==typeof t[1]&&"blank"!==n})).map((function(t){var n,r=i()(t,2),o=r[0],a=r[1],s=null!==(n=e[o])&&void 0!==n?n:{},u=s.text;return{text:null!=u?u:o,value:a,img:s.img,key:o}}))}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var e,t=this;if(null!==(e=this.controlOption.options)&&void 0!==e&&e.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var r,i,o=this.controlOption.defaultValue;this.controlOption.defaultValue=null!==(r=null===(i=this.controlOption.options.find((function(e){return e.key===o})))||void 0===i?void 0:i.value)&&void 0!==r?r:o}else{var a=this.getMapStyle();a?this.controlOption.defaultValue=a:this.mapsService.map.once("styledata",(function(){var e=t.mapsService.getMapStyle();t.controlOption.defaultValue=e,t.setSelectValue(e,!1)}))}return this.on("selectChange",this.onMapThemeChange),d()(g()(n.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),n}(n(771).Z)},5584:function(e,t,n){"use strict";n.d(t,{A:function(){return S}});var r=n(3420),i=n.n(r),o=n(4450),a=n.n(o),s=n(8025),u=n.n(s),l=n(1133),c=n.n(l),f=n(1119),h=n.n(f),p=n(6413),d=n.n(p),v=n(5757),g=n.n(v),m=n(3491),y=n.n(m),_=n(2060),b=n.n(_),x=n(3769),E=n.n(x),T=n(7033),A=n(7193),S=function(e){y()(n,e);var t=b()(n);function n(){var e;u()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),E()(h()(e),"location",[0,0]),E()(h()(e),"onMouseMove",(function(t){var n=e.location,r=t.lngLat||t.lnglat,i=e.controlOption.transform;r&&(n=[r.lng,r.lat]),e.location=n,i&&(n=i(n)),e.insertLocation2HTML(n),e.emit("locationChange",n)})),e}return c()(n,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(e){return a()(a()({},d()(g()(n.prototype),"getDefault",this).call(this,e)),{},{position:T.PositionType.BOTTOMLEFT,transform:function(e){var t=i()(e,2),n=t[0],r=t[1];return[+(+n).toFixed(6),+(+r).toFixed(6)]}})}},{key:"onAdd",value:function(){var e=A.SO.create("div","l7-control-mouse-location");return e.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),e}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(e){this.container.innerText=e.join(", ")}}]),n}(n(5773).ZP)},747:function(e,t,n){"use strict";n.d(t,{C:function(){return T}});var r=n(4450),i=n.n(r),o=n(8025),a=n.n(o),s=n(1133),u=n.n(s),l=n(1119),c=n.n(l),f=n(6413),h=n.n(f),p=n(5757),d=n.n(p),v=n(3491),g=n.n(v),m=n(2060),y=n.n(m),_=n(3769),b=n.n(_),x=n(7193),E=n(753),T=function(e){g()(n,e);var t=y()(n);function n(){var e;a()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),b()(c()(e),"mScale",void 0),b()(c()(e),"iScale",void 0),b()(c()(e),"update",(function(){var t=e.mapsService,n=e.controlOption.maxWidth,r=t.getSize()[1]/2,i=t.containerToLngLat([0,r]),o=t.containerToLngLat([n,r]),a=(0,x.yM)([i.lng,i.lat],[o.lng,o.lat]);e.updateScales(a)})),e}return u()(n,[{key:"getDefault",value:function(e){return i()(i()({},h()(d()(n.prototype),"getDefault",this).call(this,e)),{},{name:"scale",position:E.d.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var e=x.SO.create("div","l7-control-scale");this.resetScaleLines(e);var t=this.controlOption.updateWhenIdle;return this.mapsService.on(t?"moveend":"mapmove",this.update),this.mapsService.on(t?"zoomend":"zoomchange",this.update),e}},{key:"onRemove",value:function(){var e=this.controlOption.updateWhenIdle;this.mapsService.off(e?"zoomend":"zoomchange",this.update),this.mapsService.off(e?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(e){h()(d()(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(e){var t=this.controlOption,n=t.metric,r=t.imperial;n&&e&&this.updateMetric(e),r&&e&&this.updateImperial(e)}},{key:"resetScaleLines",value:function(e){x.SO.clearChildren(e);var t=this.controlOption,n=t.metric,r=t.imperial,i=t.maxWidth;t.lockWidth&&x.SO.addStyle(e,"width: ".concat(i,"px")),n&&(this.mScale=x.SO.create("div","l7-control-scale-line",e)),r&&(this.iScale=x.SO.create("div","l7-control-scale-line",e)),this.update()}},{key:"updateScale",value:function(e,t,n){var r=this.controlOption.maxWidth;e.style.width=Math.round(r*n)+"px",e.innerHTML=t}},{key:"getRoundNum",value:function(e){var t=Math.pow(10,(Math.floor(e)+"").length-1),n=e/t;return t*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)}},{key:"updateMetric",value:function(e){var t=this.getRoundNum(e),n=t<1e3?t+" m":t/1e3+" km";this.updateScale(this.mScale,n,t/e)}},{key:"updateImperial",value:function(e){var t,n,r,i=3.2808399*e;i>5280?(t=i/5280,n=this.getRoundNum(t),this.updateScale(this.iScale,n+" mi",n/t)):(r=this.getRoundNum(i),this.updateScale(this.iScale,r+" ft",r/i))}}]),n}(E.oT)},6075:function(e,t,n){"use strict";n.d(t,{o:function(){return w}});var r=n(2786),i=n.n(r),o=n(3420),a=n.n(o),s=n(4450),u=n.n(s),l=n(8025),c=n.n(l),f=n(1133),h=n.n(f),p=n(1119),d=n.n(p),v=n(6413),g=n.n(v),m=n(5757),y=n.n(m),_=n(3491),b=n.n(_),x=n(2060),E=n.n(x),T=n(3769),A=n.n(T),S=n(7033),C=n(6106),R=n(7193),w=function(e){b()(n,e);var t=E()(n);function n(){var e;c()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),A()(d()(e),"isMoving",!1),A()(d()(e),"maskLayer",void 0),A()(d()(e),"move",(function(t){switch(t.stopPropagation(),t.type){case"touchcancel":case"touchend":case"mouseup":var n;e.isMoving=!1,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach((function(t){document.removeEventListener(t,e.move)})),null===(n=e.scene)||void 0===n||n.render();break;case"mousedown":case"touchstart":e.isMoving=!0,["mouseup","mousemove","touchend","touchcancel","touchmove"].forEach((function(t){document.addEventListener(t,e.move)}));case"mousemove":case"touchmove":if(e.isMoving)if("vertical"===e.controlOption.orientation){var r;if("pageX"in t?r=t.pageX:t.touches&&t.touches.length&&t.touches[0].pageX?r=t.touches[0].pageX:t.changedTouches&&t.changedTouches.length&&(r=t.changedTouches[0].pageX),!r)break;var i=e.getContainerDOMRect(),o=e.getContainerSize(),a=o[0],s=r-((null==i?void 0:i.left)||0)+window.scrollX-document.documentElement.clientLeft,u=a-Math.min(Math.max(0,a-s),a),l=u/a;e.setOptions({ratio:l}),e.emit("moving",{size:[u,o[1]],ratio:[l,0]})}else{var c;if("pageY"in t?c=t.pageY:t.touches&&t.touches.length&&t.touches[0].pageY?c=t.touches[0].pageY:t.changedTouches&&t.changedTouches.length&&(c=t.changedTouches[0].pageY),!c)break;var f=e.getContainerDOMRect(),h=e.getContainerSize(),p=h[1],d=c-((null==f?void 0:f.top)||0)+window.scrollY-document.documentElement.clientTop,v=p-Math.min(Math.max(0,p-d),p),g=v/p;e.setOptions({ratio:g}),e.emit("moving",{size:[h[0],v],ratio:[0,g]})}}})),A()(d()(e),"getMaskLayer",(function(){return console.log(e.getMaskGeoData()),new C.Z({visible:!1}).source(e.getMaskGeoData()).shape("fill").color("red").style({opacity:.1})})),A()(d()(e),"updateMask",(function(){var t;if(e.mapsService){var n=e.getMaskGeoData();null===(t=e.maskLayer)||void 0===t||t.setData(n)}})),e}return h()(n,[{key:"getDefault",value:function(){return u()(u()({},g()(y()(n.prototype),"getDefault",this).call(this)),{},{layers:[],rightLayers:[],ratio:.5,orientation:"vertical"})}},{key:"onAdd",value:function(){var e=R.SO.create("div","l7-control-swipe");R.SO.create("button","l7-control-swipe__button",e);var t=this.controlOption,n=t.orientation,r=void 0===n?"vertical":n,i=t.ratio,o=void 0===i?.5:i;return"horizontal"===r?(e.style.top=100*o+"%",e.style.left=""):(e.style.left=100*o+"%",e.style.top=""),e.classList.add(r),e}},{key:"addTo",value:function(e){this.mapsService=e.mapService,this.renderService=e.rendererService,this.layerService=e.layerService,this.controlService=e.controlService,this.configService=e.globalConfigService,this.scene=e.sceneService,this.sceneContainer=e,this.isShow=!0,this.container=this.onAdd();var t=this.controlOption,n=t.className,r=t.style,i=t.layers,o=t.rightLayers;n&&this.setClassName(n),r&&this.setStyle(r),this.mapsService.getMarkerContainer().appendChild(this.container),this.maskLayer=this.getMaskLayer(),this.registerEvent();var a=(0,S.createLayerContainer)(e);return this.maskLayer.setContainer(a),this.scene.addLayer(this.maskLayer),this.addMaskToLayers(i,!1),this.addMaskToLayers(o,!0),this.emit("add",this),this}},{key:"onRemove",value:function(){if(this.maskLayer){var e,t=this.controlOption,n=t.layers,r=t.rightLayers;this.removeMaskFromLayers(n),this.removeMaskFromLayers(r),null===(e=this.layerService)||void 0===e||e.remove(this.maskLayer)}this.unRegisterEvent(),this.removeAllListeners()}},{key:"show",value:function(){var e,t=this.container;R.SO.removeClass(t,"l7-control-swipe_hide");var n=this.controlOption,r=n.layers,i=n.rightLayers;r.forEach((function(e){return e.enableMask()})),i.forEach((function(e){return e.enableMask()})),null===(e=this.scene)||void 0===e||e.render(),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var e,t=this.container;R.SO.addClass(t,"l7-control-swipe_hide");var n=this.controlOption,r=n.layers,i=n.rightLayers;r.forEach((function(e){return e.disableMask()})),i.forEach((function(e){return e.disableMask()})),null===(e=this.scene)||void 0===e||e.render(),this.isShow=!1,this.emit("hide",this)}},{key:"setOptions",value:function(e){var t=u()(u()({},this.controlOption),e);if(e.className&&this.setClassName(e.className),e.style&&this.setStyle(e.style),(e.orientation||void 0!==e.ratio)&&this.setOrientationAndRatio(t.orientation,t.ratio),e.layers){var n=e.layers,r=this.controlOption.layers;this.setLayers(n,r,!1)}if(e.rightLayers){var i=e.rightLayers,o=this.controlOption.rightLayers;this.setLayers(i,o,!0)}this.controlOption=t,this.updateMask()}},{key:"registerEvent",value:function(){this.container.addEventListener("mousedown",this.move),this.container.addEventListener("touchstart",this.move),this.mapsService.on("camerachange",this.updateMask)}},{key:"unRegisterEvent",value:function(){var e;this.container.removeEventListener("mousedown",this.move),this.container.removeEventListener("touchstart",this.move),null===(e=this.mapsService)||void 0===e||e.off("camerachange",this.updateMask)}},{key:"setOrientationAndRatio",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"vertical",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;this.container.classList.remove("horizontal","vertical"),this.container.classList.add(e),"horizontal"===e?(this.container.style.top=100*t+"%",this.container.style.left=""):(this.container.style.left=100*t+"%",this.container.style.top="")}},{key:"setLayers",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=e.filter((function(e){return!1===t.includes(e)})),i=t.filter((function(t){return!1===e.includes(t)}));this.addMaskToLayers(r,n),this.removeMaskFromLayers(i)}},{key:"addMaskToLayers",value:function(e,t){var n=this;e.forEach((function(e){e.updateLayerConfig({maskInside:!t}),e.addMask(n.maskLayer)}))}},{key:"removeMaskFromLayers",value:function(e){var t=this;e.forEach((function(e){e.updateLayerConfig({maskInside:!0}),e.removeMask(t.maskLayer)}))}},{key:"getMaskGeoData",value:function(){var e,t=this.controlOption,n=t.ratio,r=void 0===n?.5:n,i=t.orientation,o="vertical"===(void 0===i?"vertical":i),s=this.getBounds(),u=a()(s,2),l=u[0],c=u[1],f=a()(l,2),h=f[0],p=f[1],d=a()(c,2),v=d[0],g=d[1];if(o){var m=h+(v-h)*r;e=[[h,g],[m,g],[m,p],l,[h,g]]}else{var y=this.getContainerSize(),_=this.mapsService.containerToLngLat([y[0],y[1]*r]).lat;e=[[h,g],c,[v,_],[h,_],[h,g]]}return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[e]}}]}}},{key:"getContainerDOMRect",value:function(){var e;return null===(e=this.mapsService.getContainer())||void 0===e?void 0:e.getBoundingClientRect()}},{key:"getContainerSize",value:function(){return this.mapsService.getSize()}},{key:"getBounds",value:function(){return this.mapsService.getBounds()}},{key:"addLayer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=Array.isArray(e)?e:[e];if(t){var r,o=(r=this.controlOption.rightLayers).concat.apply(r,i()(n));this.setOptions({rightLayers:o})}else{var a,s=(a=this.controlOption.layers).concat.apply(a,i()(n));this.setOptions({layers:s})}}},{key:"removeLayer",value:function(e){var t=Array.isArray(e)?e:[e],n=this.controlOption.layers.filter((function(e){return t.includes(e)})),r=this.controlOption.rightLayers.filter((function(e){return t.includes(e)}));this.setOptions({layers:n,rightLayers:r})}},{key:"removeLayers",value:function(){this.setOptions({layers:[],rightLayers:[]})}}]),n}(n(753).oT)},8384:function(e,t,n){"use strict";n.d(t,{L:function(){return A}});var r=n(4450),i=n.n(r),o=n(8025),a=n.n(o),s=n(1133),u=n.n(s),l=n(1119),c=n.n(l),f=n(6413),h=n.n(f),p=n(5757),d=n.n(p),v=n(3491),g=n.n(v),m=n(2060),y=n.n(m),_=n(3769),b=n.n(_),x=n(7033),E=n(7193),T=n(8542),A=function(e){g()(n,e);var t=y()(n);function n(){var e;a()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),b()(c()(e),"disabled",void 0),b()(c()(e),"zoomInButton",void 0),b()(c()(e),"zoomOutButton",void 0),b()(c()(e),"zoomNumDiv",void 0),b()(c()(e),"zoomIn",(function(){!e.disabled&&e.mapsService.getZoom()<e.mapsService.getMaxZoom()&&e.mapsService.zoomIn()})),b()(c()(e),"zoomOut",(function(){!e.disabled&&e.mapsService.getZoom()>e.mapsService.getMinZoom()&&e.mapsService.zoomOut()})),b()(c()(e),"updateDisabled",(function(){var t=e.mapsService;e.zoomInButton.removeAttribute("disabled"),e.zoomOutButton.removeAttribute("disabled"),(e.disabled||t.getZoom()<=t.getMinZoom())&&e.zoomOutButton.setAttribute("disabled","true"),e.controlOption.showZoom&&e.zoomNumDiv&&(e.zoomNumDiv.innerText=String(Math.floor(t.getZoom()))),(e.disabled||t.getZoom()>=t.getMaxZoom())&&e.zoomInButton.setAttribute("disabled","true")})),e}return u()(n,[{key:"getDefault",value:function(e){return i()(i()({},h()(d()(n.prototype),"getDefault",this).call(this,e)),{},{position:x.PositionType.BOTTOMRIGHT,name:"zoom",zoomInText:(0,T.Q)("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:(0,T.Q)("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}},{key:"setOptions",value:function(e){h()(d()(n.prototype),"setOptions",this).call(this,e),this.checkUpdateOption(e,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var e=E.SO.create("div","l7-control-zoom");return this.resetButtonGroup(e),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),e}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(e){E.SO.clearChildren(e),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",e,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",e)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",e,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(e,t,n,r,i){var o=E.SO.create("button",n,r);return"string"==typeof e?o.innerHTML=e:o.append(e),o.title=t,i&&o.addEventListener("click",i),o}}]),n}(n(753).oT)},8168:function(e,t,n){"use strict";n.r(t),n.d(t,{ButtonControl:function(){return o.NA},Control:function(){return o.oT},ExportImage:function(){return a.d},Fullscreen:function(){return s.i},GeoLocate:function(){return u.v},LayerPopup:function(){return _.K},LayerSwitch:function(){return l.F},Logo:function(){return c.T},MapTheme:function(){return f.Y},Marker:function(){return r.Z},MarkerLayer:function(){return i.Z},MouseLocation:function(){return h.A},PopperControl:function(){return o.p4},Popup:function(){return b.G},PositionType:function(){return o.d},Scale:function(){return p.C},SelectControl:function(){return o.Yw},Swipe:function(){return d.o},Zoom:function(){return v.L}});var r=n(539),i=n(3119),o=(n(6325),n(753)),a=n(4940),s=n(5038),u=n(7170),l=n(2960),c=n(8976),f=n(2330),h=n(5584),p=n(747),d=n(6075),v=n(8384),g=n(2028),m={};for(var y in g)["default","ExportImage","Fullscreen","GeoLocate","LayerSwitch","Logo","MapTheme","MouseLocation","Scale","Swipe","Zoom","LayerPopup","Popup","Marker","MarkerLayer","ButtonControl","Control","PopperControl","PositionType","SelectControl"].indexOf(y)<0&&(m[y]=function(e){return g[e]}.bind(0,y));n.d(t,m);var _=n(2831),b=n(8039);!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".l7-marker-container {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n.l7-marker {\n  position: absolute !important;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  cursor: pointer;\n}\n.l7-marker-cluster {\n  width: 40px;\n  height: 40px;\n  background-color: rgba(181, 226, 140, 0.6);\n  background-clip: padding-box;\n  border-radius: 20px;\n}\n.l7-marker-cluster div {\n  width: 30px;\n  height: 30px;\n  margin-top: 5px;\n  margin-left: 5px;\n  font:\n    12px 'Helvetica Neue',\n    Arial,\n    Helvetica,\n    sans-serif;\n  text-align: center;\n  background-color: rgba(110, 204, 57, 0.6);\n  border-radius: 15px;\n}\n.l7-marker-cluster span {\n  line-height: 30px;\n}\n.l7-touch .l7-control-attribution,\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  box-shadow: none;\n}\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  background-clip: padding-box;\n  border: 2px solid rgba(0, 0, 0, 0.2);\n}\n.mapboxgl-ctrl-logo,\n.amap-logo {\n  display: none !important;\n}\n.l7-select-box {\n  border: 3px dashed gray;\n  border-radius: 2px;\n  position: absolute;\n  z-index: 999;\n  box-sizing: border-box;\n}\n.l7-control-container {\n  font:\n    12px/1.5 'Helvetica Neue',\n    Arial,\n    Helvetica,\n    sans-serif;\n}\n.l7-control-container .l7-control {\n  position: relative;\n  z-index: 999;\n  float: left;\n  clear: both;\n  color: #595959;\n  font-size: 12px;\n  pointer-events: visiblePainted;\n  /* IE 9-10 doesn't have auto */\n  pointer-events: auto;\n}\n.l7-control-container .l7-control.l7-control--hide {\n  display: none;\n}\n.l7-control-container .l7-top {\n  top: 0;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {\n  margin-top: 8px;\n}\n.l7-control-container .l7-right {\n  right: 0;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {\n  margin-right: 8px;\n}\n.l7-control-container .l7-bottom {\n  bottom: 0;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-left {\n  left: 0;\n  display: flex;\n  position: absolute;\n  z-index: 999;\n  pointer-events: none;\n}\n.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {\n  margin-left: 8px;\n}\n.l7-control-container .l7-center {\n  position: absolute;\n  display: flex;\n  justify-content: center;\n}\n.l7-control-container .l7-center.l7-top,\n.l7-control-container .l7-center.l7-bottom {\n  width: 100%;\n}\n.l7-control-container .l7-center.l7-left,\n.l7-control-container .l7-center.l7-right {\n  height: 100%;\n}\n.l7-control-container .l7-center .l7-control {\n  margin-right: 8px;\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-row {\n  flex-direction: row;\n}\n.l7-control-container .l7-row.l7-top {\n  align-items: flex-start;\n}\n.l7-control-container .l7-row.l7-bottom {\n  align-items: flex-end;\n}\n.l7-control-container .l7-column {\n  flex-direction: column;\n}\n.l7-control-container .l7-column.l7-left {\n  align-items: flex-start;\n}\n.l7-control-container .l7-column.l7-right {\n  align-items: flex-end;\n}\n.l7-button-control {\n  min-width: 28px;\n  height: 28px;\n  background-color: #fff;\n  border-width: 0;\n  border-radius: 2px;\n  outline: 0;\n  cursor: pointer;\n  transition: all 0.2s;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  padding: 0 6px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  line-height: 16px;\n}\n.l7-button-control .l7-iconfont {\n  fill: #595959;\n  color: #595959;\n  width: 16px;\n  height: 16px;\n}\n.l7-button-control.l7-button-control--row {\n  padding: 0 16px 0 13px;\n}\n.l7-button-control.l7-button-control--row * + .l7-button-control__text {\n  margin-left: 8px;\n}\n.l7-button-control.l7-button-control--column {\n  height: 44px;\n  flex-direction: column;\n}\n.l7-button-control.l7-button-control--column .l7-iconfont {\n  margin-top: 3px;\n}\n.l7-button-control.l7-button-control--column .l7-button-control__text {\n  margin-top: 3px;\n  font-size: 10px;\n  -webkit-transform: scale(0.83333);\n          transform: scale(0.83333);\n}\n.l7-button-control:not(:disabled):hover {\n  background-color: #f3f3f3;\n}\n.l7-button-control:not(:disabled):active {\n  background-color: #f3f3f3;\n}\n.l7-button-control:disabled {\n  background-color: #fafafa;\n  color: #bdbdbd;\n  cursor: not-allowed;\n}\n.l7-button-control:disabled .l7-iconfont {\n  fill: #bdbdbd;\n  color: #bdbdbd;\n}\n.l7-button-control:disabled:hover {\n  background-color: #fafafa;\n}\n.l7-button-control:disabled:active {\n  background-color: #fafafa;\n}\n.l7-popper {\n  position: absolute;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  z-index: 5;\n  color: #595959;\n}\n.l7-popper.l7-popper-hide {\n  display: none;\n}\n.l7-popper .l7-popper-content {\n  min-height: 28px;\n  background: #fff;\n  border-radius: 2px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper .l7-popper-arrow {\n  width: 0;\n  height: 0;\n  border-width: 4px;\n  border-style: solid;\n  border-top-color: transparent;\n  border-bottom-color: transparent;\n  border-left-color: transparent;\n  border-right-color: transparent;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper.l7-popper-left {\n  flex-direction: row;\n}\n.l7-popper.l7-popper-left .l7-popper-arrow {\n  border-left-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-right {\n  flex-direction: row-reverse;\n}\n.l7-popper.l7-popper-right .l7-popper-arrow {\n  border-right-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-top {\n  flex-direction: column;\n}\n.l7-popper.l7-popper-top .l7-popper-arrow {\n  border-top-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-bottom {\n  flex-direction: column-reverse;\n}\n.l7-popper.l7-popper-bottom .l7-popper-arrow {\n  border-bottom-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-start {\n  align-items: flex-start;\n}\n.l7-popper.l7-popper-end {\n  align-items: flex-end;\n}\n.l7-select-control--normal {\n  padding: 4px 0;\n}\n.l7-select-control--normal .l7-select-control-item {\n  display: flex;\n  align-items: center;\n  height: 24px;\n  padding: 0 16px;\n  font-size: 12px;\n  line-height: 24px;\n}\n.l7-select-control--normal .l7-select-control-item > * + * {\n  margin-left: 6px;\n}\n.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {\n  width: 14px;\n  height: 14px;\n}\n.l7-select-control--normal .l7-select-control-item:hover {\n  background-color: #f3f3f3;\n}\n.l7-select-control--image {\n  display: flex;\n  flex-wrap: wrap;\n  align-items: flex-start;\n  box-sizing: content-box;\n  max-width: 460px;\n  max-height: 400px;\n  margin: 12px 0 0 12px;\n  overflow-x: hidden;\n  overflow-y: auto;\n}\n.l7-select-control--image .l7-select-control-item {\n  position: relative;\n  display: flex;\n  flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);\n  flex-direction: column;\n  justify-content: center;\n  box-sizing: content-box;\n  margin-right: 12px;\n  margin-bottom: 12px;\n  overflow: hidden;\n  font-size: 12px;\n  border: 1px solid #fff;\n  border-radius: 2px;\n}\n.l7-select-control--image .l7-select-control-item img {\n  width: 100%;\n  height: 80px;\n}\n.l7-select-control--image .l7-select-control-item input[type='checkbox'] {\n  position: absolute;\n  top: 0;\n  right: 0;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  line-height: 26px;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {\n  margin-left: 8px;\n}\n.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {\n  border-color: #0370fe;\n}\n.l7-select-control-item {\n  cursor: pointer;\n}\n.l7-select-control-item input[type='checkbox'] {\n  margin: 0;\n  cursor: pointer;\n}\n.l7-select-control--multiple .l7-select-control-item:hover {\n  background-color: transparent;\n}\n.l7-control-logo {\n  width: 89px;\n  height: 16px;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.l7-control-logo img {\n  height: 100%;\n  width: 100%;\n}\n.l7-control-logo .l7-control-logo-link {\n  display: block;\n  cursor: pointer;\n}\n.l7-control-logo .l7-control-logo-link img {\n  cursor: pointer;\n}\n.l7-control-mouse-location {\n  background-color: #fff;\n  border-radius: 2px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  padding: 2px 4px;\n  min-width: 130px;\n}\n.l7-control-zoom {\n  overflow: hidden;\n  border-radius: 2px;\n  box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-control-zoom .l7-button-control {\n  font-size: 16px;\n  border-bottom: 1px solid #f0f0f0;\n  border-radius: 0;\n  box-shadow: 0 0 0;\n}\n.l7-control-zoom .l7-button-control .l7-iconfont {\n  width: 14px;\n  height: 14px;\n}\n.l7-control-zoom .l7-button-control:last-child {\n  border-bottom: 0;\n}\n.l7-control-zoom .l7-control-zoom__number {\n  color: #595959;\n  padding: 0;\n}\n.l7-control-zoom .l7-control-zoom__number:hover {\n  background-color: #fff;\n}\n.l7-control-scale {\n  display: flex;\n  flex-direction: column;\n}\n.l7-control-scale .l7-control-scale-line {\n  box-sizing: border-box;\n  padding: 2px 5px 1px;\n  overflow: hidden;\n  color: #595959;\n  font-size: 10px;\n  line-height: 1.1;\n  white-space: nowrap;\n  background: #fff;\n  border: 2px solid #000;\n  border-top: 0;\n  transition: width 0.1s;\n}\n.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {\n  margin-top: -2px;\n  border-top: 2px solid #777;\n  border-bottom: none;\n}\n.l7-right .l7-control-scale {\n  display: flex;\n  align-items: flex-end;\n}\n.l7-right .l7-control-scale .l7-control-scale-line {\n  text-align: right;\n}\n.l7-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  display: flex;\n  will-change: transform;\n  pointer-events: none;\n}\n.l7-popup.l7-popup-hide {\n  display: none;\n}\n.l7-popup .l7-popup-content {\n  position: relative;\n  padding: 16px;\n  font-size: 14px;\n  background: #fff;\n  border-radius: 3px;\n  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.l7-popup .l7-popup-content .l7-popup-content__title {\n  margin-bottom: 8px;\n  font-weight: bold;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button,\n.l7-popup .l7-popup-content .l7-popup-content__title,\n.l7-popup .l7-popup-content .l7-popup-content__panel {\n  white-space: normal;\n  -webkit-user-select: text;\n     -moz-user-select: text;\n      -ms-user-select: text;\n          user-select: text;\n  pointer-events: initial;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 18px;\n  height: 18px;\n  padding: 0;\n  font-size: 14px;\n  line-height: 18px;\n  text-align: center;\n  background-color: transparent;\n  border: 0;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n}\n.l7-popup .l7-popup-tip {\n  position: relative;\n  z-index: 1;\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n}\n.l7-popup.l7-popup-anchor-bottom,\n.l7-popup.l7-popup-anchor-bottom-left,\n.l7-popup.l7-popup-anchor-bottom-right {\n  flex-direction: column-reverse;\n}\n.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {\n  bottom: 1px;\n}\n.l7-popup.l7-popup-anchor-top,\n.l7-popup.l7-popup-anchor-top-left,\n.l7-popup.l7-popup-anchor-top-right {\n  flex-direction: column;\n}\n.l7-popup.l7-popup-anchor-top .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {\n  top: 1px;\n}\n.l7-popup.l7-popup-anchor-left {\n  flex-direction: row;\n}\n.l7-popup.l7-popup-anchor-right {\n  flex-direction: row-reverse;\n}\n.l7-popup-anchor-top .l7-popup-tip {\n  position: relative;\n  align-self: center;\n  border-top: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-tip {\n  align-self: flex-start;\n  border-top: none;\n  border-bottom-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-top-right .l7-popup-tip {\n  align-self: flex-end;\n  border-top: none;\n  border-right: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-bottom .l7-popup-tip {\n  align-self: center;\n  border-top-color: #fff;\n  border-bottom: none;\n}\n.l7-popup-anchor-bottom-left .l7-popup-tip {\n  align-self: flex-start;\n  border-top-color: #fff;\n  border-bottom: none;\n  border-left: none;\n}\n.l7-popup-anchor-bottom-right .l7-popup-tip {\n  align-self: flex-end;\n  border-top-color: #fff;\n  border-right: none;\n  border-bottom: none;\n}\n.l7-popup-anchor-left .l7-popup-tip {\n  align-self: center;\n  border-right-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-right .l7-popup-tip {\n  right: 1px;\n  align-self: center;\n  border-right: none;\n  border-left-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-content {\n  border-top-left-radius: 0;\n}\n.l7-popup-anchor-top-right .l7-popup-content {\n  border-top-right-radius: 0;\n}\n.l7-popup-anchor-bottom-left .l7-popup-content {\n  border-bottom-left-radius: 0;\n}\n.l7-popup-anchor-bottom-right .l7-popup-content {\n  border-bottom-right-radius: 0;\n}\n.l7-popup-track-pointer {\n  display: none;\n}\n.l7-popup-track-pointer * {\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  pointer-events: none;\n}\n.l7-map:hover .l7-popup-track-pointer {\n  display: flex;\n}\n.l7-map:active .l7-popup-track-pointer {\n  display: none;\n}\n.l7-layer-popup__row {\n  font-size: 12px;\n}\n.l7-layer-popup__row + .l7-layer-popup__row {\n  margin-top: 4px;\n}\n.l7-control-swipe {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  z-index: 6;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n  touch-action: none;\n}\n.l7-control-swipe_hide {\n  display: none;\n}\n.l7-control-swipe:before {\n  position: absolute;\n  top: -5000px;\n  bottom: -5000px;\n  left: 50%;\n  z-index: -1;\n  width: 4px;\n  background: #fff;\n  -webkit-transform: translate(-2px, 0);\n          transform: translate(-2px, 0);\n  content: '';\n}\n.l7-control-swipe.horizontal:before {\n  top: 50%;\n  right: -5000px;\n  bottom: auto;\n  left: -5000px;\n  width: auto;\n  height: 4px;\n}\n.l7-control-swipe__button {\n  display: block;\n  width: 28px;\n  height: 28px;\n  margin: 0;\n  padding: 0;\n  color: #595959;\n  font-weight: bold;\n  font-size: inherit;\n  text-align: center;\n  text-decoration: none;\n  background-color: #fff;\n  border: none;\n  border-radius: 2px;\n  outline: none;\n}\n.l7-control-swipe,\n.l7-control-swipe__button {\n  cursor: ew-resize;\n}\n.l7-control-swipe.horizontal,\n.l7-control-swipe.horizontal button {\n  cursor: ns-resize;\n}\n.l7-control-swipe:after,\n.l7-control-swipe__button:before,\n.l7-control-swipe__button:after {\n  position: absolute;\n  top: 25%;\n  bottom: 25%;\n  left: 50%;\n  width: 2px;\n  background: currentColor;\n  -webkit-transform: translate(-1px, 0);\n          transform: translate(-1px, 0);\n  content: '';\n}\n.l7-control-swipe__button:after {\n  -webkit-transform: translateX(4px);\n          transform: translateX(4px);\n}\n.l7-control-swipe__button:before {\n  -webkit-transform: translateX(-6px);\n          transform: translateX(-6px);\n}\n")},2028:function(){},3119:function(e,t,n){"use strict";n.d(t,{Z:function(){return T}});var r=n(4450),i=n.n(r),o=n(8025),a=n.n(o),s=n(1133),u=n.n(s),l=n(1119),c=n.n(l),f=n(3491),h=n.n(f),p=n(2060),d=n.n(p),v=n(3769),g=n.n(v),m=n(7193),y=n(3262),_=n(5947),b=n.n(_),x=n(539),E=m.rU.merge,T=function(e){h()(n,e);var t=d()(n);function n(e){var r,i;return a()(this,n),i=t.call(this),g()(c()(i),"markers",[]),g()(c()(i),"markerLayerOption",void 0),g()(c()(i),"clusterIndex",void 0),g()(c()(i),"points",[]),g()(c()(i),"clusterMarkers",[]),g()(c()(i),"mapsService",void 0),g()(c()(i),"scene",void 0),g()(c()(i),"zoom",void 0),g()(c()(i),"bbox",void 0),g()(c()(i),"inited",void 0),g()(c()(i),"containerSize",void 0),i.markerLayerOption=E(i.getDefault(),e),(0,m.Ev)(["update"],c()(i)),i.zoom=(null===(r=i.markerLayerOption.clusterOption)||void 0===r?void 0:r.zoom)||-99,i}return u()(n,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(e){return this.scene=e,this.mapsService=e.mapService,this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(this.mapsService){var e=this.mapsService.getContainer();this.containerSize={containerWidth:(null==e?void 0:e.scrollWidth)||0,containerHeight:(null==e?void 0:e.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(e){var t=this.markerLayerOption.cluster;if(e.getMarkerLayerContainerSize=this.getContainerSize.bind(this),t&&(this.addPoint(e,this.markers.length),this.mapsService)){var n=this.mapsService.getZoom(),r=this.mapsService.getBounds();this.bbox=(0,m.yA)(r,.5),this.zoom=Math.floor(n),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(e)}},{key:"removeMarker",value:function(e){this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&(this.markers.splice(t,1),this.markerLayerOption.cluster&&(this.removePoint(t),this.mapsService&&this.getClusterMarker(this.bbox,this.zoom)))}},{key:"hide",value:function(){this.markers.map((function(e){e.getElement().style.opacity="0"})),this.clusterMarkers.map((function(e){e.getElement().style.opacity="0"}))}},{key:"show",value:function(){this.markers.map((function(e){e.getElement().style.opacity="1"})),this.clusterMarkers.map((function(e){e.getElement().style.opacity="1"}))}},{key:"getMarkers",value:function(){return this.markerLayerOption.cluster?this.clusterMarkers:this.markers}},{key:"getOriginMarkers",value:function(){return this.markers}},{key:"addMarkers",value:function(){var e=this;this.getMarkers().forEach((function(t){t.addTo(e.scene)}))}},{key:"clear",value:function(){this.markers.forEach((function(e){e.remove()})),this.clusterMarkers.forEach((function(e){e.remove()})),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(e,t){var n=e.getLnglat(),r={geometry:{type:"Point",coordinates:[n.lng,n.lat]},properties:i()(i()({},e.getExtData()),{},{marker_id:t})};this.points.push(r),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"removePoint",value:function(e){var t=this.points.findIndex((function(t){return t.properties.marker_id===e}));t>-1&&this.points.splice(t,1),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(this.markerLayerOption.cluster){var e=this.markerLayerOption.clusterOption,t=e.radius,n=e.minZoom,r=void 0===n?0:n,i=e.maxZoom;this.clusterIndex=new(b())({radius:t,minZoom:r,maxZoom:i}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(e,t){var n=this,r=e[0].concat(e[1]),i=this.clusterIndex.getClusters(r,t);this.clusterMarkers.forEach((function(e){e.remove()})),this.clusterMarkers=[],i.forEach((function(e){var t,r=n.markerLayerOption.clusterOption,i=r.field,o=r.method;if(null!==(t=e.properties)&&void 0!==t&&t.cluster_id){var a,s=n.getLeaves(null===(a=e.properties)||void 0===a?void 0:a.cluster_id);if(e.properties.clusterData=s,i&&o){var u=null==s?void 0:s.map((function(e){return g()({},i,e.properties[i])})),l=m.a5.getColumn(u,i),c=m.a5.getSatByColumn(o,l),f="point_"+o;e.properties[f]=c.toFixed(2)}}var h=n.clusterMarker(e);n.clusterMarkers.push(h),h.addTo(n.scene)}))}},{key:"getLeaves",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return e?this.clusterIndex.getLeaves(e,t,n):null}},{key:"clusterMarker",value:function(e){var t=this.markerLayerOption.clusterOption.element,n=void 0===t?this.generateElement.bind(this):t;return new x.Z({element:n(e)}).setLnglat({lng:e.geometry.coordinates[0],lat:e.geometry.coordinates[1]})}},{key:"normalMarker",value:function(e){var t=e.properties.marker_id;return this.markers[t]}},{key:"update",value:function(){if(this.mapsService&&0!==this.markers.length){var e=this.mapsService.getZoom(),t=this.mapsService.getBounds();(!this.bbox||Math.abs(e-this.zoom)>=1||!(0,m.oO)(this.bbox,t))&&(this.bbox=(0,m.yA)(t,.5),this.zoom=Math.floor(e),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(e){var t=m.SO.create("div","l7-marker-cluster"),n=m.SO.create("div","",t),r=m.SO.create("span","",n),i=this.markerLayerOption.clusterOption,o=i.field,a=i.method;e.properties.point_count=e.properties.point_count||1;var s=o&&a?e.properties["point_"+a]||e.properties[o]:e.properties.point_count;return r.textContent=s,t}}]),n}(y.EventEmitter)},539:function(e,t,n){"use strict";n.d(t,{Z:function(){return _}});var r=n(4450),i=n.n(r),o=n(8025),a=n.n(o),s=n(1133),u=n.n(s),l=n(1119),c=n.n(l),f=n(3491),h=n.n(f),p=n(2060),d=n.n(p),v=n(3769),g=n.n(v),m=n(7193),y=n(3262),_=function(e){h()(n,e);var t=d()(n);function n(e){var r;return a()(this,n),r=t.call(this),g()(c()(r),"markerOption",void 0),g()(c()(r),"popup",void 0),g()(c()(r),"mapsService",void 0),g()(c()(r),"lngLat",void 0),g()(c()(r),"scene",void 0),g()(c()(r),"added",!1),g()(c()(r),"preLngLat",{lng:0,lat:0}),g()(c()(r),"onMarkerDragStart",(function(e){var t=r.mapsService.getContainer();if(t){r.mapsService.setMapStatus({dragEnable:!1,zoomEnable:!1});var n=t.getClientRects()[0],i=n.left,o=n.top,a=e.x,s=e.y;r.preLngLat=r.mapsService.containerToLngLat([a-i,s-o]),r.mapsService.on("mousemove",r.onMarkerDragMove),document.addEventListener("mouseup",r.onMarkerDragEnd),r.emit("dragstart",r.lngLat)}})),g()(c()(r),"onMarkerDragMove",(function(e){var t=e.lngLat||e.lnglat,n=r.preLngLat,i=n.lng,o=n.lat,a=t.lng,s=t.lat,u={lng:r.lngLat.lng+a-i,lat:r.lngLat.lat+s-o};r.setLnglat(u),r.preLngLat=t,r.emit("dragging",u)})),g()(c()(r),"onMarkerDragEnd",(function(){r.mapsService.setMapStatus({dragEnable:!0,zoomEnable:!0}),r.mapsService.off("mousemove",r.onMarkerDragMove),document.removeEventListener("mouseup",r.onMarkerDragEnd),r.emit("dragend",r.lngLat)})),g()(c()(r),"eventHandle",(function(e){r.polyfillEvent(e),r.emit(e.type,{target:e,data:r.markerOption.extData,lngLat:r.lngLat})})),g()(c()(r),"touchStartTime",void 0),r.markerOption=i()(i()({},r.getDefault()),e),(0,m.Ev)(["update","onMove","onMapClick","updatePositionWhenZoom"],c()(r)),r.init(),r}return u()(n,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:m.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1,overflowHide:!0}}},{key:"addTo",value:function(e){this.scene=e,this.mapsService=e.mapService;var t=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.mapsService.on("camerachange",this.update),this.update(),this.updateDraggable(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var e=this.markerOption.element;return e&&m.SO.remove(e),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(e){return this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(e){var t=this;if(!this.added)return this.once("added",(function(){t.setElement(e)})),this;var n=this.markerOption.element;return n&&m.SO.remove(n),this.markerOption.element=e,this.init(),this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.updateDraggable(),this.update(),this}},{key:"openPopup",value:function(){var e=this;if(!this.added)return this.once("added",(function(){e.openPopup()})),this;var t=this.popup;return t?(t.isOpen()||t.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var e=this;this.added||this.once("added",(function(){e.closePopup()}));var t=this.popup;return t&&t.remove(),this}},{key:"setPopup",value:function(e){return this.popup=e,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var e=this.popup;return e?(e.isOpen()?e.remove():e.addTo(this.scene),this):this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(e){this.markerOption.draggable=e,this.updateDraggable()}},{key:"getDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(e){this.markerOption.extData=e}},{key:"update",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.anchor;this.updatePosition(),m.SO.setTransform(t,"".concat(m.rQ[n]))}}},{key:"updatePositionWhenZoom",value:function(e){if(this.mapsService){var t=this.markerOption,n=t.element,r=t.offsets,i=this.lngLat,o=i.lng,a=i.lat;if(n){n.style.display="block",n.style.whiteSpace="nowrap";var s=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),u=s.containerHeight,l=s.containerWidth,c=s.bounds;if(!c)return;var f=e.map,h=e.center,p=e.zoom,d=f.DE(this.lngLat,p,h);if(d.x=Math.round(d.x+r[0]),d.y=Math.round(d.y-r[1]),Math.abs(c[0][0])>180||Math.abs(c[1][0])>180){if(d.x>l){var v=this.mapsService.lngLatToContainer([o-360,a]);d.x=v.x}if(d.x<0){var g=this.mapsService.lngLatToContainer([o+360,a]);d.x=g.x}}(d.x>l||d.x<0||d.y>u||d.y<0)&&(n.style.display="none"),n.style.left=d.x+"px",n.style.top=d.y+"px",n.style.transition="left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)"}}}},{key:"onMapClick",value:function(e){var t=this.markerOption.element;this.popup&&t&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var e=this.mapsService.getContainer();return{containerHeight:(null==e?void 0:e.scrollHeight)||0,containerWidth:(null==e?void 0:e.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updateDraggable",value:function(){var e=this.markerOption.element;null==e||e.removeEventListener("mousedown",this.onMarkerDragStart),this.mapsService.off("mousemove",this.onMarkerDragMove),document.removeEventListener("mouseup",this.onMarkerDragEnd),this.markerOption.draggable&&(null==e||e.addEventListener("mousedown",this.onMarkerDragStart))}},{key:"updatePosition",value:function(){if(this.mapsService){var e=this.markerOption,t=e.element,n=e.offsets,r=this.lngLat,i=r.lng,o=r.lat,a=this.mapsService.lngLatToContainer([i,o]);if(t){t.style.display="block",t.style.whiteSpace="nowrap";var s=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),u=s.containerHeight,l=s.containerWidth,c=s.bounds;if(!c)return;if(Math.abs(c[0][0])>180||Math.abs(c[1][0])>180){if(a.x>l){var f=this.mapsService.lngLatToContainer([i-360,o]);a.x=f.x}if(a.x<0){var h=this.mapsService.lngLatToContainer([i+360,o]);a.x=h.x}}this.markerOption.overflowHide&&(a.x>l||a.x<0||a.y>u||a.y<0)&&(t.style.display="none"),t.style.left=a.x+n[0]+"px",t.style.top=a.y-n[1]+"px"}}}},{key:"init",value:function(){var e=this,t=this.markerOption.element,n=this.markerOption,r=n.color,i=n.anchor;if(!t){t=m.SO.create("div"),this.markerOption.element=t;var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","48px"),o.setAttributeNS(null,"width","48px"),o.setAttributeNS(null,"viewBox","0 0 1024 1024");var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),a.setAttributeNS(null,"fill",r),o.appendChild(a),t.appendChild(o)}m.SO.addClass(t,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach((function(n){var r,i,o=(null===(r=e.markerOption)||void 0===r?void 0:r.style)&&(null===(i=e.markerOption)||void 0===i?void 0:i.style[n]);t&&(t.style[n]=o)})),(0,m.zi)(t,i,"marker")}},{key:"registerMarkerEvent",value:function(e){e.addEventListener("click",this.onMapClick),e.addEventListener("mousemove",this.eventHandle),e.addEventListener("click",this.eventHandle),e.addEventListener("mousedown",this.eventHandle),e.addEventListener("mouseup",this.eventHandle),e.addEventListener("dblclick",this.eventHandle),e.addEventListener("contextmenu",this.eventHandle),e.addEventListener("mouseover",this.eventHandle),e.addEventListener("mouseout",this.eventHandle),e.addEventListener("touchstart",this.eventHandle),e.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var e=this.getElement();e.removeEventListener("click",this.onMapClick),e.removeEventListener("mousemove",this.eventHandle),e.removeEventListener("click",this.eventHandle),e.removeEventListener("mousedown",this.eventHandle),e.removeEventListener("mouseup",this.eventHandle),e.removeEventListener("dblclick",this.eventHandle),e.removeEventListener("contextmenu",this.eventHandle),e.removeEventListener("mouseover",this.eventHandle),e.removeEventListener("mouseout",this.eventHandle),e.removeEventListener("touchstart",this.eventHandle),e.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(e){this.mapsService&&"amap"===this.mapsService.getType()&&((0,m.Ro)()||("touchstart"===e.type&&(this.touchStartTime=Date.now()),"touchend"===e.type&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:e,data:this.markerOption.extData,lngLat:this.lngLat})))}},{key:"addDragHandler",value:function(e){return null}},{key:"onUp",value:function(e){throw new Error("Method not implemented.")}}]),n}(y.EventEmitter)},2831:function(e,t,n){"use strict";n.d(t,{K:function(){return A}});var r=n(4450),i=n.n(r),o=n(8025),a=n.n(o),s=n(1133),u=n.n(s),l=n(1119),c=n.n(l),f=n(6413),h=n.n(f),p=n(5757),d=n.n(p),v=n(3491),g=n.n(v),m=n(2060),y=n.n(m),_=n(3769),b=n.n(_),x=n(7193),E=n(8039),T=x.rU.get,A=function(e){g()(n,e);var t=y()(n);function n(){var e;a()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),b()(c()(e),"layerClickCountByFrame",0),b()(c()(e),"layerConfigMap",new WeakMap),b()(c()(e),"displayFeatureInfo",void 0),b()(c()(e),"onLayerClick",(function(t,n){requestAnimationFrame((function(){if(e.popupOption.closeOnClick&&e.layerClickCountByFrame++,e.isShow&&e.isSameFeature(t,n.featureId))e.hide();else{var r=e.getLayerInfoFrag(t,n),i=r.title,o=r.content;e.setDOMContent(o),e.setLnglat(n.lngLat),e.setTitle(i),e.setDisplayFeatureInfo({layer:t,featureId:n.featureId}),e.show()}}))})),b()(c()(e),"onSceneClick",(function(){e.layerClickCountByFrame=0,requestAnimationFrame((function(){e.layerClickCountByFrame||e.hide()}))})),b()(c()(e),"onLayerHide",(function(){e.hide(),e.setDisplayFeatureInfo(void 0)})),b()(c()(e),"updateCloseOnClick",(function(){})),e}return u()(n,[{key:"layerConfigItems",get:function(){var e,t=this.popupOption,n=t.config,r=t.items;return null!==(e=null!=n?n:r)&&void 0!==e?e:[]}},{key:"addTo",value:function(e){return h()(d()(n.prototype),"addTo",this).call(this,e),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return h()(d()(n.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(e){this.unbindLayerEvent();var t=i()({},e),r=t.trigger||this.popupOption.trigger,o=t.items||this.popupOption.items,a=0===(null==o?void 0:o.length);t.followCursor="hover"===r&&!a;var s=this.isShow;return h()(d()(n.prototype),"setOptions",this).call(this,t),this.bindLayerEvent(),!a&&s||this.hide(),this}},{key:"getDefault",value:function(e){var t="click"!==e.trigger;return i()(i()({},h()(d()(n.prototype),"getDefault",this).call(this,e)),{},{trigger:"hover",followCursor:t,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!0,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var e=this,t=this.popupOption,n=t.trigger,r=t.closeOnClick;this.layerConfigItems.forEach((function(t){var o,a=e.getLayerByConfig(t);if(a){var s=i()({},t);if("hover"===n){var u=e.onLayerMouseMove.bind(e,a),l=e.onLayerMouseOut.bind(e,a);s.onMouseMove=u,s.onMouseOut=l,null==a||a.on("mousemove",u),null==a||a.on("mouseout",l)}else{var c,f=e.onLayerClick.bind(e,a);s.onClick=f,null==a||a.on("click",f);var h=null===(c=e.mapsService)||void 0===c?void 0:c.getMapContainer();h&&r&&h.addEventListener("click",e.onSceneClick)}var p=null==a||null===(o=a.getSource)||void 0===o?void 0:o.call(a),d=e.onSourceUpdate.bind(e);null==p||p.on("update",d),s.onSourceUpdate=d,e.layerConfigMap.set(a,s)}}))}},{key:"unbindLayerEvent",value:function(){var e=this;this.layerConfigItems.forEach((function(t){var n,r=e.getLayerByConfig(t),i=r&&e.layerConfigMap.get(r);if(i){var o,a=i.onMouseMove,s=i.onMouseOut,u=i.onClick,l=i.onSourceUpdate;if(a&&r.off("mousemove",a),s&&r.off("mouseout",s),u&&r.off("click",u),l)null==r||null===(o=r.getSource())||void 0===o||o.off("update",l);var c=null===(n=e.mapsService)||void 0===n?void 0:n.getMapContainer();c&&c.removeEventListener("click",e.onSceneClick)}}))}},{key:"onLayerMouseMove",value:function(e,t){if(!this.isSameFeature(e,t.featureId)){var n=this.getLayerInfoFrag(e,t),r=n.title,i=n.content;this.setDOMContent(i),this.setTitle(r),this.setDisplayFeatureInfo({layer:e,featureId:t.featureId}),this.show()}}},{key:"onLayerMouseOut",value:function(e,t){this.setDisplayFeatureInfo(void 0),this.isShow&&this.hide()}},{key:"onSourceUpdate",value:function(){this.hide(),this.setDisplayFeatureInfo(void 0)}},{key:"getLayerInfoFrag",value:function(e,t){var n,r=this.layerConfigMap.get(e),i=document.createDocumentFragment();if(r){var o=t.feature;"Feature"===o.type&&"properties"in o&&"geometry"in o&&(o=o.properties);var a=r.title,s=r.fields,u=r.customContent;if(a){n=document.createDocumentFragment();var l=a instanceof Function?a(o):a;x.SO.appendElementType(n,l)}if(u){var c=u instanceof Function?u(o):u;x.SO.appendElementType(i,c)}else null!=s&&s.length&&(null==s||s.forEach((function(e){var n,r,a="string"==typeof e?{field:e}:e,s=a.field,u=a.formatField,l=a.formatValue,c=a.getValue,f=x.SO.create("div","l7-layer-popup__row"),h=c?c(t.feature):T(o,s),p=null!==(n=u instanceof Function?u(s,o):u)&&void 0!==n?n:s,d=null!==(r=l instanceof Function?l(h,o):l)&&void 0!==r?r:h,v=x.SO.create("span","l7-layer-popup__key",f);x.SO.appendElementType(v,p),x.SO.appendElementType(v,document.createTextNode("："));var g=x.SO.create("span","l7-layer-popup__value",f);Array.isArray(d)&&d.every((function(e){return!(e instanceof Object)}))&&(d=d.map((function(e){return String(e)})).join(",")),x.SO.appendElementType(g,d),i.appendChild(f)})))}return{title:n,content:i}}},{key:"getLayerByConfig",value:function(e){var t=e.layer;return t instanceof Object?t:"string"==typeof t?this.layerService.getLayer(t)||this.layerService.getLayerByName(t):void 0}},{key:"isSameFeature",value:function(e,t){var n=this.displayFeatureInfo;return n&&e===n.layer&&t===n.featureId}},{key:"setDisplayFeatureInfo",value:function(e){var t=this.displayFeatureInfo;t&&t.layer.off("hide",this.onLayerHide),e&&e.layer.on("hide",this.onLayerHide),this.displayFeatureInfo=e}}]),n}(E.Z)},8039:function(e,t,n){"use strict";n.d(t,{G:function(){return b},Z:function(){return b}});var r=n(4450),i=n.n(r),o=n(8025),a=n.n(o),s=n(1133),u=n.n(s),l=n(1119),c=n.n(l),f=n(3491),h=n.n(f),p=n(2060),d=n.n(p),v=n(3769),g=n.n(v),m=n(7193),y=n(3262),_=n(8542),b=function(e){h()(n,e);var t=d()(n);function n(e){var r;a()(this,n),r=t.call(this),g()(c()(r),"popupOption",void 0),g()(c()(r),"mapsService",void 0),g()(c()(r),"sceneService",void 0),g()(c()(r),"layerService",void 0),g()(c()(r),"scene",void 0),g()(c()(r),"closeButton",void 0),g()(c()(r),"container",void 0),g()(c()(r),"content",void 0),g()(c()(r),"contentTitle",void 0),g()(c()(r),"contentPanel",void 0),g()(c()(r),"tip",void 0),g()(c()(r),"isShow",!0),g()(c()(r),"onMouseMove",(function(e){var t,n=r.mapsService.getMapContainer(),i=null!==(t=null==n?void 0:n.getBoundingClientRect())&&void 0!==t?t:{},o=i.left,a=void 0===o?0:o,s=i.top,u=void 0===s?0:s;r.setPopupPosition(e.clientX-a,e.clientY-u)})),g()(c()(r),"updateLngLatPosition",(function(){if(r.mapsService&&!r.popupOption.followCursor){var e=r.lngLat,t=e.lng,n=e.lat,i=r.mapsService.lngLatToContainer([t,n]),o=i.x,a=i.y;r.setPopupPosition(o,a)}})),g()(c()(r),"updateLngLatPositionWhenZoom",(function(e){if(r.mapsService&&!r.popupOption.followCursor){var t=e.map,n=t.getSize();n.x=n.x/2,n.y=n.y/2;var i=e.center,o=e.zoom,a=t.DE(r.lngLat,o,i);a.x=Math.round(a.x),a.y=Math.round(a.y),r.setPopupPosition(a.x,a.y,!0)}})),g()(c()(r),"onKeyDown",(function(e){27===e.keyCode&&r.remove()})),g()(c()(r),"onCloseButtonClick",(function(e){e.stopPropagation&&e.stopPropagation(),r.hide()})),g()(c()(r),"updatePosition",(function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!!r.lngLat,i=r.popupOption,o=i.className,a=i.style,s=i.maxWidth,u=i.anchor,l=i.stopPropagation;if(r.mapsService&&n&&r.content){var c=r.mapsService.getMarkerContainer();if(!r.container&&c&&(r.container=m.SO.create("div","l7-popup ".concat(null!=o?o:""," ").concat(r.isShow?"":"l7-popup-hide"),c),a&&r.container.setAttribute("style",a),r.tip=m.SO.create("div","l7-popup-tip",r.container),r.container.appendChild(r.content),l&&["mousemove","mousedown","mouseup","click","dblclick"].forEach((function(e){r.container.addEventListener(e,(function(e){e.stopPropagation()}))})),r.container.style.whiteSpace="nowrap"),t?r.updateLngLatPositionWhenZoom(e):r.updateLngLatPosition(),m.SO.setTransform(r.container,"".concat(m.rQ[u])),(0,m.zi)(r.container,u,"popup"),s){var f=r.container.getBoundingClientRect(),h=f.width;h>parseFloat(s)&&(r.container.style.width=s)}else r.container.style.removeProperty("width")}})),g()(c()(r),"updateWhenZoom",(function(e){r.updatePosition(e,!0)})),g()(c()(r),"update",(function(){r.updatePosition(null,!1)})),r.popupOption=i()(i()({},r.getDefault(null!=e?e:{})),e);var o=r.popupOption.lngLat;return o&&(r.lngLat=o),r}return u()(n,[{key:"lngLat",get:function(){var e;return null!==(e=this.popupOption.lngLat)&&void 0!==e?e:{lng:0,lat:0}},set:function(e){this.popupOption.lngLat=e}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(e){this.mapsService=e.mapService,this.sceneService=e.sceneService,this.layerService=e.layerService,this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=e,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var t=this.popupOption,n=t.html,r=t.text,i=t.title;return n?this.setHTML(n):r&&this.setText(r),i&&this.setTitle(i),this.emit("open"),this}},{key:"remove",value:function(){if(null!=this&&this.isOpen())return this.content&&m.SO.remove(this.content),this.container&&(m.SO.remove(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(e){this.show();var t,n,r=this.popupOption.className;(this.popupOption=i()(i()({},this.popupOption),e),this.checkUpdateOption(e,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","lngLat","offsets"])&&(this.container&&(m.SO.remove(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(e,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(e,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(e,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(e,["html"])&&e.html?this.setHTML(e.html):this.checkUpdateOption(e,["text"])&&e.text&&this.setText(e.text),this.checkUpdateOption(e,["className"]))&&(r&&this.container.classList.remove(null!=r?r:""),this.container.classList.add(null!==(t=e.className)&&void 0!==t?t:""));this.checkUpdateOption(e,["style"])&&m.SO.addStyle(this.container,null!==(n=e.style)&&void 0!==n?n:"");return this.checkUpdateOption(e,["lngLat"])&&e.lngLat&&this.setLnglat(e.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&m.SO.removeClass(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(this.isShow)return this.container&&m.SO.addClass(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(e){return this.popupOption.html=e,this.setDOMContent(e)}},{key:"setText",value:function(e){return this.popupOption.text=e,this.setDOMContent(window.document.createTextNode(e))}},{key:"setTitle",value:function(e){this.show(),this.popupOption.title=e,e?(this.contentTitle||(this.contentTitle=m.SO.create("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),m.SO.clearChildren(this.contentTitle),m.SO.appendElementType(this.contentTitle,e)):this.contentTitle&&(m.SO.remove(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var e=this.lngLat,t=e.lng,n=e.lat;return this.popupOption.autoPan&&this.mapsService.panTo([t,n]),this}},{key:"setLngLat",value:function(e){return this.setLnglat(e)}},{key:"setLnglat",value:function(e){var t=this;return this.show(),this.lngLat=e,Array.isArray(e)&&(this.lngLat={lng:e[0],lat:e[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout((function(){t.panToPopup()}),0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(e){return this.popupOption.maxWidth=e,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(e){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:m.bV.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(e){return this.show(),this.createContent(),m.SO.appendElementType(this.contentPanel,e),this.update(),this}},{key:"updateCloseOnClick",value:function(e){var t=this,n=this.mapsService;n&&(null==n||n.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!e&&requestAnimationFrame((function(){null==n||n.on("click",t.onCloseButtonClick)})))}},{key:"updateCloseOnEsc",value:function(e){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!e&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(e){var t,n=null===(t=this.mapsService)||void 0===t?void 0:t.getContainer();n&&(null==n||n.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!e&&(null==n||n.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var e=this;if(this.content&&m.SO.remove(this.content),this.contentTitle=void 0,this.content=m.SO.create("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var t=(0,_.Q)("l7-icon-guanbi");m.SO.addClass(t,"l7-popup-close-button"),this.content.appendChild(t),this.popupOption.closeButtonOffsets&&(t.style.right=this.popupOption.closeButtonOffsets[0]+"px",t.style.top=this.popupOption.closeButtonOffsets[1]+"px"),t.setAttribute("aria-label","Close popup"),t.addEventListener("click",(function(){e.hide()})),t.addEventListener("pointerup",(function(e){e.stopPropagation()})),t.addEventListener("pointerdown",(function(e){e.stopPropagation()})),this.closeButton=t}else this.closeButton=void 0;this.contentPanel=m.SO.create("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.container){var r=this.popupOption.offsets;this.container.style.left=e+r[0]+"px",this.container.style.top=t-r[1]+"px",this.container.style.transition=n?"left 0.25s cubic-bezier(0,0,0.25,1), top 0.25s cubic-bezier(0,0,0.25,1)":""}}},{key:"checkUpdateOption",value:function(e,t){return t.some((function(t){return t in e}))}}]),n}(y.EventEmitter)},8542:function(e,t,n){"use strict";n.d(t,{Q:function(){return r}});var r=function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(e)),t.appendChild(n),t}},7033:function(e,t,n){"use strict";n.r(t),n.d(t,{AttributeType:function(){return x.GC},BasePostProcessingPass:function(){return r.Z},BlendType:function(){return b.h0},CameraUniform:function(){return f.l},CoordinateSystem:function(){return g.l},CoordinateUniform:function(){return g.k},IDebugLog:function(){return m.O},ILayerStage:function(){return b.KD},InteractionEvent:function(){return y.s},MapServiceEvent:function(){return E.I},MaskOperation:function(){return b.lE},PassType:function(){return k.G},PositionType:function(){return h.d},RasterTileType:function(){return D.n},ScaleTypes:function(){return x.vY},SceneEventList:function(){return N.P},StencilType:function(){return b.yn},StyleScaleType:function(){return x.ee},TextureUsage:function(){return I.v},createLayerContainer:function(){return A.e7},createSceneContainer:function(){return A.Hp},gl:function(){return T.gl},globalConfigService:function(){return A.cO},packCircleVertex:function(){return o.wL},removeDuplicateUniforms:function(){return i.Vb}});var r=n(1008),i=n(8521),o=n(7747),a=n(7702),s={};for(var u in a)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms"].indexOf(u)<0&&(s[u]=function(e){return a[e]}.bind(0,u));n.d(t,s);var l=n(2011);s={};for(var u in l)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms"].indexOf(u)<0&&(s[u]=function(e){return l[e]}.bind(0,u));n.d(t,s);var c=n(2539);s={};for(var u in c)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms"].indexOf(u)<0&&(s[u]=function(e){return c[e]}.bind(0,u));n.d(t,s);var f=n(3223),h=n(4373),p=n(8346);s={};for(var u in p)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType"].indexOf(u)<0&&(s[u]=function(e){return p[e]}.bind(0,u));n.d(t,s);var d=n(663);s={};for(var u in d)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType"].indexOf(u)<0&&(s[u]=function(e){return d[e]}.bind(0,u));n.d(t,s);var v=n(7626);s={};for(var u in v)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType"].indexOf(u)<0&&(s[u]=function(e){return v[e]}.bind(0,u));n.d(t,s);var g=n(409),m=n(5315),y=n(6571),_=n(5090);s={};for(var u in _)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent"].indexOf(u)<0&&(s[u]=function(e){return _[e]}.bind(0,u));n.d(t,s);var b=n(8186),x=n(689),E=n(3113),T=n(901),A=n(5375),S=n(4599);s={};for(var u in S)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent","BlendType","ILayerStage","MaskOperation","StencilType","AttributeType","ScaleTypes","StyleScaleType","MapServiceEvent","gl","createLayerContainer","createSceneContainer","globalConfigService"].indexOf(u)<0&&(s[u]=function(e){return S[e]}.bind(0,u));n.d(t,s);var C=n(7092);s={};for(var u in C)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent","BlendType","ILayerStage","MaskOperation","StencilType","AttributeType","ScaleTypes","StyleScaleType","MapServiceEvent","gl","createLayerContainer","createSceneContainer","globalConfigService"].indexOf(u)<0&&(s[u]=function(e){return C[e]}.bind(0,u));n.d(t,s);var R=n(3594);s={};for(var u in R)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent","BlendType","ILayerStage","MaskOperation","StencilType","AttributeType","ScaleTypes","StyleScaleType","MapServiceEvent","gl","createLayerContainer","createSceneContainer","globalConfigService"].indexOf(u)<0&&(s[u]=function(e){return R[e]}.bind(0,u));n.d(t,s);var w=n(2875);s={};for(var u in w)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent","BlendType","ILayerStage","MaskOperation","StencilType","AttributeType","ScaleTypes","StyleScaleType","MapServiceEvent","gl","createLayerContainer","createSceneContainer","globalConfigService"].indexOf(u)<0&&(s[u]=function(e){return w[e]}.bind(0,u));n.d(t,s);var M=n(6483);s={};for(var u in M)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent","BlendType","ILayerStage","MaskOperation","StencilType","AttributeType","ScaleTypes","StyleScaleType","MapServiceEvent","gl","createLayerContainer","createSceneContainer","globalConfigService"].indexOf(u)<0&&(s[u]=function(e){return M[e]}.bind(0,u));n.d(t,s);var k=n(8188),L=n(7301);s={};for(var u in L)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent","BlendType","ILayerStage","MaskOperation","StencilType","AttributeType","ScaleTypes","StyleScaleType","MapServiceEvent","gl","createLayerContainer","createSceneContainer","globalConfigService","PassType"].indexOf(u)<0&&(s[u]=function(e){return L[e]}.bind(0,u));n.d(t,s);var O=n(1795);s={};for(var u in O)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent","BlendType","ILayerStage","MaskOperation","StencilType","AttributeType","ScaleTypes","StyleScaleType","MapServiceEvent","gl","createLayerContainer","createSceneContainer","globalConfigService","PassType"].indexOf(u)<0&&(s[u]=function(e){return O[e]}.bind(0,u));n.d(t,s);var I=n(4),P=n(6306);s={};for(var u in P)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent","BlendType","ILayerStage","MaskOperation","StencilType","AttributeType","ScaleTypes","StyleScaleType","MapServiceEvent","gl","createLayerContainer","createSceneContainer","globalConfigService","PassType","TextureUsage"].indexOf(u)<0&&(s[u]=function(e){return P[e]}.bind(0,u));n.d(t,s);var N=n(8420),B=n(4892);s={};for(var u in B)["default","BasePostProcessingPass","packCircleVertex","removeDuplicateUniforms","CameraUniform","PositionType","CoordinateSystem","CoordinateUniform","IDebugLog","InteractionEvent","BlendType","ILayerStage","MaskOperation","StencilType","AttributeType","ScaleTypes","StyleScaleType","MapServiceEvent","gl","createLayerContainer","createSceneContainer","globalConfigService","PassType","TextureUsage","SceneEventList"].indexOf(u)<0&&(s[u]=function(e){return B[e]}.bind(0,u));n.d(t,s);var D=n(3954)},5375:function(e,t,n){"use strict";n.d(t,{e7:function(){return mt},Hp:function(){return gt},cO:function(){return dt}});var r=n(4450),i=n.n(r),o=n(2729),a=n.n(o),s=n(8025),u=n.n(s),l=n(1133),c=n.n(l),f=n(1119),h=n.n(f),p=n(3491),d=n.n(p),v=n(2060),g=n.n(v),m=n(3769),y=n.n(m),_=n(7193),b=n(1786),x=n.n(b),E=n(3262),T=n.n(E);function A(e,t,n){var r,o=a()(t);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=s.icon,l=s.xOffset;e[u.id]=i()(i()({},u),{},{x:l,y:n,image:u.image,width:u.width,height:u.height})}}catch(e){o.e(e)}finally{o.f()}}function S(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var C=function(){for(var e=[],t=32;t<128;t++)e.push(String.fromCharCode(t));return e}();function R(e,t,n,r){e.font="".concat(r," ").concat(n,"px ").concat(t),e.fillStyle="black",e.textBaseline="middle"}function w(e,t){for(var n=0;n<e.length;n++)t.data[4*n+3]=e[n]}var M=function(e){d()(n,e);var t=g()(n);function n(){var e;u()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),y()(h()(e),"fontAtlas",void 0),y()(h()(e),"iconFontMap",void 0),y()(h()(e),"iconFontGlyphs",{}),y()(h()(e),"fontOptions",void 0),y()(h()(e),"key",void 0),y()(h()(e),"cache",new _.z6(3)),e}return c()(n,[{key:"scale",get:function(){return 1}},{key:"canvas",get:function(){var e=this.cache.get(this.key);return e&&e.data}},{key:"mapping",get:function(){var e=this.cache.get(this.key);return e&&e.mapping||{}}},{key:"getCanvasByKey",value:function(e){var t=this.cache.get(e);return t&&t.data}},{key:"getMappingByKey",value:function(e){var t=this.cache.get(e);return t&&t.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:"sans-serif",fontWeight:"normal",characterSet:C,fontSize:24,buffer:3,sdf:!0,cutoff:.25,radius:8,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(e){var t=this;e.forEach((function(e){t.iconFontGlyphs[e.name]=e.unicode}))}},{key:"addIconFont",value:function(e,t){this.iconFontMap.set(e,t)}},{key:"getIconFontKey",value:function(e){return this.iconFontMap.get(e)||e}},{key:"getGlyph",value:function(e){return this.iconFontGlyphs[e]?String.fromCharCode(parseInt(this.iconFontGlyphs[e],16)):""}},{key:"setFontOptions",value:function(e){this.fontOptions=i()(i()({},this.fontOptions),e),this.key=this.getKey();var t=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(!n||0!==t.length){var r=this.generateFontAtlas(this.key,t,n);this.fontAtlas=r,this.cache.set(this.key,r)}}},{key:"addFontFace",value:function(e,t){var n=this,r=document.createElement("style");r.type="text/css",r.innerText="\n        @font-face{\n            font-family: '".concat(e,"';\n            src: url('").concat(t,"') format('woff2'),\n            url('").concat(t,"') format('woff'),\n            url('").concat(t,"') format('truetype');\n        }"),r.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(e),"L7text"),document.fonts.ready.then((function(){n.emit("fontloaded",{fontFamily:e})}))}catch(e){console.warn("当前环境不支持 document.fonts !"),console.warn("当前环境不支持 iconfont !"),console.warn(e)}},document.getElementsByTagName("head")[0].appendChild(r)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(e,t,n){var r=this.fontOptions,o=r.fontFamily,s=r.fontWeight,u=r.fontSize,l=r.buffer,c=r.sdf,f=r.radius,h=r.cutoff,p=r.iconfont,d=n&&n.data;d||((d=window.document.createElement("canvas")).width=1024);var v=d.getContext("2d",{willReadFrequently:!0});R(v,o,u,s);var g=function(e){var t=e.characterSet,n=e.getFontWidth,r=e.fontHeight,i=e.buffer,o=e.maxCanvasWidth,a=e.mapping,s=void 0===a?{}:a,u=e.xOffset,l=void 0===u?0:u,c=e.yOffset,f=void 0===c?0:c,h=0,p=l;Array.from(t).forEach((function(e,t){if(!s[e]){var r=n(e,t);p+30>o&&(p=0,h++),s[e]={x:p,y:f+30*h,width:30,height:30,advance:r},p+=30}}));var d=r+2*i;return{mapping:s,xOffset:p,yOffset:f+h*d,canvasHeight:S(f+(h+1)*d)}}(i()({getFontWidth:function(e){return v.measureText(e).width},fontHeight:1*u,buffer:l,characterSet:t,maxCanvasWidth:1024},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),m=g.mapping,y=g.canvasHeight,_=g.xOffset,b=g.yOffset,E=v.getImageData(0,0,d.width,d.height);if(d.height=y,v.putImageData(E,0,0),R(v,o,u,s),c){var T,A=new(x())(u,l,f,h,o,s),C=v.getImageData(0,0,A.size,A.size),M=a()(t);try{for(M.s();!(T=M.n()).done;){var k=T.value;if(p){var L=String.fromCharCode(parseInt(k.replace("&#x","").replace(";",""),16));w(A.draw(L),C)}else w(A.draw(k),C);v.putImageData(C,m[k].x,m[k].y)}}catch(e){M.e(e)}finally{M.f()}}else{var O,I=a()(t);try{for(I.s();!(O=I.n()).done;){var P=O.value;v.fillText(P,m[P].x,m[P].y+1*u)}}catch(e){I.e(e)}finally{I.f()}}return{xOffset:_,yOffset:b,mapping:m,data:d,width:d.width,height:d.height}}},{key:"getKey",value:function(){var e=this.fontOptions,t=e.fontFamily,n=e.fontWeight;return"".concat(t,"_").concat(n)}},{key:"getNewChars",value:function(e,t){var n=this.cache.get(e);if(!n)return t;var r=[],i=n.mapping,o=new Set(Object.keys(i));return new Set(t).forEach((function(e){o.has(e)||r.push(e)})),r}}]),n}(E.EventEmitter),k=n(6502),L=n.n(k),O=n(4351),I=n.n(O),P=function(e){d()(r,e);var t,n=g()(r);function r(){var e;u()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),y()(h()(e),"canvasHeight",128),y()(h()(e),"texture",void 0),y()(h()(e),"canvas",void 0),y()(h()(e),"iconData",void 0),y()(h()(e),"iconMap",void 0),y()(h()(e),"ctx",void 0),y()(h()(e),"loadingImageCount",0),e}return c()(r,[{key:"isLoading",value:function(){return 0===this.loadingImageCount}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:(t=I()(L()().mark((function e(t,n){var r,i;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Image,this.loadingImageCount++,this.hasImage(t)?console.warn("Image Id already exists"):this.iconData.push({id:t,size:64}),this.updateIconMap(),e.next=6,this.loadImage(n);case 6:r=e.sent,(i=this.iconData.find((function(e){return e.id===t})))&&(i.image=r,i.width=r.width,i.height=r.height),this.update();case 10:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"addImageMini",value:function(e,t,n){var r=this,i=n.getSceneConfig().canvas,o=i.createImage();if(this.loadingImageCount++,this.hasImage(e))throw new Error("Image Id already exists");this.iconData.push({id:e,size:64}),this.updateIconMap(),this.loadImageMini(t,i).then((function(t){o=t;var n=r.iconData.find((function(t){return t.id===e}));n&&(n.image=o,n.width=o.width,n.height=o.height),r.update()}))}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(e){return this.iconMap.hasOwnProperty(e)}},{key:"removeImage",value:function(e){this.hasImage(e)&&(this.iconData=this.iconData.filter((function(t){return t.id!==e})),delete this.iconMap[e],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(e){return new Promise((function(t,n){if(e instanceof HTMLImageElement)t(e);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t(r)},r.onerror=function(){n(new Error("Could not load image at "+e))},r.src=e instanceof File?URL.createObjectURL(e):e}}))}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,0===this.loadingImageCount&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var e=this;this.canvas.width=1024,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach((function(t){var n=e.iconMap[t],r=n.x,i=n.y,o=n.image,a=n.width,s=void 0===a?64:a,u=n.height,l=void 0===u?64:u,c=Math.max(s,l)/64,f=l/c,h=s/c;o&&e.ctx.drawImage(o,r+(64-h)/2,i+(64-f)/2,h,f)}))}},{key:"updateIconMap",value:function(){var e=function(e,t,n){var r,i=0,o=0,s=0,u=[],l={},c=a()(e);try{for(c.s();!(r=c.n()).done;){var f=r.value;if(!l[f.id]){var h=f.size;i+h+t>n&&(A(l,u,o),i=0,o=s+o+t,s=0,u=[]),u.push({icon:f,xOffset:i}),i=i+h+t,s=Math.max(s,h)}}}catch(e){c.e(e)}finally{c.f()}return u.length>0&&A(l,u,o),{mapping:l,canvasHeight:S(s+o+t)}}(this.iconData,3,1024),t=e.mapping,n=e.canvasHeight;this.iconMap=t,this.canvasHeight=n}},{key:"loadImageMini",value:function(e,t){return new Promise((function(n,r){var i=t.createImage();i.crossOrigin="anonymous",i.onload=function(){n(i)},i.onerror=function(){r(new Error("Could not load image at "+e))},i.src=e}))}}]),r}(E.EventEmitter),N=n(3420),B=n.n(N),D=n(7703),U=function(){function e(){u()(this,e),y()(this,"viewport",void 0),y()(this,"overridedViewProjectionMatrix",void 0),y()(this,"viewMatrixInverse",void 0),y()(this,"cameraPosition",void 0)}return c()(e,[{key:"init",value:function(){}},{key:"update",value:function(e){this.viewport=e,this.viewMatrixInverse=D.create(),D.invert(this.viewMatrixInverse,e.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var e=this.viewport.getCenter(),t=B()(e,2);return[t[0],t[1]]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}},{key:"setViewProjectionMatrix",value:function(e){this.overridedViewProjectionMatrix=e}}]),e}(),F=n(2786),z=n.n(F),G=n(4373),V={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},j=function(){function e(){u()(this,e),y()(this,"container",void 0),y()(this,"controlCorners",void 0),y()(this,"controlContainer",void 0),y()(this,"scene",void 0),y()(this,"mapsService",void 0),y()(this,"controls",[]),y()(this,"unAddControls",[])}return c()(e,[{key:"init",value:function(e,t){this.container=e.container,this.scene=t,this.mapsService=t.mapService,this.initControlPos()}},{key:"addControl",value:function(e,t){t.mapService.map?(e.addTo(this.scene),this.controls.push(e)):this.unAddControls.push(e)}},{key:"getControlByName",value:function(e){return this.controls.find((function(t){return t.controlOption.name===e}))}},{key:"removeControl",value:function(e){var t=this.controls.indexOf(e);return t>-1&&this.controls.splice(t,1),e.remove(),this}},{key:"addControls",value:function(){var e=this;this.unAddControls.forEach((function(t){t.addTo(e.scene),e.controls.push(t)})),this.unAddControls=[]}},{key:"destroy",value:function(){var e,t=a()(this.controls);try{for(t.s();!(e=t.n()).done;){e.value.remove()}}catch(e){t.e(e)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var e=this.controlCorners={},t="l7-",n=this.controlContainer=_.SO.create("div",t+"control-container",this.container);Object.values(G.d).forEach((function(r){var i,o;!function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=r.map((function(e){return t+e})).join(" ");e[r.filter((function(e){return!["row","column"].includes(e)})).join("")]=_.SO.create("div",i,n)}((i=r,o=i.replace(/^(top|bottom|left|right|center)/,"$1-").split("-"),[].concat(z()(o),[V[i]])))})),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var e in this.controlCorners)this.controlCorners[e]&&_.SO.remove(this.controlCorners[e]);this.controlContainer&&_.SO.remove(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var e=this,t=window.MutationObserver;if(t)for(var n=function(){var n=i[r].match(/^(top|bottom)(left|right)$/);if(n){var o=B()(n,3),a=o[1],s=o[2],u=e.controlCorners["".concat(a).concat(s)];new t((function(e){var t=B()(e,1)[0].target;u&&(u.style[a]=t.clientHeight+"px")})).observe(e.controlCorners["".concat(s).concat(a)],{childList:!0,attributes:!0})}},r=0,i=Object.keys(this.controlCorners);r<i.length;r++)n()}}]),e}(),H=function(){function e(){u()(this,e),y()(this,"container",void 0),y()(this,"scene",void 0),y()(this,"mapsService",void 0),y()(this,"markers",[]),y()(this,"markerLayers",[]),y()(this,"unAddMarkers",[]),y()(this,"unAddMarkerLayers",[])}return c()(e,[{key:"addMarkerLayer",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(e),e.addTo(this.scene)):this.unAddMarkerLayers.push(e)}},{key:"removeMarkerLayer",value:function(e){e.destroy(),this.markerLayers.indexOf(e);var t=this.markerLayers.indexOf(e);t>-1&&this.markerLayers.splice(t,1)}},{key:"addMarker",value:function(e){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(e),e.addTo(this.scene)):this.unAddMarkers.push(e)}},{key:"addMarkers",value:function(){var e=this;this.unAddMarkers.forEach((function(t){t.addTo(e.scene),e.markers.push(t)})),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var e=this;this.unAddMarkerLayers.forEach((function(t){e.markerLayers.push(t),t.addTo(e.scene)})),this.unAddMarkers=[]}},{key:"removeMarker",value:function(e){e.remove(),this.markers.indexOf(e);var t=this.markers.indexOf(e);t>-1&&this.markers.splice(t,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.mapService}},{key:"destroy",value:function(){this.markers.forEach((function(e){e.remove()})),this.markers=[],this.markerLayers.forEach((function(e){e.destroy()})),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(e){e.destroy()}}]),e}(),W=function(){function e(){u()(this,e),y()(this,"scene",void 0),y()(this,"mapsService",void 0),y()(this,"popups",[]),y()(this,"unAddPopups",[])}return c()(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(e){null!=e&&e.isOpen()&&e.remove();var t=this.popups.indexOf(e);t>-1&&this.popups.splice(t,1);var n=this.unAddPopups.indexOf(e);n>-1&&this.unAddPopups.splice(n,1)}},{key:"destroy",value:function(){this.popups.forEach((function(e){return e.remove()}))}},{key:"addPopup",value:function(e){var t=this;e&&e.getOptions().autoClose&&[].concat(z()(this.popups),z()(this.unAddPopups)).forEach((function(e){e.getOptions().autoClose&&t.removePopup(e)})),this.isMarkerReady?(e.addTo(this.scene),this.popups.push(e)):this.unAddPopups.push(e),e.on("close",(function(){t.removePopup(e)}))}},{key:"initPopup",value:function(){var e=this;this.unAddPopups.length&&this.unAddPopups.forEach((function(t){e.addPopup(t),e.unAddPopups=[]}))}},{key:"init",value:function(e){this.scene=e,this.mapsService=e.mapService}}]),e}(),X=n(8186),Z={MapToken:"您正在使用 Demo 测试 Token, 生产环境务必自行注册 Token 确保服务稳定 高德地图申请地址 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox地图申请地址 https://docs.mapbox.com/help/glossary/access-token/",SDK:"请确认引入了mapbox-gl api且在L7之前引入"},Y=_.rU.merge,q={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},K={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:X.lE.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Q=function(){function e(){u()(this,e),y()(this,"sceneConfigCache",{}),y()(this,"layerConfigCache",{}),y()(this,"layerAttributeConfigCache",{})}return c()(e,[{key:"getSceneConfig",value:function(e){return this.sceneConfigCache[e]}},{key:"getSceneWarninfo",value:function(e){return Z[e]}},{key:"setSceneConfig",value:function(e,t){this.sceneConfigCache[e]=i()(i()({},q),t)}},{key:"getLayerConfig",value:function(e){return this.layerConfigCache[e]}},{key:"setLayerConfig",value:function(e,t,n){this.layerConfigCache[t]=i()({},Y({},this.sceneConfigCache[e],K,n))}},{key:"getAttributeConfig",value:function(e){return this.layerAttributeConfigCache[e]}},{key:"setAttributeConfig",value:function(e,t){this.layerAttributeConfigCache[e]=i()(i()({},this.layerAttributeConfigCache[e]),t)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}(),$=n(8942),J=Math.PI/180,ee=4003e4;function te(e){var t=e.latitude,n=void 0===t?0:t,r=e.zoom,i=void 0===r?0:r,o=e.scale,a=e.highPrecision,s=void 0!==a&&a,u=e.flipY,l=void 0!==u&&u,c={},f=512*(o=void 0!==o?o:Math.pow(2,i)),h=Math.cos(n*J),p=f/360,d=p/h,v=f/ee/h;if(c.pixelsPerMeter=[v,-v,v],c.metersPerPixel=[1/v,-1/v,1/v],c.pixelsPerDegree=[p,-d,v],c.degreesPerPixel=[1/p,-1/d,1/v],s){var g=J*Math.tan(n*J)/h,m=p*g/2,y=f/ee*g,_=y/d*v;c.pixelsPerDegree2=[0,-m,y],c.pixelsPerMeter2=[_,0,_],l&&(c.pixelsPerDegree2[1]=-c.pixelsPerDegree2[1],c.pixelsPerMeter2[1]=-c.pixelsPerMeter2[1])}return l&&(c.pixelsPerMeter[1]=-c.pixelsPerMeter[1],c.metersPerPixel[1]=-c.metersPerPixel[1],c.pixelsPerDegree[1]=-c.pixelsPerDegree[1],c.degreesPerPixel[1]=-c.degreesPerPixel[1]),c}var ne=n(409),re=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ie=function(){function e(t){u()(this,e),y()(this,"needRefresh",!0),y()(this,"coordinateSystem",void 0),y()(this,"viewportCenter",void 0),y()(this,"viewportCenterProjection",void 0),y()(this,"pixelsPerDegree",void 0),y()(this,"pixelsPerDegree2",void 0),y()(this,"pixelsPerMeter",void 0),this.cameraService=t}return c()(e,[{key:"refresh",value:function(e){var t=this.cameraService.getZoom(),n=e||this.cameraService.getCenter(),r=te({latitude:n[1],zoom:t}),i=r.pixelsPerMeter,o=r.pixelsPerDegree;this.viewportCenter=n,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=i,this.pixelsPerDegree=o,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===ne.l.LNGLAT?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===ne.l.LNGLAT_OFFSET&&this.calculateLnglatOffset(n,t),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(e){this.coordinateSystem=e}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(e,t,n,r){var i=te({latitude:e[1],zoom:t,scale:n,flipY:r,highPrecision:!0}),o=i.pixelsPerMeter,a=i.pixelsPerDegree,s=i.pixelsPerDegree2,u=this.cameraService.getViewMatrix(),l=this.cameraService.getProjectionMatrix(),c=D.multiply([],l,u),f=this.cameraService.projectFlat([Math.fround(e[0]),Math.fround(e[1])],Math.pow(2,t));this.viewportCenterProjection=$.fF([],[f[0],f[1],0,1],c),u=this.cameraService.getViewMatrixUncentered()||u,c=D.multiply([],l,u),c=D.multiply([],c,re),this.cameraService.setViewProjectionMatrix(c),this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=s}}]),e}(),oe=n(5116),ae=n.n(oe),se=function(e){d()(n,e);var t=g()(n);function n(){var e;u()(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return e=t.call.apply(t,[this].concat(i)),y()(h()(e),"renderMap",new Map),y()(h()(e),"enable",!1),y()(h()(e),"renderEnable",!1),y()(h()(e),"cacheLogs",{}),e}return c()(n,[{key:"setEnable",value:function(e){this.enable=!!e}},{key:"log",value:function(e,t){var n=this;if(this.enable){var r=e.split("."),o=null;r.forEach((function(e,a){null!==o?(o[e]||(o[e]={}),a!==r.length-1&&(o=o[e])):(n.cacheLogs[e]||(n.cacheLogs[e]={}),a!==r.length-1&&(o=n.cacheLogs[e])),a===r.length-1&&(o[e]=i()(i()({time:Date.now()},o[e]),t))}))}}},{key:"getLog",value:function(e){var t=this;switch(ae()(e)){case"string":return this.cacheLogs[e];case"object":return e.map((function(e){return t.cacheLogs[e]})).filter((function(e){return void 0!==e}));case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(e){delete this.cacheLogs[e]}},{key:"generateRenderUid",value:function(){return this.renderEnable?(0,_.M8)():""}},{key:"renderDebug",value:function(e){this.renderEnable=e}},{key:"renderStart",value:function(e){if(this.renderEnable&&this.enable){var t=this.renderMap.get(e)||{};this.renderMap.set(e,i()(i()({},t),{},{renderUid:e,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(e){if(this.renderEnable&&this.enable){var t=this.renderMap.get(e);if(t){var n=t.renderStart,r=Date.now();this.emit("renderEnd",i()(i()({},t),{},{renderEnd:r,renderDuration:r-n})),this.renderMap.delete(e)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),n}(E.EventEmitter),ue=n(2410),le=n.n(ue),ce=n(6571),fe={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},he=function(e){d()(n,e);var t=g()(n);function n(e){var r;return u()(this,n),r=t.call(this),y()(h()(r),"indragging",!1),y()(h()(r),"hammertime",void 0),y()(h()(r),"lastClickTime",0),y()(h()(r),"lastClickXY",[-1,-1]),y()(h()(r),"clickTimer",void 0),y()(h()(r),"$containter",void 0),y()(h()(r),"onDrag",(function(e){var t=r.interactionEvent(e);t.type=fe[t.type],"dragging"===t.type?r.indragging=!0:r.indragging=!1,r.emit(ce.s.Drag,t)})),y()(h()(r),"onHammer",(function(e){e.srcEvent.stopPropagation();var t=r.interactionEvent(e);r.emit(ce.s.Hover,t)})),y()(h()(r),"onTouch",(function(e){var t=e.touches[0];r.onHover({clientX:t.clientX,clientY:t.clientY,type:"touchstart"})})),y()(h()(r),"onTouchEnd",(function(e){if(e.changedTouches.length>0){var t=e.changedTouches[0];r.onHover({clientX:t.clientX,clientY:t.clientY,type:"touchend"})}})),y()(h()(r),"onTouchMove",(function(e){var t=e.changedTouches[0];r.onHover({clientX:t.clientX,clientY:t.clientY,type:"touchmove"})})),y()(h()(r),"onHover",(function(e){var t=e.clientX,n=e.clientY,i=e.type,o=r.mapService.getMapContainer();if(o){var a=o.getBoundingClientRect(),s=a.top;t=t-a.left-o.clientLeft,n=n-s-o.clientTop}var u=r.mapService.containerToLngLat([t,n]);"click"!==i&&"touch"!==i?"click"!==i&&"dblclick"!==i&&r.emit(ce.s.Hover,{x:t,y:n,lngLat:u,type:i,target:e}):r.isDoubleTap(t,n,u)})),r.container=e,r}return c()(n,[{key:"mapService",get:function(){return this.container.mapService}},{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(ce.s.Hover)}},{key:"triggerHover",value:function(e){var t=e.x,n=e.y;this.emit(ce.s.Hover,{x:t,y:n})}},{key:"triggerSelect",value:function(e){this.emit(ce.s.Select,{featureId:e})}},{key:"triggerActive",value:function(e){this.emit(ce.s.Active,{featureId:e})}},{key:"addEventListenerOnMap",value:function(){var e=this.mapService.getMapContainer();if(e){var t=new(le().Manager)(e);t.add(new(le().Tap)({event:"dblclick",taps:2})),t.add(new(le().Tap)({event:"click"})),t.add(new(le().Pan)({threshold:0,pointers:0})),t.add(new(le().Press)({})),t.on("dblclick click",this.onHammer),t.on("panstart panmove panend pancancel",this.onDrag),e.addEventListener("touchstart",this.onTouch),e.addEventListener("touchend",this.onTouchEnd),e.addEventListener("mousemove",this.onHover),e.addEventListener("touchmove",this.onTouchMove),e.addEventListener("mousedown",this.onHover,!0),e.addEventListener("mouseup",this.onHover),e.addEventListener("contextmenu",this.onHover),this.hammertime=t}}},{key:"removeEventListenerOnMap",value:function(){var e=this.mapService.getMapContainer();e&&(e.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),e.removeEventListener("touchstart",this.onTouch),e.removeEventListener("touchend",this.onTouchEnd),e.removeEventListener("mousedown",this.onHover),e.removeEventListener("mouseup",this.onHover),e.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(e){var t,n,r=e.type;"touch"===e.pointerType?(n=Math.floor(e.pointers[0].clientY),t=Math.floor(e.pointers[0].clientX)):(n=Math.floor(e.srcEvent.y),t=Math.floor(e.srcEvent.x));var i=this.mapService.getMapContainer();if(i){var o=i.getBoundingClientRect(),a=o.top;t-=o.left,n-=a}return{x:t,y:n,lngLat:this.mapService.containerToLngLat([t,n]),type:r,target:e.srcEvent}}},{key:"isDoubleTap",value:function(e,t,n){var r=this,i=(new Date).getTime(),o="click";i-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-e)<10&&Math.abs(this.lastClickXY[1]-t)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),o="dblclick",this.emit(ce.s.Hover,{x:e,y:t,lngLat:n,type:o})):(this.lastClickTime=i,this.lastClickXY=[e,t],this.clickTimer=setTimeout((function(){o="click",r.emit(ce.s.Hover,{x:e,y:t,lngLat:n,type:o})}),400))}}]),n}(T()),pe=0;function de(e){var t=e;if("string"==typeof e&&(t=document.getElementById(e)),t){var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      z-index:2;\n      height: 100%;\n      width: 100%;\n      pointer-events: none;\n    ",n.id="l7-scene-".concat(pe++),n.classList.add("l7-scene"),t.appendChild(n),n}return null}var ve=n(4),ge=function(){function e(t){var n=this;u()(this,e),y()(this,"pickedColors",void 0),y()(this,"pickedTileLayers",[]),y()(this,"pickingFBO",void 0),y()(this,"width",0),y()(this,"height",0),y()(this,"alreadyInPicking",!1),y()(this,"pickBufferScale",1),y()(this,"pickFromPickingFBO",function(){var e=I()(L()().mark((function e(t,r){var o,a,s,u,l,c,f,h,p,d,v,g,m,y,b,x,E,T,A,S,C,R,w,M,k,O;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=r.x,s=r.y,u=r.lngLat,l=r.type,c=r.target,f=!1,h=n.rendererService,p=h.readPixels,d=h.readPixelsAsync,v=h.getViewportSize,g=h.queryVerdorInfo,m=v(),y=m.width,b=m.height,x=t.getLayerConfig(),E=x.enableHighlight,T=x.enableSelect,A=a*_.SO.DPR,S=s*_.SO.DPR,!(A>y-1*_.SO.DPR||A<0||S>b-1*_.SO.DPR||S<0)){e.next=9;break}return e.abrupt("return",!1);case 9:if(!("WebGPU"===g())){e.next=16;break}return e.next=13,d({x:Math.floor(A/n.pickBufferScale),y:Math.floor((b-(s+1)*_.SO.DPR)/n.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:n.pickingFBO});case 13:C=e.sent,e.next=17;break;case 16:C=p({x:Math.floor(A/n.pickBufferScale),y:Math.floor((b-(s+1)*_.SO.DPR)/n.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:n.pickingFBO});case 17:return n.pickedColors=C,0!==C[0]||0!==C[1]||0!==C[2]?(R=(0,_.W0)(C),w=t.layerPickService.getFeatureById(R),R!==t.getCurrentPickId()&&"mousemove"===l&&(l="mouseenter"),M={x:a,y:s,type:l,lngLat:u,featureId:R,feature:w,target:c},w&&(f=!0,t.setCurrentPickId(R),n.triggerHoverOnLayer(t,M))):(k={x:a,y:s,lngLat:u,type:null!==t.getCurrentPickId()&&"mousemove"===l?"mouseout":"un"+l,featureId:null,target:c,feature:null},n.triggerHoverOnLayer(t,i()(i()({},k),{},{type:"unpick"})),n.triggerHoverOnLayer(t,k),t.setCurrentPickId(null)),E&&t.layerPickService.highlightPickedFeature(C),T&&"click"===l&&(null===(o=C)||void 0===o?void 0:o.toString())!==[0,0,0,0].toString()&&(O=(0,_.W0)(C),null===t.getCurrentSelectedId()||O!==t.getCurrentSelectedId()?(t.layerPickService.selectFeature(C),t.setCurrentSelectedId(O)):(t.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))),e.abrupt("return",f);case 22:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),this.container=t}var t,n,r,o;return c()(e,[{key:"mapService",get:function(){return this.container.mapService}},{key:"rendererService",get:function(){return this.container.rendererService}},{key:"configService",get:function(){return this.container.globalConfigService}},{key:"interactionService",get:function(){return this.container.interactionService}},{key:"layerService",get:function(){return this.container.layerService}},{key:"init",value:function(e){var t=this.rendererService,n=t.createTexture2D,r=t.createFramebuffer,i=(0,t.getViewportSize)(),o=i.width,a=i.height;this.pickBufferScale=this.configService.getSceneConfig(e).pickBufferScale||1;var s=n({width:o=Math.round(o/this.pickBufferScale),height:a=Math.round(a/this.pickBufferScale),usage:ve.v.RENDER_TARGET,label:"Picking Texture"});this.pickingFBO=r({color:s,depth:!0,width:o,height:a}),this.interactionService.on(ce.s.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:(o=I()(L()().mark((function e(t,n,r){var i,o,a,s,u=this;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=this.rendererService,o=i.useFramebufferAsync,a=i.clear,this.resizePickingFBO(),t.hooks.beforePickingEncode.call(),e.next=5,o(this.pickingFBO,I()(L()().mark((function e(){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a({framebuffer:u.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.renderModels({ispick:!0});case 2:case"end":return e.stop()}}),e)}))));case 5:return t.hooks.afterPickingEncode.call(),e.next=8,this.pickBox(t,n);case 8:s=e.sent,r(s);case 10:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return o.apply(this,arguments)})},{key:"pickBox",value:(r=I()(L()().mark((function e(t,n){var r,o,a,s,u,l,c,f,h,p,d,v,g,m,y,b,x,E,T,A,S,C=this;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.map((function(e){var t=e<0?0:e;return Math.floor(t*_.SO.DPR/C.pickBufferScale)})),o=B()(r,4),a=o[0],s=o[1],u=o[2],l=o[3],c=this.rendererService,f=c.readPixelsAsync,h=c.getViewportSize,p=h(),d=p.width,v=p.height,!(a>(d-1)*_.SO.DPR/this.pickBufferScale||u<0||s>(v-1)*_.SO.DPR/this.pickBufferScale||l<0)){e.next=5;break}return e.abrupt("return",[]);case 5:return g=Math.min(d/this.pickBufferScale,u)-a,m=Math.min(v/this.pickBufferScale,l)-s,e.next=9,f({x:a,y:Math.floor(v/this.pickBufferScale-(l+1)),width:g,height:m,data:new Uint8Array(g*m*4),framebuffer:this.pickingFBO});case 9:for(y=e.sent,b=[],x={},E=0;E<y.length/4;E+=1)T=y.slice(4*E,4*E+4),-1===(A=(0,_.W0)(T))||x[A]||(S=t.layerPickService.getFeatureById(A),b.push(i()(i()({},S),{},{pickedFeatureIdx:A})),x[A]=!0);return e.abrupt("return",b);case 14:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"handleCursor",value:function(e,t){var n=e.getLayerConfig(),r=n.cursor,i=void 0===r?"":r;if(n.cursorEnabled){var o="amap"===this.mapService.getType()?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),a=null==o?void 0:o.style.getPropertyValue("cursor");"unmousemove"===t&&""!==a?null==o||o.style.setProperty("cursor",""):"mousemove"===t&&(null==o||o.style.setProperty("cursor",i))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"pickingAllLayer",value:(n=I()(L()().mark((function e(t){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.layerService.needPick(t.type)&&this.isPickingAllLayer()){e.next=2;break}return e.abrupt("return");case 2:return this.alreadyInPicking=!0,e.next=5,this.pickingLayers(t);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"isPickingAllLayer",value:function(){return!this.alreadyInPicking&&(!this.layerService.alreadyInRendering&&(!this.interactionService.indragging&&!!this.layerService.getShaderPickStat()))}},{key:"resizePickingFBO",value:function(){var e=(0,this.rendererService.getViewportSize)(),t=e.width,n=e.height;this.width===t&&this.height===n||(this.pickingFBO.resize({width:Math.round(t/this.pickBufferScale),height:Math.round(n/this.pickBufferScale)}),this.width=t,this.height=n)}},{key:"pickingLayers",value:(t=I()(L()().mark((function e(t){var n,r,i,o,s,u,l,c=this;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=this.rendererService,r=n.clear,i=n.useFramebufferAsync,this.resizePickingFBO(),o=this.layerService.getRenderList(),s=a()(o.filter((function(e){return e.needPick(t.type)})).reverse()),e.prev=4,l=L()().mark((function e(){var n,o;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u.value,e.next=3,i(c.pickingFBO,I()(L()().mark((function e(){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r({framebuffer:c.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),n.layerPickService.pickRender(t);case 2:case"end":return e.stop()}}),e)}))));case 3:return e.next=5,c.pickFromPickingFBO(n,t);case 5:if(o=e.sent,c.layerService.pickedLayerId=o?+n.id:-1,!o||n.getLayerConfig().enablePropagation){e.next=9;break}return e.abrupt("return",1);case 9:case"end":return e.stop()}}),e)})),s.s();case 7:if((u=s.n()).done){e.next=13;break}return e.delegateYield(l(),"t0",9);case 9:if(!e.t0){e.next=11;break}return e.abrupt("break",13);case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t1=e.catch(4),s.e(e.t1);case 18:return e.prev=18,s.f(),e.finish(18);case 21:case"end":return e.stop()}}),e,this,[[4,15,18,21]])}))),function(e){return t.apply(this,arguments)})},{key:"triggerHoverOnLayer",value:function(e,t){(function(e){var t,n=!0;if((null==e||null===(t=e.target)||void 0===t?void 0:t.target)instanceof HTMLElement)for(var r,i=null==e||null===(r=e.target)||void 0===r?void 0:r.target;i;){var o,a=Array.from(i.classList);if(a.includes("l7-marker")||a.includes("l7-popup")){n=!1;break}i=null===(o=i)||void 0===o?void 0:o.parentElement}return n})(t)&&(this.handleCursor(e,t.type),e.emit(t.type,t))}}]),e}(),me=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];u()(this,e),y()(this,"autoStart",void 0),y()(this,"startTime",0),y()(this,"oldTime",0),y()(this,"running",!1),y()(this,"elapsedTime",0),this.autoStart=t}return c()(e,[{key:"start",value:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}(),ye=_.rU.throttle,_e=function(e){d()(f,e);var t,n,r,i,o,s,l=g()(f);function f(e){var t;return u()(this,f),t=l.call(this),y()(h()(t),"pickedLayerId",-1),y()(h()(t),"clock",new me),y()(h()(t),"alreadyInRendering",!1),y()(h()(t),"layers",[]),y()(h()(t),"layerList",[]),y()(h()(t),"layerRenderID",void 0),y()(h()(t),"sceneInited",!1),y()(h()(t),"animateInstanceCount",0),y()(h()(t),"shaderPicking",!0),y()(h()(t),"enableRender",!0),y()(h()(t),"reRender",ye((function(){t.renderLayers()}),32)),y()(h()(t),"throttleRenderLayers",ye((function(){t.renderLayers()}),16)),t.container=e,t}return c()(f,[{key:"renderService",get:function(){return this.container.rendererService}},{key:"mapService",get:function(){return this.container.mapService}},{key:"debugService",get:function(){return this.container.debugService}},{key:"needPick",value:function(e){return this.updateLayerRenderList(),this.layerList.some((function(t){return t.needPick(e)}))}},{key:"add",value:function(e){var t=this;this.layers.push(e),this.sceneInited&&e.init().then((function(){t.renderLayers()}))}},{key:"addMask",value:function(e){var t=this;this.sceneInited&&e.init().then((function(){t.renderLayers()}))}},{key:"initLayers",value:(s=I()(L()().mark((function e(){var t=this;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var e=I()(L()().mark((function e(n){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.startInit){e.next=4;break}return e.next=3,n.init();case 3:t.updateLayerRenderList();case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 2:case"end":return e.stop()}}),e,this)}))),function(){return s.apply(this,arguments)})},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(e){return this.layers.find((function(t){return t.id===e}))}},{key:"getLayerByName",value:function(e){return this.layers.find((function(t){return t.name===e}))}},{key:"remove",value:(o=I()(L()().mark((function e(t,n){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n?n.layerChildren=n.layerChildren.filter((function(e){return e!==t})):this.layers=this.layers.filter((function(e){return e!==t})),t.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return o.apply(this,arguments)})},{key:"removeAllLayers",value:(i=I()(L()().mark((function e(){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.destroy(),this.reRender();case 2:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"setEnableRender",value:function(e){this.enableRender=e}},{key:"renderLayers",value:(r=I()(L()().mark((function e(){var t,n,r,i,o,s,u,l;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.alreadyInRendering&&this.enableRender){e.next=2;break}return e.abrupt("return");case 2:this.updateLayerRenderList(),t=this.debugService.generateRenderUid(),this.debugService.renderStart(t),this.alreadyInRendering=!0,this.clear(),n=a()(this.layerList);try{for(n.s();!(r=n.n()).done;)r.value.prerender()}catch(e){n.e(e)}finally{n.f()}this.renderService.beginFrame(),i=a()(this.layerList),e.prev=11,i.s();case 13:if((o=i.n()).done){e.next=25;break}if(s=o.value,u=s.getLayerConfig(),l=u.enableMask,s.masks.filter((function(e){return e.inited})).length>0&&l&&this.renderMask(s.masks),!s.getLayerConfig().enableMultiPassRenderer){e.next=22;break}return e.next=20,s.renderMultiPass();case 20:e.next=23;break;case 22:s.render();case 23:e.next=13;break;case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(11),i.e(e.t0);case 30:return e.prev=30,i.f(),e.finish(30);case 33:this.renderService.endFrame(),this.debugService.renderEnd(t),this.alreadyInRendering=!1;case 36:case"end":return e.stop()}}),e,this,[[11,27,30,33]])}))),function(){return r.apply(this,arguments)})},{key:"renderMask",value:function(e){var t=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var n,r=e.length>1?X.yn.MULTIPLE:X.yn.SINGLE,i=a()(e);try{for(i.s();!(n=i.n()).done;){n.value.render({isStencil:!0,stencilType:r,stencilIndex:t++})}}catch(e){i.e(e)}finally{i.f()}}},{key:"beforeRenderData",value:(n=I()(L()().mark((function e(t){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.hooks.beforeRenderData.promise();case 2:e.sent&&this.renderLayers();case 4:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"renderTileLayerMask",value:function(e){var t=0,n=e.getLayerConfig().enableMask,r=void 0===n||n,i=e.tileMask?1:0,o=e.masks.filter((function(e){return e.inited})),s=(i+=r?o.length:1)>1?X.yn.MULTIPLE:X.yn.SINGLE;if((e.tileMask||o.length&&r)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),o.length&&r){var u,l=a()(o);try{for(l.s();!(u=l.n()).done;){u.value.render({isStencil:!0,stencilType:s,stencilIndex:t++})}}catch(e){l.e(e)}finally{l.f()}}e.tileMask&&e.tileMask.render({isStencil:!0,stencilType:s,stencilIndex:t++,stencilOperation:X.lE.OR})}},{key:"renderTileLayer",value:(t=I()(L()().mark((function e(t){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.renderTileLayerMask(t),!t.getLayerConfig().enableMultiPassRenderer){e.next=6;break}return e.next=4,t.renderMultiPass();case 4:e.next=8;break;case 6:return e.next=8,t.render();case 8:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateLayerRenderList",value:function(){var e=this;this.layerList=[],this.layers.filter((function(e){return e.inited})).filter((function(e){return e.isVisible()})).sort((function(e,t){return e.zIndex-t.zIndex})).forEach((function(t){e.layerList.push(t)}))}},{key:"destroy",value:function(){this.layers.forEach((function(e){e.destroy()})),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){0==this.animateInstanceCount++&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){0==--this.animateInstanceCount&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var e=(0,_.CI)(this.mapService.bgColor);this.renderService.clear({color:e,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){window.cancelAnimationFrame(this.layerRenderID)}}]),f}(E.EventEmitter),be=n(1409),xe=n.n(be),Ee=n(901),Te=_.rU.isNil,Ae=function(){function e(t){var n=this;u()(this,e),y()(this,"name",void 0),y()(this,"type",void 0),y()(this,"scale",void 0),y()(this,"descriptor",void 0),y()(this,"featureBufferLayout",[]),y()(this,"needRescale",!1),y()(this,"needRemapping",!1),y()(this,"needRegenerateVertices",!1),y()(this,"featureRange",{startIndex:0,endIndex:1/0}),y()(this,"vertexAttribute",void 0),y()(this,"defaultCallback",(function(e){var t;return 0===e.length?(null===(t=n.scale)||void 0===t?void 0:t.defaultValues)||[]:e.map((function(e,t){var r;return(null===(r=n.scale)||void 0===r?void 0:r.scalers[t].func)(e)}))})),this.setProps(t)}return c()(e,[{key:"setProps",value:function(e){Object.assign(this,e)}},{key:"mapping",value:function(e){var t;if(null!==(t=this.scale)&&void 0!==t&&t.callback){var n,r=null===(n=this.scale)||void 0===n?void 0:n.callback.apply(n,z()(e));if(!Te(r))return[r]}return this.defaultCallback(e)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Se=["buffer","update","name"],Ce=["buffer","update","name"],Re=y()(y()(y()({},Ee.gl.FLOAT,4),Ee.gl.UNSIGNED_BYTE,1),Ee.gl.UNSIGNED_SHORT,2),we=function(){function e(t){u()(this,e),y()(this,"attributesAndIndices",void 0),y()(this,"attributes",[]),y()(this,"triangulation",void 0),y()(this,"featureLayout",{sizePerElement:0,elements:[]}),this.rendererService=t}return c()(e,[{key:"registerStyleAttribute",value:function(e){var t=this.getLayerStyleAttribute(e.name||"");return t?t.setProps(e):(t=new Ae(e),this.attributes.push(t)),t}},{key:"unRegisterStyleAttribute",value:function(e){var t=this.attributes.findIndex((function(t){return t.name===e}));t>-1&&this.attributes.splice(t,1)}},{key:"updateScaleAttribute",value:function(e){this.attributes.forEach((function(t){var n,r=t.name,i=null===(n=t.scale)||void 0===n?void 0:n.field;(e[r]||i&&e[i])&&(t.needRescale=!0,t.needRemapping=!0,t.needRegenerateVertices=!0)}))}},{key:"updateStyleAttribute",value:function(e,t,n){var r=this.getLayerStyleAttribute(e);r||(r=this.registerStyleAttribute(i()(i()({},t),{},{name:e})));var o=t.scale;o&&r&&(r.scale=o,r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0,n&&n.featureRange&&(r.featureRange=n.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(e){return this.attributes.find((function(t){return t.name===e}))}},{key:"getLayerAttributeScale",value:function(e){var t,n=this.getLayerStyleAttribute(e),r=null==n||null===(t=n.scale)||void 0===t?void 0:t.scalers;return r&&r[0]?r[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=this.attributes.find((function(t){return t.name===e}));if(o&&o.descriptor){var a=o.descriptor,s=a.update,u=a.buffer,l=a.size,c=void 0===l?0:l,f=Re[u.type||Ee.gl.FLOAT];if(s){var h=this.featureLayout,p=h.elements,d=h.sizePerElement,v=p.slice(n,r);if(!v.length)return;var g=v[0].offset,m=g*c*f,y=v.map((function(e,n){for(var r=e.featureIdx,i=e.vertices,o=e.normals,a=i.length/d,u=[],l=0;l<a;l++){var c=o?o.slice(3*l,3*l+3):[];u.push.apply(u,z()(s(t[r],r,i.slice(l*d,l*d+d),n,c)))}return u})).flat();o.vertexAttribute.updateBuffer({data:y,offset:m}),null==i||i.emit("legend:".concat(e),i.getLegend(e))}}}},{key:"createAttributesAndIndices",value:function(e,t,n,r){var o=this;this.featureLayout={sizePerElement:0,elements:[]},t&&(this.triangulation=t);var a=this.attributes.map((function(e){return e.resetDescriptor(),e.descriptor})),s=0,u=0,l=[],c=3;e.forEach((function(e,t){var r=o.triangulation(e,n),i=r.indices,f=r.vertices,h=r.normals,p=r.size,d=r.indexes,v=r.count;"number"==typeof v&&(u+=v),i.forEach((function(e){l.push(e+s)})),c=p;var g=f.length/p;o.featureLayout.sizePerElement=c,o.featureLayout.elements.push({featureIdx:t,vertices:f,normals:h,offset:s}),s+=g;for(var m=function(n){var r=(null==h?void 0:h.slice(3*n,3*n+3))||[],i=f.slice(n*p,n*p+p),o=0;d&&void 0!==d[n]&&(o=d[n]),a.forEach((function(a,s){var u;a&&a.update&&(u=a.buffer.data).push.apply(u,z()(a.update(e,t,i,n,r,o)))}))},y=0;y<g;y++)m(y)}));var f=this.rendererService,h=f.createAttribute,p=f.createBuffer,d=f.createElements,v={};a.forEach((function(e,t){if(e){var n=e.buffer,r=(e.update,e.name,xe()(e,Se)),a=h(i()({buffer:p(n)},r));v[e.name||""]=a,o.attributes[t].vertexAttribute=a}}));var g=d({data:l,type:Ee.gl.UNSIGNED_INT,count:l.length});return this.attributesAndIndices={attributes:v,elements:g,count:u},Object.values(this.attributes).filter((function(e){return e.scale})).forEach((function(e){var t=e.name;null==r||r.emit("legend:".concat(t),r.getLegend(t))})),this.attributesAndIndices}},{key:"createAttributes",value:function(e,t){var n=this;this.featureLayout={sizePerElement:0,elements:[]},t&&(this.triangulation=t);var r=this.attributes.map((function(e){return e.resetDescriptor(),e.descriptor})),o=0,a=[],s=3;e.forEach((function(e,t){var i=n.triangulation(e),u=i.indices,l=i.vertices,c=i.normals,f=i.size,h=i.indexes;u.forEach((function(e){a.push(e+o)})),s=f;var p=l.length/f;n.featureLayout.sizePerElement=s,n.featureLayout.elements.push({featureIdx:t,vertices:l,normals:c,offset:o}),o+=p;for(var d=function(n){var i=(null==c?void 0:c.slice(3*n,3*n+3))||[],o=l.slice(n*f,n*f+f),a=0;h&&void 0!==h[n]&&(a=h[n]),r.forEach((function(r,s){var u;r&&r.update&&(u=r.buffer.data).push.apply(u,z()(r.update(e,t,o,n,i,a)))}))},v=0;v<p;v++)d(v)}));var u=this.rendererService,l=u.createAttribute,c=u.createBuffer,f={};return r.forEach((function(e,t){if(e){var r=e.buffer,o=(e.update,e.name,xe()(e,Ce)),a=l(i()({buffer:c(r)},o));f[e.name||""]=a,n.attributes[t].vertexAttribute=a}})),{attributes:f}}},{key:"clearAllAttributes",value:function(){var e;this.attributes.forEach((function(e){e.vertexAttribute&&e.vertexAttribute.destroy()})),null===(e=this.attributesAndIndices)||void 0===e||e.elements.destroy(),this.attributes=[]}}]),e}(),Me=n(4474),ke=n(5841),Le=n.n(ke),Oe=function(e){d()(i,e);var t,n,r=g()(i);function i(e){var t;return u()(this,i),t=r.call(this),y()(h()(t),"destroyed",!1),y()(h()(t),"loaded",!1),y()(h()(t),"id",void 0),y()(h()(t),"inited",!1),y()(h()(t),"rendering",!1),y()(h()(t),"$container",void 0),y()(h()(t),"canvas",void 0),y()(h()(t),"markerContainer",void 0),y()(h()(t),"resizeDetector",void 0),y()(h()(t),"hooks",void 0),y()(h()(t),"handleWindowResized",(function(){t.emit("resize"),t.$container&&(t.initContainer(),t.coordinateSystemService.needRefresh=!0,t.render())})),y()(h()(t),"handleMapCameraChanged",(function(e){t.cameraService.update(e),t.render()})),t.container=e,t.hooks={init:new Me.sX},t.id=e.id,t}return c()(i,[{key:"iconService",get:function(){return this.container.iconService}},{key:"fontService",get:function(){return this.container.fontService}},{key:"controlService",get:function(){return this.container.controlService}},{key:"configService",get:function(){return this.container.globalConfigService}},{key:"map",get:function(){return this.container.mapService}},{key:"coordinateSystemService",get:function(){return this.container.coordinateSystemService}},{key:"rendererService",get:function(){return this.container.rendererService}},{key:"layerService",get:function(){return this.container.layerService}},{key:"debugService",get:function(){return this.container.debugService}},{key:"cameraService",get:function(){return this.container.cameraService}},{key:"interactionService",get:function(){return this.container.interactionService}},{key:"pickingService",get:function(){return this.container.pickingService}},{key:"shaderModuleService",get:function(){return this.container.shaderModuleService}},{key:"markerService",get:function(){return this.container.markerService}},{key:"popupService",get:function(){return this.container.popupService}},{key:"init",value:function(e){var t=this;this.configService.setSceneConfig(this.id,e),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return t.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",I()(L()().mark((function e(){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.debugService.log("map.mapInitStart",{type:t.map.version}),e.next=3,new Promise((function(e){t.map.onCameraChanged((function(n){t.cameraService.init(),t.cameraService.update(n),e()})),t.map.init()}));case 3:t.map.onCameraChanged(t.handleMapCameraChanged),t.map.addMarkerContainer(),t.markerService.addMarkers(),t.markerService.addMarkerLayers(),t.popupService.initPopup(),t.interactionService.init(),t.interactionService.on(ce.s.Drag,t.addSceneEvent.bind(t));case 10:case"end":return e.stop()}}),e)})))),this.hooks.init.tapPromise("initRenderer",I()(L()().mark((function n(){var r,i,o,a;return L()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=(null===(r=t.map)||void 0===r?void 0:r.getOverlayContainer())||void 0,t.$container=i||de(t.configService.getSceneConfig(t.id).id||""),!t.$container){n.next=15;break}return o=e.canvas,t.canvas=o||_.SO.create("canvas","",t.$container),t.setCanvas(),n.next=8,t.rendererService.init(t.canvas,t.configService.getSceneConfig(t.id),e.gl);case 8:t.registerContextLost(),t.initContainer(),t.resizeDetector=Le()({strategy:"scroll"}),t.resizeDetector.listenTo(t.$container,t.handleWindowResized),window.matchMedia&&(null===(a=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))||void 0===a||a.addListener(t.handleWindowResized.bind("screen"))),n.next=16;break;case 15:console.error("容器 id 不存在");case 16:t.pickingService.init(t.id);case 17:case"end":return n.stop()}}),n)})))),this.render()}},{key:"registerContextLost",value:function(){var e=this,t=this.rendererService.getCanvas();t&&t.addEventListener("webglcontextlost",(function(){return e.emit("webglcontextlost")}))}},{key:"addLayer",value:function(e){this.layerService.sceneService=this,this.layerService.add(e)}},{key:"addMask",value:function(e){this.layerService.sceneService=this,this.layerService.addMask(e)}},{key:"render",value:(n=I()(L()().mark((function e(){return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rendering&&!this.destroyed){e.next=2;break}return e.abrupt("return");case 2:if(this.rendering=!0,this.inited){e.next=16;break}return e.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),e.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,e.next=20;break;case 16:return e.next=18,this.layerService.initLayers();case 18:return e.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"addFontFace",value:function(e,t){this.fontService.addFontFace(e,t)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:(t=I()(L()().mark((function e(t){var n,r,i;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=null===(n=this.$container)||void 0===n?void 0:n.getElementsByTagName("canvas")[0],e.next=3,this.render();case 3:return i="jpg"===t?null==r?void 0:r.toDataURL("image/jpeg"):null==r?void 0:r.toDataURL("image/png"),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var e=this.$container.parentElement;null!==e&&(this.markerContainer=_.SO.create("div","l7-marker-container",e))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var e,t=this;this.inited?(this.resizeDetector.removeListener(this.$container,this.handleWindowResized),this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout((function(){var e;null===(e=t.$container)||void 0===e||e.removeChild(t.canvas),t.canvas=null,t.rendererService.destroy()})),null===(e=this.$container)||void 0===e||null===(e=e.parentNode)||void 0===e||e.removeChild(this.$container),this.emit("destroy")):this.destroyed=!0}},{key:"initContainer",value:function(){var e,t,n=_.SO.DPR,r=(null===(e=this.$container)||void 0===e?void 0:e.clientWidth)||400,i=(null===(t=this.$container)||void 0===t?void 0:t.clientHeight)||300,o=this.canvas;o&&(o.width=r*n,o.height=i*n),this.rendererService.viewport({x:0,y:0,width:n*r,height:n*i})}},{key:"setCanvas",value:function(){var e,t,n=_.SO.DPR,r=(null===(e=this.$container)||void 0===e?void 0:e.clientWidth)||400,i=(null===(t=this.$container)||void 0===t?void 0:t.clientHeight)||300,o=this.canvas;o.width=r*n,o.height=i*n,o.style.width="100%",o.style.height="100%"}},{key:"addSceneEvent",value:function(e){this.emit(e.type,e)}}]),i}(E.EventEmitter),Ie=n(8521),Pe=_.rU.uniq,Ne="#define PI 3.14159265359",Be="layout(std140) uniform PickingUniforms {\n  vec4 u_HighlightColor;\n  vec4 u_SelectColor;\n  vec3 u_PickingColor;\n  float u_PickingStage;\n  vec3 u_CurrentSelectedId;\n  float u_PickingThreshold;\n  float u_PickingBuffer;\n  float u_shaderPick;\n  float u_activeMix;\n};",De='#define TILE_SIZE (512.0)\n#define PI (3.1415926536)\n#define WORLD_SCALE (TILE_SIZE / (PI * 2.0))\n#define EARTH_CIRCUMFERENCE (40.03e6)\n\n#define COORDINATE_SYSTEM_LNGLAT (1.0) // mapbox\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET (2.0) // mapbox offset\n#define COORDINATE_SYSTEM_VECTOR_TILE (3.0)\n#define COORDINATE_SYSTEM_IDENTITY (4.0)\n#define COORDINATE_SYSTEM_METER_OFFSET (5.0)\n\n#pragma include "scene_uniforms"\n\nconst vec2 ZERO_64_XY_LOW = vec2(0.0, 0.0);\n\n// web mercator coords -> world coords\nvec2 project_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  return vec2(radians(x) + PI, PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5)));\n}\n\nfloat project_scale(float meters) {\n  return meters * u_PixelsPerMeter.z;\n}\n\n// offset coords -> world coords\nvec4 project_offset(vec4 offset) {\n  float dy = offset.y;\n  dy = clamp(dy, -1.0, 1.0);\n  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;\n  return vec4(offset.xyz * pixels_per_unit, offset.w);\n}\n\nvec3 project_normal(vec3 normal) {\n  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);\n  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);\n}\n\nvec3 project_offset_normal(vec3 vector) {\n  if (\n    u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 &&\n      u_CoordinateSystem > COORDINATE_SYSTEM_LNGLAT - 0.01 ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    // normals generated by the polygon tesselator are in lnglat offsets instead of meters\n    return normalize(vector * u_PixelsPerDegree);\n  }\n  return project_normal(vector);\n}\n\nvec4 project_position(vec4 position, vec2 position64xyLow) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float X = position.x - u_ViewportCenter.x;\n    float Y = position.y - u_ViewportCenter.y;\n    return project_offset(\n      vec4(X + position64xyLow.x, Y + position64xyLow.y, position.z, position.w)\n    );\n  }\n  if (\n    u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 &&\n    u_CoordinateSystem > COORDINATE_SYSTEM_LNGLAT - 0.01\n  ) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  return position;\n}\n\nvec4 project_position(vec4 position) {\n  return project_position(position, ZERO_64_XY_LOW);\n}\n\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;\n  return offset * u_FocalDistance;\n}\n\n// 适配纹理贴图的等像素大小\nfloat project_pixel_texture(float pixel) {\n  // mapbox zoom > 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    return pixel * pow(0.5, u_Zoom) * u_FocalDistance;\n  }\n\n  return pixel * 2.0 * u_FocalDistance;\n}\n\n// 在不论什么底图下需要统一处理的时候使用\nfloat project_float_pixel(float pixel) {\n  if (\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    // mapbox 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, 19.0 - u_Zoom) * u_FocalDistance;\n  }\n\n  return pixel * u_FocalDistance;\n}\n\n// Project meter into the unit of pixel which used in the camera world space\nfloat project_float_meter(float meter) {\n  if (\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    // Since the zoom level uniform is updated by mapservice and it\'s alread been subtracted by 1\n    // Not sure if we are supposed to do that again\n    return meter;\n  } else {\n    return project_float_pixel(meter);\n  }\n\n  // TODO: change the following code to make adaptations for amap\n  // return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;\n\n}\n\nfloat project_pixel(float pixel) {\n  return pixel * u_FocalDistance;\n}\n\nvec2 project_pixel(vec2 pixel) {\n  return pixel * -1.0 * u_FocalDistance;\n}\n\nvec3 project_pixel(vec3 pixel) {\n  return pixel * -1.0 * u_FocalDistance;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  if (\n    u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n    position.w *= u_PixelsPerMeter.z;\n  }\n\n  return viewProjectionMatrix * position + center;\n}\n\n// Projects from common space coordinates to clip space\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(\n    position,\n    u_ViewProjectionMatrix,\n    u_ViewportCenterProjection\n  );\n}\n\nvec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {\n  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);\n\n  if (\n    u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n    pos.w = pos.w / u_PixelsPerMeter.z;\n  }\n  return pos;\n}\n\nbool isEqual(float a, float b) {\n  return a < b + 0.001 && a > b - 0.001;\n}\n\n',Ue="layout(std140) uniform SceneUniforms {\n  mat4 u_ViewMatrix;\n  mat4 u_ProjectionMatrix;\n  mat4 u_ViewProjectionMatrix;\n  mat4 u_ModelMatrix;\n  vec4 u_ViewportCenterProjection;\n  vec3 u_PixelsPerDegree;\n  float u_Zoom;\n  vec3 u_PixelsPerDegree2;\n  float u_ZoomScale;\n  vec3 u_PixelsPerMeter;\n  float u_CoordinateSystem;\n  vec3 u_CameraPosition;\n  float u_DevicePixelRatio;\n  vec2 u_ViewportCenter;\n  vec2 u_ViewportSize;\n  float u_FocalDistance;\n};\n",Fe=/precision\s+(high|low|medium)p\s+float/,ze="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n",Ge=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,Ve=/void\s+main\s*\([^)]*\)\s*\{\n?/,je=function(){function e(){u()(this,e),y()(this,"moduleCache",{}),y()(this,"rawContentCache",{})}return c()(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Ne,fs:Ne}),this.registerModule("decode",{vs:"#define SHIFT_RIGHT17 1.0 / 131072.0\n#define SHIFT_RIGHT18 1.0 / 262144.0\n#define SHIFT_RIGHT19 1.0 / 524288.0\n#define SHIFT_RIGHT20 1.0 / 1048576.0\n#define SHIFT_RIGHT21 1.0 / 2097152.0\n#define SHIFT_RIGHT22 1.0 / 4194304.0\n#define SHIFT_RIGHT23 1.0 / 8388608.0\n#define SHIFT_RIGHT24 1.0 / 16777216.0\n\n#define SHIFT_LEFT17 131072.0\n#define SHIFT_LEFT18 262144.0\n#define SHIFT_LEFT19 524288.0\n#define SHIFT_LEFT20 1048576.0\n#define SHIFT_LEFT21 2097152.0\n#define SHIFT_LEFT22 4194304.0\n#define SHIFT_LEFT23 8388608.0\n#define SHIFT_LEFT24 16777216.0\n\nvec2 unpack_float(float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec4 decode_color(vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n",fs:""}),this.registerModule("scene_uniforms",{vs:Ue,fs:Ue}),this.registerModule("picking_uniforms",{vs:Be,fs:Be}),this.registerModule("projection",{vs:De,fs:De}),this.registerModule("project",{vs:"\n#define E 2.718281828459045\nvec2 ProjectFlat(vec2 lnglat){\n  float maxs=85.0511287798;\n  float lat=max(min(maxs,lnglat.y),-maxs);\n  float scale= 268435456.;\n  float d=PI/180.;\n  float x=lnglat.x*d;\n  float y=lat*d;\n  y=log(tan((PI/4.)+(y/2.)));\n\n  float a=.5/PI,\n  b=.5,\n  c=-.5/PI;\n  d=.5;\n  x=scale*(a*x+b);\n  y=scale*(c*y+d);\n  return vec2(x,y);\n}\n\nvec2 unProjectFlat(vec2 px){\n  float a=.5/PI;\n  float b=.5;\n  float c=-.5/PI;\n  float d=.5;\n  float scale = 268435456.;\n  float x=(px.x/scale-b)/a;\n  float y=(px.y/scale-d)/c;\n  y=(atan(pow(E,y))-(PI/4.))*2.;\n  d=PI/180.;\n  float lat=y/d;\n  float lng=x/d;\n  return vec2(lng,lat);\n}\n\nfloat pixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}\n\n// gaode2.0\nvec2 customProject(vec2 lnglat) { // 经纬度 => 平面坐标\n  float t = lnglat.x;\n  float e = lnglat.y;\n  float Sm = 180.0 / PI;\n  float Tm = 6378137.0;\n  float Rm = PI / 180.0;\n  float r = 85.0511287798;\n  e = max(min(r, e), -r);\n  t *= Rm;\n  e *= Rm;\n  e = log(tan(PI / 4.0 + e / 2.0));\n  return vec2(t * Tm, e * Tm);\n}\n\nvec2 unProjCustomCoord(vec2 point) { // 平面坐标 => 经纬度\n  float Sm = 57.29577951308232; //180 / Math.PI\n  float Tm = 6378137.0;\n  float t = point.x;\n  float e = point.y;\n  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);\n}\n\n\nfloat customPixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}",fs:""}),this.registerModule("sdf_2d",{vs:"",fs:"/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdEquilateralTriangle(vec2 p) {\n  float k = sqrt(3.0);\n  p.x = abs(p.x) - 1.0;\n  p.y = p.y + 1.0/k;\n  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\n  p.x -= clamp( p.x, -2.0, 0.0 );\n  return -length(p)*sign(p.y);\n}\n\nfloat sdBox(vec2 p, vec2 b) {\n  vec2 d = abs(p)-b;\n  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdPentagon(vec2 p, float r) {\n  vec3 k = vec3(0.809016994,0.587785252,0.726542528);\n  p.x = abs(p.x);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagon(vec2 p, float r) {\n  vec3 k = vec3(-0.866025404,0.5,0.577350269);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdOctogon(vec2 p, float r) {\n  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\n  p = abs(p);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagram(vec2 p, float r) {\n  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\n  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdRhombus(vec2 p, vec2 b) {\n  vec2 q = abs(p);\n  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\n  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\n  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\n\nfloat sdVesica(vec2 p, float r, float d) {\n  p = abs(p);\n  float b = sqrt(r*r-d*d); // can delay this sqrt\n  return ((p.y-b)*d>p.x*b)\n          ? length(p-vec2(0.0,b))\n          : length(p-vec2(-d,0.0))-r;\n}\n"}),this.registerModule("lighting",{vs:"// Blinn-Phong model\n// apply lighting in vertex shader instead of fragment shader\n// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting\nuniform float u_Ambient : 1.0;\nuniform float u_Diffuse : 1.0;\nuniform float u_Specular : 1.0;\nuniform int u_NumOfDirectionalLights : 1;\nuniform int u_NumOfSpotLights : 0;\n\n#define SHININESS 32.0\n#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3\n#define MAX_NUM_OF_SPOT_LIGHTS 3\n\nstruct DirectionalLight {\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n};\n\nstruct SpotLight {\n  vec3 position;\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n  float constant;\n  float linear;\n  float quadratic;\n  float angle;\n  float blur;\n  float exponent;\n};\n\nuniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];\nuniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];\n\nvec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {\n  vec3 lightDir = normalize(light.direction);\n  // diffuse shading\n  float diff = max(dot(normal, lightDir), 0.0);\n  // Blinn-Phong specular shading\n  vec3 halfwayDir = normalize(lightDir + viewDir);\n  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);\n\n  vec3 ambient = light.ambient * u_Ambient;\n  vec3 diffuse = light.diffuse * diff * u_Diffuse;\n  vec3 specular = light.specular * spec * u_Specular;\n\n  return ambient + diffuse + specular;\n}\n\n\nvec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {\n  vec3 weight = vec3(0.0);\n  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {\n    if (i >= u_NumOfDirectionalLights) {\n      break;\n    }\n    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);\n  }\n  return weight;\n}\n",fs:""}),this.registerModule("light",{vs:"#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n      // //cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(vec3(1, -10.5, 12));\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n      // //lambert\n    float lambert = dot(worldNormal, lightDir);\n        //specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n        //sum to light weight\n    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;\n\n    return lightWeight;\n}\n",fs:""}),this.registerModule("picking",{vs:'layout(location = ATTRIBUTE_LOCATION_PICKING_COLOR) in vec3 a_PickingColor;\nout vec4 v_PickingResult;\n\n#pragma include "picking_uniforms"\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define NORMAL 0.0\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\nbool isVertexPicked(vec3 vertexColor) {\n  return distance(vertexColor,u_PickingColor.rgb) < 0.01;\n}\n\n// 判断当前点是否已经被 select 选中\nbool isVertexSelected(vec3 vertexColor) {\n  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;\n}\n\nvoid setPickingColor(vec3 pickingColor) {\n  if(u_shaderPick < 0.5) {\n    return;\n  }\n  // compares only in highlight stage\n\n  if(u_PickingStage == PICKING_HIGHLIGHT) {\n    if(isVertexPicked(pickingColor)) {\n       v_PickingResult = vec4(pickingColor.rgb * COLOR_SCALE,HIGHLIGHT);\n       return;\n    }\n    if(isVertexSelected(pickingColor)) {\n     v_PickingResult = vec4(u_CurrentSelectedId.rgb * COLOR_SCALE,SELECT);\n      return;\n    }\n\n  } else {\n      v_PickingResult= vec4(pickingColor.rgb * COLOR_SCALE,NORMAL);\n      return;\n  }\n\n  // // v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && (isVertexPicked(pickingColor) || isVertexPicked(u_CurrentSelectedId)));\n\n  // // Stores the picking color so that the fragment shader can render it during picking\n  // v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nfloat setPickingSize(float x) {\n   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}\n\nfloat setPickingOrder(float z) {\n   bool selected = bool(v_PickingResult.a);\n   return selected ? z + 1. : 0.;\n}\n',fs:'\nin vec4 v_PickingResult;\n\n#pragma include "picking_uniforms"\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 filterHighlightColor(vec4 color, float weight) {\n  float activeType = v_PickingResult.a;\n  if(activeType > 0.0) {\n    vec4 highLightColor =  activeType > 1.5 ? u_SelectColor : u_HighlightColor;\n    highLightColor = highLightColor * COLOR_SCALE;\n    float highLightAlpha = highLightColor.a;\n    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\n    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);\n  }\n  else {\n    return color;\n  }\n\n  \n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 filterPickingColor(vec4 color) {\n  vec3 pickingColor = v_PickingResult.rgb;\n  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 filterColor(vec4 color) {\n  // 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, 1.0));\n  }\n  \n}\n\nvec4 filterColorAlpha(vec4 color, float alpha) {\n  // 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, alpha));\n  }\n}\n\n'}),this.registerModule("rotation_2d",{vs:"vec2 rotate_matrix(vec2 v, float a) {\n    float b = a / 180.0 * 3.1415926535897932384626433832795;\n    float s = sin(b);\n    float c = cos(b);\n    mat2 m = mat2(c, s, -s, c);\n    return m * v;\n}",fs:""})}},{key:"registerModule",value:function(e,t){t.vs=t.vs.replace(/\r\n/g,"\n"),t.fs=t.fs.replace(/\r\n/g,"\n");var n=t.vs,r=t.fs,o=t.uniforms,a=t.defines,s=t.inject,u=(0,Ie.y4)(n),l=u.content,c=u.uniforms,f=(0,Ie.y4)(r),h=f.content,p=f.uniforms;this.rawContentCache[e]={fs:h,defines:a,inject:s,uniforms:i()(i()(i()({},c),p),o),vs:l}}},{key:"getModule",value:function(e){var t=this,n=this.rawContentCache[e].vs,r=this.rawContentCache[e].fs,o=this.rawContentCache[e],a=o.defines,s=void 0===a?{}:a,u=o.inject,l=void 0===u?{}:u,c={};l["vs:#decl"]&&(n=l["vs:#decl"]+n,c=(0,Ie.y4)(l["vs:#decl"]).uniforms),l["vs:#main-start"]&&(n=n.replace(Ve,(function(e){return e+l["vs:#main-start"]}))),l["fs:#decl"]&&(r=l["fs:#decl"]+r);var f=function(e){var t=Object.keys(e).reduce((function(t,n){return t+"#define ".concat(n.toUpperCase()," ").concat(e[n],"\n")}),"\n");return t}(s);n=f+n;var h=this.processModule(n,[],"vs"),p=h.content,d=h.includeList,v=this.processModule(r,[],"fs"),g=v.content,m=v.includeList,y=Pe(d.concat(m).concat(e)).reduce((function(e,n){return i()(i()({},e),t.rawContentCache[n].uniforms)}),i()({},c)),_=(Fe.test(g)?"":ze)+p,b=(Fe.test(g)?"":ze)+g;return this.moduleCache[e]={vs:_.trim(),fs:b.trim(),uniforms:y},this.moduleCache[e]}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"processModule",value:function(e,t,n){var r=this;return{content:e.replace(Ge,(function(e,i){var o=i.split(" ")[0].replace(/"/g,"");if(t.indexOf(o)>-1)return"";var a=r.rawContentCache[o][n];return t.push(o),r.processModule(a,t,n).content})),includeList:t}}}]),e}();var He=n(6413),We=n.n(He),Xe=n(5757),Ze=n.n(Xe),Ye=n(8188),qe=function(){function e(){u()(this,e),y()(this,"shaderModuleService",void 0),y()(this,"rendererService",void 0),y()(this,"cameraService",void 0),y()(this,"mapService",void 0),y()(this,"interactionService",void 0),y()(this,"layerService",void 0),y()(this,"config",void 0)}return c()(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return Ye.G.Normal}},{key:"init",value:function(e,t){this.config=t,this.rendererService=e.getContainer().rendererService,this.cameraService=e.getContainer().cameraService,this.mapService=e.getContainer().mapService,this.interactionService=e.getContainer().interactionService,this.layerService=e.getContainer().layerService,this.shaderModuleService=e.getContainer().shaderModuleService}},{key:"render",value:function(e){}}]),e}(),Ke=function(e){d()(n,e);var t=g()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(e,t){We()(Ze()(n.prototype),"init",this).call(this,e,t)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),n}(qe),Qe=function(){function e(t){u()(this,e),y()(this,"passes",[]),y()(this,"layer",void 0),y()(this,"renderFlag",void 0),y()(this,"width",0),y()(this,"height",0),this.postProcessor=t}var t;return c()(e,[{key:"setLayer",value:function(e){this.layer=e}},{key:"setRenderFlag",value:function(e){this.renderFlag=e}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:(t=I()(L()().mark((function e(){var t,n,r;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=a()(this.passes),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return r=n.value,e.next=7,r.render(this.layer);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:return e.next=19,this.postProcessor.render(this.layer);case 19:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))),function(){return t.apply(this,arguments)})},{key:"resize",value:function(e,t){this.width===e&&this.height===t||(this.postProcessor.resize(e,t),this.width=e,this.height=t)}},{key:"add",value:function(e,t){e.getType()===Ye.G.PostProcessing?this.postProcessor.add(e,this.layer,t):(e.init(this.layer,t),this.passes.push(e))}},{key:"insert",value:function(e,t,n){e.init(this.layer,t),this.passes.splice(n,0,e)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),$e=function(e){d()(n,e);var t=g()(n);function n(){var e;u()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),y()(h()(e),"pickingFBO",void 0),y()(h()(e),"layer",void 0),y()(h()(e),"width",0),y()(h()(e),"height",0),y()(h()(e),"alreadyInRendering",!1),y()(h()(e),"pickFromPickingFBO",(function(t){var n=t.x,r=t.y,o=t.lngLat,a=t.type;if(e.layer.isVisible()&&e.layer.needPick(a)){var s,u=e.rendererService,l=u.getViewportSize,c=u.readPixelsAsync,f=u.useFramebuffer,h=l(),p=h.width,d=h.height,v=e.layer.getLayerConfig(),g=v.enableHighlight,m=v.enableSelect,y=n*_.SO.DPR,b=r*_.SO.DPR;if(!(y>p||y<0||b>d||b<0))f(e.pickingFBO,I()(L()().mark((function t(){var u,l,f,h,p;return L()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c({x:Math.round(y),y:Math.round(d-(r+1)*_.SO.DPR),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO});case 2:0!==(s=t.sent)[0]||0!==s[1]||0!==s[2]?(l=(0,_.W0)(s),f=e.layer.getSource().getFeatureById(l),h={x:n,y:r,type:a,lngLat:o,featureId:l,feature:f},f&&(e.layer.setCurrentPickId(l),e.triggerHoverOnLayer(h))):(p={x:n,y:r,lngLat:o,type:null===e.layer.getCurrentPickId()?"un"+a:"mouseout",featureId:null,feature:null},e.triggerHoverOnLayer(i()(i()({},p),{},{type:"unpick"})),e.triggerHoverOnLayer(p),e.layer.setCurrentPickId(null)),g&&e.highlightPickedFeature(s),m&&"click"===a&&(null===(u=s)||void 0===u?void 0:u.toString())!==[0,0,0,0].toString()&&e.selectFeature(s);case 6:case"end":return t.stop()}}),t)}))))}})),e}return c()(n,[{key:"getType",value:function(){return Ye.G.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(e,t){We()(Ze()(n.prototype),"init",this).call(this,e,t),this.layer=e;var r=this.rendererService,i=r.createTexture2D,o=r.createFramebuffer,a=(0,r.getViewportSize)(),s=i({width:a.width,height:a.height,wrapS:Ee.gl.CLAMP_TO_EDGE,wrapT:Ee.gl.CLAMP_TO_EDGE,label:"Picking Texture"});this.pickingFBO=o({color:s}),this.interactionService.on(ce.s.Hover,this.pickFromPickingFBO),this.interactionService.on(ce.s.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(ce.s.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(e){var t=this;if(!this.alreadyInRendering){var n=this.rendererService,r=n.getViewportSize,i=n.useFramebuffer,o=n.clear,a=r(),s=a.width,u=a.height;this.alreadyInRendering=!0,this.width===s&&this.height===u||(this.pickingFBO.resize({width:s,height:u}),this.width=s,this.height=u),i(this.pickingFBO,(function(){o({framebuffer:t.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var n=t.layer.multiPassRenderer.getRenderFlag();t.layer.multiPassRenderer.setRenderFlag(!1),e.hooks.beforePickingEncode.call(),e.render(),e.hooks.afterPickingEncode.call(),t.layer.multiPassRenderer.setRenderFlag(n),t.alreadyInRendering=!1}))}}},{key:"triggerHoverOnLayer",value:function(e){this.layer.emit(e.type,e)}},{key:"highlightPickedFeature",value:function(e){var t=B()(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeHighlight.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(e){var t=B()(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeSelect.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(e){var t=e.featureId,n=(0,_.Z6)(t);this.selectFeature(new Uint8Array(n))}},{key:"highlightFeatureHandle",value:function(e){var t=e.featureId,n=(0,_.Z6)(t);this.highlightPickedFeature(new Uint8Array(n))}}]),n}(qe),Je=function(){function e(t){u()(this,e),y()(this,"passes",[]),y()(this,"readFBO",void 0),y()(this,"writeFBO",void 0),this.rendererService=t,this.init()}var t,n;return c()(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var e=this.rendererService,t=e.getViewportSize,n=e.createTexture2D,r=t();return n({x:0,y:0,width:r.width,height:r.height,copy:!0})}},{key:"getReadFBOTex",value:function(){var e=this,t=this.rendererService.useFramebuffer;return new Promise((function(n){t(e.readFBO,I()(L()().mark((function t(){return L()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n(e.getCurrentFBOTex());case 1:case"end":return t.stop()}}),t)}))))}))}},{key:"renderBloomPass",value:(n=I()(L()().mark((function e(t,n){var r,i;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getReadFBOTex();case 2:r=e.sent,i=0;case 4:if(!(i<4)){e.next=11;break}return e.next=7,n.render(t,r);case 7:this.swap(),i++,e.next=4;break;case 11:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"render",value:(t=I()(L()().mark((function e(t){var n,r;return L()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=0;case 1:if(!(n<this.passes.length)){e.next=15;break}if((r=this.passes[n]).setRenderToScreen(this.isLastEnabledPass(n)),"bloom"!==r.getName()){e.next=9;break}return e.next=7,this.renderBloomPass(t,r);case 7:e.next=12;break;case 9:return e.next=11,r.render(t);case 11:n!==this.passes.length-1&&this.swap();case 12:n++,e.next=1;break;case 15:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"resize",value:function(e,t){this.readFBO.resize({width:e,height:t}),this.writeFBO.resize({width:e,height:t})}},{key:"add",value:function(e,t,n){e.init(t,n),this.passes.push(e)}},{key:"insert",value:function(e,t,n,r){e.init(n,r),this.passes.splice(t,0,e)}},{key:"getPostProcessingPassByName",value:function(e){return this.passes.find((function(t){return t.getName()===e}))}},{key:"init",value:function(){var e=this.rendererService,t=e.createFramebuffer,n=e.createTexture2D;this.readFBO=t({color:n({width:1,height:1,wrapS:Ee.gl.CLAMP_TO_EDGE,wrapT:Ee.gl.CLAMP_TO_EDGE,usage:ve.v.RENDER_TARGET})}),this.writeFBO=t({color:n({width:1,height:1,wrapS:Ee.gl.CLAMP_TO_EDGE,wrapT:Ee.gl.CLAMP_TO_EDGE,usage:ve.v.RENDER_TARGET})})}},{key:"isLastEnabledPass",value:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].isEnabled())return!1;return!0}},{key:"swap",value:function(){var e=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=e}}]),e}(),et=function(e){d()(n,e);var t=g()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"getType",value:function(){return Ye.G.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(e,t){We()(Ze()(n.prototype),"init",this).call(this,e,t)}},{key:"render",value:function(e){var t=this.rendererService,n=t.useFramebuffer,r=t.clear,i=e.multiPassRenderer.getPostProcessor().getReadFBO();n(i,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i}),e.multiPassRenderer.setRenderFlag(!1),e.models.forEach((function(t){t.draw({uniforms:e.layerModel.getUninforms()})})),e.multiPassRenderer.setRenderFlag(!0)}))}}]),n}(qe),tt=n(1008),nt=_.rU.isNil,rt=function(e){d()(n,e);var t=g()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform float u_BloomFinal: 0.0;\nuniform sampler2D u_Texture;\nuniform sampler2D u_Texture2;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_radius: 5.0;\nuniform float u_intensity: 0.3;\nuniform float u_baseRadio: 0.5;\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nfloat luminance(vec4 color) {\n  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;\n}\n\nvoid main() {\n  // vec4 baseColor = texture2D(u_Texture, v_UV);\n\n  float r = sqrt(u_radius);\n\n  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));\n  // c1 *= luminance(c1);\n  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));\n  // c2 *= luminance(c2);\n  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));\n  // c3 *= luminance(c3);\n  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));\n  // c4 *= luminance(c4);\n  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;\n\n  // float lum = luminance(inbloomColor);\n  // inbloomColor.rgb *= lum;\n\n  if(u_BloomFinal > 0.0) {\n    vec4 baseColor = texture2D(u_Texture2, v_UV);\n    float baselum = luminance(baseColor);\n    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);\n    if(baselum <= 0.2) {\n      gl_FragColor = inbloomColor * u_intensity;\n    }\n  } else {\n    gl_FragColor = inbloomColor;\n  }\n}"});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,o=this.rendererService.getViewportSize(),a=o.width,s=o.height;return{vs:t,fs:n,uniforms:i()(i()({},r),{},{u_ViewportSize:[a,s]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return nt(e.bloomRadius)||(t.u_radius=e.bloomRadius),nt(e.bloomIntensity)||(t.u_intensity=e.bloomIntensity),nt(e.bloomBaseRadio)||(t.u_baseRadio=e.bloomBaseRadio),t}}]),n}(tt.Z),it=_.rU.isNil,ot=function(e){d()(n,e);var t=g()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,o=this.rendererService.getViewportSize(),a=o.width,s=o.height;return{vs:t,fs:n,uniforms:i()(i()({},r),{},{u_ViewportSize:[a,s]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return it(e.blurRadius)||(t.u_BlurDir=[e.blurRadius,0]),t}}]),n}(tt.Z),at=_.rU.isNil,st=function(e){d()(n,e);var t=g()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}"});var e=this.shaderModuleService.getModule("blur-pass"),t=e.vs,n=e.fs,r=e.uniforms,o=this.rendererService.getViewportSize(),a=o.width,s=o.height;return{vs:t,fs:n,uniforms:i()(i()({},r),{},{u_ViewportSize:[a,s]})}}},{key:"convertOptionsToUniforms",value:function(e){var t={};return at(e.blurRadius)||(t.u_BlurDir=[0,e.blurRadius]),t}}]),n}(tt.Z),ut=function(e){d()(n,e);var t=g()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:'varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Angle : 0;\nuniform float u_Size : 8;\n\n#pragma include "common"\n\nfloat scale = PI / u_Size;\n\nfloat pattern(float u_Angle, vec2 texSize, vec2 texCoord) {\n  float s = sin(u_Angle), c = cos(u_Angle);\n  vec2 tex = texCoord * texSize - u_Center * texSize;\n  vec2 point = vec2(\n    c * tex.x - s * tex.y,\n    s * tex.x + c * tex.y\n  ) * scale;\n  return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js\nvec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  vec3 cmy = 1.0 - color.rgb;\n  float k = min(cmy.x, min(cmy.y, cmy.z));\n  cmy = (cmy - k) / (1.0 - k);\n  cmy = clamp(\n    cmy * 10.0 - 3.0 + vec3(\n      pattern(u_Angle + 0.26179, texSize, texCoord),\n      pattern(u_Angle + 1.30899, texSize, texCoord),\n      pattern(u_Angle, texSize, texCoord)\n    ),\n    0.0,\n    1.0\n  );\n  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);\n  return vec4(1.0 - cmy - k, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);\n}'});var e=this.shaderModuleService.getModule("colorhalftone-pass"),t=e.vs,n=e.fs,r=e.uniforms,o=this.rendererService.getViewportSize(),a=o.width,s=o.height;return{vs:t,fs:n,uniforms:i()(i()({},r),{},{u_ViewportSize:[a,s]})}}}]),n}(tt.Z),lt=function(e){d()(n,e);var t=g()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}"}),this.shaderModuleService.getModule("copy-pass")}}]),n}(tt.Z),ct=function(e){d()(n,e);var t=g()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Scale : 10;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js\nvec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;\n  tex.y /= 0.866025404;\n  tex.x -= tex.y * 0.5;\n  vec2 a;\n  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\n    a = vec2(floor(tex.x), floor(tex.y));\n  }\n  else a = vec2(ceil(tex.x), ceil(tex.y));\n  vec2 b = vec2(ceil(tex.x), floor(tex.y));\n  vec2 c = vec2(floor(tex.x), ceil(tex.y));\n  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\n  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\n  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\n  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\n  float alen = length(TEX - A);\n  float blen = length(TEX - B);\n  float clen = length(TEX - C);\n  vec2 choice;\n  if (alen < blen) {\n    if (alen < clen) choice = a;\n    else choice = c;\n  } else {\n    if (blen < clen) choice = b;\n    else choice = c;\n  }\n  choice.x += choice.y * 0.5;\n  choice.y *= 0.866025404;\n  choice *= u_Scale / texSize;\n  return texture2D(texture, choice + u_Center);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("hexagonalpixelate-pass"),t=e.vs,n=e.fs,r=e.uniforms,o=this.rendererService.getViewportSize(),a=o.width,s=o.height;return{vs:t,fs:n,uniforms:i()(i()({},r),{},{u_ViewportSize:[a,s]})}}}]),n}(tt.Z),ft=function(e){d()(n,e);var t=g()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_Strength : 0.6;\n\nvec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 dx = vec2(1.0 / texSize.x, 0.0);\n  vec2 dy = vec2(0.0, 1.0 / texSize.y);\n  vec4 color = texture2D(texture, texCoord);\n  float bigTotal = 0.0;\n  float smallTotal = 0.0;\n  vec3 bigAverage = vec3(0.0);\n  vec3 smallAverage = vec3(0.0);\n  for (float x = -2.0; x <= 2.0; x += 1.0) {\n    for (float y = -2.0; y <= 2.0; y += 1.0) {\n      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\n      bigAverage += sample;\n      bigTotal += 1.0;\n      if (abs(x) + abs(y) < 2.0) {\n        smallAverage += sample;\n        smallTotal += 1.0;\n      }\n    }\n  }\n  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\n  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;\n  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}"});var e=this.shaderModuleService.getModule("ink-pass"),t=e.vs,n=e.fs,r=e.uniforms,o=this.rendererService.getViewportSize(),a=o.width,s=o.height;return{vs:t,fs:n,uniforms:i()(i()({},r),{},{u_ViewportSize:[a,s]})}}}]),n}(tt.Z),ht=function(e){d()(n,e);var t=g()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\n\nfloat rand(vec2 co) {\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js\nvec4 noise_filterColor(vec4 color, vec2 texCoord) {\n  float diff = (rand(texCoord) - 0.5) * u_Amount;\n  color.r += diff;\n  color.g += diff;\n  color.b += diff;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);\n}"}),this.shaderModuleService.getModule("noise-pass")}}]),n}(tt.Z),pt=function(e){d()(n,e);var t=g()(n);function n(){return u()(this,n),t.apply(this,arguments)}return c()(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:"attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",fs:"varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform float u_Amount : 0.5;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js\nvec4 sepia_filterColor(vec4 color) {\n  float r = color.r;\n  float g = color.g;\n  float b = color.b;\n  color.r =\n    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));\n  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));\n  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = sepia_filterColor(gl_FragColor);\n}"}),this.shaderModuleService.getModule("sepia-pass")}}]),n}(tt.Z),dt=new Q,vt=0;function gt(){var e=new je,t=new se,n=new U,r=new ie(n),i=new M,o=new P,a=new H,s=new W,u=new j,l={id:"".concat(vt++),globalConfigService:dt,shaderModuleService:e,debugService:t,cameraService:n,coordinateSystemService:r,fontService:i,iconService:o,markerService:a,popupService:s,controlService:u,customRenderService:{}},c=new _e(l);l.layerService=c;var f=new Oe(l);l.sceneService=f;var h=new he(l);l.interactionService=h;var p=new ge(l);l.pickingService=p;var d={clear:new Ke,pixelPicking:new $e,render:new et};l.normalPassFactory=function(e){return d[e]};var v={copy:new lt,bloom:new rt,blurH:new ot,blurV:new st,noise:new ht,sepia:new pt,colorHalftone:new ut,hexagonalPixelate:new ct,ink:new ft};return l.postProcessingPass=v,l.postProcessingPassFactory=function(e){return v[e]},l}function mt(e){var t=i()({},e);return t.postProcessor=new Je(t.rendererService),t.multiPassRenderer=new Qe(t.postProcessor),t.styleAttributeService=new we(t.rendererService),t}},7702:function(){},2011:function(){},2539:function(){},3223:function(e,t,n){"use strict";n.d(t,{l:function(){return r}});var r={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"}},4373:function(e,t,n){"use strict";n.d(t,{d:function(){return r}});var r=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({})},8346:function(){},663:function(){},7626:function(){},409:function(e,t,n){"use strict";n.d(t,{k:function(){return i},l:function(){return r}});var r=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.METER_OFFSET=5]="METER_OFFSET",e}({}),i={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter"}},5315:function(e,t,n){"use strict";n.d(t,{O:function(){return r}});var r={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"}},6571:function(e,t,n){"use strict";n.d(t,{s:function(){return r}});var r=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({})},5090:function(){},8186:function(e,t,n){"use strict";n.d(t,{KD:function(){return a},h0:function(){return r},lE:function(){return o},yn:function(){return i}});var r=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),i=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),o=function(e){return e.AND="and",e.OR="or",e}({}),a=function(e){return e.INIT="init",e.UPDATE="update",e}({})},689:function(e,t,n){"use strict";n.d(t,{GC:function(){return o},ee:function(){return i},vY:function(){return r}});var r=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e.CUSTOM="threshold",e}({}),i=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),o=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({})},3113:function(e,t,n){"use strict";n.d(t,{I:function(){return r}});var r=["mapload","mapchange","mapAfterFrameChange"]},4599:function(){},7092:function(){},3594:function(){},2875:function(){},6483:function(){},8188:function(e,t,n){"use strict";n.d(t,{G:function(){return r}});var r=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({})},7301:function(){},1795:function(){},4:function(e,t,n){"use strict";n.d(t,{v:function(){return r}});var r=function(e){return e[e.SAMPLED=0]="SAMPLED",e[e.RENDER_TARGET=1]="RENDER_TARGET",e}({})},6306:function(){},901:function(e,t,n){"use strict";n.d(t,{gl:function(){return r}});var r=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({})},1008:function(e,t,n){"use strict";n.d(t,{Z:function(){return m}});var r=n(4450),i=n.n(r),o=n(8025),a=n.n(o),s=n(1133),u=n.n(s),l=n(3769),c=n.n(l),f=n(7193),h=n(8188),p=n(901),d=f.rU.camelCase,v=f.rU.isNil,g=f.rU.upperFirst,m=function(){function e(){a()(this,e),c()(this,"shaderModuleService",void 0),c()(this,"rendererService",void 0),c()(this,"config",void 0),c()(this,"quad","attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}"),c()(this,"enabled",!0),c()(this,"renderToScreen",!1),c()(this,"model",void 0),c()(this,"name",void 0),c()(this,"optionsToUpdate",{})}return u()(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(e){this.name=e}},{key:"getType",value:function(){return h.G.PostProcessing}},{key:"init",value:function(e,t){this.config=t,this.rendererService=e.getContainer().rendererService,this.shaderModuleService=e.getContainer().shaderModuleService;var n=this.rendererService,r=n.createAttribute,o=n.createBuffer,a=n.createModel,s=this.setupShaders(),u=s.vs,l=s.fs,c=s.uniforms;this.model=a({vs:u,fs:l,attributes:{a_Position:r({buffer:o({data:[-4,-4,4,-4,0,4],type:p.gl.FLOAT}),size:2})},uniforms:i()(i()({u_Texture:null},c),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:"copy"===this.getName()}})}},{key:"render",value:function(e,t){var n=this,r=e.multiPassRenderer.getPostProcessor(),o=this.rendererService,a=o.useFramebuffer,s=o.getViewportSize,u=o.clear,l=s(),c=l.width,f=l.height;a(this.renderToScreen?null:r.getWriteFBO(),(function(){u({framebuffer:r.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var e=i()({u_BloomFinal:0,u_Texture:r.getReadFBO(),u_ViewportSize:[c,f]},n.convertOptionsToUniforms(n.optionsToUpdate));t&&(e.u_BloomFinal=1,e.u_Texture2=t),n.model.draw({uniforms:e})}))}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(e){this.enabled=e}},{key:"setRenderToScreen",value:function(e){this.renderToScreen=e}},{key:"updateOptions",value:function(e){this.optionsToUpdate=i()(i()({},this.optionsToUpdate),e)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(e){var t={};return Object.keys(e).forEach((function(n){v(e[n])||(t["u_".concat(g(d(n)))]=e[n])})),t}}]),e}()},8420:function(e,t,n){"use strict";n.d(t,{P:function(){return r}});var r=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},4892:function(){},3954:function(e,t,n){"use strict";n.d(t,{n:function(){return r}});var r=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({})},8521:function(e,t,n){"use strict";function r(e){var t=0;switch(e){case"vec2":case"ivec2":t=2;break;case"vec3":case"ivec3":t=3;break;case"vec4":case"ivec4":case"mat2":t=4;break;case"mat3":t=9;break;case"mat4":t=16}return t}n.d(t,{Vb:function(){return s},y4:function(){return a}});var i=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function o(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n={};return{content:e=e.replace(i,(function(e,i,o){var a=o.split(":"),s=a[0].trim(),u="";switch(a.length>1&&(u=a[1].trim()),i){case"bool":u="true"===u;break;case"float":case"int":u=Number(u);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":u=u?u.replace("[","").replace("]","").split(",").reduce((function(e,t){return e.push(Number(t.trim())),e}),[]):new Array(r(i)).fill(0)}return n[s]=u,"".concat(t?"uniform ":"").concat(i," ").concat(s,";\n")})),uniforms:n}}function a(e){var t=o(e,!0),n=t.content,r=t.uniforms;return{content:n=n.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,(function(e,t,n){var i=o(n=n.trim().replace(/^.*$/gm,(function(e){return"uniform ".concat(e)}))),a=i.content,s=i.uniforms;return Object.assign(r,s),"".concat(t,"{\n").concat(a,"\n};")})),uniforms:r}}function s(e){var t={};return e.replace(i,(function(e,n,r){var i=r.trim();return t[i]?"":(t[i]=!0,"uniform ".concat(n," ").concat(i,";\n"))}))}},7747:function(e,t,n){"use strict";n.d(t,{wL:function(){return f}});var r=n(3420),i=n.n(r),o=n(7193),a=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"];function s(e){return a.indexOf(e)}var u=o.rU.clamp,l=131072;function c(e,t){return 256*(e=u(Math.floor(e),0,255))+(t=u(Math.floor(t),0,255))}function f(e){var t=e.color,n=e.radius,r=e.tileX,o=e.tileY,a=e.shape,u=e.opacity,f=e.stroke,h=e.strokeWidth,p=e.strokeOpacity,d=[],v=[],g=[],m=[c(t[0],t[1]),c(t[2],t[3])],y=[c(f[0],f[1]),c(f[2],f[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach((function(e){var t=i()(e,2),c=t[0],f=t[1];d.push([].concat(m,[8388608*(c+1)+2097152*(f+1)+s(a)*l+n,524288*(r+512)+64*(o+512)])),v.push([].concat(y,[h,p])),g.push([u,0,0,0])})),{packedBuffer:d,packedBuffer2:v,packedBuffer3:g}}},8909:function(e,t,n){"use strict";n.d(t,{i:function(){return r}});var r='"2.22.3"'},6677:function(e,t,n){"use strict";n.d(t,{Z:function(){return Mi}});var r=n(2786),i=n.n(r),o=n(1409),a=n.n(o),s=n(6502),u=n.n(s),l=n(2729),c=n.n(l),f=n(4351),h=n.n(f),p=n(4450),d=n.n(p),v=n(8025),g=n.n(v),m=n(1133),y=n.n(m),_=n(1119),b=n.n(_),x=n(3491),E=n.n(x),T=n(2060),A=n.n(T),S=n(3769),C=n.n(S),R=n(4474),w=n(7033),M=n(7193),k=n(3262),L=function(){function e(){g()(this,e),C()(this,"mapService",void 0),C()(this,"fontService",void 0)}return y()(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService,i=t.mapService,o=t.fontService;this.mapService=i,this.fontService=o,e.hooks.init.tapPromise("DataMappingPlugin",h()(u()().mark((function t(){return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.log(w.IDebugLog.MappingStart,w.ILayerStage.INIT),n.generateMaping(e,{styleAttributeService:r}),e.log(w.IDebugLog.MappingEnd,w.ILayerStage.INIT);case 3:case"end":return t.stop()}}),t)})))),e.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var t=h()(u()().mark((function t(i){var o;return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return",i);case 2:return e.dataState.dataMappingNeedUpdate=!1,e.log(w.IDebugLog.MappingStart,w.ILayerStage.UPDATE),o=n.generateMaping(e,{styleAttributeService:r}),e.log(w.IDebugLog.MappingEnd,w.ILayerStage.UPDATE),t.abrupt("return",o);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.hooks.beforeRender.tap("DataMappingPlugin",(function(){var t=e.getSource();if(!e.layerModelNeedUpdate&&t&&t.inited){var i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=t.data.dataArray;if(!Array.isArray(a)||0!==a.length){var s=i.filter((function(e){return e.needRemapping})),u=a;if(null!=o&&o.needRemapping&&null!=o&&o.scale&&(u=a.filter((function(e){return n.applyAttributeMapping(o,e)[0]}))),s.length){var l=n.mapping(e,s,u,e.getEncodedData());e.setEncodedData(l)}}}}))}},{key:"generateMaping",value:function(e,t){var n=this,r=t.styleAttributeService,i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=e.getSource().data.dataArray,s=a;null!=o&&o.scale&&(s=a.filter((function(e){return n.applyAttributeMapping(o,e)[0]}))),s=e.processData(s);var u=this.mapping(e,i,s,void 0);return e.setEncodedData(u),e.emit("dataUpdate",null),!0}},{key:"mapping",value:function(e,t,n,r){var i=this,o=t.filter((function(e){return void 0!==e.scale})).filter((function(e){return"filter"!==e.name})),a=n.map((function(e,t){var n=r?r[t]:{},a=d()({id:e._id,coordinates:e.coordinates},n);return o.forEach((function(t){var n=i.applyAttributeMapping(t,e);"color"!==t.name&&"stroke"!==t.name||(n=n.map((function(e){return(0,M.CI)(e)}))),a[t.name]=Array.isArray(n)&&1===n.length?n[0]:n,"shape"===t.name&&(a.shape=i.fontService.getIconFontKey(a[t.name]))})),a}));return t.forEach((function(e){e.needRemapping=!1})),this.adjustData2SimpleCoordinates(a),a}},{key:"adjustData2SimpleCoordinates",value:function(e){var t=this;e.length>0&&"SIMPLE"===this.mapService.version&&e.map((function(e){e.simpleCoordinate||(e.coordinates=t.unProjectCoordinates(e.coordinates),e.simpleCoordinate=!0)}))}},{key:"unProjectCoordinates",value:function(e){var t=this;if("number"==typeof e[0])return this.mapService.simpleMapCoord.unproject(e);if(e[0]&&e[0][0]instanceof Array){var n=[];return e.map((function(e){var r=[];e.map((function(e){r.push(t.mapService.simpleMapCoord.unproject(e))})),n.push(r)})),n}var r=[];return e.map((function(e){r.push(t.mapService.simpleMapCoord.unproject(e))})),r}},{key:"applyAttributeMapping",value:function(e,t){var n;if(!e.scale)return[];var r=(null==e||null===(n=e.scale)||void 0===n?void 0:n.scalers)||[],i=[];return r.forEach((function(n){var r,o=n.field;(t.hasOwnProperty(o)||"variable"===(null===(r=e.scale)||void 0===r?void 0:r.type))&&i.push(t[o])})),e.mapping?e.mapping(i):[]}},{key:"getArrowPoints",value:function(e,t){var n=[t[0]-e[0],t[1]-e[1]],r=(0,M.Fv)(n);return[e[0]+1e-4*r[0],e[1]+1e-4*r[1]]}}]),e}(),O=n(946),I=function(){function e(){g()(this,e),C()(this,"mapService",void 0)}return y()(e,[{key:"apply",value:function(e){var t=this;this.mapService=e.getContainer().mapService,e.hooks.init.tapPromise("DataSourcePlugin",h()(u()().mark((function n(){var r,i,o,a;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.log(w.IDebugLog.SourceInitStart,w.ILayerStage.INIT),(r=e.getSource())||(i=e.sourceOption||e.defaultSourceConfig,o=i.data,a=i.options,r=new O.default(o,a),e.setSource(r)),!r.inited){n.next=8;break}t.updateClusterData(e),e.log(w.IDebugLog.SourceInitEnd,w.ILayerStage.INIT),n.next=10;break;case 8:return n.next=10,new Promise((function(n){r.on("update",(function(r){"inited"===r.type&&(t.updateClusterData(e),e.log(w.IDebugLog.SourceInitEnd,w.ILayerStage.INIT)),n(null)}))}));case 10:case"end":return n.stop()}}),n)})))),e.hooks.beforeRenderData.tapPromise("DataSourcePlugin",h()(u()().mark((function n(){var r,i,o;return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t.updateClusterData(e),i=e.dataState.dataSourceNeedUpdate,e.dataState.dataSourceNeedUpdate=!1,o=r||i,n.abrupt("return",o);case 5:case"end":return n.stop()}}),n)}))))}},{key:"updateClusterData",value:function(e){if(e.isTileLayer||e.tileLayer||!e.getSource())return!1;var t=e.getSource(),n=t.cluster,r=t.clusterOptions.zoom,i=void 0===r?0:r,o=this.mapService.getZoom()-1,a=e.dataState.dataSourceNeedUpdate;return n&&a&&t.updateClusterData(Math.floor(o)),!!(n&&Math.abs(e.clusterZoom-o)>=1)&&(i!==Math.floor(o)&&t.updateClusterData(Math.floor(o)),e.clusterZoom=o,!0)}}]),e}();function P(e,t){var n,r;if(void 0===t){var i,o=c()(e);try{for(o.s();!(i=o.n()).done;){var a=i.value;null!=a&&(void 0===n?a>=a&&(n=r=a):(n>a&&(n=a),r<a&&(r=a)))}}catch(e){o.e(e)}finally{o.f()}}else{var s,u=-1,l=c()(e);try{for(l.s();!(s=l.n()).done;){var f=s.value;null!=(f=t(f,++u,e))&&(void 0===n?f>=f&&(n=r=f):(n>f&&(n=f),r<f&&(r=f)))}}catch(e){l.e(e)}finally{l.f()}}return[n,r]}var N=n(7361);function B(e,t,n,r,i){var o=e*e,a=o*e;return((1-3*e+3*o-a)*t+(4-6*o+3*a)*n+(1+3*e+3*o-3*a)*r+a*i)/6}function D(e){return function(){return e}}function U(e,t){return function(n){return e+n*t}}function F(e){return 1==(e=+e)?z:function(t,n){return n-t?function(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(r){return Math.pow(e+r*t,n)}}(t,n,e):D(isNaN(t)?n:t)}}function z(e,t){var n=t-e;return n?U(e,n):D(isNaN(e)?t:e)}var G=function e(t){var n=F(t);function r(e,t){var r=n((e=(0,N.B8)(e)).r,(t=(0,N.B8)(t)).r),i=n(e.g,t.g),o=n(e.b,t.b),a=z(e.opacity,t.opacity);return function(t){return e.r=r(t),e.g=i(t),e.b=o(t),e.opacity=a(t),e+""}}return r.gamma=e,r}(1);function V(e){return function(t){var n,r,i=t.length,o=new Array(i),a=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=(0,N.B8)(t[n]),o[n]=r.r||0,a[n]=r.g||0,s[n]=r.b||0;return o=e(o),a=e(a),s=e(s),r.opacity=1,function(e){return r.r=o(e),r.g=a(e),r.b=s(e),r+""}}}var j=V((function(e){var t=e.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,t-1):Math.floor(n*t),i=e[r],o=e[r+1],a=r>0?e[r-1]:2*i-o,s=r<t-1?e[r+2]:2*o-i;return B((n-r/t)*t,a,i,o,s)}}));V((function(e){var t=e.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*t),i=e[(r+t-1)%t],o=e[r%t],a=e[(r+1)%t],s=e[(r+2)%t];return B((n-r/t)*t,i,o,a,s)}}));function H(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function W(e){var t;return 1===e.length&&(t=e,e=function(e,n){return H(t(e),n)}),{left:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)<0?r=o+1:i=o}return r},right:function(t,n,r,i){for(null==r&&(r=0),null==i&&(i=t.length);r<i;){var o=r+i>>>1;e(t[o],n)>0?i=o:r=o+1}return r}}}var X=W(H),Z=X.right,Y=(X.left,Z),q=Array.prototype,K=(q.slice,q.map,Math.sqrt(50)),Q=Math.sqrt(10),$=Math.sqrt(2);function J(e,t,n){var r,i,o,a,s=-1;if(n=+n,(e=+e)===(t=+t)&&n>0)return[e];if((r=t<e)&&(i=e,e=t,t=i),0===(a=ee(e,t,n))||!isFinite(a))return[];if(a>0)for(e=Math.ceil(e/a),t=Math.floor(t/a),o=new Array(i=Math.ceil(t-e+1));++s<i;)o[s]=(e+s)*a;else for(e=Math.floor(e*a),t=Math.ceil(t*a),o=new Array(i=Math.ceil(e-t+1));++s<i;)o[s]=(e-s)/a;return r&&o.reverse(),o}function ee(e,t,n){var r=(t-e)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=K?10:o>=Q?5:o>=$?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=K?10:o>=Q?5:o>=$?2:1)}function te(e,t,n){var r=Math.abs(t-e)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=K?i*=10:o>=Q?i*=5:o>=$&&(i*=2),t<e?-i:i}function ne(e){return null===e?NaN:+e}function re(e,t,n){if(null==n&&(n=ne),r=e.length){if((t=+t)<=0||r<2)return+n(e[0],0,e);if(t>=1)return+n(e[r-1],r-1,e);var r,i=(r-1)*t,o=Math.floor(i),a=+n(e[o],o,e);return a+(+n(e[o+1],o+1,e)-a)*(i-o)}}var ie="$";function oe(){}function ae(e,t){var n=new oe;if(e instanceof oe)e.each((function(e,t){n.set(t,e)}));else if(Array.isArray(e)){var r,i=-1,o=e.length;if(null==t)for(;++i<o;)n.set(i,e[i]);else for(;++i<o;)n.set(t(r=e[i],i,e),r)}else if(e)for(var a in e)n.set(a,e[a]);return n}oe.prototype=ae.prototype={constructor:oe,has:function(e){return ie+e in this},get:function(e){return this[ie+e]},set:function(e,t){return this[ie+e]=t,this},remove:function(e){var t=ie+e;return t in this&&delete this[t]},clear:function(){for(var e in this)e[0]===ie&&delete this[e]},keys:function(){var e=[];for(var t in this)t[0]===ie&&e.push(t.slice(1));return e},values:function(){var e=[];for(var t in this)t[0]===ie&&e.push(this[t]);return e},entries:function(){var e=[];for(var t in this)t[0]===ie&&e.push({key:t.slice(1),value:this[t]});return e},size:function(){var e=0;for(var t in this)t[0]===ie&&++e;return e},empty:function(){for(var e in this)if(e[0]===ie)return!1;return!0},each:function(e){for(var t in this)t[0]===ie&&e(this[t],t.slice(1),this)}};var se=ae;function ue(){}var le=se.prototype;function ce(e,t){var n=new ue;if(e instanceof ue)e.each((function(e){n.add(e)}));else if(e){var r=-1,i=e.length;if(null==t)for(;++r<i;)n.add(e[r]);else for(;++r<i;)n.add(t(e[r],r,e))}return n}ue.prototype=ce.prototype={constructor:ue,has:le.has,add:function(e){return this[ie+(e+="")]=e,this},remove:le.remove,clear:le.clear,values:le.keys,size:le.size,empty:le.empty,each:le.each};var fe=Array.prototype,he=fe.map,pe=fe.slice;function de(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function ve(e,t){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(t).domain(e)}return this}var ge={name:"implicit"};function me(){var e=se(),t=[],n=[],r=ge;function i(i){var o=i+"",a=e.get(o);if(!a){if(r!==ge)return r;e.set(o,a=t.push(i))}return n[(a-1)%n.length]}return i.domain=function(n){if(!arguments.length)return t.slice();t=[],e=se();for(var r,o,a=-1,s=n.length;++a<s;)e.has(o=(r=n[a])+"")||e.set(o,t.push(r));return i},i.range=function(e){return arguments.length?(n=pe.call(e),i):n.slice()},i.unknown=function(e){return arguments.length?(r=e,i):r},i.copy=function(){return me(t,n).unknown(r)},de.apply(i,arguments),i}var ye=n(5116),_e=n.n(ye);function be(e,t){var n,r=t?t.length:0,i=e?Math.min(r,e.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=we(e[n],t[n]);for(;n<r;++n)a[n]=t[n];return function(e){for(n=0;n<i;++n)a[n]=o[n](e);return a}}function xe(e,t){var n=new Date;return e=+e,t=+t,function(r){return n.setTime(e*(1-r)+t*r),n}}function Ee(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function Te(e,t){var n,r={},i={};for(n in null!==e&&"object"===_e()(e)||(e={}),null!==t&&"object"===_e()(t)||(t={}),t)n in e?r[n]=we(e[n],t[n]):i[n]=t[n];return function(e){for(n in r)i[n]=r[n](e);return i}}var Ae=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Se=new RegExp(Ae.source,"g");function Ce(e,t){var n,r,i,o=Ae.lastIndex=Se.lastIndex=0,a=-1,s=[],u=[];for(e+="",t+="";(n=Ae.exec(e))&&(r=Se.exec(t));)(i=r.index)>o&&(i=t.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:Ee(n,r)})),o=Se.lastIndex;return o<t.length&&(i=t.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?function(e){return function(t){return e(t)+""}}(u[0].x):function(e){return function(){return e}}(t):(t=u.length,function(e){for(var n,r=0;r<t;++r)s[(n=u[r]).i]=n.x(e);return s.join("")})}function Re(e,t){t||(t=[]);var n,r=e?Math.min(t.length,e.length):0,i=t.slice();return function(o){for(n=0;n<r;++n)i[n]=e[n]*(1-o)+t[n]*o;return i}}function we(e,t){var n,r,i=_e()(t);return null==t||"boolean"===i?D(t):("number"===i?Ee:"string"===i?(n=(0,N.ZP)(t))?(t=n,G):Ce:t instanceof N.ZP?G:t instanceof Date?xe:(r=t,!ArrayBuffer.isView(r)||r instanceof DataView?Array.isArray(t)?be:"function"!=typeof t.valueOf&&"function"!=typeof t.toString||isNaN(t)?Te:Ee:Re))(e,t)}function Me(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}function ke(e){return+e}var Le=[0,1];function Oe(e){return e}function Ie(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:(n=isNaN(t)?NaN:.5,function(){return n});var n}function Pe(e){var t,n=e[0],r=e[e.length-1];return n>r&&(t=n,n=r,r=t),function(e){return Math.max(n,Math.min(r,e))}}function Ne(e,t,n){var r=e[0],i=e[1],o=t[0],a=t[1];return i<r?(r=Ie(i,r),o=n(a,o)):(r=Ie(r,i),o=n(o,a)),function(e){return o(r(e))}}function Be(e,t,n){var r=Math.min(e.length,t.length)-1,i=new Array(r),o=new Array(r),a=-1;for(e[r]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<r;)i[a]=Ie(e[a],e[a+1]),o[a]=n(t[a],t[a+1]);return function(t){var n=Y(e,t,1,r)-1;return o[n](i[n](t))}}function De(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function Ue(){var e,t,n,r,i,o,a=Le,s=Le,u=we,l=Oe;function c(){return r=Math.min(a.length,s.length)>2?Be:Ne,i=o=null,f}function f(t){return isNaN(t=+t)?n:(i||(i=r(a.map(e),s,u)))(e(l(t)))}return f.invert=function(n){return l(t((o||(o=r(s,a.map(e),Ee)))(n)))},f.domain=function(e){return arguments.length?(a=he.call(e,ke),l===Oe||(l=Pe(a)),c()):a.slice()},f.range=function(e){return arguments.length?(s=pe.call(e),c()):s.slice()},f.rangeRound=function(e){return s=pe.call(e),u=Me,c()},f.clamp=function(e){return arguments.length?(l=e?Pe(a):Oe,f):l!==Oe},f.interpolate=function(e){return arguments.length?(u=e,c()):u},f.unknown=function(e){return arguments.length?(n=e,f):n},function(n,r){return e=n,t=r,c()}}function Fe(e,t){return Ue()(e,t)}var ze,Ge=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Ve(e){if(!(t=Ge.exec(e)))throw new Error("invalid format: "+e);var t;return new je({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function je(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function He(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,r=e.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+e.slice(n+1)]}function We(e){return(e=He(Math.abs(e)))?e[1]:NaN}function Xe(e,t){var n=He(e,t);if(!n)return e+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}Ve.prototype=je.prototype,je.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var Ze={"%":function(e,t){return(100*e).toFixed(t)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},g:function(e,t){return e.toPrecision(t)},o:function(e){return Math.round(e).toString(8)},p:function(e,t){return Xe(100*e,t)},r:Xe,s:function(e,t){var n=He(e,t);if(!n)return e+"";var r=n[0],i=n[1],o=i-(ze=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+He(e,Math.max(0,t+o-1))[0]},X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Ye(e){return e}var qe,Ke,Qe,$e=Array.prototype.map,Je=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function et(e){var t,n,r=void 0===e.grouping||void 0===e.thousands?Ye:(t=$e.call(e.grouping,Number),n=e.thousands+"",function(e,r){for(var i=e.length,o=[],a=0,s=t[0],u=0;i>0&&s>0&&(u+s+1>r&&(s=Math.max(1,r-u)),o.push(e.substring(i-=s,i+s)),!((u+=s+1)>r));)s=t[a=(a+1)%t.length];return o.reverse().join(n)}),i=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?Ye:function(e){return function(t){return t.replace(/[0-9]/g,(function(t){return e[+t]}))}}($e.call(e.numerals,String)),u=void 0===e.percent?"%":e.percent+"",l=void 0===e.minus?"-":e.minus+"",c=void 0===e.nan?"NaN":e.nan+"";function f(e){var t=(e=Ve(e)).fill,n=e.align,f=e.sign,h=e.symbol,p=e.zero,d=e.width,v=e.comma,g=e.precision,m=e.trim,y=e.type;"n"===y?(v=!0,y="g"):Ze[y]||(void 0===g&&(g=12),m=!0,y="g"),(p||"0"===t&&"="===n)&&(p=!0,t="0",n="=");var _="$"===h?i:"#"===h&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",b="$"===h?o:/[%p]/.test(y)?u:"",x=Ze[y],E=/[defgprs%]/.test(y);function T(e){var i,o,u,h=_,T=b;if("c"===y)T=x(e)+T,e="";else{var A=(e=+e)<0||1/e<0;if(e=isNaN(e)?c:x(Math.abs(e),g),m&&(e=function(e){e:for(var t,n=e.length,r=1,i=-1;r<n;++r)switch(e[r]){case".":i=t=r;break;case"0":0===i&&(i=r),t=r;break;default:if(!+e[r])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),A&&0==+e&&"+"!==f&&(A=!1),h=(A?"("===f?f:l:"-"===f||"("===f?"":f)+h,T=("s"===y?Je[8+ze/3]:"")+T+(A&&"("===f?")":""),E)for(i=-1,o=e.length;++i<o;)if(48>(u=e.charCodeAt(i))||u>57){T=(46===u?a+e.slice(i+1):e.slice(i))+T,e=e.slice(0,i);break}}v&&!p&&(e=r(e,1/0));var S=h.length+e.length+T.length,C=S<d?new Array(d-S+1).join(t):"";switch(v&&p&&(e=r(C+e,C.length?d-T.length:1/0),C=""),n){case"<":e=h+e+T+C;break;case"=":e=h+C+e+T;break;case"^":e=C.slice(0,S=C.length>>1)+h+e+T+C.slice(S);break;default:e=C+h+e+T}return s(e)}return g=void 0===g?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),T.toString=function(){return e+""},T}return{format:f,formatPrefix:function(e,t){var n=f(((e=Ve(e)).type="f",e)),r=3*Math.max(-8,Math.min(8,Math.floor(We(t)/3))),i=Math.pow(10,-r),o=Je[8+r/3];return function(e){return n(i*e)+o}}}}function tt(e,t,n,r){var i,o=te(e,t,n);switch((r=Ve(null==r?",f":r)).type){case"s":var a=Math.max(Math.abs(e),Math.abs(t));return null!=r.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(We(t)/3)))-We(Math.abs(e)))}(o,a))||(r.precision=i),Qe(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,We(t)-We(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=function(e){return Math.max(0,-We(Math.abs(e)))}(o))||(r.precision=i-2*("%"===r.type))}return Ke(r)}function nt(e){var t=e.domain;return e.ticks=function(e){var n=t();return J(n[0],n[n.length-1],null==e?10:e)},e.tickFormat=function(e,n){var r=t();return tt(r[0],r[r.length-1],null==e?10:e,n)},e.nice=function(n){null==n&&(n=10);var r,i=t(),o=0,a=i.length-1,s=i[o],u=i[a];return u<s&&(r=s,s=u,u=r,r=o,o=a,a=r),(r=ee(s,u,n))>0?r=ee(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,n):r<0&&(r=ee(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,n)),r>0?(i[o]=Math.floor(s/r)*r,i[a]=Math.ceil(u/r)*r,t(i)):r<0&&(i[o]=Math.ceil(s*r)/r,i[a]=Math.floor(u*r)/r,t(i)),e},e}function rt(e,t){var n,r=0,i=(e=e.slice()).length-1,o=e[r],a=e[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),e[r]=t.floor(o),e[i]=t.ceil(a),e}function it(e){return Math.log(e)}function ot(e){return Math.exp(e)}function at(e){return-Math.log(-e)}function st(e){return-Math.exp(-e)}function ut(e){return isFinite(e)?+("1e"+e):e<0?0:e}function lt(e){return function(t){return-e(-t)}}function ct(e){var t,n,r=e(it,ot),i=r.domain,o=10;function a(){return t=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),function(t){return Math.log(t)/e})}(o),n=function(e){return 10===e?ut:e===Math.E?Math.exp:function(t){return Math.pow(e,t)}}(o),i()[0]<0?(t=lt(t),n=lt(n),e(at,st)):e(it,ot),r}return r.base=function(e){return arguments.length?(o=+e,a()):o},r.domain=function(e){return arguments.length?(i(e),a()):i()},r.ticks=function(e){var r,a=i(),s=a[0],u=a[a.length-1];(r=u<s)&&(h=s,s=u,u=h);var l,c,f,h=t(s),p=t(u),d=null==e?10:+e,v=[];if(!(o%1)&&p-h<d){if(h=Math.round(h)-1,p=Math.round(p)+1,s>0){for(;h<p;++h)for(c=1,l=n(h);c<o;++c)if(!((f=l*c)<s)){if(f>u)break;v.push(f)}}else for(;h<p;++h)for(c=o-1,l=n(h);c>=1;--c)if(!((f=l*c)<s)){if(f>u)break;v.push(f)}}else v=J(h,p,Math.min(p-h,d)).map(n);return r?v.reverse():v},r.tickFormat=function(e,i){if(null==i&&(i=10===o?".0e":","),"function"!=typeof i&&(i=Ke(i)),e===1/0)return i;null==e&&(e=10);var a=Math.max(1,o*e/r.ticks().length);return function(e){var r=e/n(Math.round(t(e)));return r*o<o-.5&&(r*=o),r<=a?i(e):""}},r.nice=function(){return i(rt(i(),{floor:function(e){return n(Math.floor(t(e)))},ceil:function(e){return n(Math.ceil(t(e)))}}))},r}function ft(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function ht(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function pt(e){return e<0?-e*e:e*e}function dt(e){var t=e(Oe,Oe),n=1;function r(){return 1===n?e(Oe,Oe):.5===n?e(ht,pt):e(ft(n),ft(1/n))}return t.exponent=function(e){return arguments.length?(n=+e,r()):n},nt(t)}function vt(){var e=dt(Ue());return e.copy=function(){return De(e,vt()).exponent(e.exponent())},de.apply(e,arguments),e}qe=et({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"}),Ke=qe.format,Qe=qe.formatPrefix;var gt=new Date,mt=new Date;function yt(e,t,n,r){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=function(t){return e(t=new Date(+t)),t},i.ceil=function(n){return e(n=new Date(n-1)),t(n,1),e(n),n},i.round=function(e){var t=i(e),n=i.ceil(e);return e-t<n-e?t:n},i.offset=function(e,n){return t(e=new Date(+e),null==n?1:Math.floor(n)),e},i.range=function(n,r,o){var a,s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r&&o>0))return s;do{s.push(a=new Date(+n)),t(n,o),e(n)}while(a<n&&n<r);return s},i.filter=function(n){return yt((function(t){if(t>=t)for(;e(t),!n(t);)t.setTime(t-1)}),(function(e,r){if(e>=e)if(r<0)for(;++r<=0;)for(;t(e,-1),!n(e););else for(;--r>=0;)for(;t(e,1),!n(e););}))},n&&(i.count=function(t,r){return gt.setTime(+t),mt.setTime(+r),e(gt),e(mt),Math.floor(n(gt,mt))},i.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(r?function(t){return r(t)%e==0}:function(t){return i.count(0,t)%e==0}):i:null}),i}var _t=yt((function(e){e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,t){e.setFullYear(e.getFullYear()+t)}),(function(e,t){return t.getFullYear()-e.getFullYear()}),(function(e){return e.getFullYear()}));_t.every=function(e){return isFinite(e=Math.floor(e))&&e>0?yt((function(t){t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,n){t.setFullYear(t.getFullYear()+n*e)})):null};var bt=_t,xt=(_t.range,yt((function(e){e.setDate(1),e.setHours(0,0,0,0)}),(function(e,t){e.setMonth(e.getMonth()+t)}),(function(e,t){return t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear())}),(function(e){return e.getMonth()}))),Et=xt,Tt=(xt.range,1e3),At=6e4,St=36e5,Ct=864e5,Rt=6048e5;function wt(e){return yt((function(t){t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+7*t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*At)/Rt}))}var Mt=wt(0),kt=wt(1),Lt=wt(2),Ot=wt(3),It=wt(4),Pt=wt(5),Nt=wt(6),Bt=(Mt.range,kt.range,Lt.range,Ot.range,It.range,Pt.range,Nt.range,yt((function(e){e.setHours(0,0,0,0)}),(function(e,t){e.setDate(e.getDate()+t)}),(function(e,t){return(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*At)/Ct}),(function(e){return e.getDate()-1}))),Dt=Bt,Ut=(Bt.range,yt((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Tt-e.getMinutes()*At)}),(function(e,t){e.setTime(+e+t*St)}),(function(e,t){return(t-e)/St}),(function(e){return e.getHours()}))),Ft=Ut,zt=(Ut.range,yt((function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Tt)}),(function(e,t){e.setTime(+e+t*At)}),(function(e,t){return(t-e)/At}),(function(e){return e.getMinutes()}))),Gt=zt,Vt=(zt.range,yt((function(e){e.setTime(e-e.getMilliseconds())}),(function(e,t){e.setTime(+e+t*Tt)}),(function(e,t){return(t-e)/Tt}),(function(e){return e.getUTCSeconds()}))),jt=Vt,Ht=(Vt.range,yt((function(){}),(function(e,t){e.setTime(+e+t)}),(function(e,t){return t-e})));Ht.every=function(e){return e=Math.floor(e),isFinite(e)&&e>0?e>1?yt((function(t){t.setTime(Math.floor(t/e)*e)}),(function(t,n){t.setTime(+t+n*e)}),(function(t,n){return(n-t)/e})):Ht:null};var Wt=Ht;Ht.range;function Xt(e){return yt((function(t){t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+7*t)}),(function(e,t){return(t-e)/Rt}))}var Zt=Xt(0),Yt=Xt(1),qt=Xt(2),Kt=Xt(3),Qt=Xt(4),$t=Xt(5),Jt=Xt(6),en=(Zt.range,Yt.range,qt.range,Kt.range,Qt.range,$t.range,Jt.range,yt((function(e){e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCDate(e.getUTCDate()+t)}),(function(e,t){return(t-e)/Ct}),(function(e){return e.getUTCDate()-1}))),tn=en,nn=(en.range,yt((function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,t){e.setUTCFullYear(e.getUTCFullYear()+t)}),(function(e,t){return t.getUTCFullYear()-e.getUTCFullYear()}),(function(e){return e.getUTCFullYear()})));nn.every=function(e){return isFinite(e=Math.floor(e))&&e>0?yt((function(t){t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,n){t.setUTCFullYear(t.getUTCFullYear()+n*e)})):null};var rn=nn;nn.range;function on(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function an(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function sn(e,t,n){return{y:e,m:t,d:n,H:0,M:0,S:0,L:0}}var un,ln,cn={"-":"",_:" ",0:"0"},fn=/^\s*\d+/,hn=/^%/,pn=/[\\^$*+?|[\]().{}]/g;function dn(e,t,n){var r=e<0?"-":"",i=(r?-e:e)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(t)+i:i)}function vn(e){return e.replace(pn,"\\$&")}function gn(e){return new RegExp("^(?:"+e.map(vn).join("|")+")","i")}function mn(e){for(var t={},n=-1,r=e.length;++n<r;)t[e[n].toLowerCase()]=n;return t}function yn(e,t,n){var r=fn.exec(t.slice(n,n+1));return r?(e.w=+r[0],n+r[0].length):-1}function _n(e,t,n){var r=fn.exec(t.slice(n,n+1));return r?(e.u=+r[0],n+r[0].length):-1}function bn(e,t,n){var r=fn.exec(t.slice(n,n+2));return r?(e.U=+r[0],n+r[0].length):-1}function xn(e,t,n){var r=fn.exec(t.slice(n,n+2));return r?(e.V=+r[0],n+r[0].length):-1}function En(e,t,n){var r=fn.exec(t.slice(n,n+2));return r?(e.W=+r[0],n+r[0].length):-1}function Tn(e,t,n){var r=fn.exec(t.slice(n,n+4));return r?(e.y=+r[0],n+r[0].length):-1}function An(e,t,n){var r=fn.exec(t.slice(n,n+2));return r?(e.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function Sn(e,t,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(n,n+6));return r?(e.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function Cn(e,t,n){var r=fn.exec(t.slice(n,n+1));return r?(e.q=3*r[0]-3,n+r[0].length):-1}function Rn(e,t,n){var r=fn.exec(t.slice(n,n+2));return r?(e.m=r[0]-1,n+r[0].length):-1}function wn(e,t,n){var r=fn.exec(t.slice(n,n+2));return r?(e.d=+r[0],n+r[0].length):-1}function Mn(e,t,n){var r=fn.exec(t.slice(n,n+3));return r?(e.m=0,e.d=+r[0],n+r[0].length):-1}function kn(e,t,n){var r=fn.exec(t.slice(n,n+2));return r?(e.H=+r[0],n+r[0].length):-1}function Ln(e,t,n){var r=fn.exec(t.slice(n,n+2));return r?(e.M=+r[0],n+r[0].length):-1}function On(e,t,n){var r=fn.exec(t.slice(n,n+2));return r?(e.S=+r[0],n+r[0].length):-1}function In(e,t,n){var r=fn.exec(t.slice(n,n+3));return r?(e.L=+r[0],n+r[0].length):-1}function Pn(e,t,n){var r=fn.exec(t.slice(n,n+6));return r?(e.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function Nn(e,t,n){var r=hn.exec(t.slice(n,n+1));return r?n+r[0].length:-1}function Bn(e,t,n){var r=fn.exec(t.slice(n));return r?(e.Q=+r[0],n+r[0].length):-1}function Dn(e,t,n){var r=fn.exec(t.slice(n));return r?(e.s=+r[0],n+r[0].length):-1}function Un(e,t){return dn(e.getDate(),t,2)}function Fn(e,t){return dn(e.getHours(),t,2)}function zn(e,t){return dn(e.getHours()%12||12,t,2)}function Gn(e,t){return dn(1+Dt.count(bt(e),e),t,3)}function Vn(e,t){return dn(e.getMilliseconds(),t,3)}function jn(e,t){return Vn(e,t)+"000"}function Hn(e,t){return dn(e.getMonth()+1,t,2)}function Wn(e,t){return dn(e.getMinutes(),t,2)}function Xn(e,t){return dn(e.getSeconds(),t,2)}function Zn(e){var t=e.getDay();return 0===t?7:t}function Yn(e,t){return dn(Mt.count(bt(e)-1,e),t,2)}function qn(e){var t=e.getDay();return t>=4||0===t?It(e):It.ceil(e)}function Kn(e,t){return e=qn(e),dn(It.count(bt(e),e)+(4===bt(e).getDay()),t,2)}function Qn(e){return e.getDay()}function $n(e,t){return dn(kt.count(bt(e)-1,e),t,2)}function Jn(e,t){return dn(e.getFullYear()%100,t,2)}function er(e,t){return dn((e=qn(e)).getFullYear()%100,t,2)}function tr(e,t){return dn(e.getFullYear()%1e4,t,4)}function nr(e,t){var n=e.getDay();return dn((e=n>=4||0===n?It(e):It.ceil(e)).getFullYear()%1e4,t,4)}function rr(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+dn(t/60|0,"0",2)+dn(t%60,"0",2)}function ir(e,t){return dn(e.getUTCDate(),t,2)}function or(e,t){return dn(e.getUTCHours(),t,2)}function ar(e,t){return dn(e.getUTCHours()%12||12,t,2)}function sr(e,t){return dn(1+tn.count(rn(e),e),t,3)}function ur(e,t){return dn(e.getUTCMilliseconds(),t,3)}function lr(e,t){return ur(e,t)+"000"}function cr(e,t){return dn(e.getUTCMonth()+1,t,2)}function fr(e,t){return dn(e.getUTCMinutes(),t,2)}function hr(e,t){return dn(e.getUTCSeconds(),t,2)}function pr(e){var t=e.getUTCDay();return 0===t?7:t}function dr(e,t){return dn(Zt.count(rn(e)-1,e),t,2)}function vr(e){var t=e.getUTCDay();return t>=4||0===t?Qt(e):Qt.ceil(e)}function gr(e,t){return e=vr(e),dn(Qt.count(rn(e),e)+(4===rn(e).getUTCDay()),t,2)}function mr(e){return e.getUTCDay()}function yr(e,t){return dn(Yt.count(rn(e)-1,e),t,2)}function _r(e,t){return dn(e.getUTCFullYear()%100,t,2)}function br(e,t){return dn((e=vr(e)).getUTCFullYear()%100,t,2)}function xr(e,t){return dn(e.getUTCFullYear()%1e4,t,4)}function Er(e,t){var n=e.getUTCDay();return dn((e=n>=4||0===n?Qt(e):Qt.ceil(e)).getUTCFullYear()%1e4,t,4)}function Tr(){return"+0000"}function Ar(){return"%"}function Sr(e){return+e}function Cr(e){return Math.floor(+e/1e3)}!function(e){un=function(e){var t=e.dateTime,n=e.date,r=e.time,i=e.periods,o=e.days,a=e.shortDays,s=e.months,u=e.shortMonths,l=gn(i),c=mn(i),f=gn(o),h=mn(o),p=gn(a),d=mn(a),v=gn(s),g=mn(s),m=gn(u),y=mn(u),_={a:function(e){return a[e.getDay()]},A:function(e){return o[e.getDay()]},b:function(e){return u[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:Un,e:Un,f:jn,g:er,G:nr,H:Fn,I:zn,j:Gn,L:Vn,m:Hn,M:Wn,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:Sr,s:Cr,S:Xn,u:Zn,U:Yn,V:Kn,w:Qn,W:$n,x:null,X:null,y:Jn,Y:tr,Z:rr,"%":Ar},b={a:function(e){return a[e.getUTCDay()]},A:function(e){return o[e.getUTCDay()]},b:function(e){return u[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:ir,e:ir,f:lr,g:br,G:Er,H:or,I:ar,j:sr,L:ur,m:cr,M:fr,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:Sr,s:Cr,S:hr,u:pr,U:dr,V:gr,w:mr,W:yr,x:null,X:null,y:_r,Y:xr,Z:Tr,"%":Ar},x={a:function(e,t,n){var r=p.exec(t.slice(n));return r?(e.w=d[r[0].toLowerCase()],n+r[0].length):-1},A:function(e,t,n){var r=f.exec(t.slice(n));return r?(e.w=h[r[0].toLowerCase()],n+r[0].length):-1},b:function(e,t,n){var r=m.exec(t.slice(n));return r?(e.m=y[r[0].toLowerCase()],n+r[0].length):-1},B:function(e,t,n){var r=v.exec(t.slice(n));return r?(e.m=g[r[0].toLowerCase()],n+r[0].length):-1},c:function(e,n,r){return A(e,t,n,r)},d:wn,e:wn,f:Pn,g:An,G:Tn,H:kn,I:kn,j:Mn,L:In,m:Rn,M:Ln,p:function(e,t,n){var r=l.exec(t.slice(n));return r?(e.p=c[r[0].toLowerCase()],n+r[0].length):-1},q:Cn,Q:Bn,s:Dn,S:On,u:_n,U:bn,V:xn,w:yn,W:En,x:function(e,t,r){return A(e,n,t,r)},X:function(e,t,n){return A(e,r,t,n)},y:An,Y:Tn,Z:Sn,"%":Nn};function E(e,t){return function(n){var r,i,o,a=[],s=-1,u=0,l=e.length;for(n instanceof Date||(n=new Date(+n));++s<l;)37===e.charCodeAt(s)&&(a.push(e.slice(u,s)),null!=(i=cn[r=e.charAt(++s)])?r=e.charAt(++s):i="e"===r?" ":"0",(o=t[r])&&(r=o(n,i)),a.push(r),u=s+1);return a.push(e.slice(u,s)),a.join("")}}function T(e,t){return function(n){var r,i,o=sn(1900,void 0,1);if(A(o,e,n+="",0)!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(t&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(r=an(sn(o.y,0,1))).getUTCDay(),r=i>4||0===i?Yt.ceil(r):Yt(r),r=tn.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(i=(r=on(sn(o.y,0,1))).getDay(),r=i>4||0===i?kt.ceil(r):kt(r),r=Dt.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?an(sn(o.y,0,1)).getUTCDay():on(sn(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,an(o)):on(o)}}function A(e,t,n,r){for(var i,o,a=0,s=t.length,u=n.length;a<s;){if(r>=u)return-1;if(37===(i=t.charCodeAt(a++))){if(i=t.charAt(a++),!(o=x[i in cn?t.charAt(a++):i])||(r=o(e,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}return _.x=E(n,_),_.X=E(r,_),_.c=E(t,_),b.x=E(n,b),b.X=E(r,b),b.c=E(t,b),{format:function(e){var t=E(e+="",_);return t.toString=function(){return e},t},parse:function(e){var t=T(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=E(e+="",b);return t.toString=function(){return e},t},utcParse:function(e){var t=T(e+="",!0);return t.toString=function(){return e},t}}}(e),ln=un.format,un.parse,un.utcFormat,un.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var Rr,wr=1e3,Mr=6e4,kr=36e5,Lr=864e5,Or=2592e6,Ir=31536e6;function Pr(e){return new Date(e)}function Nr(e){return e instanceof Date?+e:+new Date(+e)}function Br(e,t,n,r,i,o,a,s,u){var l=Fe(Oe,Oe),c=l.invert,f=l.domain,h=u(".%L"),p=u(":%S"),d=u("%I:%M"),v=u("%I %p"),g=u("%a %d"),m=u("%b %d"),y=u("%B"),_=u("%Y"),b=[[a,1,wr],[a,5,5e3],[a,15,15e3],[a,30,3e4],[o,1,Mr],[o,5,3e5],[o,15,9e5],[o,30,18e5],[i,1,kr],[i,3,108e5],[i,6,216e5],[i,12,432e5],[r,1,Lr],[r,2,1728e5],[n,1,6048e5],[t,1,Or],[t,3,7776e6],[e,1,Ir]];function x(s){return(a(s)<s?h:o(s)<s?p:i(s)<s?d:r(s)<s?v:t(s)<s?n(s)<s?g:m:e(s)<s?y:_)(s)}function E(t,n,r,i){if(null==t&&(t=10),"number"==typeof t){var o=Math.abs(r-n)/t,a=W((function(e){return e[2]})).right(b,o);a===b.length?(i=te(n/Ir,r/Ir,t),t=e):a?(i=(a=b[o/b[a-1][2]<b[a][2]/o?a-1:a])[1],t=a[0]):(i=Math.max(te(n,r,t),1),t=s)}return null==i?t:t.every(i)}return l.invert=function(e){return new Date(c(e))},l.domain=function(e){return arguments.length?f(he.call(e,Nr)):f().map(Pr)},l.ticks=function(e,t){var n,r=f(),i=r[0],o=r[r.length-1],a=o<i;return a&&(n=i,i=o,o=n),n=(n=E(e,i,o,t))?n.range(i,o+1):[],a?n.reverse():n},l.tickFormat=function(e,t){return null==t?x:u(t)},l.nice=function(e,t){var n=f();return(e=E(e,n[0],n[n.length-1],t))?f(rt(n,e)):l},l.copy=function(){return De(l,Br(e,t,n,r,i,o,a,s,u))},l}function Dr(){var e,t,n,r,i,o=0,a=1,s=Oe,u=!1;function l(t){return isNaN(t=+t)?i:s(0===n?.5:(t=(r(t)-e)*n,u?Math.max(0,Math.min(1,t)):t))}return l.domain=function(i){return arguments.length?(e=r(o=+i[0]),t=r(a=+i[1]),n=e===t?0:1/(t-e),l):[o,a]},l.clamp=function(e){return arguments.length?(u=!!e,l):u},l.interpolator=function(e){return arguments.length?(s=e,l):s},l.unknown=function(e){return arguments.length?(i=e,l):i},function(i){return r=i,e=i(o),t=i(a),n=e===t?0:1/(t-e),l}}function Ur(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Fr(){var e,t,n,r,i,o,a,s=0,u=.5,l=1,c=Oe,f=!1;function h(e){return isNaN(e=+e)?a:(e=.5+((e=+o(e))-t)*(e<t?r:i),c(f?Math.max(0,Math.min(1,e)):e))}return h.domain=function(a){return arguments.length?(e=o(s=+a[0]),t=o(u=+a[1]),n=o(l=+a[2]),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),h):[s,u,l]},h.clamp=function(e){return arguments.length?(f=!!e,h):f},h.interpolator=function(e){return arguments.length?(c=e,h):c},h.unknown=function(e){return arguments.length?(a=e,h):a},function(a){return o=a,e=a(s),t=a(u),n=a(l),r=e===t?0:.5/(t-e),i=t===n?0:.5/(n-t),h}}var zr=M.rU.isNil,Gr=M.rU.isString,Vr=M.rU.uniq,jr=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,Hr=(Rr={},C()(C()(C()(C()(C()(C()(C()(C()(C()(C()(Rr,w.ScaleTypes.LINEAR,(function e(){var t=Fe(Oe,Oe);return t.copy=function(){return De(t,e())},de.apply(t,arguments),nt(t)})),w.ScaleTypes.POWER,vt),w.ScaleTypes.LOG,(function e(){var t=ct(Ue()).domain([1,10]);return t.copy=function(){return De(t,e()).base(t.base())},de.apply(t,arguments),t})),w.ScaleTypes.IDENTITY,(function e(t){var n,r=[];function i(e){return null==e?n:e}return i.invert=i,i.domain=i.range=function(e){return e?(r=e,e):r},i.unknown=function(e){return e?(n=e,e):n},i.copy=function(){return e(t).unknown(n)},i})),w.ScaleTypes.SEQUENTIAL,(function e(){var t=nt(Dr()(Oe));return t.copy=function(){return Ur(t,e())},ve.apply(t,arguments)})),w.ScaleTypes.TIME,(function(){return de.apply(Br(bt,Et,Mt,Dt,Ft,Gt,jt,Wt,ln).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)})),w.ScaleTypes.QUANTILE,(function e(){var t,n=[],r=[],i=[];function o(){var e=0,t=Math.max(1,r.length);for(i=new Array(t-1);++e<t;)i[e-1]=re(n,e/t);return a}function a(e){return isNaN(e=+e)?t:r[Y(i,e)]}return a.invertExtent=function(e){var t=r.indexOf(e);return t<0?[NaN,NaN]:[t>0?i[t-1]:n[0],t<i.length?i[t]:n[n.length-1]]},a.domain=function(e){if(!arguments.length)return n.slice();n=[];for(var t,r=0,i=e.length;r<i;++r)null==(t=e[r])||isNaN(t=+t)||n.push(t);return n.sort(H),o()},a.range=function(e){return arguments.length?(r=pe.call(e),o()):r.slice()},a.unknown=function(e){return arguments.length?(t=e,a):t},a.quantiles=function(){return i.slice()},a.copy=function(){return e().domain(n).range(r).unknown(t)},de.apply(a,arguments)})),w.ScaleTypes.QUANTIZE,(function e(){var t,n=0,r=1,i=1,o=[.5],a=[0,1];function s(e){return e<=e?a[Y(o,e,0,i)]:t}function u(){var e=-1;for(o=new Array(i);++e<i;)o[e]=((e+1)*r-(e-i)*n)/(i+1);return s}return s.domain=function(e){return arguments.length?(n=+e[0],r=+e[1],u()):[n,r]},s.range=function(e){return arguments.length?(i=(a=pe.call(e)).length-1,u()):a.slice()},s.invertExtent=function(e){var t=a.indexOf(e);return t<0?[NaN,NaN]:t<1?[n,o[0]]:t>=i?[o[i-1],r]:[o[t-1],o[t]]},s.unknown=function(e){return arguments.length?(t=e,s):s},s.thresholds=function(){return o.slice()},s.copy=function(){return e().domain([n,r]).range(a).unknown(t)},de.apply(nt(s),arguments)})),w.ScaleTypes.THRESHOLD,(function e(){var t,n=[.5],r=[0,1],i=1;function o(e){return e<=e?r[Y(n,e,0,i)]:t}return o.domain=function(e){return arguments.length?(n=pe.call(e),i=Math.min(n.length,r.length-1),o):n.slice()},o.range=function(e){return arguments.length?(r=pe.call(e),i=Math.min(n.length,r.length-1),o):r.slice()},o.invertExtent=function(e){var t=r.indexOf(e);return[n[t-1],n[t]]},o.unknown=function(e){return arguments.length?(t=e,o):t},o.copy=function(){return e().domain(n).range(r).unknown(t)},de.apply(o,arguments)})),w.ScaleTypes.CAT,me),C()(Rr,w.ScaleTypes.DIVERGING,(function e(){var t=nt(Fr()(Oe));return t.copy=function(){return Ur(t,e())},ve.apply(t,arguments)}))),Wr=function(){function e(){g()(this,e),C()(this,"scaleOptions",{})}return y()(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("FeatureScalePlugin",h()(u()().mark((function t(){var i,o,a;return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.log(w.IDebugLog.ScaleInitStart,w.ILayerStage.INIT),n.scaleOptions=e.getScaleOptions(),o=r.getLayerStyleAttributes(),a=null===(i=e.getSource())||void 0===i?void 0:i.data.dataArray,!Array.isArray(a)||0!==a.length){t.next=8;break}return t.abrupt("return");case 8:n.caculateScalesForAttributes(o||[],a);case 9:e.log(w.IDebugLog.ScaleInitEnd,w.ILayerStage.INIT);case 10:case"end":return t.stop()}}),t)})))),e.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var t=h()(u()().mark((function t(i){var o,a;return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return",i);case 2:if(e.log(w.IDebugLog.ScaleInitStart,w.ILayerStage.UPDATE),n.scaleOptions=e.getScaleOptions(),o=r.getLayerStyleAttributes(),a=e.getSource().data.dataArray,!Array.isArray(a)||0!==a.length){t.next=8;break}return t.abrupt("return",!0);case 8:return n.caculateScalesForAttributes(o||[],a),e.log(w.IDebugLog.ScaleInitEnd,w.ILayerStage.UPDATE),e.layerModelNeedUpdate=!0,t.abrupt("return",!0);case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),e.hooks.beforeRender.tap("FeatureScalePlugin",(function(){if(!e.layerModelNeedUpdate){n.scaleOptions=e.getScaleOptions();var t=r.getLayerStyleAttributes(),i=e.getSource().data.dataArray;if((!Array.isArray(i)||0!==i.length)&&t){var o=t.filter((function(e){return e.needRescale}));o.length&&n.caculateScalesForAttributes(o,i)}}}))}},{key:"isNumber",value:function(e){return!isNaN(parseFloat(e))&&isFinite(e)}},{key:"caculateScalesForAttributes",value:function(e,t){var n=this;e.forEach((function(e){if(e.scale){var r=e.scale,i=e.scale.field;r.names=n.parseFields(zr(i)?[]:i);var o=[];r.names.forEach((function(r){var i;o.push(n.createScale(r,e.name,null===(i=e.scale)||void 0===i?void 0:i.values,t))})),o.some((function(e){return e.type===w.StyleScaleType.VARIABLE}))?(r.type=w.StyleScaleType.VARIABLE,o.forEach((function(e){var t,n;if(!r.callback&&"text"!==r.values)switch(null===(t=e.option)||void 0===t?void 0:t.type){case w.ScaleTypes.LOG:case w.ScaleTypes.LINEAR:case w.ScaleTypes.POWER:if(r.values&&r.values.length>2){var i=e.scale.ticks(r.values.length);e.scale.domain(i)}r.values?e.scale.range(r.values):e.scale.range(e.option.domain);break;case w.ScaleTypes.QUANTILE:case w.ScaleTypes.QUANTIZE:case w.ScaleTypes.THRESHOLD:e.scale.range(r.values);break;case w.ScaleTypes.IDENTITY:break;case w.ScaleTypes.CAT:r.values?e.scale.range(r.values):e.scale.range(e.option.domain);break;case w.ScaleTypes.DIVERGING:case w.ScaleTypes.SEQUENTIAL:e.scale.interpolator(j(r.values))}"text"===r.values&&e.scale.range(null===(n=e.option)||void 0===n?void 0:n.domain)}))):(r.type=w.StyleScaleType.CONSTANT,r.defaultValues=o.map((function(e,t){return e.scale(r.names[t])}))),r.scalers=o.map((function(e){return{field:e.field,func:e.scale,option:e.option}})),e.needRescale=!1}}))}},{key:"parseFields",value:function(e){return Array.isArray(e)?e:Gr(e)?e.split("*"):[e]}},{key:"createScale",value:function(e,t,n,r){var i,o,a=this.scaleOptions[t]&&(null===(i=this.scaleOptions[t])||void 0===i?void 0:i.field)===e?this.scaleOptions[t]:this.scaleOptions[e],s={field:e,scale:void 0,type:w.StyleScaleType.VARIABLE,option:a};if(!r||!r.length)return a&&a.type?s.scale=this.createDefaultScale(a):(s.scale=me([e]),s.type=w.StyleScaleType.CONSTANT),s;var u=null===(o=r.find((function(t){return!zr(t[e])})))||void 0===o?void 0:o[e];if(this.isNumber(e)||zr(u)&&!a)s.scale=me([e]),s.type=w.StyleScaleType.CONSTANT;else{var l=a&&a.type||this.getDefaultType(u);"text"===n&&(l=w.ScaleTypes.CAT),void 0===n&&(l=w.ScaleTypes.IDENTITY);var c=this.createScaleConfig(l,e,a,r);s.scale=this.createDefaultScale(c),s.option=c}return s}},{key:"getDefaultType",value:function(e){var t=w.ScaleTypes.LINEAR;return"string"==typeof e&&(t=jr.test(e)?w.ScaleTypes.TIME:w.ScaleTypes.CAT),t}},{key:"createScaleConfig",value:function(e,t,n,r){var i=d()(d()({},n),{},{type:e});if(null!=i&&i.domain)return i;var o=[];if(e===w.ScaleTypes.QUANTILE){var a=new Map;null==r||r.forEach((function(e){a.set(e._id,e[t])})),o=Array.from(a.values())}else o=(null==r?void 0:r.map((function(e){return e[t]})))||[];if(e===w.ScaleTypes.CAT||e===w.ScaleTypes.IDENTITY)i.domain=Vr(o);else if(e===w.ScaleTypes.QUANTILE)i.domain=o;else if(e===w.ScaleTypes.DIVERGING){var s=P(o),u=void 0!==(null==n?void 0:n.neutral)?null==n?void 0:n.neutral:(s[0]+s[1])/2;i.domain=[s[0],u,s[1]]}else i.domain=P(o);return i}},{key:"createDefaultScale",value:function(e){var t=e.type,n=e.domain,r=e.unknown,i=e.clamp,o=e.nice,a=Hr[t]();return n&&a.domain&&a.domain(n),r&&a.unknown(r),void 0!==i&&a.clamp&&a.clamp(i),void 0!==o&&a.nice&&a.nice(o),a}}]),e}(),Xr=function(){function e(){g()(this,e)}return y()(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LayerAnimateStylePlugin",(function(){e.animateStatus&&e.models.forEach((function(t){t.addUniforms(d()({},e.layerModel.getAnimateUniforms()))}))}))}}]),e}(),Zr=function(){function e(){g()(this,e)}return y()(e,[{key:"apply",value:function(e){e.hooks.afterInit.tap("LayerMaskPlugin",(function(){var t=e.getLayerConfig(),n=t.maskLayers,r=t.enableMask;!e.tileLayer&&n&&n.length>0&&e.updateLayerConfig({mask:r})}))}}]),e}(),Yr=function(){function e(){g()(this,e)}var t,n,r;return y()(e,[{key:"build",value:(r=h()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.prepareBuildModel(),e.next=3,t.buildModels();case 3:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"initLayerModel",value:(n=h()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"prepareLayerModel",value:(t=h()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.build(t);case 2:t.styleNeedUpdate=!1;case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"apply",value:function(e){var t=this;e.hooks.init.tapPromise("LayerModelPlugin",h()(u()().mark((function n(){return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!e.getSource().isTile){n.next=3;break}return e.prepareBuildModel(),n.abrupt("return");case 3:return e.log(w.IDebugLog.BuildModelStart,w.ILayerStage.INIT),n.next=6,t.initLayerModel(e);case 6:e.log(w.IDebugLog.BuildModelEnd,w.ILayerStage.INIT);case 7:case"end":return n.stop()}}),n)})))),e.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var n=h()(u()().mark((function n(r){return u()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r){n.next=2;break}return n.abrupt("return",!1);case 2:if(!e.getSource().isTile){n.next=4;break}return n.abrupt("return",!1);case 4:return e.log(w.IDebugLog.BuildModelStart,w.ILayerStage.UPDATE),n.next=7,t.prepareLayerModel(e);case 7:return e.log(w.IDebugLog.BuildModelEnd,w.ILayerStage.UPDATE),n.abrupt("return",!0);case 9:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}}]),e}(),qr=function(){function e(){g()(this,e)}return y()(e,[{key:"apply",value:function(e){e.hooks.afterInit.tap("LayerStylePlugin",(function(){var t=e.getLayerConfig(),n=t.autoFit,r=t.fitBoundsOptions;n&&e.fitBounds(r),e.styleNeedUpdate=!1}))}}]),e}(),Kr=["type"],Qr={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},$r={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},Jr={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},ei={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};var ti=function(){function e(){g()(this,e)}return y()(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("LightingPlugin",(function(){e.getLayerConfig().enableLighting&&e.models.forEach((function(e){return e.addUniforms(d()({},(n={u_DirectionalLights:new Array(3).fill(d()({},Jr)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(d()({},ei)),u_NumOfSpotLights:0},t&&t.length||(t=[$r]),t.forEach((function(e){var t=e.type,r=void 0===t?"directional":t,i=a()(e,Kr),o=Qr[r].lights,s=Qr[r].num,u=n[s];n[o][u]=d()(d()({},n[o][u]),i),n[s]++})),n)));var t,n}))}))}}]),e}(),ni=n(3420),ri=n.n(ni);function ii(e){return e.map((function(e){return"string"==typeof e&&(e=[e,{}]),e}))}function oi(e,t,n,r){var i=e.multiPassRenderer;return i.add(r("render")),ii(t).forEach((function(e){var t=ri()(e,2),r=t[0],o=t[1];i.add(n(r),o)})),i.add(n("copy")),i}var ai=function(){function e(){g()(this,e),C()(this,"enabled",void 0)}return y()(e,[{key:"apply",value:function(e,t){var n=this,r=t.rendererService,i=t.postProcessingPassFactory,o=t.normalPassFactory;e.hooks.init.tapPromise("MultiPassRendererPlugin",(function(){var t=e.getLayerConfig(),r=t.enableMultiPassRenderer,a=t.passes,s=void 0===a?[]:a;n.enabled=!!r&&!1!==e.getLayerConfig().enableMultiPassRenderer,n.enabled&&(e.multiPassRenderer=oi(e,s,i,o),e.multiPassRenderer.setRenderFlag(!0))})),e.hooks.beforeRender.tap("MultiPassRendererPlugin",(function(){if(n.enabled){var t=r.getViewportSize(),i=t.width,o=t.height;e.multiPassRenderer.resize(i,o)}}))}}]),e}(),si=n(740),ui=M.rU.isNumber,li=1,ci=2,fi=function(){function e(){g()(this,e),C()(this,"pickingUniformMap",void 0)}return y()(e,[{key:"pickOption2Array",value:function(){var e=[];return this.pickingUniformMap.forEach((function(t){ui(t)?e.push(t):e.push.apply(e,i()(t))})),e}},{key:"updatePickOption",value:function(e,t){var n=this;Object.keys(e).forEach((function(t){n.pickingUniformMap.set(t,e[t])}));var r=t.getLayerConfig().pickingBuffer||0,i=Number(t.getShaderPickStat());this.pickingUniformMap.set("u_PickingBuffer",r),this.pickingUniformMap.set("u_shaderPick",i),t.getPickingUniformBuffer().subData({offset:0,data:this.pickOption2Array()})}},{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;this.pickingUniformMap=new Map([["u_HighlightColor",[1,0,0,1]],["u_SelectColor",[1,0,0,1]],["u_PickingColor",[0,0,0]],["u_PickingStage",0],["u_CurrentSelectedId",[0,0,0]],["u_PickingThreshold",10],["u_PickingBuffer",0],["u_shaderPick",0],["u_activeMix",0]]),e.hooks.init.tapPromise("PixelPickingPlugin",(function(){var t=e.getLayerConfig().enablePicking;r.registerStyleAttribute({name:"pickingColor",type:w.AttributeType.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:si.F.PICKING_COLOR,buffer:{data:[],type:w.gl.FLOAT},size:3,update:function(e){var n=e.id;return t?(0,M.Z6)(n):[0,0,0]}}})})),e.hooks.beforePickingEncode.tap("PixelPickingPlugin",(function(){e.getLayerConfig().enablePicking&&e.isVisible()&&(n.updatePickOption({u_PickingStage:li},e),e.models.forEach((function(e){return e.addUniforms({u_PickingStage:li})})))})),e.hooks.afterPickingEncode.tap("PixelPickingPlugin",(function(){e.getLayerConfig().enablePicking&&e.isVisible()&&(n.updatePickOption({u_PickingStage:ci},e),e.models.forEach((function(e){return e.addUniforms({u_PickingStage:ci})})))})),e.hooks.beforeHighlight.tap("PixelPickingPlugin",(function(t){var r=e.getLayerConfig(),i=r.highlightColor,o=r.activeMix,a=void 0===o?0:o,s="string"==typeof i?(0,M.CI)(i):i||[1,0,0,1];e.updateLayerConfig({pickedFeatureID:(0,M.W0)(new Uint8Array(t))});var u={u_PickingStage:ci,u_PickingColor:t,u_HighlightColor:s.map((function(e){return 255*e})),u_activeMix:a};n.updatePickOption(u,e),e.models.forEach((function(e){return e.addUniforms(u)}))})),e.hooks.beforeSelect.tap("PixelPickingPlugin",(function(t){var r=e.getLayerConfig(),i=r.selectColor,o=r.selectMix,a=void 0===o?0:o,s="string"==typeof i?(0,M.CI)(i):i||[1,0,0,1];e.updateLayerConfig({pickedFeatureID:(0,M.W0)(new Uint8Array(t))});var u={u_PickingStage:ci,u_PickingColor:t,u_HighlightColor:s.map((function(e){return 255*e})),u_activeMix:a,u_CurrentSelectedId:t,u_SelectColor:s.map((function(e){return 255*e}))};n.updatePickOption(u,e),e.models.forEach((function(e){return e.addUniforms(u)}))}))}}]),e}(),hi=["mvt","geojsonvt","testTile"];var pi=function(){function e(){g()(this,e)}return y()(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("RegisterStyleAttributePlugin",(function(){(function(e){var t=e.getSource();return hi.includes(t.parser.type)})(e)||n.registerBuiltinAttributes(r,e)}))}},{key:"registerBuiltinAttributes",value:function(e,t){"MaskLayer"!==t.type?(this.registerPositionAttribute(e),this.registerColorAttribute(e)):this.registerPositionAttribute(e)}},{key:"registerPositionAttribute",value:function(e){e.registerStyleAttribute({name:"position",type:w.AttributeType.Attribute,descriptor:{name:"a_Position",shaderLocation:si.F.POSITION,buffer:{data:[],type:w.gl.FLOAT},size:3,update:function(e,t,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}}})}},{key:"registerColorAttribute",value:function(e){e.registerStyleAttribute({name:"color",type:w.AttributeType.Attribute,descriptor:{name:"a_Color",shaderLocation:si.F.COLOR,buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:4,update:function(e){var t=e.color;return t&&t.length?t:[1,1,1,1]}}})}}]),e}(),di=function(){function e(){g()(this,e),C()(this,"cameraService",void 0),C()(this,"coordinateSystemService",void 0),C()(this,"rendererService",void 0),C()(this,"mapService",void 0),C()(this,"layerService",void 0)}return y()(e,[{key:"apply",value:function(e,t){var n,r=this,i=t.rendererService,o=t.mapService,a=t.layerService,s=t.coordinateSystemService,u=t.cameraService;this.rendererService=i,this.mapService=o,this.layerService=a,this.coordinateSystemService=s,this.cameraService=u,this.rendererService.uniformBuffers[0]||(n=this.rendererService.createBuffer({data:new Float32Array(92),isUBO:!0,label:"renderUniformBuffer"}),this.rendererService.uniformBuffers[0]=n),e.hooks.beforeRender.tap("ShaderUniformPlugin",(function(){var t=e.getLayerConfig().tileOrigin;r.coordinateSystemService.refresh(t);var n=r.rendererService.getViewportSize(),i=n.width,o=n.height,a=r.generateUBO(i,o),s=a.data,u=a.uniforms;r.layerService.alreadyInRendering&&r.rendererService.uniformBuffers[0]&&r.rendererService.uniformBuffers[0].subData({offset:0,data:s});"WebGL1"===r.rendererService.queryVerdorInfo()&&e.models.forEach((function(t){t.addUniforms(d()(d()({},u),{},{u_PickingBuffer:e.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(e.getShaderPickStat())}))}))}))}},{key:"generateUBO",value:function(e,t){var n,r=this.cameraService.getProjectionMatrix(),o=this.cameraService.getViewMatrix(),a=this.cameraService.getViewProjectionMatrix(),s=this.cameraService.getModelMatrix(),u=this.coordinateSystemService.getViewportCenterProjection(),l=this.coordinateSystemService.getPixelsPerDegree(),c=this.cameraService.getZoom(),f=this.coordinateSystemService.getPixelsPerDegree2(),h=this.cameraService.getZoomScale(),p=this.coordinateSystemService.getPixelsPerMeter(),d=this.coordinateSystemService.getCoordinateSystem(),v=this.cameraService.getCameraPosition(),g=window.devicePixelRatio,m=this.coordinateSystemService.getViewportCenter(),y=[e,t],_=this.cameraService.getFocalDistance();return{data:[].concat(i()(o),i()(r),i()(a),i()(s),i()(u),i()(l),[c],i()(f),[h],i()(p),[d],i()(v),[g],i()(m),y,[_,0,0,0]),uniforms:(n={},C()(C()(C()(C()(C()(C()(C()(C()(C()(C()(n,w.CameraUniform.ProjectionMatrix,r),w.CameraUniform.ViewMatrix,o),w.CameraUniform.ViewProjectionMatrix,a),w.CameraUniform.Zoom,c),w.CameraUniform.ZoomScale,h),w.CameraUniform.FocalDistance,_),w.CameraUniform.CameraPosition,v),w.CoordinateUniform.CoordinateSystem,d),w.CoordinateUniform.ViewportCenter,m),w.CoordinateUniform.ViewportCenterProjection,u),C()(C()(C()(C()(C()(C()(n,w.CoordinateUniform.PixelsPerDegree,l),w.CoordinateUniform.PixelsPerDegree2,f),w.CoordinateUniform.PixelsPerMeter,p),"u_ViewportSize",y),"u_ModelMatrix",s),"u_DevicePixelRatio",g))}}}]),e}(),vi=function(){function e(){g()(this,e)}return y()(e,[{key:"apply",value:function(e){e.hooks.beforeRender.tap("UpdateModelPlugin",(function(){e.layerModel&&e.layerModel.needUpdate().then((function(t){t&&e.renderLayers()}))})),e.hooks.afterRender.tap("UpdateModelPlugin",(function(){e.layerModelNeedUpdate=!1}))}}]),e}(),gi=function(){function e(){g()(this,e)}return y()(e,[{key:"apply",value:function(e,t){var n=this,r=t.styleAttributeService;e.hooks.init.tapPromise("UpdateStyleAttributePlugin",(function(){n.initStyleAttribute(e,{styleAttributeService:r})})),e.hooks.beforeRender.tap("UpdateStyleAttributePlugin",(function(){e.layerModelNeedUpdate||e.inited&&n.updateStyleAttribute(e,{styleAttributeService:r})}))}},{key:"updateStyleAttribute",value:function(e,t){var n=t.styleAttributeService,r=n.getLayerStyleAttributes()||[],i=n.getLayerStyleAttribute("filter");if(i&&i.needRegenerateVertices)return e.layerModelNeedUpdate=!0,void r.forEach((function(e){return e.needRegenerateVertices=!1}));r.filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex,e),t.needRegenerateVertices=!1}))}},{key:"initStyleAttribute",value:function(e,t){var n=t.styleAttributeService;(n.getLayerStyleAttributes()||[]).filter((function(e){return e.needRegenerateVertices})).forEach((function(t){n.updateAttributeByFeatureRange(t.name,e.getEncodedData(),t.featureRange.startIndex,t.featureRange.endIndex),t.needRegenerateVertices=!1}))}}]),e}();var mi=n(6068),yi=function(){function e(t){g()(this,e),C()(this,"layer",void 0),this.layer=t}var t;return y()(e,[{key:"pickRender",value:function(e){var t=this.layer.getContainer().layerService,n=this.layer;if(n.tileLayer)return n.tileLayer.pickRender(e);n.hooks.beforePickingEncode.call(),t.renderTileLayerMask(n),n.renderModels({ispick:!0}),n.hooks.afterPickingEncode.call()}},{key:"pick",value:(t=h()(u()().mark((function e(t,n){var r,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.layer.getContainer(),i=r.pickingService,"RasterLayer"!==t.type){e.next=4;break}return e.abrupt("return",this.pickRasterLayer(t,n));case 4:return this.pickRender(n),e.abrupt("return",i.pickFromPickingFBO(t,n));case 6:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"pickRasterLayer",value:function(e,t,n){var r=this.layer.getContainer(),i=r.pickingService,o=r.mapService,a=this.layer.getSource().extent,s=(0,M.if)(t.lngLat,a),u={x:t.x,y:t.y,type:t.type,lngLat:t.lngLat,target:t,rasterValue:null},l=n||e;if(s){var c=this.readRasterValue(e,a,o,t.x,t.y);return u.rasterValue=c,i.triggerHoverOnLayer(l,u),!0}return u.type="mousemove"===t.type?"mouseout":"un"+t.type,i.triggerHoverOnLayer(l,d()(d()({},u),{},{type:"unpick"})),i.triggerHoverOnLayer(l,u),!1}},{key:"readRasterValue",value:function(e,t,n,r,i){var o=e.getSource().data.dataArray[0],a=ri()(t,4),s=a[0],u=void 0===s?0:s,l=a[1],c=void 0===l?0:l,f=a[2],h=void 0===f?10:f,p=a[3],d=void 0===p?-10:p,v=n.lngLatToContainer([u,c]),g=n.lngLatToContainer([h,d]),m=g.x-v.x,y=v.y-g.y,_=[(r-v.x)/m,(i-g.y)/y],b=o.width||1,x=o.height||1,E=Math.floor(_[0]*b),T=Math.floor(_[1]*x),A=Math.max(0,T-1)*b+E;return o.data[A]}},{key:"selectFeature",value:function(e){var t=this.layer,n=ri()(e,3),r=n[0],i=n[1],o=n[2];t.hooks.beforeSelect.call([r,i,o])}},{key:"highlightPickedFeature",value:function(e){var t=ri()(e,3),n=t[0],r=t[1],i=t[2];this.layer.hooks.beforeHighlight.call([n,r,i])}},{key:"getFeatureById",value:function(e){return this.layer.getSource().getFeatureById(e)}}]),e}(),_i=function(){function e(t){g()(this,e),C()(this,"layer",void 0),C()(this,"rendererService",void 0),C()(this,"colorTexture",void 0),C()(this,"key",void 0),this.layer=t;var n=this.layer.getContainer();this.rendererService=n.rendererService}return y()(e,[{key:"getColorTexture",value:function(e,t){var n=this.getTextureKey(e,t);return this.key===n||(this.createColorTexture(e,t),this.key=n),this.colorTexture}},{key:"createColorTexture",value:function(e,t){var n=this.rendererService.createTexture2D,r=this.getColorRampBar(e,t),i=n({data:new Uint8Array(r.data),width:r.width,height:r.height,flipY:!1,unorm:!0});return this.colorTexture=i,i}},{key:"setColorTexture",value:function(e,t,n){this.key=this.getTextureKey(t,n),this.colorTexture=e}},{key:"destroy",value:function(){var e;null===(e=this.colorTexture)||void 0===e||e.destroy()}},{key:"getColorRampBar",value:function(e,t){switch(e.type){case"cat":return(0,M.hj)(e);case"quantize":return(0,M.NJ)(e);case"custom":return(0,M.Oc)(e,t);case"linear":return(0,M.M4)(e,t);default:return(0,M.Cl)(e)}}},{key:"getTextureKey",value:function(e,t){var n;return"".concat(e.colors.join("_"),"_").concat(null==e||null===(n=e.positions)||void 0===n?void 0:n.join("_"),"_").concat(e.type,"_").concat(null==t?void 0:t.join("_"))}}]),e}(),bi=["passes"],xi=["moduleName","vertexShader","fragmentShader","defines","inject","triangulation","styleOption","pickingEnabled"],Ei=M.rU.isEqual,Ti=M.rU.isFunction,Ai=M.rU.isNumber,Si=M.rU.isObject,Ci=M.rU.isPlainObject,Ri=M.rU.isUndefined,wi=0,Mi=function(e){E()(v,e);var t,n,r,o,s,l,f,p=A()(v);function v(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return g()(this,v),e=p.call(this),C()(b()(e),"id","".concat(wi++)),C()(b()(e),"name","".concat(wi)),C()(b()(e),"parent",void 0),C()(b()(e),"coordCenter",void 0),C()(b()(e),"type",void 0),C()(b()(e),"visible",!0),C()(b()(e),"zIndex",0),C()(b()(e),"minZoom",void 0),C()(b()(e),"maxZoom",void 0),C()(b()(e),"inited",!1),C()(b()(e),"layerModelNeedUpdate",!1),C()(b()(e),"pickedFeatureID",null),C()(b()(e),"selectedFeatureID",null),C()(b()(e),"styleNeedUpdate",!1),C()(b()(e),"rendering",void 0),C()(b()(e),"forceRender",!1),C()(b()(e),"clusterZoom",0),C()(b()(e),"layerType",void 0),C()(b()(e),"triangulation",void 0),C()(b()(e),"layerPickService",void 0),C()(b()(e),"textureService",void 0),C()(b()(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),C()(b()(e),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),C()(b()(e),"hooks",{init:new R.S$,afterInit:new R.oI,beforeRender:new R.oI,beforeRenderData:new R.bf,afterRender:new R.ni,beforePickingEncode:new R.ni,afterPickingEncode:new R.ni,beforeHighlight:new R.ni(["pickedColor"]),afterHighlight:new R.ni,beforeSelect:new R.ni(["pickedColor"]),afterSelect:new R.ni,beforeDestroy:new R.ni,afterDestroy:new R.ni}),C()(b()(e),"models",[]),C()(b()(e),"multiPassRenderer",void 0),C()(b()(e),"plugins",void 0),C()(b()(e),"startInit",!1),C()(b()(e),"sourceOption",void 0),C()(b()(e),"layerModel",void 0),C()(b()(e),"shapeOption",void 0),C()(b()(e),"tileLayer",void 0),C()(b()(e),"layerChildren",[]),C()(b()(e),"masks",[]),C()(b()(e),"configService",w.globalConfigService),C()(b()(e),"styleAttributeService",void 0),C()(b()(e),"layerSource",void 0),C()(b()(e),"postProcessingPassFactory",void 0),C()(b()(e),"animateOptions",{enable:!1}),C()(b()(e),"container",void 0),C()(b()(e),"encodedData",void 0),C()(b()(e),"currentPickId",null),C()(b()(e),"rawConfig",void 0),C()(b()(e),"needUpdateConfig",void 0),C()(b()(e),"encodeStyleAttribute",{}),C()(b()(e),"enableShaderEncodeStyles",[]),C()(b()(e),"enableDataEncodeStyles",[]),C()(b()(e),"pendingStyleAttributes",[]),C()(b()(e),"scaleOptions",{}),C()(b()(e),"animateStartTime",void 0),C()(b()(e),"animateStatus",!1),C()(b()(e),"isDestroyed",!1),C()(b()(e),"uniformBuffers",[]),C()(b()(e),"encodeDataLength",0),C()(b()(e),"sourceEvent",(function(){e.dataState.dataSourceNeedUpdate=!0;var t=e.getLayerConfig();t&&t.autoFit&&e.fitBounds(t.fitBoundsOptions),e.layerSource.getSourceCfg().autoRender&&setTimeout((function(){e.reRender()}),10)})),e.name=t.name||e.id,e.zIndex=t.zIndex||0,e.rawConfig=t,e.masks=t.maskLayers||[],e}return y()(v,[{key:"shaderModuleService",get:function(){return this.container.shaderModuleService}},{key:"cameraService",get:function(){return this.container.cameraService}},{key:"coordinateService",get:function(){return this.container.coordinateSystemService}},{key:"iconService",get:function(){return this.container.iconService}},{key:"fontService",get:function(){return this.container.fontService}},{key:"pickingService",get:function(){return this.container.pickingService}},{key:"rendererService",get:function(){return this.container.rendererService}},{key:"layerService",get:function(){return this.container.layerService}},{key:"debugService",get:function(){return this.container.debugService}},{key:"interactionService",get:function(){return this.container.interactionService}},{key:"mapService",get:function(){var e;return null===(e=this.container)||void 0===e?void 0:e.mapService}},{key:"normalPassFactory",get:function(){return this.container.normalPassFactory}},{key:"addMask",value:function(e){this.masks.push(e),this.updateLayerConfig({maskLayers:this.masks}),this.enableMask()}},{key:"removeMask",value:function(e){var t=this.masks.indexOf(e);t>-1&&this.masks.splice(t,1),this.updateLayerConfig({maskLayers:this.masks})}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(e){this.masks.push(e)}},{key:"removeMaskLayer",value:function(e){var t=this.masks.indexOf(e);t>-1&&this.masks.splice(t,1),e.destroy()}},{key:"getAttribute",value:function(e){return this.styleAttributeService.getLayerStyleAttribute(e)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(e){var t=this;if(Object.keys(e).map((function(n){n in t.rawConfig&&(t.rawConfig[n]=e[n])})),this.startInit){var n=this.container.id;this.configService.setLayerConfig(n,this.id,d()(d()(d()({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),e)),this.needUpdateConfig={}}else this.needUpdateConfig=d()(d()({},this.needUpdateConfig),e)}},{key:"setContainer",value:function(e){this.container=e}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(e){return this.plugins.push(e),this}},{key:"init",value:(f=h()(u()().mark((function e(){var t,n,r,i,o,a,s=this;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.container.id,this.startInit=!0,this.configService.setLayerConfig(t,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,n=this.getLayerConfig(),r=n.enableMultiPassRenderer,i=n.passes,r&&null!=i&&i.length&&i.length>0&&this.mapService.on("mapAfterFrameChange",(function(){s.renderLayers()})),this.postProcessingPassFactory=this.container.postProcessingPassFactory,this.styleAttributeService=this.container.styleAttributeService,r&&(this.multiPassRenderer=this.container.multiPassRenderer,this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach((function(e){var t=e.attributeName,n=e.attributeField,r=e.attributeValues,i=e.updateOptions;s.styleAttributeService.updateStyleAttribute(t,{scale:d()({field:n},s.splitValuesAndCallbackInAttribute(r,n?void 0:s.getLayerConfig()[t]))},i)})),this.pendingStyleAttributes=[],this.plugins=[new I,new pi,new Wr,new L,new qr,new Zr,new gi,new vi,new ai,new di,new Xr,new ti,new fi,new Yr],o=c()(this.plugins);try{for(o.s();!(a=o.n()).done;)a.value.apply(this,this.container)}catch(e){o.e(e)}finally{o.f()}return this.layerPickService=new yi(this),this.textureService=new _i(this),this.log(w.IDebugLog.LayerInitStart),e.next=19,this.hooks.init.promise();case 19:this.log(w.IDebugLog.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 24:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"log",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"init";if(!this.tileLayer&&!this.isTileLayer){var r="".concat(this.id,".").concat(n,".").concat(e),i={id:this.id,type:this.type};null===(t=this.debugService)||void 0===t||t.log(r,i)}}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models.map((function(t){t.updateAttributesAndElements(e.attributes,e.elements)})):console.warn("data error")}},{key:"setLayerPickService",value:function(e){this.layerPickService=e}},{key:"prepareBuildModel",value:function(){0!==Object.keys(this.needUpdateConfig||{}).length&&this.updateLayerConfig({});var e=this.getLayerConfig().animateOption;null!=e&&e.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(e,t,n){return this.updateStyleAttribute("color",e,t,n),this}},{key:"texture",value:function(e,t,n){return this.updateStyleAttribute("texture",e,t,n),this}},{key:"rotate",value:function(e,t,n){return this.updateStyleAttribute("rotate",e,t,n),this}},{key:"size",value:function(e,t,n){return this.updateStyleAttribute("size",e,t,n),this}},{key:"filter",value:function(e,t,n){var r=this.updateStyleAttribute("filter",e,t,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"shape",value:function(e,t,n){this.shapeOption={field:e,values:t};var r=this.updateStyleAttribute("shape",e,t,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"label",value:function(e,t,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:e,attributeValues:t,updateOptions:n}),this}},{key:"animate",value:function(e){var t={};return Si(e)?(t.enable=!0,t=d()(d()({},t),e)):t.enable=e,this.updateLayerConfig({animateOption:t}),this}},{key:"source",value:function(e,t){return"source"===(null==e?void 0:e.type)?(this.setSource(e),this):(this.sourceOption={data:e,options:t},this.clusterZoom=0,this)}},{key:"setData",value:function(e,t){var n=this;return this.inited?(this.dataUpdatelog(),this.layerSource.setData(e,t)):this.on("inited",(function(){n.dataUpdatelog(),n.layerSource.setData(e,t)})),this}},{key:"dataUpdatelog",value:function(){var e=this;this.log(w.IDebugLog.SourceInitStart,w.ILayerStage.UPDATE),this.layerSource.once("update",(function(){e.log(w.IDebugLog.SourceInitEnd,w.ILayerStage.UPDATE)}))}},{key:"style",value:function(e){var t=this,n=e.passes,r=a()(e,bi);n&&ii(n).forEach((function(e){var n=t.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(e[0]);n&&n.updateOptions(e[1])})),r.borderColor&&(r.stroke=r.borderColor),r.borderWidth&&(r.strokeWidth=r.borderWidth);var i=r;return Object.keys(r).forEach((function(e){var t=r[e];!Array.isArray(t)||2!==t.length||Ai(t[0])||Ai(t[1])||(i[e]={field:t[0],value:t[1]})})),this.encodeStyle(i),this.updateLayerConfig(i),this}},{key:"encodeStyle",value:function(e){var t=this;Object.keys(e).forEach((function(n){[].concat(i()(t.enableShaderEncodeStyles),i()(t.enableDataEncodeStyles)).includes(n)&&Ci(e[n])&&(e[n].field||e[n].value)&&!Ei(t.encodeStyleAttribute[n],e[n])?(t.encodeStyleAttribute[n]=e[n],t.updateStyleAttribute(n,e[n].field,e[n].value),t.inited&&(t.dataState.dataMappingNeedUpdate=!0)):t.encodeStyleAttribute[n]&&(delete t.encodeStyleAttribute[n],t.dataState.dataSourceNeedUpdate=!0)}))}},{key:"scale",value:function(e,t){var n=d()({},this.scaleOptions);if(Si(e)?this.scaleOptions=d()(d()({},this.scaleOptions),e):this.scaleOptions[e]=t,this.styleAttributeService&&!Ei(n,this.scaleOptions)){var r=Si(e)?e:C()({},e,t);this.styleAttributeService.updateScaleAttribute(r)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"prerender",value:function(){}},{key:"render",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender||this.renderModels(e),this)}},{key:"renderMultiPass",value:(l=h()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.encodeDataLength<=0)||this.forceRender){e.next=2;break}return e.abrupt("return");case 2:if(!this.multiPassRenderer||!this.multiPassRenderer.getRenderFlag()){e.next=7;break}return e.next=5,this.multiPassRenderer.render();case 5:e.next=8;break;case 7:this.renderModels();case 8:case"end":return e.stop()}}),e,this)}))),function(){return l.apply(this,arguments)})},{key:"active",value:function(e){var t={};return t.enableHighlight=!!Si(e)||e,Si(e)?(t.enableHighlight=!0,e.color&&(t.highlightColor=e.color),e.mix&&(t.activeMix=e.mix)):t.enableHighlight=!!e,this.updateLayerConfig(t),this}},{key:"setActive",value:function(e,t){var n=this;if(Si(e)){var r=e.x,i=void 0===r?0:r,o=e.y,a=void 0===o?0:o;this.updateLayerConfig({highlightColor:Si(t)?t.color:this.getLayerConfig().highlightColor,activeMix:Si(t)?t.mix:this.getLayerConfig().activeMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:e,highlightColor:Si(t)?t.color:this.getLayerConfig().highlightColor,activeMix:Si(t)?t.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call((0,M.Z6)(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"select",value:function(e){var t={};return t.enableSelect=!!Si(e)||e,Si(e)?(t.enableSelect=!0,e.color&&(t.selectColor=e.color),e.mix&&(t.selectMix=e.mix)):t.enableSelect=!!e,this.updateLayerConfig(t),this}},{key:"setSelect",value:function(e,t){var n=this;if(Si(e)){var r=e.x,i=void 0===r?0:r,o=e.y,a=void 0===o?0:o;this.updateLayerConfig({selectColor:Si(t)?t.color:this.getLayerConfig().selectColor,selectMix:Si(t)?t.mix:this.getLayerConfig().selectMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:e,selectColor:Si(t)?t.color:this.getLayerConfig().selectColor,selectMix:Si(t)?t.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call((0,M.Z6)(e)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"setBlend",value:function(e){return this.updateLayerConfig({blend:e}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(e){return this.zIndex=e,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(e){this.currentPickId=e}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(e){this.selectedFeatureID=e}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var e=this.mapService.getZoom(),t=this.getLayerConfig(),n=t.visible,r=t.minZoom,i=void 0===r?-1/0:r,o=t.maxZoom;return!!n&&e>=i&&e<(void 0===o?1/0:o)}},{key:"setMultiPass",value:function(e,t){if(this.updateLayerConfig({enableMultiPassRenderer:e}),t&&this.updateLayerConfig({passes:t}),e){var n=this.getLayerConfig().passes,r=void 0===n?[]:n;this.multiPassRenderer=oi(this,r,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var i=this.rendererService.getViewportSize(),o=i.width,a=i.height;this.multiPassRenderer.resize(o,a)}return this}},{key:"setMinZoom",value:function(e){return this.updateLayerConfig({minZoom:e}),this}},{key:"getMinZoom",value:function(){return this.getLayerConfig().minZoom}},{key:"getMaxZoom",value:function(){return this.getLayerConfig().maxZoom}},{key:"get",value:function(e){return this.getLayerConfig()[e]}},{key:"setMaxZoom",value:function(e){return this.updateLayerConfig({maxZoom:e}),this}},{key:"setAutoFit",value:function(e){return this.updateLayerConfig({autoFit:e}),this}},{key:"fitBounds",value:function(e){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var t=this.getSource().extent;return t.some((function(e){return Math.abs(e)===1/0}))||this.mapService.fitBounds([[t[0],t[1]],[t[2],t[3]]],e),this}},{key:"destroy",value:function(){var e,t,n,r,i,o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.isDestroyed){null===(e=this.layerModel)||void 0===e||e.uniformBuffers.forEach((function(e){e.destroy()})),this.layerChildren.map((function(e){return e.destroy(!1)})),this.layerChildren=[];var a=this.getLayerConfig(),s=a.maskfence;s&&(this.masks.map((function(e){return e.destroy(!1)})),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),null===(t=this.multiPassRenderer)||void 0===t||t.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),null===(n=this.layerModel)||void 0===n||n.clearModels(o),null===(r=this.tileLayer)||void 0===r||r.destroy(),this.models=[],null===(i=this.debugService)||void 0===i||i.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var e;this.models.forEach((function(e){return e.destroy()})),null===(e=this.layerModel)||void 0===e||e.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter((function(e){return e.needRescale||e.needRemapping||e.needRegenerateVertices})).length}},{key:"setSource",value:function(e){var t=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=e,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var n=this.mapService.getZoom();this.layerSource.updateClusterData(n)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",(function(e){var n=e.type;if(void 0===t.coordCenter){var r=t.layerSource.center;t.coordCenter=r}if("update"===n){if(t.tileLayer)return void t.tileLayer.reload();t.sourceEvent()}}))}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(e){this.encodedData=e,this.encodeDataLength=e.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(e){return this.styleAttributeService.getLayerAttributeScale(e)}},{key:"getLegend",value:function(e){var t,n,r,i=this.styleAttributeService.getLayerStyleAttribute(e);return{type:null===(n=((null==i||null===(t=i.scale)||void 0===t?void 0:t.scalers)||[])[0])||void 0===n||null===(n=n.option)||void 0===n?void 0:n.type,field:null==i||null===(r=i.scale)||void 0===r?void 0:r.field,items:this.getLegendItems(e)}}},{key:"getLegendItems",value:function(e){var t=this.styleAttributeService.getLayerAttributeScale(e);return t?t.invertExtent?t.range().map((function(n){return C()({value:t.invertExtent(n)},e,n)})):t.ticks?t.ticks().map((function(n){return C()({value:n},e,t(n))})):null!=t&&t.domain?t.domain().filter((function(e){return!Ri(e)})).map((function(n){return C()({value:n},e,t(n))})):[]:[]}},{key:"pick",value:function(e){var t=e.x,n=e.y;this.interactionService.triggerHover({x:t,y:n})}},{key:"boxSelect",value:function(e,t){this.pickingService.boxPickLayer(this,e,t)}},{key:"buildLayerModel",value:(s=h()(u()().mark((function e(t){var n,r,o,s,l,c,f,h,p,v,g,m,y,_,b,x=this;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.moduleName,r=t.vertexShader,o=t.fragmentShader,s=t.defines,l=t.inject,c=t.triangulation,f=t.styleOption,h=t.pickingEnabled,p=void 0===h||h,v=a()(t,xi),this.shaderModuleService.registerModule(n,{vs:r,fs:o,defines:s,inject:l}),g=this.shaderModuleService.getModule(n),m=g.vs,y=g.fs,_=g.uniforms,b=this.rendererService.createModel,e.abrupt("return",new Promise((function(e){var t=x.styleAttributeService.createAttributesAndIndices(x.encodedData,c,f,x),n=t.attributes,r=t.elements,o=t.count,a=[].concat(i()(x.layerModel.uniformBuffers),i()(x.rendererService.uniformBuffers));p&&a.push(x.getPickingUniformBuffer());var s=d()({attributes:n,uniforms:_,fs:y,vs:m,elements:r,blend:mi.y[w.BlendType.normal],uniformBuffers:a,textures:x.layerModel.textures},v);o&&(s.count=o),e(b(s))})));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"createAttributes",value:function(e){var t=e.triangulation;return this.styleAttributeService.createAttributes(this.encodedData,t).attributes}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(e){var t=this.getLayerConfig(),n=t.enableHighlight,r=void 0===n||n,i=t.enableSelect,o=void 0===i||i,a=-1!==this.eventNames().indexOf(e)||-1!==this.eventNames().indexOf("un"+e);return"click"!==e&&"dblclick"!==e||!o||(a=!0),"mousemove"!==e||!r&&-1===this.eventNames().indexOf("mouseenter")&&-1===this.eventNames().indexOf("unmousemove")&&-1===this.eventNames().indexOf("mouseout")||(a=!0),this.isVisible()&&a}},{key:"buildModels",value:(o=h()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)}))),function(){return o.apply(this,arguments)})},{key:"rebuildModels",value:(r=h()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.buildModels();case 2:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"renderMulPass",value:(n=h()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.render();case 2:case"end":return e.stop()}}),e)}))),function(e){return n.apply(this,arguments)})},{key:"renderModels",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach((function(n){n.draw({uniforms:e.layerModel.getUninforms(),blend:e.layerModel.getBlend(),stencil:e.layerModel.getStencil(t),textures:e.layerModel.textures},(null==t?void 0:t.ispick)||!1)})),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(e,t,n,r){var i=this.configService.getAttributeConfig(this.id)||{};return!Ei(i[e],{field:t,values:n})&&(-1!==["color","size","texture","rotate","filter","label","shape"].indexOf(e)&&this.configService.setAttributeConfig(this.id,C()({},e,{field:t,values:n})),this.startInit?this.styleAttributeService.updateStyleAttribute(e,{scale:d()({field:t},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[t]))},r):this.pendingStyleAttributes.push({attributeName:e,attributeField:t,attributeValues:n,updateOptions:r}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(e){console.warn("empty fn")}},{key:"processData",value:function(e){return e}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:(t=h()(u()().mark((function e(){var t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.models.forEach((function(e){return e.destroy()})),this.models=[],this.uniformBuffers.forEach((function(e){e.destroy()})),this.uniformBuffers=[],t=this.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0,label:"pickingUniforms"}),this.uniformBuffers.push(t),e.next=8,this.layerModel.initModels();case 8:this.models=e.sent;case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getPickingUniformBuffer",value:function(){return this.uniformBuffers[0]}},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(e){return{values:Ti(e)?void 0:e,callback:Ti(e)?e:void 0}}}]),v}(k.EventEmitter)},8407:function(e,t,n){"use strict";n.d(t,{Z:function(){return C}});var r=n(2786),i=n.n(r),o=n(6502),a=n.n(o),s=n(4351),u=n.n(s),l=n(4450),c=n.n(l),f=n(8025),h=n.n(f),p=n(1133),d=n.n(p),v=n(3769),g=n.n(v),m=n(7033),y=n(7193),_=n(6068);function b(e){return e.maskOperation===m.MaskOperation.OR?{enable:!0,mask:255,func:{cmp:m.gl.ALWAYS,ref:1,mask:255},opFront:{fail:m.gl.KEEP,zfail:m.gl.REPLACE,zpass:m.gl.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===m.StencilType.SINGLE||0===e.stencilIndex?m.gl.ALWAYS:m.gl.LESS,ref:e.stencilType===m.StencilType.SINGLE?1:0===e.stencilIndex?2:1,mask:255},opFront:{fail:m.gl.KEEP,zfail:m.gl.REPLACE,zpass:m.gl.REPLACE}}}var x=n(740),E={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},T={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"},A=n(2662),S="ATTRIBUTE_LOCATION_",C=function(){function e(t){h()(this,e),g()(this,"triangulation",void 0),g()(this,"uniformBuffers",[]),g()(this,"textures",[]),g()(this,"createTexture2D",void 0),g()(this,"preStyleAttribute",{}),g()(this,"encodeStyleAttribute",{}),g()(this,"layer",void 0),g()(this,"dataTexture",void 0),g()(this,"DATA_TEXTURE_WIDTH",void 0),g()(this,"dataTextureTest",void 0),g()(this,"configService",void 0),g()(this,"shaderModuleService",void 0),g()(this,"rendererService",void 0),g()(this,"iconService",void 0),g()(this,"fontService",void 0),g()(this,"styleAttributeService",void 0),g()(this,"mapService",void 0),g()(this,"cameraService",void 0),g()(this,"layerService",void 0),g()(this,"pickingService",void 0),g()(this,"attributeUnifoms",void 0),g()(this,"commonUnifoms",void 0),this.layer=t,this.configService=t.getContainer().globalConfigService,this.rendererService=t.getContainer().rendererService,this.pickingService=t.getContainer().pickingService,this.shaderModuleService=t.getContainer().shaderModuleService,this.styleAttributeService=t.getContainer().styleAttributeService,this.mapService=t.getContainer().mapService,this.iconService=t.getContainer().iconService,this.fontService=t.getContainer().fontService,this.cameraService=t.getContainer().cameraService,this.layerService=t.getContainer().layerService,this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var n=this.rendererService.createTexture2D;this.createTexture2D=n}var t,n,r;return d()(e,[{key:"attributeLocation",get:function(){return c()({},x.F)}},{key:"getBlend",value:function(){var e=this.layer.getLayerConfig().blend,t=void 0===e?"normal":e;return _.y[m.BlendType[t]]}},{key:"getStencil",value:function(e){var t=this.layer.getLayerConfig(),n=t.mask,r=void 0!==n&&n,i=t.maskInside,o=void 0===i||i,a=t.enableMask,s=t.maskOperation,u=void 0===s?m.MaskOperation.AND:s;return"MaskLayer"===this.layer.type?b({isStencil:!0,stencilType:m.StencilType.SINGLE}):e.isStencil?b(c()(c()({},e),{},{maskOperation:u})):function(e,t){return{enable:e,mask:255,func:{cmp:m.gl.EQUAL,ref:t?1:0,mask:1}}}(r||a&&0!==this.layer.masks.length||void 0!==this.layer.tileMask,o)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());this.updateStyleUnifoms();var n=c()(c()({},t.uniformsOption),e.uniformsOption);return Object.keys(n).forEach((function(e){"boolean"==typeof n[e]&&(n[e]=n[e]?1:0)})),!this.rendererService.hasOwnProperty("device")&&this.textures&&1===this.textures.length&&(n.u_texture=this.textures[0]),n}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:(r=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",!1);case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"initModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"prerender",value:function(){}},{key:"render",value:function(e){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.duration||4,e.interval||.2,e.trailLength||.1]}},{key:"startModelAnimate",value:function(){this.layer.getLayerConfig().animateOption.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){return function(e,t){var n=[],r="";e.forEach((function(e){var i=e.replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase(),o=S+i;t[e]?r+="#define USE_ATTRIBUTE_".concat(i," 0.0 \n"):n.push("  ".concat(T[e]," u_").concat(e,";")),r+="\n#ifdef USE_ATTRIBUTE_".concat(i,"\nlayout(location = ").concat(o,") in ").concat(T[e]," a_").concat(e.charAt(0).toUpperCase()+e.slice(1),";\n#endif \n")}));var i=n.length?"\nlayout(std140) uniform AttributeUniforms {\n  ".concat(n.join("\n"),"\n};\n"):"";r+=i;var o="";return e.forEach((function(e){var t=e.replace(/([a-z])([A-Z])/g,"$1_$2").toUpperCase();o+="\n  #ifdef USE_ATTRIBUTE_".concat(t,"\n    ").concat(T[e]," ").concat(e," = a_").concat(e.charAt(0).toUpperCase()+e.slice(1),";\n  #else\n    ").concat(T[e]," ").concat(e," = u_").concat(e,";\n  #endif\n  ")})),{"vs:#decl":r,"fs:#decl":i,"vs:#main-start":o}}(this.layer.enableShaderEncodeStyles,this.layer.encodeStyleAttribute)}},{key:"getDefines",value:function(){var e=this,t=Object.keys(this.attributeLocation).reduce((function(t,n){return t[S+n]=e.attributeLocation[n],t}),{});return c()({},t)}},{key:"getStyleAttribute",value:function(){var e=this,t={};return this.layer.enableShaderEncodeStyles.forEach((function(n){if(!e.layer.encodeStyleAttribute[n]){var r=e.layer.getLayerConfig()[n],i=void 0===r?E[n]:r;"stroke"===n&&(i=(0,y.CI)(i)),t["u_"+n]=i}})),t}},{key:"registerStyleAttribute",value:function(){var e=this;Object.keys(this.layer.encodeStyleAttribute).forEach((function(t){var n=(0,x.C)(t);n&&e.styleAttributeService.registerStyleAttribute(n)}))}},{key:"registerPosition64LowAttribute",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.styleAttributeService.registerStyleAttribute({name:"position64Low",type:m.AttributeType.Attribute,descriptor:{name:"a_Position64Low",shaderLocation:this.attributeLocation.POSITION_64LOW,buffer:{data:[],type:m.gl.FLOAT},size:2,update:function(t,n,r){return e?[(0,y.Ks)(r[0]),(0,y.Ks)(r[1])]:[0,0]}}})}},{key:"updateEncodeAttribute",value:function(e,t){this.encodeStyleAttribute[e]=t}},{key:"initUniformsBuffer",value:function(){var e=this.getUniformsBufferInfo(this.getStyleAttribute()),t=this.getCommonUniformsInfo();0!==e.uniformsLength&&(this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array((0,A.I)(e.uniformsLength)).fill(0),isUBO:!0,label:"layerModelAttributeUnifoms"}),this.uniformBuffers.push(this.attributeUnifoms)),0!==t.uniformsLength&&(this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array((0,A.I)(t.uniformsLength)).fill(0),isUBO:!0,label:"layerModelCommonUnifoms"}),this.uniformBuffers.push(this.commonUnifoms))}},{key:"getUniformsBufferInfo",value:function(e){var t=0,n=[];return Object.values(e).forEach((function(e){Array.isArray(e)?(n.push.apply(n,i()(e)),t+=e.length):"number"==typeof e?(n.push(e),t+=1):"boolean"==typeof e&&(n.push(Number(e)),t+=1)})),{uniformsOption:e,uniformsLength:t,uniformsArray:n}}},{key:"getCommonUniformsInfo",value:function(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}},{key:"updateStyleUnifoms",value:function(){var e,t,n=this.getUniformsBufferInfo(this.getStyleAttribute()).uniformsArray,r=this.getCommonUniformsInfo().uniformsArray;null===(e=this.attributeUnifoms)||void 0===e||e.subData({offset:0,data:new Uint8Array(new Float32Array(n).buffer)}),null===(t=this.commonUnifoms)||void 0===t||t.subData({offset:0,data:new Uint8Array(new Float32Array(r).buffer)})}}]),e}()},740:function(e,t,n){"use strict";n.d(t,{C:function(){return o},F:function(){return i}});var r=n(7033),i={POSITION:0,POSITION_64LOW:1,COLOR:2,PICKING_COLOR:3,STROKE:4,OPACITY:5,OFFSETS:6,ROTATION:7,MAX:8};function o(e){switch(e){case"rotation":return{name:"Rotation",type:r.AttributeType.Attribute,descriptor:{name:"a_Rotation",shaderLocation:i.ROTATION,buffer:{usage:r.gl.DYNAMIC_DRAW,data:[],type:r.gl.FLOAT},size:1,update:function(e){var t=e.rotation,n=void 0===t?0:t;return Array.isArray(n)?[n[0]]:[n]}}};case"stroke":return{name:"stroke",type:r.AttributeType.Attribute,descriptor:{name:"a_Stroke",shaderLocation:i.STROKE,buffer:{usage:r.gl.DYNAMIC_DRAW,data:[],type:r.gl.FLOAT},size:4,update:function(e){var t=e.stroke;return void 0===t?[1,1,1,1]:t}}};case"opacity":return{name:"opacity",type:r.AttributeType.Attribute,descriptor:{name:"a_Opacity",shaderLocation:i.OPACITY,buffer:{usage:r.gl.STATIC_DRAW,data:[],type:r.gl.FLOAT},size:1,update:function(e){var t=e.opacity;return[void 0===t?1:t]}}};case"offsets":return{name:"offsets",type:r.AttributeType.Attribute,descriptor:{name:"a_Offsets",shaderLocation:i.OFFSETS,buffer:{usage:r.gl.STATIC_DRAW,data:[],type:r.gl.FLOAT},size:2,update:function(e){return e.offsets}}};default:return}}},4659:function(e,t,n){"use strict";n.d(t,{Fy:function(){return s},cA:function(){return i},qy:function(){return o},xg:function(){return a},zW:function(){return r}});var r=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),i=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),o=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),a=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),s=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({})},3370:function(e,t,n){"use strict";n.d(t,{SE:function(){return p},Xw:function(){return u}});var r=n(3769),i=n.n(r),o=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),a=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function s(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2*Math.PI/e,r=[],i=0;i<e;i++)r.push(n*i+t*Math.PI/12);var o=r.map((function(e){return[Math.sin(e+Math.PI/4),Math.cos(e+Math.PI/4),0]}));return o}function u(){return s(30)}function l(){return s(4)}function c(){return s(3)}function f(){return s(6,1)}function h(){return s(5)}var p=i()(i()(i()(i()(i()(i()(i()(i()(i()(i()({},a.CIRCLE,u),a.HEXAGON,f),a.TRIANGLE,c),a.SQUARE,l),a.PENTAGON,h),o.CYLINDER,u),o.HEXAGONCOLUMN,f),o.TRIANGLECOLUMN,c),o.SQUARECOLUMN,l),o.PENTAGONCOLUMN,h)},8222:function(e,t,n){"use strict";n.d(t,{S:function(){return P},Rs:function(){return W},zO:function(){return Y},$4:function(){return Z},sN:function(){return D},NM:function(){return N},oX:function(){return I},xH:function(){return B},Xz:function(){return H},iC:function(){return X},us:function(){return U},qZ:function(){return Q},NW:function(){return K},Qr:function(){return G},T3:function(){return V}});var r=n(3420),i=n.n(r),o=n(2786),a=n.n(o),s=n(7193),u=n(1102),l=n.n(u),c=n(7967),f=n(8025),h=n.n(f),p=n(1133),d=n.n(p),v=n(3769),g=n.n(v),m=n(2621),y=m.Ue(),_=(m.Ue(),m.Ue()),b=m.Ue(),x=m.Ue();function E(e,t,n,r,i){m.IH(e,n,r),m.Fv(e,e),t=m.al(-e[1],e[0]);var o=m.al(-n[1],n[0]);return[i/m.AK(t,o),t]}function T(e,t){return m.t8(e,-t[1],t[0])}function A(e,t,n){return m.lu(e,t,n),m.Fv(e,e),e}function S(e,t){return e[0]===t[0]&&e[1]===t[1]}var C=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};h()(this,e),g()(this,"complex",void 0),g()(this,"join",void 0),g()(this,"cap",void 0),g()(this,"miterLimit",void 0),g()(this,"thickness",void 0),g()(this,"normal",void 0),g()(this,"lastFlip",-1),g()(this,"miter",m.al(0,0)),g()(this,"started",!1),g()(this,"dash",!1),g()(this,"totalDistance",0),g()(this,"currentIndex",0),this.join=t.join||"miter",this.cap=t.cap||"butt",this.miterLimit=t.miterLimit||10,this.thickness=t.thickness||1,this.dash=t.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return d()(e,[{key:"simpleExtrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.simpleSegment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"extrude",value:function(e){var t=this.complex;if(e.length<=1)return t;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=e.length,r=t.startIndex,i=1;i<n;i++){var o=e[i-1],a=e[i],s=i<e.length-1?e[i+1]:null;r+=this.segment(t,r,o,a,s)}if(this.dash)for(var u=0;u<t.positions.length/6;u++)t.positions[6*u+5]=this.totalDistance;return t.startIndex=t.positions.length/6,t}},{key:"simpleSegment",value:function(e,t,n,r,o){var u=0,l=e.indices,c=e.positions,f=e.normals,h=(0,s.Z)([r[0],r[1]]),p=(0,s.Z)([n[0],n[1]]);A(_,h,p);var d=0;if(this.dash&&(d=this.lineSegmentDistance(h,p),this.totalDistance+=d),this.normal||(this.normal=m.Ue(),T(this.normal,_)),this.started||(this.started=!0,this.extrusions(c,f,n,this.normal,this.thickness,this.totalDistance-d)),l.push(t+0,t+1,t+2),o){var v=(0,s.Z)([o[0],o[1]]);S(h,v)&&m.IH(v,h,m.Fv(v,m.$X(v,h,p))),A(b,v,h);var g=E(x,m.Ue(),_,b,this.thickness),y=i()(g,2),C=y[0],R=y[1];m.AK(x,this.normal);this.extrusions(c,f,r,R,C,this.totalDistance),l.push.apply(l,a()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),-1,m.JG(this.normal,R),u+=2,this.lastFlip=-1}else T(this.normal,_),this.extrusions(c,f,r,this.normal,this.thickness,this.totalDistance),l.push.apply(l,a()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),u+=2;return u}},{key:"segment",value:function(e,t,n,r,o){var u=0,l=e.indices,c=e.positions,f=e.normals,h="square"===this.cap,p="bevel"===this.join,d=(0,s.Z)([r[0],r[1]]),v=(0,s.Z)([n[0],n[1]]);A(_,d,v);var g=0;if(this.dash&&(g=this.lineSegmentDistance(d,v),this.totalDistance+=g),this.normal||(this.normal=m.Ue(),T(this.normal,_)),!this.started)if(this.started=!0,h){var C=m.Ue(),R=m.Ue();m.IH(C,this.normal,_),m.IH(R,this.normal,_),f.push(R[0],R[1],0),f.push(C[0],C[1],0),c.push(n[0],n[1],0|n[2],this.totalDistance-g,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),c.push(n[0],n[1],0|n[2],this.totalDistance-g,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,f,n,this.normal,this.thickness,this.totalDistance-g);if(l.push(t+0,t+1,t+2),o){var w=(0,s.Z)([o[0],o[1]]);S(d,w)&&m.IH(w,d,m.Fv(w,m.$X(w,d,v))),A(b,w,d);var M=E(x,m.Ue(),_,b,this.thickness),k=i()(M,2),L=k[0],O=k[1],I=m.AK(x,this.normal)<0?-1:1,P=p;if(!P&&"miter"===this.join)L>this.miterLimit&&(P=!0);P?(f.push(this.normal[0],this.normal[1],0),f.push(O[0],O[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*I,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*I,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l.push.apply(l,a()(this.lastFlip!==-I?[t,t+2,t+3]:[t+2,t+1,t+3])),l.push(t+2,t+3,t+4),T(y,b),m.JG(this.normal,y),f.push(this.normal[0],this.normal[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*I,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(c,f,r,O,L,this.totalDistance),l.push.apply(l,a()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),I=-1,m.JG(this.normal,O),u+=2),this.lastFlip=I}else{if(T(this.normal,_),h){var N=m.Ue(),B=m.Ue();m.lu(B,_,this.normal),m.IH(N,_,this.normal),f.push(B[0],B[1],0),f.push(N[0],N[1],0),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),c.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(c,f,r,this.normal,this.thickness,this.totalDistance);l.push.apply(l,a()(1===this.lastFlip?[t,t+2,t+3]:[t+2,t+1,t+3])),u+=2}return u}},{key:"extrusions",value:function(e,t,n,r,i,o){t.push(r[0],r[1],0),t.push(r[0],r[1],0),e.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),e.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}}]),e}(),R=n(3370),w=n(3188),M=n(2662);function k(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e[0][0],r=e[0][e[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,o=l().flatten(e),s=o.vertices,u=o.dimensions,c=o.holes,f=[],h=[],p=[],d=0;d<s.length/u;d++)f.push(s[d*u],s[d*u+1],1,-1,-1),p.push(0,0,1);var v=(0,M.c)(s,c,u,t);h.push.apply(h,a()(v));for(var g=function(){var e=o.vertices.slice(m*u,(m+1)*u),n=o.vertices.slice((m+1)*u,(m+2)*u);0===n.length&&(n=o.vertices.slice(0,u));var r=f.length/5;f.push(e[0],e[1],1,0,0,n[0],n[1],1,.1,0,e[0],e[1],0,0,.8,n[0],n[1],0,.1,.8);var i=L([n[0],n[1],1],[e[0],e[1],0],[e[0],e[1],1],t);p.push.apply(p,a()(i).concat(a()(i),a()(i),a()(i))),h.push.apply(h,a()([1,2,0,3,2,1].map((function(e){return e+r}))))},m=0;m<i;m++)g();return{positions:f,index:h,normals:p}}function L(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=w.create(),o=w.create(),u=w.create();r&&(e=(0,s.vP)(e),t=(0,s.vP)(t),n=(0,s.vP)(n));var l=w.fromValues.apply(w,a()(e)),c=w.fromValues.apply(w,a()(t)),f=w.fromValues.apply(w,a()(n));w.sub(i,f,c),w.sub(o,l,c),w.cross(u,i,o);var h=w.create();return w.normalize(h,u),h}var O={};function I(e){var t=(0,s.SI)(e.coordinates);return{vertices:[].concat(a()(t),a()(t),a()(t),a()(t)),indices:[0,1,2,2,3,0],size:t.length}}function P(e){var t=(0,s.SI)(e.coordinates),n=(0,c.rq)(t);return{vertices:[].concat(a()(n),a()(n),a()(n),a()(n)),indices:[0,1,2,2,3,0],size:n.length}}function N(e){var t=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(O&&O[e])return O[e];var n=R.SE[e]?R.SE[e]():R.SE.cylinder(),r=k([n],t);return O[e]=r,r}(e.shape,!1);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function B(e){var t=(0,s.SI)(e.coordinates);return{vertices:a()(t),indices:[0],size:t.length}}function D(e){var t=e.coordinates,n=new C({dash:!0,join:"bevel"}),r=t;r[0]&&!Array.isArray(r[0][0])&&(r=[t]),r.forEach((function(e){n.extrude(e)}));var i=n.complex;return{vertices:i.positions,indices:i.indices,normals:i.normals,indexes:i.indexes,size:6}}function U(e){var t=e.coordinates,n=[];if(!Array.isArray(t[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var r=function(e){var t=e;Array.isArray(t)&&Array.isArray(t[0])&&Array.isArray(t[0][0])&&(t=e.flat());var n=0;if(t.length<2)return{results:t,totalDistance:0};var r=[],i=z(t[0],n);r.push(i);for(var o=1;o<t.length-1;o++){n+=F((0,s.Z)(t[o-1]),(0,s.Z)(t[o]));var a=z(t[o],n);r.push(a),r.push(a)}return n+=F((0,s.Z)(t[t.length-2]),(0,s.Z)(t[t.length-1])),r.push(z(t[t.length-1],n)),{results:r,totalDistance:n}}(t),i=r.results,o=r.totalDistance;return i.map((function(e){n.push(e[0],e[1],e[2],e[3],0,o)})),{vertices:n,indices:[],normals:[],size:6,count:i.length}}function F(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(n*n+r*r)}function z(e,t){return e.length<3&&e.push(0),void 0!==t&&e.push(t),e}function G(e){var t=e.coordinates,n=l().flatten(t),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:(0,M.c)(r,o,i),vertices:r,size:i}}function V(e){var t=G(e),n=t.indices,r=t.vertices,i=t.size;return{indices:n,vertices:j(r),size:i+4}}function j(e){for(var t=[],n=(0,s.Rx)(e),r=n.center,i=n.radius,o=0;o<e.length;o+=2){var u=e[o],l=e[o+1];t.push.apply(t,[u,l,0].concat(a()(r),[i]))}return t}function H(e){var t=k(e.coordinates,!0);return{vertices:t.positions,indices:t.index,normals:t.normals,size:5}}function W(e){var t=function(e){var t=["cylinder","triangleColumn","hexagonColumn","squareColumn"],n=R.SE[e]?R.SE[e]():R.SE.circle(),r=-1===t.indexOf(e)?(i=[n],o=l().flatten(i),s=l()(o.vertices,o.holes,o.dimensions),{positions:o.vertices,index:s}):function(e){var t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var r=e[0].length,i=l().flatten(e),o=i.vertices,s=i.dimensions,u=[],c=[],f=0;f<o.length/s;f++)2===s?u.push(o[2*f],o[2*f+1],1):u.push(o[3*f],o[3*f+1],1);var h=l()(i.vertices,i.holes,i.dimensions);c.push.apply(c,a()(h));for(var p=function(){var e=i.vertices.slice(d*s,(d+1)*s),t=i.vertices.slice((d+1)*s,(d+2)*s);0===t.length&&(t=i.vertices.slice(0,s));var n=u.length/3;u.push(e[0],e[1],1,t[0],t[1],1,e[0],e[1],0,t[0],t[1],0),c.push.apply(c,a()([0,2,1,2,3,1].map((function(e){return e+n}))))},d=0;d<r;d++)p();return{positions:u,index:c}}([n]);var i,o,s;return r}(e.shape);return{vertices:t.positions,indices:t.index,size:3}}function X(e){var t=e.coordinates;return{vertices:[].concat(a()(t[0]),[0,0,0],a()(t[1]),[0,1,0],a()(t[2]),[0,1,1],a()(t[3]),[0,0,1]),indices:[0,1,2,0,2,3],size:5}}function Z(e,t){for(var n=t.segmentNumber,r=void 0===n?30:n,i=e.coordinates,o=[],s=[],u=function(e){o.push(e,1,e,i[0][0],i[0][1],i[1][0],i[1][1],e,-1,e,i[0][0],i[0][1],i[1][0],i[1][1]),e!==r-1&&s.push.apply(s,a()([0,1,2,1,3,2].map((function(t){return 2*e+t}))))},l=0;l<r;l++)u(l);return{vertices:o,indices:s,size:7}}function Y(e){var t=e.coordinates;2===t.length&&t.push(0);var n=q(-1,1),r=q(1,1),i=q(-1,-1),o=q(1,-1);return{vertices:[].concat(a()(t),a()(n),a()(t),a()(i),a()(t),a()(o),a()(t),a()(r)),indices:[0,1,2,3,0,2],size:5}}function q(e,t){return[(e+1)/2,(t+1)/2]}function K(){var e=(0,c.j7)(c.Y5,{segments:c.r1});return{vertices:e.positionsArr,indices:e.indicesArr,size:5,normals:e.normalArr}}function Q(){var e=(0,c.j7)(c.Y5+c.XJ,{segments:c.r1});return{vertices:e.positionsArr,indices:e.indicesArr,size:5,normals:e.normalArr}}},2662:function(e,t,n){"use strict";n.d(t,{I:function(){return a},c:function(){return s}});var r=n(7193),i=n(1102),o=n.n(i);function a(e){return Math.max(4*Math.ceil(e/4),4)}function s(e,t,n){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=3===n;if(i){e=e.slice();for(var s=[],u=0;u<e.length;u+=n){s[0]=e[u],s[1]=e[u+1],a&&(s[2]=e[u+2]);var l=(0,r.vP)(s,!0,{enable:!1,decimal:1});e[u]=l[0],e[u+1]=l[1],a&&(e[u+2]=l[2])}}var c=o()(e,t,n);return c}},7967:function(e,t,n){"use strict";n.d(t,{XJ:function(){return l},Y5:function(){return s},j7:function(){return h},r1:function(){return u},rq:function(){return f}});var r=n(2786),i=n.n(r),o=n(7703),a=n(3188),s=100,u=36,l=40;function c(e){return e/180*Math.acos(-1)}function f(e){var t=c(e[0])+Math.PI/2,n=c(e[1]),r=s+.4*Math.random(),i=r*Math.cos(n)*Math.cos(t);return[r*Math.cos(n)*Math.sin(t),r*Math.sin(n),i]}function h(e,t){var n=o.create(),r=o.create(),s=a.fromValues(0,1,0),u=a.fromValues(0,0,0);e=void 0!==e?e:1;for(var l=2+(void 0!==(t=t||{}).segments?t.segments:32),c=2*l,f=[],h=[],p=[],d=[],v=[],g=[],m=0;m<=l;m++){for(var y=m/l,_=y*Math.PI,b=0;b<=c;b++){var x=b/c,E=x*Math.PI*2;o.identity(r),o.rotateZ(r,r,-_),o.identity(n),o.rotateY(n,n,E),a.transformMat4(u,s,r),a.transformMat4(u,u,n),a.scale(u,u,-e),p.push(u.slice()),d.push.apply(d,i()(u.slice())),a.normalize(u,u),v.push.apply(v,i()(u.slice())),g.push([x,1-y]),d.push(x,1-y)}if(m>0)for(var T=p.length,A=T-2*(c+1);A+c+2<T;A++)f.push([A,A+1,A+c+1]),h.push(A,A+1,A+c+1),f.push([A+c+1,A+1,A+c+2]),h.push(A+c+1,A+1,A+c+2)}return{cells:f,positions:p,uvs:g,positionsArr:d,indicesArr:h,normalArr:v}}},3281:function(e,t,n){"use strict";n.d(t,{Z:function(){return k}});var r=n(6502),i=n.n(r),o=n(4351),a=n.n(o),s=n(8025),u=n.n(s),l=n(1133),c=n.n(l),f=n(1119),h=n.n(f),p=n(3491),d=n.n(p),v=n(2060),g=n.n(v),m=n(3769),y=n.n(m),_=n(6677),b=n(6413),x=n.n(b),E=n(5757),T=n.n(E),A=n(7033),S=n(7193),C=n(8407),R=n(8222),w=function(e){d()(s,e);var t,n,r,o=g()(s);function s(){var e;u()(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=o.call.apply(o,[this].concat(n)),y()(h()(e),"texture",void 0),e}return c()(s,[{key:"attributeLocation",get:function(){return Object.assign(x()(T()(s.prototype),"attributeLocation",this),{MAX:x()(T()(s.prototype),"attributeLocation",this).MAX,UV:9})}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.brightness,r=e.contrast,i=e.saturation,o=e.gamma,a={u_opacity:(0,S.LS)(t,1),u_brightness:(0,S.LS)(n,1),u_contrast:(0,S.LS)(r,1),u_saturation:(0,S.LS)(i,1),u_gamma:(0,S.LS)(o,1)};return this.textures=[this.texture],this.getUniformsBufferInfo(a)}},{key:"initModels",value:(r=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadTexture();case 2:return e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"loadTexture",value:(n=a()(i()().mark((function e(){var t,n,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.rendererService.createTexture2D,n=this.layer.getSource(),e.next=4,n.data.images;case 4:r=e.sent,this.texture=t({data:r[0],width:r[0].width,height:r[0].height,mag:A.gl.LINEAR,min:A.gl.LINEAR});case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n    float u_opacity:1.0;\n    float u_brightness:1.0;\n    float u_contrast:1.0;\n    float u_saturation:1.0;\n    float u_gamma:1.0;\n};\n\nout vec2 v_texCoord;\n#pragma include "projection"\n\nvoid main() {\n  v_texCoord = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));\n}\n',fragmentShader:"uniform sampler2D u_texture;\nlayout(std140) uniform commonUniforms {\n    float u_opacity:1.0;\n    float u_brightness:1.0;\n    float u_contrast:1.0;\n    float u_saturation:1.0;\n    float u_gamma:1.0;\n};\n\nin vec2 v_texCoord;\nout vec4 outputColor;\nvec3 setContrast(vec3 rgb, float contrast) {\n  vec3 color = mix(vec3(0.5), rgb, contrast);\n  color = clamp(color, 0.0, 1.0);\n  return color;\n}\nvec3 setSaturation(vec3 rgb, float adjustment) {\n  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);\n  vec3 intensity = vec3(dot(rgb, grayVector));\n  vec3 color = mix(intensity, rgb, adjustment);\n  color = clamp(color, 0.0, 1.0);\n  return color;\n}\nvoid main() {\n  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));\n  //brightness\n  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);\n  //contrast\n  color.rgb = setContrast(color.rgb, u_contrast);\n  // saturation\n  color.rgb = setSaturation(color.rgb, u_saturation);\n  // gamma\n  color.rgb = pow(color.rgb, vec3(u_gamma));\n  outputColor = color;\n  outputColor.a *= u_opacity;\n  if(outputColor.a < 0.01)\n    discard;\n}\n",defines:this.getDefines(),triangulation:R.iC,primitive:A.gl.TRIANGLES,blend:{enable:!0},depth:{enable:!1},pickingEnabled:!1});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:A.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:A.gl.DYNAMIC_DRAW,data:[],type:A.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),s}(C.Z),M={image:w},k=function(e){d()(r,e);var t,n=g()(r);function r(){var e;u()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),y()(h()(e),"type","ImageLayer"),e}return c()(r,[{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new M[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{image:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"image"}}]),r}(_.Z)},2422:function(e,t,n){"use strict";n.d(t,{zi:function(){return S.Z},gq:function(){return w.Z},mM:function(){return O},Fy:function(){return M.Fy},Rf:function(){return F},fJ:function(){return ve},VR:function(){return W},zP:function(){return ee},Q8:function(){return te.Z},Ie:function(){return ne.Z},cA:function(){return M.cA},$1:function(){return ge.Z},ns:function(){return re.Z},dW:function(){return ie.Z},YY:function(){return oe.Z},xg:function(){return M.xg},qy:function(){return M.qy},sh:function(){return se},Im:function(){return ae.Z},vo:function(){return Me},zW:function(){return M.zW}});var r=n(4450),i=n.n(r),o=n(6502),a=n.n(o),s=n(4351),u=n.n(s),l=n(8025),c=n.n(l),f=n(1133),h=n.n(f),p=n(1119),d=n.n(p),v=n(6413),g=n.n(v),m=n(5757),y=n.n(m),_=n(3491),b=n.n(_),x=n(2060),E=n.n(x),T=n(3769),A=n.n(T),S=n(6677),C=n(3420),R=n.n(C),w=n(8407),M=n(4659),k={canvas2d:"2d",webgl:"webgl",webgl2:"webgl2",webgpu:"webgpu"},L=function(e){b()(r,e);var t,n=E()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),A()(d()(e),"canvas",null),A()(d()(e),"ctx",void 0),A()(d()(e),"ctxType",void 0),A()(d()(e),"viewportSize",void 0),A()(d()(e),"initCanvas",(function(){var t,n,r,i,o,a=e.layerConfig,s=a.zIndex,u=a.getContext,l=document.createElement("canvas"),c=e.layer.getModelType();e.canvas=l,l.classList.add("l7-canvas-layer"),l.style.position="absolute",l.style.top="0",l.style.left="0",l.style.zIndex=String(s),e.resetCanvasSize();var f=null!==(t=null===(n=(r=e.mapService).getCanvasOverlays)||void 0===n?void 0:n.call(r))&&void 0!==t?t:null===(i=(o=e.mapService).getMapCanvasContainer)||void 0===i?void 0:i.call(o);null==f||f.appendChild(l),e.ctx=u?u(l):l.getContext(k[c]),e.ctx||console.error("Failed to get rendering context for canvas"),e.bindListeners()})),A()(d()(e),"resetViewportSize",(function(){var t=e.rendererService.getViewportSize(),n=t.width,r=t.height;e.viewportSize=[n,r]})),A()(d()(e),"resetCanvasSize",(function(){var t=e.canvas;if(t){e.resetViewportSize();var n=e.mapService.getSize(),r=R()(n,2),i=r[0],o=r[1],a=R()(e.viewportSize,2),s=a[0],u=a[1];t.width=s,t.height=u,t.style.width=i+"px",t.style.height=o+"px"}})),A()(d()(e),"renderCanvas",(function(){var t;e.canvas||e.initCanvas();var n=e.layerConfig,r=n.draw,i=n.drawingOnCanvas,o=R()(e.viewportSize,2),a=o[0],s=o[1],u=e.mapService.getBounds();null===(t=null!=r?r:i)||void 0===t||t({canvas:e.canvas,ctx:e.ctx,container:{width:a,height:s,bounds:u},size:[a,s],utils:{lngLatToContainer:e.lngLatToContainer},mapService:e.mapService})})),A()(d()(e),"removeCanvas",(function(){var t;e.canvas&&(null===(t=e.canvas.parentElement)||void 0===t||t.removeChild(e.canvas),e.canvas=null);e.unbindListeners()})),A()(d()(e),"onMapResize",(function(){requestAnimationFrame((function(){e.resetCanvasSize(),e.renderCanvas()}))})),A()(d()(e),"lngLatToContainer",(function(t){var n=e.mapService.lngLatToContainer(t),r=n.x,i=n.y;return{x:r*window.devicePixelRatio,y:i*window.devicePixelRatio}})),e}return h()(r,[{key:"layerConfig",get:function(){return this.layer.getLayerConfig()}},{key:"initModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.renderCanvas(),e.abrupt("return",[]);case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"bindListeners",value:function(){this.mapService.on("resize",this.onMapResize);var e=this.layerConfig,t=e.trigger;e.update===M.Fy.ALWAYS||"change"===t?this.mapService.on("mapchange",this.renderCanvas):(this.mapService.on("zoomstart",this.removeCanvas),this.mapService.on("zoomend",this.renderCanvas),this.mapService.on("movestart",this.removeCanvas),this.mapService.on("moveend",this.renderCanvas))}},{key:"unbindListeners",value:function(){this.mapService.off("resize",this.onMapResize),this.mapService.off("mapchange",this.renderCanvas),this.mapService.off("zoomstart",this.removeCanvas),this.mapService.off("zoomend",this.renderCanvas),this.mapService.off("movestart",this.removeCanvas),this.mapService.off("moveend",this.renderCanvas)}},{key:"registerBuiltinAttributes",value:function(){}}]),r}(w.Z),O=function(e){b()(r,e);var t,n=E()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),A()(d()(e),"type","CanvasLayer"),e}return h()(r,[{key:"getDefaultConfig",value:function(){return{zIndex:3,contextType:"canvas2d",trigger:"change"}}},{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layerModel=new L(this),e.next=3,this.initLayerModels();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getModelType",value:function(){return this.getLayerConfig().contextType||"canvas2d"}},{key:"draw",value:function(e){return this.updateLayerConfig({draw:e}),this.render(),this}},{key:"getLayerConfig",value:function(){var e=i()(i()({},this.getDefaultConfig()),g()(y()(r.prototype),"getLayerConfig",this).call(this));return e.zIndex<3&&(e.zIndex=3),e}},{key:"render",value:function(){var e;return null===(e=this.layerModel)||void 0===e||e.renderCanvas(),this}},{key:"getCanvas",value:function(){var e;return null===(e=this.layerModel)||void 0===e?void 0:e.canvas}},{key:"show",value:function(){var e=this.getCanvas();return e&&(e.style.display="unset"),this}},{key:"hide",value:function(){var e=this.getCanvas();return e&&(e.style.display="none"),this}},{key:"destroy",value:function(){this.layerModel.removeCanvas(),g()(y()(r.prototype),"destroy",this).call(this)}}]),r}(S.Z),I=n(2786),P=n.n(I),N=n(7033),B=n(7193),D=n(8222),U=function(e){b()(i,e);var t,n,r=E()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),A()(d()(e),"cityCenter",void 0),A()(d()(e),"cityMinSize",void 0),e}return h()(i,[{key:"attributeLocation",get:function(){return Object.assign(g()(y()(i.prototype),"attributeLocation",this),{MAX:g()(y()(i.prototype),"attributeLocation",this).MAX,SIZE:9,NORMAL:10,UV:11})}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.baseColor,i=void 0===r?"rgb(16,16,16)":r,o=e.brightColor,a=void 0===o?"rgb(255,176,38)":o,s=e.windowColor,u=void 0===s?"rgb(30,60,89)":s,l=e.time,c=void 0===l?0:l,f=e.sweep,h=void 0===f?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:f,p={u_baseColor:(0,B.CI)(i),u_brightColor:(0,B.CI)(a),u_windowColor:(0,B.CI)(u),u_circleSweepColor:[].concat(P()((0,B.CI)(h.sweepColor).slice(0,3)),[1]),u_cityCenter:h.sweepCenter||this.cityCenter,u_circleSweep:h.enable?1:0,u_cityMinSize:this.cityMinSize*h.sweepRadius,u_circleSweepSpeed:h.sweepSpeed,u_opacity:n,u_near:0,u_far:1,u_time:this.layer.getLayerAnimateTime()||c};return this.getUniformsBufferInfo(p)}},{key:"calCityGeo",value:function(){var e=R()(this.layer.getSource().extent,4),t=e[0],n=e[1],r=e[2],i=e[3],o=r-t,a=i-n;this.cityCenter=[(r+t)/2,(i+n)/2],this.cityMinSize=Math.sqrt(Math.pow(o,2)+Math.pow(a,2))/4}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.calCityGeo(),this.initUniformsBuffer(),this.startModelAnimate(),e.abrupt("return",this.buildModels());case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:'precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\nout vec2 v_texCoord;\nout vec4 v_Color;\nout float v_worldDis;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];\n  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];\n  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];\n  vec4 u_circleSweepColor;\n  vec2 u_cityCenter;\n  float u_circleSweep;\n  float u_cityMinSize;\n  float u_circleSweepSpeed;\n  float u_opacity: 1.0;\n  float u_near : 0;\n  float u_far : 1;\n  float u_time;\n};\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n   v_texCoord = a_Uv;\n\n  if(u_circleSweep > 0.0) {\n     vec2 lnglatscale = vec2(0.0);\n    lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);\n    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  float lightWeight = calc_lighting(pos);\n  // v_Color = a_Color;\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nlayout(std140) uniform commonUniforms {\n  vec4 u_baseColor: [ 1.0, 0, 0, 1.0 ];\n  vec4 u_brightColor: [ 1.0, 0, 0, 1.0 ];\n  vec4 u_windowColor: [ 1.0, 0, 0, 1.0 ];\n  vec4 u_circleSweepColor;\n  vec2 u_cityCenter;\n  float u_circleSweep;\n  float u_cityMinSize;\n  float u_circleSweepSpeed;\n  float u_opacity: 1.0;\n  float u_near: 0;\n  float u_far: 1;\n  float u_time;\n};\nin vec4 v_Color;\nin vec2 v_texCoord;\nin float v_worldDis;\nout vec4 outputColor;\n\n#pragma include "picking"\n#pragma include "scene_uniforms"\n\nvec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {\n    float s = step(hot, n);\n    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);\n\n    return mix(darkColor, color, s);\n}\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);\n}\n\nfloat LinearizeDepth()\n{\n    float z = gl_FragCoord.z * 2.0 - 1.0;\n    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));\n}\n\nvec3 fog(vec3 color, vec3 fogColor, float depth){\n    float fogFactor=clamp(depth,0.0,1.0);\n    vec3 output_color=mix(fogColor,color,fogFactor);\n    return output_color;\n}\n\nfloat sdRect(vec2 p, vec2 sz) {\n  vec2 d = abs(p) - sz;\n  float outside = length(max(d, 0.));\n  float inside = min(max(d.x, d.y), 0.);\n  return outside + inside;\n}\n\nvoid main() {\n  outputColor = v_Color;\n  vec3 baseColor = u_baseColor.xyz;\n  vec3 brightColor = u_brightColor.xyz;\n  vec3 windowColor = u_windowColor.xyz;\n  float targetColId = 5.;\n  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;\n  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);\n  if(v_texCoord.x < 0.) { //顶部颜色\n       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);\n       outputColor = vec4( foggedColor, v_Color.w);\n  }else { // 侧面颜色\n        vec2 st = v_texCoord;\n        vec2  UvScale = v_texCoord;\n        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));\n        float tStart = 0.25 * tStep;\n        float tEnd = 0.75 * tStep;\n        float u = mod(UvScale.x, tStep);\n        float v = mod(UvScale.y, tStep);\n        float ux = floor(UvScale.x/tStep);\n        float uy = floor(UvScale.y/tStep);\n        float n = random(vec2(ux,uy));\n        float lightP = u_time;\n        float head = 1.0- step(0.005,st.y);\n        /*step3*/\n        // 将窗户颜色和墙面颜色区别开来\n        float sU = step(tStart, u) - step(tEnd, u);\n        float sV = step(tStart, v) - step(tEnd, v);\n        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));\n        float dist = sdRect(vec2(u,v), windowSize);\n        float s = sU * sV;\n\n        float curColId = floor(UvScale.x / tStep);\n        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);\n\n        float mLightP = mod(lightP, 2.);\n        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);\n        if(ux == targetColId){\n            n =0.;\n        }\n        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );\n        float hot = smoothstep(1.0,0.0,timeP);\n        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);\n        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);\n        float sFinal = s * sCol * sRow;\n        color += mix(baseColor, brightColor, sFinal*n);\n        if (st.y<0.01){\n        color = baseColor;\n         }\n        if(head ==1.0) { // 顶部亮线\n            color = brightColor;\n        }\n        color = color * v_Color.rgb;\n\n        vec3 foggedColor = fog(color,fogColor,depth);\n\n        outputColor = vec4(foggedColor,1.0);\n  }\n\n\n  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {\n    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);\n    outputColor.rgb += r * r * u_circleSweepColor.rgb;\n  }\n\n  outputColor.a *= u_opacity;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:D.Xz,depth:{enable:!0},defines:this.getDefines(),inject:this.getInject(),cull:{enable:!0,face:N.gl.BACK}});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:N.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:N.gl.STATIC_DRAW,data:[],type:N.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:N.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?10:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:N.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),i}(w.Z),F=function(e){b()(r,e);var t,n=E()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),A()(d()(e),"type","CityBuildingLayer"),e}return h()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layerModel=new U(this),e.next=3,this.initLayerModels();case 3:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setLight",value:function(e){this.updateLayerConfig({time:e})}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(S.Z),z=function(e){b()(o,e);var t,n,r=E()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),A()(d()(e),"texture",void 0),A()(d()(e),"radian",0),A()(d()(e),"planeGeometryTriangulation",(function(){var t=e.layer.getLayerConfig().center,n=void 0===t?[120,30]:t;return{size:4,indices:[0,1,2,2,3,0],vertices:[].concat(P()(n),[1,1],P()(n),[0,1],P()(n),[0,0],P()(n),[1,0])}})),e}return h()(o,[{key:"attributeLocation",get:function(){return Object.assign(g()(y()(o.prototype),"attributeLocation",this),{MAX:g()(y()(o.prototype),"attributeLocation",this).MAX,EXTRUDE:9,UV:10})}},{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),i()(i()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.width,r=void 0===n?1:n,i=e.height,o=void 0===i?1:i,a=e.raisingHeight,s=void 0===a?0:a,u=1;"amap"===this.mapService.getType()&&(u=-1),this.radian=u*Math.PI*(this.mapService.getRotation()%360)/180;var l={u_size:[r,o],u_raisingHeight:Number(s),u_rotation:this.radian,u_opacity:t||1,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(l)}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.drawCanvas,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),n&&this.updateTexture(n),this.initUniformsBuffer(),e.next=7,this.layer.buildLayerModel({moduleName:"geometryBillboard",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_size;\n  float u_raisingHeight;\n  float u_rotation;\n  float u_opacity;\n};\n\nout vec2 v_uv;\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "rotation_2d"\nvoid main() {\n  vec3 extrude = a_Extrude;\n  v_uv = a_Uv;\n  float raiseHeight = u_raisingHeight;\n  if (\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);\n    raiseHeight = u_raisingHeight * mapboxZoomScale;\n  }\n\n  // 计算经纬度点位坐标\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n  // 计算绕 z 轴旋转后的偏移\n  vec2 offsetXY = project_pixel(rotate_matrix(vec2(extrude.x * u_size.x, 0.0), u_rotation));\n  // 绕 z 轴旋转\n  float x = project_pos.x + offsetXY.x;\n  float y = project_pos.y + offsetXY.y;\n  // z 轴不参与旋转\n  float z = project_pixel(extrude.y * u_size.y + raiseHeight);\n\n  gl_Position = project_common_position_to_clipspace(vec4(x, y, z, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'layout(std140) uniform commonUniforms {\n vec2 u_size;\n float u_raisingHeight;\n float u_rotation;\n float u_opacity;\n};\n\nuniform sampler2D u_texture;\n\nin vec2 v_uv;\nout vec4 outputColor;\n\n#pragma include "picking"\nvoid main() {\n  outputColor = texture(SAMPLER_2D(u_texture), vec2(v_uv.x, 1.0 - v_uv.y));\n  outputColor.a *= u_opacity;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:this.planeGeometryTriangulation,defines:this.getDefines(),inject:this.getInject(),primitive:N.gl.TRIANGLES,depth:{enable:!0}});case 7:return i=e.sent,e.abrupt("return",[i]);case 9:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"updateTexture",value:function(e){var t=this.rendererService.createTexture2D,n=this.layer.getLayerConfig(),r=n.canvasWidth,i=void 0===r?1:r,o=n.canvasHeight,a=void 0===o?1:o,s=document.createElement("canvas");s.width=i,s.height=a,s.getContext("2d")&&(e(s),this.texture=t({data:s,width:s.width,height:s.height,wrapS:N.gl.CLAMP_TO_EDGE,wrapT:N.gl.CLAMP_TO_EDGE}),this.layerService.reRender())}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:N.AttributeType.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:N.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:2,update:function(e,t,n){return[n[2],n[3]]}}})}}]),o}(w.Z),G=function(e){b()(s,e);var t,n,r,o=E()(s);function s(){var e;c()(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=o.call.apply(o,[this].concat(n)),A()(d()(e),"texture",void 0),A()(d()(e),"terrainImage",void 0),A()(d()(e),"terrainImageLoaded",!1),A()(d()(e),"mapTexture",void 0),A()(d()(e),"planeGeometryTriangulation",(function(){var t,n=e.layer.getLayerConfig(),r=n.width,i=void 0===r?1:r,o=n.height,a=void 0===o?1:o,s=n.widthSegments,u=void 0===s?1:s,l=n.heightSegments,c=void 0===l?1:l,f=n.center,h=void 0===f?[120,30]:f,p=n.terrainTexture,d=n.rgb2height,v=void 0===d?function(e,t,n){return e+t+n}:d,g=(t=e).initPlane.apply(t,[i,a,u,c].concat(P()(h))),m=g.indices,y=g.positions;return p?e.translateVertex(y,m,e.terrainImage,u,c,v):{vertices:y,indices:m,size:5}})),e}return h()(s,[{key:"attributeLocation",get:function(){return Object.assign(g()(y()(s.prototype),"attributeLocation",this),{MAX:g()(y()(s.prototype),"attributeLocation",this).MAX,UV:10})}},{key:"initPlane",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:120,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,a=e/2,s=t/2,u=Math.floor(n),l=Math.floor(r),c=u+1,f=l+1,h=e/u,p=t/l,d=[],v=[],g=0;g<f;g++)for(var m=g*p-s,y=0;y<c;y++){var _=y*h-a;v.push(_+i,-m+o,0),v.push(y/u),v.push(1-g/l)}for(var b=0;b<l;b++)for(var x=0;x<u;x++){var E=x+c*b,T=x+c*(b+1),A=x+1+c*(b+1),S=x+1+c*b;d.push(E,T,S),d.push(T,A,S)}return{indices:d,positions:v}}},{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),i()(i()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.mapTexture,i=t.terrainClipHeight,o=void 0===i?0:i,a=t.terrainTexture;this.mapTexture!==r&&(this.mapTexture=r,null===(e=this.texture)||void 0===e||e.destroy(),this.updateTexture(r));var s={u_opacity:n||1,u_mapFlag:r?1:0,u_terrainClipHeight:a?o:-1,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(s)}},{key:"clearModels",value:function(){var e;this.terrainImage=null,null===(e=this.texture)||void 0===e||e.destroy(),this.textures=[]}},{key:"initModels",value:(r=u()(a()().mark((function e(){var t,n,r,i,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.layer.getLayerConfig(),n=t.mapTexture,r=t.terrainTexture,this.mapTexture=n,i=this.rendererService.createTexture2D,this.texture=i({height:0,width:0}),this.updateTexture(n),this.initUniformsBuffer(),!r){e.next=10;break}return e.next=9,this.loadTerrainImage(r);case 9:this.terrainImage=e.sent;case 10:return e.next=12,this.layer.buildLayerModel({moduleName:"geometryPlane",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec3 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_mapFlag;\n  float u_terrainClipHeight;\n};\n\nout vec3 v_Color;\nout vec2 v_uv;\nout float v_clip;\n\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\n  v_Color = a_Color;\n  v_uv = a_Uv;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  v_clip = 1.0;\n  if (a_Position.z < u_terrainClipHeight) {\n    v_clip = 0.0;\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'uniform sampler2D u_texture;\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_mapFlag;\n  float u_terrainClipHeight;\n};\n\nin vec3 v_Color;\nin vec2 v_uv;\nin float v_clip;\nout vec4 outputColor;\n\n#pragma include "picking"\nvoid main() {\n  if (u_mapFlag > 0.0) {\n    outputColor = texture(SAMPLER_2D(u_texture), vec2(v_uv.x, 1.0 - v_uv.y));\n    outputColor.a *= u_opacity;\n  } else {\n    outputColor = vec4(v_Color, u_opacity);\n  }\n  outputColor.a *= v_clip;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:this.planeGeometryTriangulation,defines:this.getDefines(),inject:this.getInject(),primitive:N.gl.TRIANGLES,depth:{enable:!0},cull:{enable:!0,face:N.gl.BACK}});case 12:return o=e.sent,e.abrupt("return",[o]);case 14:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"createModelData",value:function(e){if(e){var t=this.layer.getLayerConfig(),n=t.widthSegments,r=t.heightSegments,i=t.width,o=t.height,a=e,s=a.widthSegments,u=a.heightSegments,l=a.width,c=a.height;this.layer.style({widthSegments:void 0!==s?s:n,heightSegments:void 0!==u?u:r,width:void 0!==l?l:i,height:void 0!==c?c:o})}var f=this.layer.getEncodedData();return this.styleAttributeService.createAttributesAndIndices(f,this.planeGeometryTriangulation)}},{key:"updateTexture",value:function(e){var t=this,n=this.rendererService.createTexture2D;if(e){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height,wrapS:N.gl.CLAMP_TO_EDGE,wrapT:N.gl.CLAMP_TO_EDGE}),t.layerService.reRender()},r.src=e}else this.texture=n({width:0,height:0})}},{key:"getImageData",value:function(e){var t=document.createElement("canvas"),n=t.getContext("2d"),r=e.width,i=e.height;return t.width=r,t.height=i,n.drawImage(e,0,0,r,i),n.getImageData(0,0,r,i)}},{key:"translateVertex",value:function(e,t,n,r,i,o){for(var a=n.width,s=n.height,u=this.getImageData(n).data,l=Math.floor(r),c=Math.floor(i),f=l+1,h=c+1,p=a/l,d=s/c,v=0;v<h;v++)for(var g=Math.floor(v*d)*a,m=0;m<f;m++){var y=4*(g+Math.floor(m*p)),_=u[y],b=u[y+1],x=u[y+2];e[5*(v*f+m)+2]=o(_,b,x)}return{vertices:e,indices:t,size:5}}},{key:"loadTerrainImage",value:(t=u()(a()().mark((function e(t){var n,r=this;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.terrainImage){e.next=8;break}if(!this.terrainImageLoaded){e.next=5;break}return e.abrupt("return",this.terrainImage);case 5:return e.abrupt("return",new Promise((function(e){r.terrainImage.onload=function(){e(r.terrainImage)}})));case 6:e.next=11;break;case 8:return(n=new Image).crossOrigin="anonymous",e.abrupt("return",new Promise((function(e){n.onload=function(){r.terrainImageLoaded=!0,e(n),setTimeout((function(){return r.layer.emit("terrainImageLoaded",null)}))},n.src=t})));case 11:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:N.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),s}(w.Z),V=function(e){return e.UP="up",e.DOWN="down",e}(V||{}),j=function(e){b()(o,e);var t,n,r=E()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),A()(d()(e),"texture",void 0),A()(d()(e),"mapTexture",void 0),A()(d()(e),"positions",void 0),A()(d()(e),"indices",void 0),A()(d()(e),"timer",void 0),A()(d()(e),"spriteTop",void 0),A()(d()(e),"spriteUpdate",void 0),A()(d()(e),"spriteAnimate",void 0),A()(d()(e),"planeGeometryUpdateTriangulation",(function(){for(var t=e.layer.getLayerConfig().spriteBottom,n=void 0===t?-10:t,r=e.spriteUpdate,i=n,o=e.spriteTop,a=0;a<e.positions.length;a+=5)e.spriteAnimate===V.UP?(e.positions[a+2]+=r,e.positions[a+2]>o&&(e.positions[a+2]=i)):(e.positions[a+2]-=r,e.positions[a+2]<i&&(e.positions[a+2]=o));return{vertices:e.positions,indices:e.indices,size:5}})),A()(d()(e),"updatePosition",(function(){var t;e.planeGeometryUpdateTriangulation();var n=null===(t=e.styleAttributeService.getLayerStyleAttribute("position"))||void 0===t?void 0:t.vertexAttribute;if(n){for(var r=[],i=0;i<e.positions.length;i+=5)r.push(e.positions[i],e.positions[i+1],e.positions[i+2]);n.updateBuffer({data:r,offset:0})}e.layerService.throttleRenderLayers(),e.timer=requestAnimationFrame(e.updatePosition)})),A()(d()(e),"planeGeometryTriangulation",(function(){var t,n=e.layer.getLayerConfig(),r=n.center,i=void 0===r?[120,30]:r,o=n.spriteCount,a=void 0===o?100:o,s=n.spriteRadius,u=void 0===s?10:s,l=(t=e).initSprite.apply(t,[u,a].concat(P()(i))),c=l.indices,f=l.positions;return e.positions=f,e.indices=c,{vertices:f,indices:c,size:5}})),e}return h()(o,[{key:"initSprite",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30,i=[],o=[],a=this.spriteAnimate===V.UP?-this.spriteTop:this.spriteTop,s=0;s<t;s++){var u=Math.random()*a;o.push.apply(o,P()(c(u)))}for(var l=0;l<t;l++)i.push(l);function c(t){var i=e*Math.random(),o=e*Math.random();return[-e/2+i+n,-(-e/2+o)+r,t,0,0]}return{indices:i,positions:o}}},{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),i()(i()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e,t=this.layer.getLayerConfig(),n=t.opacity,r=t.mapTexture,i=t.spriteScale,o=void 0===i?1:i;this.mapTexture!==r&&(this.mapTexture=r,null===(e=this.texture)||void 0===e||e.destroy(),this.textures=[],this.updateTexture(r));var a={u_opacity:n||1,u_mapFlag:r?1:0,u_Scale:o,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(a)}},{key:"clearModels",value:function(){var e;cancelAnimationFrame(this.timer),null===(e=this.texture)||void 0===e||e.destroy(),this.textures=[]}},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r,i,o,s,u,l,c,f,h=this;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.mapTexture,r=t.spriteTop,i=void 0===r?300:r,o=t.spriteUpdate,s=void 0===o?10:o,u=t.spriteAnimate,l=void 0===u?V.DOWN:u,this.initUniformsBuffer(),this.mapTexture=n,this.spriteTop=i,this.spriteUpdate=s,this.spriteAnimate="up"===l?V.UP:V.DOWN,c=this.rendererService.createTexture2D,this.texture=c({height:0,width:0}),this.updateTexture(n),setTimeout((function(){h.updatePosition()}),100),e.next=12,this.layer.buildLayerModel({moduleName:"geometrySprite",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec3 a_Color;\n\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_mapFlag;\n  float u_Scale;\n};\n\nout vec3 v_Color;\nout float v_d;\n\n#pragma include "projection"\nvoid main() {\n  v_Color = a_Color.xyz;\n  v_d = a_Position.z;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n  gl_PointSize = pow(u_Zoom - 1.0, 2.0) * u_Scale;\n}\n',fragmentShader:"\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_mapFlag;\n  float u_Scale;\n};\nuniform sampler2D u_texture;\n\nin vec3 v_Color;\nin float v_d;\nout vec4 outputColor;\n\nvoid main() {\n\n  if(v_d < 0.0) {\n    discard;\n  }\n\n  if(u_mapFlag > 0.0) {\n    outputColor = texture(SAMPLER_2D(u_texture), gl_PointCoord);\n    outputColor.a *= u_opacity;\n  } else {\n    outputColor = vec4(v_Color, u_opacity);\n  }\n}\n",triangulation:this.planeGeometryTriangulation,defines:this.getDefines(),inject:this.getInject(),primitive:N.gl.POINTS,depth:{enable:!1},blend:this.getBlend()});case 12:return f=e.sent,e.abrupt("return",[f]);case 14:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"updateTexture",value:function(e){var t=this,n=this.rendererService.createTexture2D;if(e){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){t.texture=n({data:r,width:r.width,height:r.height,wrapS:N.gl.CLAMP_TO_EDGE,wrapT:N.gl.CLAMP_TO_EDGE}),t.layerService.reRender()},r.src=e}else this.texture=n({width:1,height:1})}},{key:"registerBuiltinAttributes",value:function(){return""}}]),o}(w.Z),H={plane:G,sprite:j,billboard:z},W=function(e){b()(r,e);var t,n=E()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),A()(d()(e),"type","GeometryLayer"),A()(d()(e),"defaultSourceConfig",{data:[{x:0,y:0}],options:{parser:{type:"json",x:"x",y:"y"}}}),e}return h()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new H[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{plane:{},sprite:{},billboard:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==t||null===(e=t.scale)||void 0===e?void 0:e.field;return"plane"===n?"plane":"sprite"===n?"sprite":"billboard"===n?"billboard":"plane"}}]),r}(S.Z),X=n(1344),Z=function(e){b()(o,e);var t,n,r=E()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"attributeLocation",get:function(){return Object.assign(g()(y()(o.prototype),"attributeLocation",this),{MAX:g()(y()(o.prototype),"attributeLocation",this).MAX,POS:9})}},{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),i()(i()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.coverage,r=e.angle,i={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:n||.9,u_angle:r||0};return this.getUniformsBufferInfo(i)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location =  ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;\n\nlayout(std140) uniform commonUniforms {\n    vec2 u_radius;\n    float u_opacity;\n    float u_coverage;\n    float u_angle;\n};\n\nout vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nvoid main() {\n  v_color = a_Color;\n  v_color.a *= u_opacity;\n\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage;\n\n  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\n  vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n  gl_Position = project_common_position_to_clipspace(project_pos);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'in vec4 v_color;\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',defines:this.getDefines(),triangulation:D.Rs,primitive:N.gl.TRIANGLES,depth:{enable:!1}});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:N.AttributeType.Attribute,descriptor:{shaderLocation:this.attributeLocation.POS,name:"a_Pos",buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:3,update:function(e){var t=e.coordinates;return[t[0],t[1],0]}}})}}]),o}(w.Z),Y=function(e){b()(o,e);var t,n,r=E()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"attributeLocation",get:function(){return Object.assign(g()(y()(o.prototype),"attributeLocation",this),{MAX:g()(y()(o.prototype),"attributeLocation",this).MAX,SIZE:9,POS:10,NORMAL:11})}},{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),i()(i()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.coverage,r=e.angle,i={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:n||.9,u_angle:r||0};return this.getUniformsBufferInfo(i)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_radius;\n  float u_opacity;\n  float u_coverage;\n  float u_angle;\n};\n\nout vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset = vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage);\n\n  vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 实际的经纬度\n  vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n\n  float lightWeight = calc_lighting(project_pos);\n  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  gl_Position = project_common_position_to_clipspace(project_pos);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'in vec4 v_color;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_radius;\n  float u_opacity;\n  float u_coverage;\n  float u_angle;\n};\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',defines:this.getDefines(),triangulation:D.NM,primitive:N.gl.TRIANGLES,depth:{enable:!0}});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:N.AttributeType.Attribute,descriptor:{shaderLocation:this.attributeLocation.SIZE,name:"a_Size",buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:1,update:function(e){var t=e.size;return Array.isArray(t)?[t[0]]:[t]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:N.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:N.gl.STATIC_DRAW,data:[],type:N.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:N.AttributeType.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:3,update:function(e){var t=e.coordinates;return[t[0],t[1],0]}}})}}]),o}(w.Z),q=n(7703);var K=B.rU.isEqual,Q=function(e){b()(s,e);var t,n,r,o=E()(s);function s(){var e;c()(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=o.call.apply(o,[this].concat(n)),A()(d()(e),"texture",void 0),A()(d()(e),"colorTexture",void 0),A()(d()(e),"heatmapFramerBuffer",void 0),A()(d()(e),"heatmapTexture",void 0),A()(d()(e),"intensityModel",void 0),A()(d()(e),"colorModel",void 0),A()(d()(e),"shapeType",void 0),A()(d()(e),"preRampColors",void 0),A()(d()(e),"colorModelUniformBuffer",[]),A()(d()(e),"heat3DModelUniformBuffer",[]),e}return h()(s,[{key:"attributeLocation",get:function(){return Object.assign(g()(y()(s.prototype),"attributeLocation",this),{MAX:g()(y()(s.prototype),"attributeLocation",this).MAX,SIZE:9,UV:10,DIR:11})}},{key:"prerender",value:function(){var e=this,t=this.rendererService,n=t.clear;(0,t.useFramebuffer)(this.heatmapFramerBuffer,(function(){n({color:[0,0,0,0],depth:1,stencil:0,framebuffer:e.heatmapFramerBuffer}),e.drawIntensityMode()}))}},{key:"render",value:function(e){var t=this.layer.getLayerConfig().rampColors;K(this.preRampColors,t)||this.updateColorTexture(),"heatmap"===this.shapeType?this.drawHeatMap(e):this.draw3DHeatMap(e)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:(r=u()(a()().mark((function e(){var t,n,r,i,o,s,u,l,c,f;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.rendererService,r=n.createFramebuffer,i=n.getViewportSize,o=n.createTexture2D,s=this.styleAttributeService.getLayerStyleAttribute("shape"),u=(null==s||null===(t=s.scale)||void 0===t?void 0:t.field)||"heatmap",this.shapeType=u,e.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=e.sent,this.colorModel="heatmap"===u?this.buildHeatmap():this.build3dHeatMap(),l=i(),c=l.width,f=l.height,this.heatmapTexture=o({width:Math.floor(c/4),height:Math.floor(f/4),wrapS:N.gl.CLAMP_TO_EDGE,wrapT:N.gl.CLAMP_TO_EDGE,min:N.gl.LINEAR,mag:N.gl.LINEAR,usage:N.TextureUsage.RENDER_TARGET}),this.heatmapFramerBuffer=r({color:this.heatmapTexture,depth:!0,width:Math.floor(c/4),height:Math.floor(f/4)}),this.updateColorTexture(),e.abrupt("return",[this.intensityModel,this.colorModel]);case 13:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:N.AttributeType.Attribute,descriptor:{name:"a_Dir",shaderLocation:this.attributeLocation.DIR,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:N.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:1,update:function(e){var t=e.size;return[void 0===t?1:t]}}})}},{key:"buildHeatMapIntensity",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.uniformBuffers=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})],this.layer.triangulation=D.zO,e.next=4,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_DIR) in vec2 a_Dir;\n\nlayout(std140) uniform commonUniforms {\n  float u_radius;\n  float u_intensity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n};\n\nout vec2 v_extrude;\nout float v_weight;\n\n#define GAUSS_COEF (0.3989422804014327)\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec3 picking_color_placeholder = u_PickingColor;\n\n  v_weight = a_Size;\n  float ZERO = 1.0 / 255.0 / 16.0;\n  float extrude_x = a_Dir.x * 2.0 - 1.0;\n  float extrude_y = a_Dir.y * 2.0 - 1.0;\n  vec2 extrude_dir = normalize(vec2(extrude_x, extrude_y));\n  float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;\n  v_extrude = extrude_dir * S;\n\n  vec2 offset = project_pixel(v_extrude * u_radius);\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n}\n',fragmentShader:"layout(std140) uniform commonUniforms {\n  float u_radius;\n  float u_intensity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n};\n\nin vec2 v_extrude;\nin float v_weight;\nout vec4 outputColor;\n#define GAUSS_COEF  0.3989422804014327\n\nvoid main(){\n    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\n    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);\n    outputColor = vec4(val, 1., 1., 1.);\n}\n",triangulation:D.zO,defines:this.getDefines(),depth:{enable:!1},cull:{enable:!0,face:N.gl.FRONT}});case 4:return t=e.sent,e.abrupt("return",t);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"buildHeatmap",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:'layout(location = 0) in vec3 a_Position;\nlayout(location = 10) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n  float u_common_uniforms_padding3;\n};\n\n#pragma include "scene_uniforms"\n\nout vec2 v_texCoord;\nvoid main() {\n  v_texCoord = a_Uv;\n  #ifdef VIEWPORT_ORIGIN_TL\n  v_texCoord.y = 1.0 - v_texCoord.y;\n  #endif\n\n  gl_Position = vec4(a_Position.xy, 0, 1.0);\n}\n',fs:'uniform sampler2D u_texture;        // 热力强度图\nuniform sampler2D u_colorTexture;   // 根据强度分布的色带\n\nlayout(std140) uniform commonUniforms {\n  float u_opacity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n  float u_common_uniforms_padding3;\n};\nin vec2 v_texCoord;\nout vec4 outputColor;\n\n#pragma include "scene_uniforms"\n\nfloat getBlurIndusty() {\n    float vW = 2.0/ u_ViewportSize.x;\n    float vH = 2.0/ u_ViewportSize.y;\n    vec2 vUv = v_texCoord;\n    float i11 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i12 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i13 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n\n    float i21 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y) ).r;\n    float i22 = texture(SAMPLER_2D(u_texture), vec2( vUv.x , vUv.y) ).r;\n    float i23 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y) ).r;\n\n    float i31 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;\n    float i32 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;\n    float i33 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;\n\n    return(\n        i11 + \n        i12 + \n        i13 + \n        i21 + \n        i21 + \n        i22 + \n        i23 + \n        i31 + \n        i32 + \n        i33\n        )/9.0;\n}\n\n\nvoid main(){\n    // float intensity = texture(u_texture, v_texCoord).r;\n    float intensity = getBlurIndusty();\n    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(intensity, 0.0));\n    outputColor = color;\n    outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}\n'}),this.colorModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})];var e=this.shaderModuleService.getModule("heatmapColor"),t=e.vs,n=e.fs,r=e.uniforms,o=this.rendererService,a=o.createAttribute,s=o.createElements,u=o.createBuffer;return(0,o.createModel)({vs:t,fs:n,uniformBuffers:[].concat(P()(this.colorModelUniformBuffer),P()(this.rendererService.uniformBuffers)),attributes:{a_Position:a({shaderLocation:this.attributeLocation.POSITION,buffer:u({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:N.gl.FLOAT}),size:3}),a_Uv:a({shaderLocation:this.attributeLocation.UV,buffer:u({data:[0,1,1,1,0,0,1,0],type:N.gl.FLOAT}),size:2})},uniforms:i()({},r),depth:{enable:!1},elements:s({data:[0,2,1,2,3,1],type:N.gl.UNSIGNED_INT,count:6})})}},{key:"build3dHeatMap",value:function(){var e=(0,this.rendererService.getViewportSize)(),t=function(e,t){for(var n=[],r=[],i=[],o=e+1,a=t+1,s=e/2,u=t/2,l=0;l<a;l++)for(var c=l-u,f=0;f<o;f++){var h=f-s;r.push(h/s,-c/u,0),i.push(f/e),i.push(1-l/t)}for(var p=0;p<t;p++)for(var d=0;d<e;d++){var v=d+o*p,g=d+o*(p+1),m=d+1+o*(p+1),y=d+1+o*p;n.push(v,g,y),n.push(g,m,y)}return{vertices:r,indices:n,uvs:i}}(e.width/4,e.height/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:'layout(location = 0) in vec3 a_Position;\nlayout(location = 10) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  mat4 u_ViewProjectionMatrixUncentered;\n  mat4 u_InverseViewProjectionMatrix;\n  float u_opacity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n  float u_common_uniforms_padding3;\n};\n\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nout vec2 v_texCoord;\nout float v_intensity;\n\nvec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\n  float t2 = t * t;\n  float one_minus_t = 1.0 - t;\n  float one_minus_t2 = one_minus_t * one_minus_t;\n  return P0 * one_minus_t2 * one_minus_t +\n  P1 * 3.0 * t * one_minus_t2 +\n  P2 * 3.0 * t2 * one_minus_t +\n  P3 * t2 * t;\n}\nvec2 toBezier(float t, vec4 p) {\n  return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n}\n\n#pragma include "projection"\n#pragma include "project"\n\nvoid main() {\n  v_texCoord = a_Uv;\n\n  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // 将原本 0 -> 1 的 uv 转换为 -1 -> 1 的标准坐标空间（NDC）\n\n  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y 平面上的点（z == 0）可以认为是三维上的点被投影到平面后的点\n  vec4 p2 = vec4(pos, 1.0, 1.0); // 平行于x/y平面、z==1 的平面上的点\n\n  vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // 根据视图投影矩阵的逆矩阵平面上的反算出三维空间中的点（p1平面上的点）\n  vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;\n\n  inverseP1 = inverseP1 / inverseP1.w; // 归一化操作（归一化后为世界坐标）\n  inverseP2 = inverseP2 / inverseP2.w;\n\n  float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??\n  vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);\n\n  vec4 b = vec4(0.5, 0.0, 1.0, 0.5);\n  float fh;\n\n  v_intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;\n  fh = toBezier(v_intensity, b).y;\n  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.0), 1.0);\n\n}\n',fs:"layout(std140) uniform commonUniforms {\n  mat4 u_ViewProjectionMatrixUncentered;\n  mat4 u_InverseViewProjectionMatrix;\n  float u_opacity;\n  float u_common_uniforms_padding1;\n  float u_common_uniforms_padding2;\n  float u_common_uniforms_padding3;\n};\n\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nin vec2 v_texCoord;\nin float v_intensity;\nout vec4 outputColor;\n\nvoid main(){\n   \n    float intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;\n    vec4 color = texture(SAMPLER_2D(u_colorTexture),vec2(intensity, 0));\n    outputColor = color;\n    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;\n   outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}\n"}),this.heat3DModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(36).fill(0),isUBO:!0})];var n=this.shaderModuleService.getModule("heatmap3dColor"),r=n.vs,o=n.fs,a=n.uniforms,s=this.rendererService,u=s.createAttribute,l=s.createElements,c=s.createBuffer;return(0,s.createModel)({vs:r,fs:o,attributes:{a_Position:u({shaderLocation:this.attributeLocation.POSITION,buffer:c({data:t.vertices,type:N.gl.FLOAT}),size:3}),a_Uv:u({shaderLocation:this.attributeLocation.UV,buffer:c({data:t.uvs,type:N.gl.FLOAT}),size:2})},primitive:N.gl.TRIANGLES,uniformBuffers:[].concat(P()(this.heat3DModelUniformBuffer),P()(this.rendererService.uniformBuffers)),uniforms:i()({},a),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:N.gl.SRC_ALPHA,srcAlpha:1,dstRGB:N.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:l({data:t.indices,type:N.gl.UNSIGNED_INT,count:t.indices.length})})}},{key:"drawIntensityMode",value:function(){var e,t=this.layer.getLayerConfig(),n=t.intensity,r=void 0===n?10:n,i=t.radius,o=void 0===i?5:i,a={u_radius:o,u_intensity:r};this.uniformBuffers[0].subData({offset:0,data:[o,r]}),this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),null===(e=this.intensityModel)||void 0===e||e.draw({uniforms:a,blend:{enable:!0,func:{srcRGB:N.gl.ONE,srcAlpha:1,dstRGB:N.gl.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawHeatMap",value:function(e){var t,n=this.layer.getLayerConfig().opacity,r=void 0===n?1:n,i={u_opacity:r,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},o=[this.heatmapTexture,this.colorTexture];this.colorModelUniformBuffer[0].subData({offset:0,data:[r]}),null===(t=this.colorModel)||void 0===t||t.draw({uniforms:i,textures:o,blend:this.getBlend(),stencil:this.getStencil(e)})}},{key:"draw3DHeatMap",value:function(e){var t,n=this.layer.getLayerConfig().opacity,r=void 0===n?1:n,i=q.create();q.invert(i,this.cameraService.getViewProjectionMatrixUncentered());var o={u_opacity:r,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:P()(i)};this.heat3DModelUniformBuffer[0].subData({offset:0,data:[].concat(P()(o.u_ViewProjectionMatrixUncentered),P()(o.u_InverseViewProjectionMatrix),[r])});var a=[this.heatmapTexture,this.colorTexture];null===(t=this.colorModel)||void 0===t||t.draw({uniforms:o,textures:a,blend:{enable:!0,func:{srcRGB:N.gl.SRC_ALPHA,srcAlpha:1,dstRGB:N.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(e)})}},{key:"updateColorTexture",value:function(){var e=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var t=this.layer.getLayerConfig().rampColors,n=(0,B.Cl)(t);this.colorTexture=e({data:n.data,usage:N.TextureUsage.SAMPLED,width:n.width,height:n.height,wrapS:N.gl.CLAMP_TO_EDGE,wrapT:N.gl.CLAMP_TO_EDGE,min:N.gl.NEAREST,mag:N.gl.NEAREST,flipY:!1,unorm:!0}),this.preRampColors=t}}]),s}(w.Z),$=function(e){b()(o,e);var t,n,r=E()(o);function o(){return c()(this,o),r.apply(this,arguments)}return h()(o,[{key:"attributeLocation",get:function(){return Object.assign(g()(y()(o.prototype),"attributeLocation",this),{MAX:g()(y()(o.prototype),"attributeLocation",this).MAX,POS:9})}},{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),i()(i()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.coverage,r=e.angle,i={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:t||1,u_coverage:n||.9,u_angle:r||0};return this.getUniformsBufferInfo(i)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_radius;\n  float u_opacity;\n  float u_coverage;\n  float u_angle;\n};\n\nout vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nvoid main() {\n  v_color = a_Color;\n  v_color.a *= u_opacity;\n\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset = vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage);\n  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\n\n  vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'in vec4 v_color;\n\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',defines:this.getDefines(),triangulation:D.Rs,depth:{enable:!1},primitive:N.gl.TRIANGLES});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:N.AttributeType.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:3,update:function(e){var t=e.coordinates;return[t[0],t[1],0]}}})}}]),o}(w.Z),J={heatmap:Q,heatmap3d:Q,grid:Z,grid3d:Y,hexagon:$},ee=function(e){b()(r,e);var t,n=E()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),A()(d()(e),"type","HeatMapLayer"),e}return h()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new J[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"prerender",value:function(){"heatmap"===this.getModelType()&&this.layerModel&&this.layerModel.prerender()}},{key:"renderModels",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.getModelType();return"heatmap"===n?(this.layerModel&&this.layerModel.render(t),this):(this.encodeDataLength<=0&&!this.forceRender||(this.hooks.beforeRender.call(),this.models.forEach((function(n){return n.draw({uniforms:e.layerModel.getUninforms(),blend:e.layerModel.getBlend(),stencil:e.layerModel.getStencil(t)})})),this.hooks.afterRender.call()),this)}},{key:"updateModelData",value:function(e){e.attributes&&e.elements?this.models[0].updateAttributesAndElements(e.attributes,e.elements):console.warn("data error")}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=this.getLayerConfig().shape3d,r=this.getSource().data.type,i=(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"heatmap";return"heatmap"===i||"heatmap3d"===i?"heatmap":"hexagon"===r?-1===(null==n?void 0:n.indexOf(i))?"hexagon":"grid3d":"grid"===r?-1===(null==n?void 0:n.indexOf(i))?"grid":"grid3d":"heatmap"}},{key:"getLegend",value:function(e){if("heatmap"===this.getModelType()){if("color"!==e)return{type:void 0,field:void 0,items:[]};var t=this.getLayerConfig().rampColors;return(0,X.I)(t,e)}return g()(y()(r.prototype),"getLegend",this).call(this,e)}}]),r}(S.Z),te=n(3281),ne=n(7492),re=n(428),ie=n(6106),oe=n(7303),ae=n(1767),se=function(e){b()(r,e);var t,n=E()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),A()(d()(e),"type","TileDebugLayer"),A()(d()(e),"zIndex",1e4),A()(d()(e),"defaultSourceConfig",{data:[],options:{parser:{type:"testTile"}}}),e}return h()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return");case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),r}(S.Z),ue=B.rU.isNumber,le=function(e){b()(i,e);var t,n,r=E()(i);function i(){return c()(this,i),r.apply(this,arguments)}return h()(i,[{key:"attributeLocation",get:function(){return Object.assign(g()(y()(i.prototype),"attributeLocation",this),{MAX:g()(y()(i.prototype),"attributeLocation",this).MAX,NORMAL:9,UV:10})}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?1:e,n={u_opacity:ue(t)?t:1};return this.getUniformsBufferInfo(n)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.zIndex=-997,e.next=3,this.layer.buildLayerModel({moduleName:"earthAtmoSphere",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n float u_opacity;\n};\n\n#pragma include "scene_uniforms"\nout vec3 vVertexNormal;\nout vec4 v_Color;\nout float v_offset;\n\nvoid main() {\n    float EARTH_RADIUS = 100.0;\n\n    v_Color = a_Color;\n\n    v_offset = min(((length(u_CameraPosition) - EARTH_RADIUS)/600.0) * 0.5 + 0.4, 1.0);\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n',fragmentShader:'\nlayout(std140) uniform commonUniforms {\n float u_opacity;\n};\nin vec3 vVertexNormal;\nin float v_offset;\nin vec4 v_Color;\n\n#pragma include "scene_uniforms"\nout vec4 outputColor;\nvoid main() {\n    \n    \n    // float intensity = pow(0.5 + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    float intensity = pow(v_offset + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    // 去除背面\n    if(intensity > 1.0) intensity = 0.0;\n\n    outputColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n',defines:this.getDefines(),triangulation:D.NW,depth:{enable:!1},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:N.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:N.gl.STATIC_DRAW,data:[],type:N.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:N.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),i}(w.Z),ce=function(e){b()(i,e);var t,n,r=E()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),A()(d()(e),"texture",void 0),A()(d()(e),"earthTime",3.4),A()(d()(e),"sunX",1e3),A()(d()(e),"sunY",1e3),A()(d()(e),"sunZ",1e3),A()(d()(e),"sunRadius",Math.sqrt(e.sunX*e.sunX+e.sunY*e.sunY+e.sunZ*e.sunZ)),e}return h()(i,[{key:"attributeLocation",get:function(){return Object.assign(g()(y()(i.prototype),"attributeLocation",this),{MAX:g()(y()(i.prototype),"attributeLocation",this).MAX,NORMAL:9,UV:10})}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=e.globalOptions;null!=t&&t.enable&&(this.mapService.rotateY({reg:.002}),this.earthTime+=.02,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY));var r={u_sunLight:[this.sunX,this.sunY,this.sunZ,0],u_ambientRatio:(null==n?void 0:n.ambientRatio)||.6,u_diffuseRatio:(null==n?void 0:n.diffuseRatio)||.4,u_specularRatio:(null==n?void 0:n.specularRatio)||.1};return this.textures=[this.texture],this.getUniformsBufferInfo(r)}},{key:"setEarthTime",value:function(e){this.earthTime=e,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY),this.layerService.throttleRenderLayers()}},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r,i,o=this;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),void 0!==(null==(n=t.globalOptions)?void 0:n.earthTime)&&this.setEarthTime(n.earthTime),r=this.layer.getSource(),i=this.rendererService.createTexture2D,this.texture=i({height:0,width:0}),r.data.images.then((function(e){o.texture=i({data:e[0],width:e[0].width,height:e[0].height}),o.textures=[o.texture],o.layerService.reRender()})),this.initUniformsBuffer(),e.abrupt("return",this.buildModels());case 8:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.zIndex=-998,e.next=3,this.layer.buildLayerModel({moduleName:"earthBase",vertexShader:'// attribute vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\n// attribute vec2 a_Extrude;\n// attribute float a_Size;\n// attribute float a_Shape;\n\nlayout(std140) uniform commonUniforms {\n\tvec4 u_sunLight: [1.0, -10.5, 12.0,0.0];\n\tfloat u_ambientRatio : 0.5;\n\tfloat u_diffuseRatio : 0.3;\n\tfloat u_specularRatio : 0.2;\n};\n\n#pragma include "scene_uniforms"\n\nout vec2 v_texCoord;\nout float v_lightWeight;\n\nfloat calc_lighting(vec4 pos) {\n\n\tvec3 worldPos = vec3(pos * u_ModelMatrix);\n\n\tvec3 worldNormal = a_Normal;\n\n\t// cal light weight\n\tvec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n\tvec3 lightDir = normalize(u_sunLight.xyz);\n\n\tvec3 halfDir = normalize(viewDir+lightDir);\n\t// lambert\n\tfloat lambert = dot(worldNormal, lightDir);\n\t// specular\n\tfloat specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n\t//sum to light weight\n\tfloat lightWeight = u_ambientRatio + u_diffuseRatio * lambert + u_specularRatio * specular;\n\n\treturn lightWeight;\n}\n\nvoid main() {\n\n\tv_texCoord = a_Uv;\n\n\tfloat lightWeight = calc_lighting(vec4(a_Position, 1.0));\n\tv_lightWeight = lightWeight;\n\n\tgl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n',fragmentShader:"uniform sampler2D u_texture;\n\nin vec2 v_texCoord;\nin float v_lightWeight;\nout vec4 outputColor;\n\nvoid main() {\n    vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));\n    color.xyz = color.xyz * v_lightWeight;\n    outputColor = color;\n}\n",defines:this.getDefines(),triangulation:D.NW,depth:{enable:!0},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:N.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:N.gl.STATIC_DRAW,data:[],type:N.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:N.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),i}(w.Z),fe=B.rU.isNumber,he=function(e){b()(i,e);var t,n,r=E()(i);function i(){return c()(this,i),r.apply(this,arguments)}return h()(i,[{key:"attributeLocation",get:function(){return Object.assign(g()(y()(i.prototype),"attributeLocation",this),{MAX:g()(y()(i.prototype),"attributeLocation",this).MAX,NORMAL:9,UV:10})}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig().opacity,t=void 0===e?1:e,n={u_opacity:fe(t)?t:1};return this.getUniformsBufferInfo(n)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.zIndex=-999,e.next=3,this.layer.buildLayerModel({moduleName:"earthBloom",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n float u_opacity;\n};\n#pragma include "scene_uniforms"\n\nout vec3 vVertexNormal;\nout vec4 v_Color;\n\nvoid main() {\n    v_Color = a_Color;\n\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n',fragmentShader:'\nin vec3 vVertexNormal;\nin vec4 v_Color;\n\nlayout(std140) uniform commonUniforms {\n float u_opacity;\n};\nout vec4 outputColor;\n#pragma include "scene_uniforms"\nvoid main() {\n    float intensity =  - dot(normalize(vVertexNormal), normalize(u_CameraPosition));\n    // 去除背面\n    if(intensity > 1.0) intensity = 0.0;\n\n    outputColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n',defines:this.getDefines(),triangulation:D.qZ,depth:{enable:!1},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:N.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:N.gl.STATIC_DRAW,data:[],type:N.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:N.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),i}(w.Z),pe={base:ce,atomSphere:le,bloomSphere:he},de=["base","atomSphere","bloomSphere"],ve=function(e){b()(r,e);var t,n=E()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),A()(d()(e),"type","EarthLayer"),A()(d()(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),e}return h()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new pe[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setEarthTime",value:function(e){this.layerModel&&this.layerModel.setEarthTime?this.layerModel.setEarthTime(e):console.warn("请在 scene loaded 之后执行该方法！")}},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"base";return de.indexOf(n)<0&&(n="base"),n}}]),r}(S.Z),ge=n(7431);function me(e,t,n){var r=ye(e,e.VERTEX_SHADER,t),i=ye(e,e.FRAGMENT_SHADER,n);if(!r||!i)return null;var o=e.createProgram();if(!o)return null;if(e.attachShader(o,r),e.attachShader(o,i),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS)){var a=e.getProgramInfoLog(o);return console.warn("Failed to link program: "+a),e.deleteProgram(o),e.deleteShader(i),e.deleteShader(r),null}for(var s=e.getProgramParameter(o,e.ACTIVE_ATTRIBUTES),u=0;u<s;u++){var l=e.getActiveAttrib(o,u);o[l.name]=e.getAttribLocation(o,l.name)}for(var c=e.getProgramParameter(o,e.ACTIVE_UNIFORMS),f=0;f<c;f++){var h=e.getActiveUniform(o,f);o[h.name]=e.getUniformLocation(o,h.name)}return o.vertexShader=r,o.fragmentShader=i,o}function ye(e,t,n){var r=e.createShader(t);if(null==r)return console.warn("unable to create shader"),null;if(e.shaderSource(r,n),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS)){var i=e.getShaderInfoLog(r);return console.warn("Failed to compile shader: "+i),e.deleteShader(r),null}return r}function _e(e,t,n,r,i){var o=e.createTexture();return e.bindTexture(e.TEXTURE_2D,o),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,t),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,r,i,0,e.RGBA,e.UNSIGNED_BYTE,n),e.bindTexture(e.TEXTURE_2D,null),o}function be(e,t,n){e.activeTexture(e.TEXTURE0+n),e.bindTexture(e.TEXTURE_2D,t)}function xe(e,t){var n=e.createBuffer();return e.bindBuffer(e.ARRAY_BUFFER,n),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),n}function Ee(e){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r=n.createLinearGradient(0,0,256,0),i=0,o=Object.keys(e);i<o.length;i++){var a=o[i];r.addColorStop(+a,e[+a])}return n.fillStyle=r,n.fillRect(0,0,256,1),t=null,new Uint8Array(n.getImageData(0,0,256,1).data)}function Te(e,t,n,r){e.bindBuffer(e.ARRAY_BUFFER,t),e.enableVertexAttribArray(n),e.vertexAttribPointer(n,r,e.FLOAT,!1,0,0)}function Ae(e,t,n){e.bindFramebuffer(e.FRAMEBUFFER,t),n&&e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0)}var Se=function(){function e(t){c()(this,e),A()(this,"width",512),A()(this,"height",512),A()(this,"pixels",void 0),A()(this,"fadeOpacity",void 0),A()(this,"speedFactor",void 0),A()(this,"dropRate",void 0),A()(this,"dropRateBump",void 0),A()(this,"gl",void 0),A()(this,"drawProgram",void 0),A()(this,"fullScreenProgram",void 0),A()(this,"updateProgram",void 0),A()(this,"rampColors",void 0),A()(this,"numParticles",65536),A()(this,"numParticlesSize",void 0),A()(this,"particleStateResolution",void 0),A()(this,"quadBuffer",void 0),A()(this,"particleIndexBuffer",void 0),A()(this,"framebuffer",void 0),A()(this,"colorRampTexture",void 0),A()(this,"backgroundTexture",void 0),A()(this,"screenTexture",void 0),A()(this,"particleStateTexture0",void 0),A()(this,"particleStateTexture1",void 0),A()(this,"windTexture",void 0),A()(this,"windData",void 0),this.gl=t.glContext,this.width=t.imageWidth,this.height=t.imageHeight,this.fadeOpacity=t.fadeOpacity,this.speedFactor=t.speedFactor,this.dropRate=t.dropRate,this.dropRateBump=t.dropRateBump,this.rampColors=t.rampColors,this.init()}return h()(e,[{key:"init",value:function(){var e=this.gl;this.fadeOpacity=.996,this.speedFactor=.25,this.dropRate=.003,this.dropRateBump=.01,this.drawProgram=me(e,"\n precision mediump float;\n\n attribute float a_index;\n\n uniform sampler2D u_particles;\n uniform float u_particles_res;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec4 color = texture2D(u_particles, vec2(\n         fract(a_index / u_particles_res),\n         floor(a_index / u_particles_res) / u_particles_res)\n     );\n\n     // decode current particle position from the pixel's RGBA value\n     v_particle_pos = vec2( color.r / 255.0 + color.b, color.g / 255.0 + color.a);\n\n     gl_PointSize = 1.0;\n     gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, 1.0 - 2.0 * v_particle_pos.y, 0, 1);\n }","\n precision mediump float;\n\n uniform sampler2D u_wind;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform sampler2D u_color_ramp;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec2 velocity = mix(u_wind_min, u_wind_max, texture2D(u_wind, v_particle_pos).rg);\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // color ramp is encoded in a 16x16 texture\n     vec2 ramp_pos = vec2( fract(16.0 * speed_t), floor(16.0 * speed_t) / 16.0);\n\n     gl_FragColor = texture2D(u_color_ramp, ramp_pos);\n }"),this.fullScreenProgram=me(e,"\n     precision mediump float;\n\n     attribute vec2 a_pos;\n\n     varying vec2 v_tex_pos;\n\n     void main() {\n         v_tex_pos = a_pos;\n         gl_Position = vec4(1.0 - 2.0 * a_pos, 0.0, 1.0);\n         gl_PointSize = 100.0;\n }","\n precision mediump float;\n\n uniform sampler2D u_screen;\n uniform float u_opacity;\n varying vec2 v_tex_pos;\n\n void main() {\n     vec4 color = texture2D(u_screen, 1.0 - v_tex_pos);\n\n     // a hack to guarantee opacity fade out even with a value close to 1.0\n     gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n }"),this.updateProgram=me(e,"\n precision mediump float;\n\n attribute vec2 a_pos;\n\n varying vec2 v_tex_pos;\n\n void main() {\n     v_tex_pos = a_pos;\n     gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n     // framebuffer 始终用铺满屏幕的 texture\n }","\n precision highp float;\n\n uniform sampler2D u_particles;\n uniform sampler2D u_wind;\n uniform vec2 u_wind_res;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform float u_rand_seed;\n uniform float u_speed_factor;\n uniform float u_drop_rate;\n uniform float u_drop_rate_bump;\n\n varying vec2 v_tex_pos;\n\n // pseudo-random generator\n const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\n float rand(const vec2 co) {\n float t = dot(rand_constants.xy, co);\n     return fract(sin(t) * (rand_constants.z + t));\n }\n\n // wind speed lookup; use manual bilinear filtering based on 4 adjacent pixels for smooth interpolation\n vec2 lookup_wind(const vec2 uv) {\n     // return texture2D(u_wind, uv).rg; // lower-res hardware filtering\n     vec2 px = 1.0 / u_wind_res;\n     vec2 vc = (floor(uv * u_wind_res)) * px;\n     vec2 f = fract(uv * u_wind_res);\n     vec2 tl = texture2D(u_wind, vc).rg;\n     vec2 tr = texture2D(u_wind, vc + vec2(px.x, 0)).rg;\n     vec2 bl = texture2D(u_wind, vc + vec2(0, px.y)).rg;\n     vec2 br = texture2D(u_wind, vc + px).rg;\n     return mix(mix(tl, tr, f.x), mix(bl, br, f.x), f.y);\n }\n\n void main() {\n     vec4 color = texture2D(u_particles, v_tex_pos);\n     vec2 pos = vec2(\n         color.r / 255.0 + color.b,\n         color.g / 255.0 + color.a); // decode particle position from pixel RGBA\n     vec2 velocity = mix(u_wind_min, u_wind_max, lookup_wind(pos));\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // take EPSG:4236 distortion into account for calculating where the particle moved\n     float distortion = cos(radians(pos.y * 180.0 - 90.0));\n     vec2 offset = vec2(velocity.x / distortion, -velocity.y) * 0.0001 * u_speed_factor;\n\n     // update particle position, wrapping around the date line\n     pos = fract(1.0 + pos + offset);\n\n     // a random seed to use for the particle drop\n     vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n\n     // drop rate is a chance a particle will restart at random position, to avoid degeneration\n     float drop_rate = u_drop_rate + speed_t * u_drop_rate_bump;\n     float drop = step(1.0 - drop_rate, rand(seed));\n\n     vec2 random_pos = vec2(\n         rand(seed + 1.3),\n         rand(seed + 2.1));\n         pos = mix(pos, random_pos, drop);\n\n     // encode the new particle position back into RGBA\n     gl_FragColor = vec4(\n         fract(pos * 255.0),\n         floor(pos * 255.0) / 255.0);\n }"),this.quadBuffer=xe(e,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),this.framebuffer=e.createFramebuffer(),this.colorRampTexture=_e(this.gl,this.gl.LINEAR,Ee(this.rampColors),16,16);var t=new Uint8Array(this.width*this.height*4);this.backgroundTexture=_e(e,e.NEAREST,t,this.width,this.height),this.screenTexture=_e(e,e.NEAREST,t,this.width,this.height);var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=_e(e,e.NEAREST,r,n,n),this.particleStateTexture1=_e(e,e.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=xe(e,o)}},{key:"setWind",value:function(e){var t,n,r,i;this.windData=e,this.windTexture=(t=this.gl,n=this.gl.LINEAR,r=e.image,i=t.createTexture(),t.bindTexture(t.TEXTURE_2D,i),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.bindTexture(t.TEXTURE_2D,null),i)}},{key:"updateParticelNum",value:function(e){var t=this.gl;if(e!==this.numParticles){this.numParticles=e;var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=_e(t,t.NEAREST,r,n,n),this.particleStateTexture1=_e(t,t.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=xe(t,o)}}},{key:"updateWindDir",value:function(e,t,n,r){this.windData.uMin=e,this.windData.uMax=t,this.windData.vMin=n,this.windData.vMax=r}},{key:"updateColorRampTexture",value:function(e){if(this.isColorChanged(e)){this.rampColors=e;var t=this.gl;t.deleteTexture(this.colorRampTexture),this.colorRampTexture=_e(t,t.LINEAR,Ee(e),16,16)}}},{key:"isColorChanged",value:function(e){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],i=Number(r);if(!this.rampColors[i])return!0;if(this.rampColors[i]&&this.rampColors[i]!==e[i])return!0}return!1}},{key:"reSize",value:function(e,t){if(e!==this.width||t!==this.height){var n=this.gl;n.deleteTexture(this.backgroundTexture),n.deleteTexture(this.screenTexture),this.width=e,this.height=t;var r=new Uint8Array(e*t*4);this.backgroundTexture=_e(n,n.NEAREST,r,e,t),this.screenTexture=_e(n,n.NEAREST,r,e,t)}}},{key:"draw",value:function(){var e;if(null!==(e=this.windData)&&void 0!==e&&e.image){var t=this.gl;return be(t,this.windTexture,0),be(t,this.particleStateTexture0,1),this.drawScreen(),this.updateParticles(),{d:this.pixels,w:this.width,h:this.height}}return{d:new Uint8Array([0,0,0,0]),w:1,h:1}}},{key:"drawScreen",value:function(){var e=this.gl;Ae(e,this.framebuffer,this.screenTexture),e.viewport(0,0,this.width,this.height),e.disable(e.BLEND),this.drawFullTexture(this.backgroundTexture,this.fadeOpacity),this.drawParticles(),this.pixels=new Uint8Array(4*this.width*this.height),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,this.pixels),Ae(e,null,null),e.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);var t=this.backgroundTexture;this.backgroundTexture=this.screenTexture,this.screenTexture=t}},{key:"drawFullTexture",value:function(e,t){var n=this.gl,r=this.fullScreenProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.quadBuffer),n.vertexAttribPointer(r.a_pos,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.a_pos),n.bindBuffer(n.ARRAY_BUFFER,null),be(n,e,2),n.uniform1i(r.u_screen,2),n.uniform1f(r.u_opacity,t),n.drawArrays(n.TRIANGLES,0,6)}},{key:"drawParticles",value:function(){var e=this.gl,t=this.drawProgram;e.useProgram(t),Te(e,this.particleIndexBuffer,t.a_index,1),be(e,this.colorRampTexture,2),e.uniform1i(t.u_wind,0),e.uniform1i(t.u_particles,1),e.uniform1i(t.u_color_ramp,2),e.uniform1f(t.u_particles_res,this.particleStateResolution),e.uniform2f(t.u_wind_min,this.windData.uMin,this.windData.vMin),e.uniform2f(t.u_wind_max,this.windData.uMax,this.windData.vMax),e.drawArrays(e.POINTS,0,this.numParticlesSize)}},{key:"updateParticles",value:function(){var e=this.gl;Ae(e,this.framebuffer,this.particleStateTexture1),e.viewport(0,0,this.particleStateResolution,this.particleStateResolution);var t=this.updateProgram;e.useProgram(t),Te(e,this.quadBuffer,t.a_pos,2),e.uniform1i(t.u_wind,0),e.uniform1i(t.u_particles,1),e.uniform1f(t.u_rand_seed,Math.random()),e.uniform2f(t.u_wind_res,2*this.windData.image.width,2*this.windData.image.height),e.uniform2f(t.u_wind_min,this.windData.uMin,this.windData.vMin),e.uniform2f(t.u_wind_max,this.windData.uMax,this.windData.vMax),e.uniform1f(t.u_speed_factor,this.speedFactor),e.uniform1f(t.u_drop_rate,this.dropRate),e.uniform1f(t.u_drop_rate_bump,this.dropRateBump),e.drawArrays(e.TRIANGLES,0,6);var n=this.particleStateTexture0;this.particleStateTexture0=this.particleStateTexture1,this.particleStateTexture1=n,Ae(e,null,null)}},{key:"destroy",value:function(){this.gl.deleteBuffer(this.quadBuffer),this.gl.deleteBuffer(this.particleIndexBuffer),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteShader(this.drawProgram.vertexShader),this.gl.deleteShader(this.drawProgram.fragmentShader),this.gl.deleteProgram(this.drawProgram),this.gl.deleteShader(this.fullScreenProgram.vertexShader),this.gl.deleteShader(this.fullScreenProgram.fragmentShader),this.gl.deleteProgram(this.fullScreenProgram),this.gl.deleteShader(this.updateProgram.vertexShader),this.gl.deleteShader(this.updateProgram.fragmentShader),this.gl.deleteProgram(this.updateProgram),this.gl.deleteTexture(this.colorRampTexture),this.gl.deleteTexture(this.backgroundTexture),this.gl.deleteTexture(this.screenTexture),this.gl.deleteTexture(this.particleStateTexture0),this.gl.deleteTexture(this.particleStateTexture1),this.gl.deleteTexture(this.windTexture)}}]),e}(),Ce={0:"#3288bd",.1:"#66c2a5",.2:"#abdda4",.3:"#e6f598",.4:"#fee08b",.5:"#fdae61",.6:"#f46d43",1:"#d53e4f"},Re=function(e){b()(i,e);var t,n,r=E()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),A()(d()(e),"texture",void 0),A()(d()(e),"colorModel",void 0),A()(d()(e),"wind",void 0),A()(d()(e),"imageCoords",void 0),A()(d()(e),"sizeScale",.5),A()(d()(e),"frequency",new B.iH(7.2)),A()(d()(e),"cacheZoom",void 0),e}return h()(i,[{key:"attributeLocation",get:function(){return Object.assign(g()(y()(i.prototype),"attributeLocation",this),{MAX:g()(y()(i.prototype),"attributeLocation",this).MAX,UV:9})}},{key:"render",value:function(e){var t=this;this.drawColorMode(e),this.frequency.run((function(){t.drawWind()}))}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:(n=u()(a()().mark((function e(){var t,n,r,i,o,s,u,l,c,f,h,p,d,v,g,m,y,_,b,x,E,T,A,S,C,R,w,M=this;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.layer.getLayerConfig(),i=r.uMin,o=void 0===i?-21.32:i,s=r.uMax,u=void 0===s?26.8:s,l=r.vMin,c=void 0===l?-21.57:l,f=r.vMax,h=void 0===f?21.42:f,p=r.fadeOpacity,d=void 0===p?.996:p,v=r.speedFactor,g=void 0===v?.25:v,m=r.dropRate,y=void 0===m?.003:m,_=r.dropRateBump,b=void 0===_?.01:_,x=r.rampColors,E=void 0===x?Ce:x,T=r.sizeScale,A=void 0===T?.5:T,S=this.rendererService.createTexture2D,C=this.layer.getSource(),this.texture=S({height:0,width:0}),this.cacheZoom=Math.floor(this.mapService.getZoom()),R=this.rendererService.getGLContext(),this.imageCoords=null===(t=C.data)||void 0===t?void 0:t.dataArray[0].coordinates,null===(n=C.data)||void 0===n||null===(n=n.images)||void 0===n||n.then((function(e){var t;M.sizeScale=A*M.getZoomScale();var n=M.getWindSize(),r=n.imageWidth,i=n.imageHeight,a={glContext:R,imageWidth:r,imageHeight:i,fadeOpacity:d,speedFactor:g,dropRate:y,dropRateBump:b,rampColors:E};M.wind=new Se(a),M.wind.setWind({uMin:o,uMax:u,vMin:c,vMax:h,image:e[0]}),null===(t=M.texture)||void 0===t||t.destroy(),M.texture=S({width:r,height:i}),M.layerService.reRender()})),e.next=10,this.layer.buildLayerModel({moduleName:"wind",vertexShader:'precision highp float;\nuniform mat4 u_ModelMatrix;\n\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n  v_texCoord = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));\n}\n',fragmentShader:"precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n}\n",defines:this.getDefines(),triangulation:D.iC,primitive:N.gl.TRIANGLES,depth:{enable:!1}});case 10:return w=e.sent,this.colorModel=w,e.abrupt("return",[w]);case 13:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getWindSize",value:function(){var e=this.mapService.lngLatToPixel(this.imageCoords[0]),t=this.mapService.lngLatToPixel(this.imageCoords[1]);return{imageWidth:Math.min(Math.floor((t.x-e.x)*this.sizeScale),2048),imageHeight:Math.min(Math.floor((e.y-t.y)*this.sizeScale),2048)}}},{key:"buildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.wind)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:N.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:N.gl.DYNAMIC_DRAW,data:[],type:N.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}},{key:"getZoomScale",value:function(){return Math.min((this.cacheZoom+4)/30*2,2)}},{key:"drawWind",value:function(){if(this.wind){var e=this.layer.getLayerConfig(),t=e.uMin,n=void 0===t?-21.32:t,r=e.uMax,i=void 0===r?26.8:r,o=e.vMin,a=void 0===o?-21.57:o,s=e.vMax,u=void 0===s?21.42:s,l=e.numParticles,c=void 0===l?65535:l,f=e.fadeOpacity,h=void 0===f?.996:f,p=e.speedFactor,d=void 0===p?.25:p,v=e.dropRate,g=void 0===v?.003:v,m=e.dropRateBump,y=void 0===m?.01:m,_=e.rampColors,b=void 0===_?Ce:_,x=e.sizeScale,E=void 0===x?.5:x,T=c,A=Math.floor(this.mapService.getZoom());if("number"==typeof E&&E!==this.sizeScale||A!==this.cacheZoom){var S=this.getZoomScale();this.sizeScale=E,T*=S;var C=this.getWindSize(),R=C.imageWidth,w=C.imageHeight;this.wind.reSize(R,w),this.cacheZoom=A}this.wind.updateWindDir(n,i,a,u),this.wind.updateParticelNum(T),this.wind.updateColorRampTexture(b),this.wind.fadeOpacity=h,this.wind.speedFactor=d,this.wind.dropRate=g,this.wind.dropRateBump=y;var M=this.wind.draw(),k=M.d,L=M.w,O=M.h;this.rendererService.setBaseState(),this.texture.update({data:k,width:L,height:O})}}},{key:"drawColorMode",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.layer.getLayerConfig(),r=n.opacity;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),this.layerService.renderMask(this.layer.masks),null===(e=this.colorModel)||void 0===e||e.draw({uniforms:{u_opacity:r||1,u_texture:this.texture},blend:this.getBlend(),stencil:this.getStencil(t)}),this.layer.hooks.afterRender.call()}}]),i}(w.Z),we={wind:Re},Me=function(e){b()(r,e);var t,n=E()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),A()(d()(e),"type","WindLayer"),e}return h()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new we[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"renderModels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.layerModel&&this.layerModel.render(e),this}},{key:"getDefaultConfig",value:function(){return{wind:{}}[this.getModelType()]}},{key:"getModelType",value:function(){return"wind"}}]),r}(S.Z)},7492:function(e,t,n){"use strict";n.d(t,{Z:function(){return ee}});var r=n(4450),i=n.n(r),o=n(6502),a=n.n(o),s=n(4351),u=n.n(s),l=n(8025),c=n.n(l),f=n(1133),h=n.n(f),p=n(1119),d=n.n(p),v=n(3491),g=n.n(v),m=n(2060),y=n.n(m),_=n(3769),b=n.n(_),x=n(6677),E=n(6413),T=n.n(E),A=n(5757),S=n.n(A),C=n(7033),R=n(7193),w=n(8407),M=n(8222),k={solid:0,dash:1},L=function(e){g()(i,e);var t,n,r=y()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),b()(d()(e),"texture",void 0),b()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:C.gl.NEAREST,min:C.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128}),e.textures=[e.texture]})),e}return h()(i,[{key:"attributeLocation",get:function(){return Object.assign(T()(S()(i.prototype),"attributeLocation",this),{MAX:T()(S()(i.prototype),"attributeLocation",this).MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12,THETA_OFFSET:13})}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.textureBlend,i=void 0===r?"normal":r,o=e.lineType,a=void 0===o?"solid":o,s=e.dashArray,u=void 0===s?[10,5]:s,l=e.forward,c=void 0===l||l,f=e.lineTexture,h=void 0!==f&&f,p=e.iconStep,d=void 0===p?100:p,v=e.segmentNumber,g=void 0===v?30:v,m=this.layer.getLayerConfig().animateOption,y=u;"dash"!==a&&(y=[0,0]),2===y.length&&y.push(0,0);var _,b=0,x=[0,0,0,0],E=[0,0,0,0];(t&&n&&(x=(0,R.CI)(t),E=(0,R.CI)(n),b=1),this.rendererService.getDirty())&&(null===(_=this.texture)||void 0===_||_.bind());var T={u_animate:this.animateOption2Array(m),u_dash_array:y,u_sourceColor:x,u_targetColor:E,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:g,u_lineDir:c?1:-1,u_icon_step:d,u_line_texture:h?1:0,u_textureBlend:"normal"===i?0:1,u_blur:.9,u_line_type:k[a||"solid"],u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:b};return this.getUniformsBufferInfo(T)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){return{frag:'\n#define Animate 0.0\n#define LineTexture 1.0\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float segmentNumber;\n  float u_lineDir: 1.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_blur : 0.9;\n  float u_line_type: 0.0;\n  float u_time;\n  float u_linearColor: 0.0;\n};\n\nin vec4 v_color;\nin vec2 v_iconMapUV;\nin vec4 v_lineData;\n//dash\nin vec4 v_dash_array;\nin float v_distance_ratio;\n\nout vec4 outputColor;\n#pragma include "picking"\n\nvoid main() {\n  if(u_dash_array!=vec4(0.0)){\n    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {\n      discard;\n    };\n  }\n  float animateSpeed = 0.0; // 运动速度\n  outputColor = v_color;\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      outputColor.a *= alpha;\n  }\n\n  // 当存在贴图时在底色上贴上贴图\n  if(u_line_texture == LineTexture) { // while load texture\n    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));\n    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);\n\n    float count = v_lineData.g; // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n    float v = v_lineData.a; // 横向 v\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n\n    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor = filterColor(outputColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        outputColor = filterColor(pattern);\n    }\n    \n  } else {\n     outputColor = filterColor(outputColor);\n  }\n}',vert:'#define Animate (0.0)\n#define LineTexture (1.0)\n\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;\nlayout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float segmentNumber;\n  float u_lineDir: 1.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_blur : 0.9;\n  float u_line_type: 0.0;\n  float u_time;\n  float u_linearColor: 0.0;\n};\n\nout vec4 v_color;\nout vec2 v_iconMapUV;\nout vec4 v_lineData;\n//dash\nout vec4 v_dash_array;\nout float v_distance_ratio;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1.0 - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2 * cos(theta2) + source.x, r2 * sin(theta2) + source.y);\n  if (u_lineDir == 1.0) {\n    // 正向\n    return mid;\n  } else {\n    // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n  // dash: index / (segmentNumber - 1.);\n  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n  //  return index / (segmentNumber - 1.);\n}\nvec2 interpolate(vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x, t), bezier3(y, t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return dir_screenspace.xy * sign(offset_direction);\n}\n\nvoid main() {\n  //vs中计算渐变色\n  if (u_linearColor == 1.0) {\n    float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex / segmentNumber);\n  } else {\n    v_color = a_Color;\n  }\n  v_color.a = v_color.a * opacity;\n\n  vec2 source_world = a_Instance.rg; // 起始点\n  vec2 target_world = a_Instance.ba; // 终点\n\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  // 计算 dashArray 和 distanceRatio 输出到片元\n  float total_Distance = pixelDistance(source_world, target_world) / 2.0 * PI;\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n  v_distance_ratio = segmentIndex / segmentNumber;\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n\n  if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n      if(u_lineDir != 1.0) {\n        d_distance_ratio = 1.0 - d_distance_ratio;\n      }\n  }\n\n  v_lineData.b = d_distance_ratio;\n\n  vec4 source = project_position(vec4(source_world, 0, 1.), a_Instance64Low.xy);\n  vec4 target = project_position(vec4(target_world, 0, 1.), a_Instance64Low.zw);\n\n  vec2 currPos = interpolate(source.xy, target.xy, segmentRatio, thetaOffset);\n  vec2 nextPos = interpolate(source.xy, target.xy, nextSegmentRatio, thetaOffset);\n\n  vec2 offset = project_pixel(\n    getExtrusionOffset((nextPos.xy - currPos.xy) * indexDir, a_Position.y)\n  );\n\n  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n  v_lineData.r = d_segmentIndex;\n\n  if(LineTexture == u_line_texture) { // 开启贴图模式\n    float arcDistrance = length(source - target); // 起始点和终点的距离\n    arcDistrance = project_pixel(arcDistrance);\n\n    v_iconMapUV = a_iconMapUV;\n\n    float pixelLen = project_pixel_texture(u_icon_step); // 贴图沿弧线方向的长度 - 随地图缩放改变\n    float texCount = floor(arcDistrance / pixelLen); // 贴图在弧线上重复的数量\n    v_lineData.g = texCount;\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size); // 定点位置偏移\n    v_lineData.a = lineOffsetWidth / linePixelSize; // 线图层贴图部分的 v 坐标值\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(currPos.xy + offset, 0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i,o,s,u,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,s=i.vert,u=i.type,e.next=5,this.layer.buildLayerModel({moduleName:"lineArc2d"+u,vertexShader:s,fragmentShader:o,defines:this.getDefines(),inject:this.getInject(),triangulation:M.$4,depth:{enable:!1},styleOption:{segmentNumber:r}});case 5:return l=e.sent,e.abrupt("return",[l]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:C.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:C.gl.DYNAMIC_DRAW,data:[],type:C.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:C.AttributeType.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:C.gl.STATIC_DRAW,data:[],type:C.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:C.AttributeType.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:C.gl.STATIC_DRAW,data:[],type:C.gl.FLOAT},size:4,update:function(e,t,n){return[(0,R.Ks)(n[3]),(0,R.Ks)(n[4]),(0,R.Ks)(n[5]),(0,R.Ks)(n[6])]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:C.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:C.gl.DYNAMIC_DRAW,data:[],type:C.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}}),this.styleAttributeService.registerStyleAttribute({name:"thetaOffset",type:C.AttributeType.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:this.attributeLocation.THETA_OFFSET,buffer:{usage:C.gl.STATIC_DRAW,data:[],type:C.gl.FLOAT},size:1,update:function(e){var t=e.thetaOffset;return[void 0===t?1:t]}}})}}]),i}(w.Z),O=n(7967),I={solid:0,dash:1},P=function(e){g()(i,e);var t,n,r=y()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),b()(d()(e),"texture",void 0),b()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:C.gl.NEAREST,min:C.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128}),e.textures=[e.texture]})),e}return h()(i,[{key:"attributeLocation",get:function(){return Object.assign(T()(S()(i.prototype),"attributeLocation",this),{MAX:T()(S()(i.prototype),"attributeLocation",this).MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12,THETA_OFFSET:13})}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.textureBlend,i=void 0===r?"normal":r,o=e.lineType,a=void 0===o?"solid":o,s=e.dashArray,u=void 0===s?[10,5]:s,l=e.lineTexture,c=void 0!==l&&l,f=e.iconStep,h=void 0===f?100:f,p=e.segmentNumber,d=void 0===p?30:p,v=e.globalArcHeight,g=void 0===v?10:v,m=this.layer.getLayerConfig().animateOption;2===u.length&&u.push(0,0);var y,_=0,b=[0,0,0,0],x=[0,0,0,0];(t&&n&&(b=(0,R.CI)(t),x=(0,R.CI)(n),_=1),this.rendererService.getDirty())&&(null===(y=this.texture)||void 0===y||y.bind());var E={u_animate:this.animateOption2Array(m),u_dash_array:u,u_sourceColor:b,u_targetColor:x,u_textSize:[1024,this.iconService.canvasHeight||128],u_globel:"GLOBEL"===this.mapService.version?1:0,u_globel_radius:O.Y5,u_global_height:g,segmentNumber:d,u_line_type:I[a]||0,u_icon_step:h,u_line_texture:c?1:0,u_textureBlend:"normal"===i?0:1,u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:_};return this.getUniformsBufferInfo(E)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){return{frag:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform sampler2D u_texture;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array: [10.0, 5., 0, 0];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_globel;\n  float u_globel_radius;\n  float u_global_height: 10;\n  float segmentNumber;\n  float u_line_type: 0.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_time;\n  float u_linearColor: 0.0;\n};\n\nin vec4 v_color;\nin vec4 v_dash_array;\nin float v_segmentIndex;\nin vec2 v_iconMapUV;\nin vec4 v_line_data;\n\nout vec4 outputColor;\n\n#pragma include "picking"\n\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_line_data.g; // 当前点位距离占线总长的比例\n  outputColor = v_color;\n\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    outputColor.a *=flag;\n  }\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      outputColor.a *= alpha;\n\n      // u_animate\n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = v_line_data.a;  // 线图层贴图部分的 v 坐标值\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor = filterColor(outputColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          outputColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    outputColor = filterColor(outputColor);\n  }\n}\n',vert:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;\nlayout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;\n\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array: [10.0, 5., 0, 0];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_globel;\n  float u_globel_radius;\n  float u_global_height: 10;\n  float segmentNumber;\n  float u_line_type: 0.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_time;\n  float u_linearColor: 0.0;\n};\nout vec4 v_color;\nout vec4 v_dash_array;\nout float v_segmentIndex;\nout vec2 v_iconMapUV;\nout vec4 v_line_data;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return dir_screenspace.xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  //vs中计算渐变色\n  if(u_linearColor==1.0){\n    float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  }\n  else{\n    v_color = a_Color;\n  }\n  v_color.a = v_color.a * opacity;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0), a_Instance64Low.xy).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0), a_Instance64Low.zw).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    float total_Distance = pixelDistance(source, target) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  v_line_data.g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式\n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    v_line_data.b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n\n  gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n\n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n\n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i,o,s,u,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,s=i.vert,u=i.type,e.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+u,vertexShader:s,fragmentShader:o,defines:this.getDefines(),inject:this.getInject(),triangulation:M.$4,styleOption:{segmentNumber:r}});case 4:return l=e.sent,e.abrupt("return",[l]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:C.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:C.gl.DYNAMIC_DRAW,data:[],type:C.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:C.AttributeType.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:C.gl.STATIC_DRAW,data:[],type:C.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:C.AttributeType.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:C.gl.STATIC_DRAW,data:[],type:C.gl.FLOAT},size:4,update:function(e,t,n){return[(0,R.Ks)(n[3]),(0,R.Ks)(n[4]),(0,R.Ks)(n[5]),(0,R.Ks)(n[6])]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:C.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:C.gl.DYNAMIC_DRAW,data:[],type:C.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}}),this.styleAttributeService.registerStyleAttribute({name:"thetaOffset",type:C.AttributeType.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:this.attributeLocation.THETA_OFFSET,buffer:{usage:C.gl.STATIC_DRAW,data:[],type:C.gl.FLOAT},size:1,update:function(e){var t=e.thetaOffset;return[void 0===t?1:t]}}})}}]),i}(w.Z),N=n(2786),B=n.n(N),D=n(5116),U=n.n(D),F=n(1102),z=n.n(F),G=n(3370),V={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},j=.5;function H(e,t){var n="object"===U()(e)?e.type:e,r="source"===t?1:-1,i="object"===U()(e)?e:{};switch(n){case"circle":return function(e,t){var n=t.width,r=void 0===n?2:n,i=t.height,o=void 0===i?2:i,a=(0,G.Xw)(),s=z().flatten([a]),u=z()(s.vertices,s.holes,s.dimensions),l=a.map((function(t){return[t[0]*r*e,t[1]*o]})).flat();return{vertices:[].concat(B()(l),B()(l)),dimensions:2,indices:u.map((function(e){return e+a.length})),outLineIndices:u,normals:[].concat(B()(a.map((function(t){return[t[1]*o,t[0]*r*e,1]})).flat()),B()(new Array(3*a.length).fill(0)))}}(r,i);case"triangle":return function(e,t){var n=t.width,r=void 0===n?2:n,i=t.height,o=void 0===i?3:i;return{vertices:[0,0,1*e*r,1*o,1*e*r,-1*o,0,0,1*e*r,1*o,1*e*r,-1*o],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*e,1,2,1*e,1,-2,1*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}(r,i);case"diamond":return function(e,t){var n=t.width,r=void 0===n?2:n,i=t.height,o=void 0===i?3:i;return{vertices:[0,0,1*r*e,.5*o,2*r*e,0,1*r*e,-.5*o,0,0,1*r*e,.5*o,2*r*e,0,1*r*e,-.5*o],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}(r,i);case"rect":return function(e,t){var n=t.width,r=void 0===n?2:n,i=t.height,o=void 0===i?2:i;return{vertices:[0,o/2,e*r*1,o/2,e*r*1,-o/2,0,-o/2,0,o/2,e*r*1,o/2,e*r*1,-o/2,0,-o/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}(r,i);case"classic":return function(e,t){var n=t.width,r=void 0===n?2:n,i=t.height,o=void 0===i?3:i;return{vertices:[0,0,2*e*r,1*o,1.5*e*r,0,2*e*r,-1*o,0,0,2*e*r,1*o,1.5*e*r,0,2*e*r,-1*o],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}(r,i);case"halfTriangle":return function(e,t){var n=t.width,r=void 0===n?2:n,i=t.height,o=void 0===i?1:i;return{vertices:[0,j*e,1*e*r,-(o+j)*e,1*e*r,(o-j)*e,0,j*e,1*e*r,-(o+j)*e,1*e*r,(o-j)*e],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*e,-2*e,1,-2*e,1.5*e,1,1*e,1.5*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}(r,i);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function W(e,t){return t?function(e,t){var n=e.coordinates.flat(),r=t,i=r.target,o=void 0===i?"classic":i,a=r.source,s=X(H(void 0===a?"circle":a,"source"),n,0,0),u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2?arguments[2]:void 0,r="object"===U()(n.source)?n.source.type:n.source,i="object"===U()(n.target)?n.target.type:n.target,o="object"===U()(n.source)?n.source:{},a=o.width,s=void 0===a?r?V[r]:0:a,u=("object"===U()(n.target)?n.target:{}).width,l=void 0===u?i?V[i]:0:u;return{vertices:[0,j,1*s].concat(B()(e),[1,j,-1*l],B()(e),[1,-j,-1*l],B()(e),[0,-j,1*s],B()(e),[0,j,1*s],B()(e),[1,j,-1*l],B()(e),[1,-j,-1*l],B()(e),[0,-j,1*s],B()(e)),outLineIndices:[0,1,2,0,2,3].map((function(e){return e+t})),indices:[4,5,6,4,6,7].map((function(e){return e+t})),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}(n,s.vertices.length/7,t),l=X(H(o,"target"),n,1,s.vertices.length/7+u.vertices.length/7);return{vertices:[].concat(B()(s.vertices),B()(u.vertices),B()(l.vertices)),indices:[].concat(B()(s.outLineIndices),B()(u.outLineIndices),B()(l.outLineIndices),B()(s.indices),B()(u.indices),B()(l.indices)),normals:[].concat(B()(s.normals),B()(u.normals),B()(l.normals)),size:7}}(e,t):function(e){var t=e.coordinates.flat();return{vertices:[1,0,0].concat(B()(t),[1,2,-3],B()(t),[1,1,-3],B()(t),[0,1,0],B()(t),[0,0,0],B()(t),[1,0,0],B()(t),[1,2,-3],B()(t),[1,1,-3],B()(t),[0,1,0],B()(t),[0,0,0],B()(t)),normals:[-1,2,1,2,-1,1,1,-1,1,1,-1,1,-1,-1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}(e)}function X(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=[],a=e.vertices,s=e.indices,u=e.dimensions,l=e.outLineIndices,c=0;c<a.length;c+=u)o.push.apply(o,[n,a[c+1],a[c]].concat(B()(t)));return i()(i()({},e),{},{vertices:o,indices:s.map((function(e){return e+r})),outLineIndices:l.map((function(e){return e+r}))})}var Z=function(e){g()(i,e);var t,n,r=y()(i);function i(){return c()(this,i),r.apply(this,arguments)}return h()(i,[{key:"attributeLocation",get:function(){return Object.assign(T()(S()(i.prototype),"attributeLocation",this),{MAX:T()(S()(i.prototype),"attributeLocation",this).MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,NORMAL:12})}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.gapWidth,n=void 0===t?2:t,r=e.strokeWidth,i=void 0===r?1:r,o=e.strokeOpacity,a={u_gap_width:n,u_stroke_width:i,u_stroke_opacity:void 0===o?1:o};return this.getUniformsBufferInfo(a)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;\nlayout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;\nlayout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\n\nlayout(std140) uniform commonUniorm {\n  float u_gap_width: 1.0;\n  float u_stroke_width: 1.0;\n  float u_stroke_opacity: 1.0;\n};\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nout vec4 v_color;\n\nvec2 project_pixel_offset(vec2 offsets) {\n  vec2 data = project_pixel(offsets);\n\n  return vec2(data.x, -data.y);\n}\n\nvec2 line_dir(vec2 target, vec2 source) {\n  return normalize(ProjectFlat(target) - ProjectFlat(source));\n}\n\n\nvoid main() {\n  // 透明度计算\n  vec2 source_world = a_Instance.rg; // 起点\n  vec2 target_world = a_Instance.ba; // 终点\n  vec2 flowlineDir = line_dir(target_world, source_world);\n  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);\n\n  vec2 position = mix(source_world, target_world, a_Position.x);\n  vec2 position64Low = mix(a_Instance64Low.rg, a_Instance64Low.ba, a_Position.x);\n\n  float lengthCommon = length(\n    project_position(vec4(target_world, 0, 1)) - project_position(vec4(source_world, 0, 1))\n  );\n  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || 高德\n  vec2 limitedOffsetDistances = clamp(\n    offsetDistances,\n    project_pixel(-lengthCommon * 0.2),\n    project_pixel(lengthCommon * 0.2)\n  );\n\n  float startOffsetCommon = project_pixel(offsets[0]);\n  float endOffsetCommon = project_pixel(offsets[1]);\n  float endpointOffset = mix(\n    clamp(startOffsetCommon, 0.0, lengthCommon * 0.2),\n    -clamp(endOffsetCommon, 0.0, lengthCommon * 0.2),\n    a_Position.x\n  );\n\n  vec2 normalsCommon = u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y));\n\n  float gapCommon = -1. * project_pixel(u_gap_width);\n  vec3 offsetCommon = vec3(\n    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -\n      perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),\n    0.0\n  );\n\n  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0), position64Low);\n\n  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);\n  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy +  offsetCommon.xy, 0., 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'// #extension GL_OES_standard_derivatives : enable\n\nin vec4 v_color;\nout vec4 outputColor;\n\n\n// line texture\n\n#pragma include "picking"\n\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',defines:this.getDefines(),inject:this.getInject(),triangulation:W,styleOption:this.layer.getLayerConfig().symbol,primitive:C.gl.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:C.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:C.gl.DYNAMIC_DRAW,data:[],type:C.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:C.AttributeType.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:C.gl.STATIC_DRAW,data:[],type:C.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:C.AttributeType.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:C.gl.STATIC_DRAW,data:[],type:C.gl.FLOAT},size:4,update:function(e,t,n){return[(0,R.Ks)(n[3]),(0,R.Ks)(n[4]),(0,R.Ks)(n[5]),(0,R.Ks)(n[6])]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:C.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:C.gl.STATIC_DRAW,data:[],type:C.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}})}}]),i}(w.Z),Y={solid:0,dash:1},q=function(e){g()(i,e);var t,n,r=y()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),b()(d()(e),"texture",void 0),b()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:C.gl.NEAREST,min:C.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128}),e.textures=[e.texture]})),e}return h()(i,[{key:"attributeLocation",get:function(){return Object.assign(T()(S()(i.prototype),"attributeLocation",this),{MAX:T()(S()(i.prototype),"attributeLocation",this).MAX,SIZE:9,INSTANCE:10,INSTANCE_64LOW:11,UV:12})}},{key:"getCommonUniformsInfo",value:function(){var e,t=this.layer.getLayerConfig(),n=t.sourceColor,r=t.targetColor,i=t.textureBlend,o=void 0===i?"normal":i,a=t.lineType,s=void 0===a?"solid":a,u=t.dashArray,l=void 0===u?[10,5]:u,c=t.lineTexture,f=void 0!==c&&c,h=t.iconStep,p=void 0===h?100:h,d=t.segmentNumber,v=void 0===d?30:d,g=this.layer.getLayerConfig().animateOption;(2===l.length&&l.push(0,0),this.rendererService.getDirty())&&(null===(e=this.texture)||void 0===e||e.bind());var m=0,y=[0,0,0,0],_=[0,0,0,0];n&&r&&(y=(0,R.CI)(n),_=(0,R.CI)(r),m=1);var b=this.layer.getLayerAnimateTime();isNaN(b)&&(b=0);var x={u_animate:this.animateOption2Array(g),u_dash_array:l,u_sourceColor:y,u_targetColor:_,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:v,u_line_type:Y[s]||0,u_icon_step:p,u_line_texture:f?1:0,u_textureBlend:"normal"===o?0:1,u_time:b,u_linearColor:m};return this.getUniformsBufferInfo(x)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.segmentNumber,r=void 0===n?30:n,e.next=3,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:'#define LineTypeSolid (0.0)\n#define LineTypeDash (1.0)\n#define Animate (0.0)\n#define LineTexture (1.0)\n\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_INSTANCE) in vec4 a_Instance;\nlayout(location = ATTRIBUTE_LOCATION_INSTANCE_64LOW) in vec4 a_Instance64Low;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array: [10.0, 5., 0, 0];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float segmentNumber;\n  float u_line_type: 0.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_time;\n  float u_linearColor: 0;\n};\n\nout vec4 v_dash_array;\nout vec4 v_color;\nout vec2 v_iconMapUV;\nout vec4 v_line_data;\nout float v_distance_ratio;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps(float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return index / (segmentNumber - 1.0);\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(mix(source, target, segmentRatio), sqrt(max(0.0, vertex_height)));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return dir_screenspace.xy * sign(offset_direction);\n}\nfloat getAngularDist(vec2 source, vec2 target) {\n  vec2 delta = source - target;\n  vec2 sin_half_delta = sin(delta / 2.0);\n  float a =\n    sin_half_delta.y * sin_half_delta.y +\n    cos(source.y) * cos(target.y) * sin_half_delta.x * sin_half_delta.x;\n  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\n\nvec2 midPoint(vec2 source, vec2 target) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = 0.314;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2 * cos(theta2) + source.x, r2 * sin(theta2) + source.y);\n  return mid;\n}\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1.0 - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\n\nvec2 interpolate(vec2 source, vec2 target, float angularDist, float t) {\n  if (abs(angularDist - PI) < 0.001) {\n    return (1.0 - t) * source + t * target;\n  }\n  float a = sin((1.0 - t) * angularDist) / sin(angularDist);\n  float b = sin(t * angularDist) / sin(angularDist);\n  vec2 sin_source = sin(source);\n  vec2 cos_source = cos(source);\n  vec2 sin_target = sin(target);\n  vec2 cos_target = cos(target);\n  float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\n  float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\n  float z = a * sin_source.y + b * sin_target.y;\n  return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n\n}\n\nvoid main() {\n  v_color = a_Color;\n  v_color.a = v_color.a * opacity;\n  vec2 source = radians(a_Instance.rg);\n  vec2 target = radians(a_Instance.ba);\n  float angularDist = getAngularDist(source, target);\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  if (u_line_type == LineTypeDash) {\n    v_distance_ratio = segmentIndex / segmentNumber;\n    float total_Distance = pixelDistance(source, target) / 2.0 * PI;\n    total_Distance = total_Distance * 16.0; // total_Distance*16.0 调整默认的效果\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n  }\n\n  if (u_animate.x == Animate) {\n    v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  v_distance_ratio = segmentIndex / segmentNumber;\n\n  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0), a_Instance64Low.xy);\n  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0), a_Instance64Low.zw);\n\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n\n  v_line_data.g = a_Position.x; // 该顶点在弧线上的分段排序\n  if (LineTexture == u_line_texture) {\n    float d_arcDistrance = length(source - target);\n    d_arcDistrance = project_pixel(d_arcDistrance);\n\n    float d_pixelLen = project_pixel(u_icon_step) / 8.0;\n    v_line_data.b = floor(d_arcDistrance / d_pixelLen); // 贴图在弧线上重复的数量\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size); // 定点位置偏移，按地图等级缩放后的距离\n    v_line_data.a = lineOffsetWidth / linePixelSize; // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  setPickingColor(a_PickingColor);\n}\n\n',fragmentShader:'#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array: [10.0, 5., 0, 0];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float segmentNumber;\n  float u_line_type: 0.0;\n  float u_icon_step: 100;\n  float u_line_texture: 0.0;\n  float u_textureBlend;\n  float u_time;\n  float u_linearColor: 0;\n};\n\nin vec4 v_dash_array;\nin vec4 v_color;\nin vec2 v_iconMapUV;\nin vec4 v_line_data;\nin float v_distance_ratio;\n\nout vec4 outputColor;\n#pragma include "picking"\n#pragma include "project"\n#pragma include "projection"\n\nvoid main() {\n\n  float animateSpeed = 0.0;\n  float d_segmentIndex = v_line_data.g;\n\n  // 设置弧线的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    outputColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n    outputColor.a *= v_color.a;\n  } else { // 使用 color 方法传入的颜色\n    outputColor = v_color;\n  }\n\n  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));\n  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));\n  if(u_line_type == LineTypeDash) {\n    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      // 实线部分\n    } else {\n      // 虚线部分\n      discard;\n    };\n  }\n\n  // 设置弧线的动画模式\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      outputColor.a *= alpha;\n  }\n\n  // 设置弧线的贴图\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) {\n    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));\n    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // 贴图在弧线上重复的数量\n    float u = fract(arcRadio * count - animateSpeed * count);\n    // float u = fract(arcRadio * count - animateSpeed);\n    if(u_animate.x == Animate) {\n      u = outputColor.a/v_color.a;\n    }\n\n    float v = v_line_data.a; // 线图层贴图部分的 v 坐标值\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n\n    // 设置贴图和底色的叠加模式\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor = filterColor(outputColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        outputColor = filterColor(pattern);\n    }\n  } else {\n    outputColor = filterColor(outputColor);\n  }\n\n  // gl_FragColor = filterColor(gl_FragColor);\n}\n',triangulation:M.$4,styleOption:{segmentNumber:r},defines:this.getDefines(),inject:this.getInject(),depth:{enable:!1}});case 3:return i=e.sent,e.abrupt("return",[i]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:C.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:C.gl.DYNAMIC_DRAW,data:[],type:C.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:C.AttributeType.Attribute,descriptor:{name:"a_Instance",shaderLocation:this.attributeLocation.INSTANCE,buffer:{usage:C.gl.STATIC_DRAW,data:[],type:C.gl.FLOAT},size:4,update:function(e,t,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance64Low",type:C.AttributeType.Attribute,descriptor:{name:"a_Instance64Low",shaderLocation:this.attributeLocation.INSTANCE_64LOW,buffer:{usage:C.gl.STATIC_DRAW,data:[],type:C.gl.FLOAT},size:4,update:function(e,t,n){return[(0,R.Ks)(n[3]),(0,R.Ks)(n[4]),(0,R.Ks)(n[5]),(0,R.Ks)(n[6])]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:C.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:C.gl.DYNAMIC_DRAW,data:[],type:C.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),i}(w.Z),K=n(937),Q=function(e){g()(i,e);var t,n,r=y()(i);function i(){return c()(this,i),r.apply(this,arguments)}return h()(i,[{key:"attributeLocation",get:function(){return Object.assign(T()(S()(i.prototype),"attributeLocation",this),{MAX:T()(S()(i.prototype),"attributeLocation",this).MAX,SIZE:9})}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.sourceColor,n=e.targetColor,r=e.lineType,i=void 0===r?"solid":r,o=e.dashArray,a=void 0===o?[10,5,0,0]:o,s=e.vertexHeightScale,u=void 0===s?20:s,l=a;"dash"!==i&&(l=[0,0,0,0]),2===l.length&&l.push(0,0);var c=0,f=[0,0,0,0],h=[0,0,0,0];t&&n&&(f=(0,R.CI)(t),h=(0,R.CI)(n),c=1);var p={u_sourceColor:f,u_targetColor:h,u_dash_array:l,u_vertexScale:u,u_linearColor:c};return this.getUniformsBufferInfo(p)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getShaders",value:function(){return{frag:"\nlayout(std140) uniform commonUniorm {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec4 u_dash_array;\n  float u_vertexScale: 1.0;\n  float u_linearColor: 0;\n};\nin float v_distanceScale;\nin vec4 v_color;\n//dash\nin vec4 v_dash_array;\n\nout vec4 outputColor;\nvoid main() {\n  if(u_dash_array!=vec4(0.0)){\n    float dashLength = mod(v_distanceScale, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {\n      // 虚线部分\n      discard;\n    };\n  }\n  if(u_linearColor==1.0){\n    outputColor = mix(u_sourceColor, u_targetColor, v_distanceScale);\n    outputColor.a *= v_color.a; // 全局透明度\n  }\n  else{\n    outputColor = v_color;\n  }\n}\n",vert:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in vec4 a_SizeDistanceAndTotalDistance;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec4 u_dash_array;\n  float u_vertexScale: 1.0;\n  float u_linearColor: 0;\n};\n\n#pragma include "projection"\n#pragma include "picking"\n\nout vec4 v_color;\nout float v_distanceScale;\nout vec4 v_dash_array;\n\nvoid main() {\n  //dash输出\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;\n\n  v_color = a_Color;\n  v_distanceScale = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;\n  v_color.a = v_color.a * opacity;\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况\n\n  float lineHeight = a_SizeDistanceAndTotalDistance.y;\n  // 兼容 mapbox 在线高度上的效果表现基本一致\n  if (\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    // 保持高度相对不变\n    h *= 2.0 / pow(2.0, 20.0 - u_Zoom);\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));\n  gl_PointSize = 10.0;\n\n}\n',type:"lineSimpleNormal"}}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i,o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),t=this.getShaders(),n=t.frag,r=t.vert,i=t.type,e.next=4,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,triangulation:M.us,defines:this.getDefines(),inject:this.getInject(),primitive:C.gl.LINES,depth:{enable:!1},pick:!1});case 4:return o=e.sent,e.abrupt("return",[o]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"sizeDistanceAndTotalDistance",type:C.AttributeType.Attribute,descriptor:{name:"a_SizeDistanceAndTotalDistance",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:C.gl.STATIC_DRAW,data:[],type:C.gl.FLOAT},size:4,update:function(e,t,n){var r=e.size,i=void 0===r?1:r,o=Array.isArray(i)?[i[0],i[1]]:[i,0];return[o[0],o[1],n[3],n[5]]}}})}}]),i}(w.Z),$=function(e){g()(i,e);var t,n,r=y()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),b()(d()(e),"texture",void 0),b()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:C.gl.NEAREST,min:C.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128}),e.textures=[e.texture]})),e}return h()(i,[{key:"attributeLocation",get:function(){return Object.assign(T()(S()(i.prototype),"attributeLocation",this),{MAX:T()(S()(i.prototype),"attributeLocation",this).MAX,SIZE:9,NORMAL:12,UV:13,DISTANCE_MITER_TOTAL:15})}},{key:"getCommonUniformsInfo",value:function(){var e,t=this.layer.getLayerConfig(),n=t.sourceColor,r=t.targetColor,i=t.textureBlend,o=void 0===i?"normal":i,a=t.heightfixed,s=void 0!==a&&a,u=t.lineTexture,l=void 0!==u&&u,c=t.iconStep,f=void 0===c?100:c,h=t.iconStepCount,p=void 0===h?1:h,d=this.layer.getLayerConfig().animateOption;this.rendererService.getDirty()&&(null===(e=this.texture)||void 0===e||e.bind());var v=0,g=[0,0,0,0],m=[0,0,0,0];n&&r&&(g=(0,R.CI)(n),m=(0,R.CI)(r),v=1);var y={u_animate:this.animateOption2Array(d),u_sourceColor:g,u_targetColor:m,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:f,u_heightfixed:Number(s),u_linearColor:v,u_line_texture:l?1:0,u_textureBlend:"normal"===o?0:1,u_iconStepCount:p,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(y)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),e.abrupt("return",this.buildModels());case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:'#define Animate 0.0\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;\nlayout(location = ATTRIBUTE_LOCATION_DISTANCE_MITER_TOTAL) in vec3 a_Distance_Total_Miter;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_icon_step: 100;\n  float u_heightfixed;\n  float u_linearColor: 0;\n  float u_line_texture;\n  float u_textureBlend;\n  float u_iconStepCount;\n  float u_time;\n};\n\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nout vec2 v_iconMapUV;\nout vec4 v_color;\nout float v_blur;\nout vec4 v_dataset;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  float a_Distance = a_Distance_Total_Miter.x;\n  float a_Miter = a_Distance_Total_Miter.y;\n  float a_Total_Distance = a_Distance_Total_Miter.z;\n\n  float d_distance_ratio; // 当前点位距离占线总长的比例\n  float d_texPixelLen; // 贴图的像素长度，根据地图层级缩放\n\n  v_iconMapUV = a_iconMapUV;\n  if (u_heightfixed < 1.0) {\n    // 高度随 zoom 调整\n    d_texPixelLen = project_pixel(u_icon_step);\n  } else {\n    d_texPixelLen = u_icon_step;\n  }\n\n  if (u_animate.x == Animate || u_linearColor == 1.0) {\n    d_distance_ratio = a_Distance / a_Total_Distance;\n  }\n\n  float miter = (a_Miter + 1.0) / 2.0;\n  // 设置数据集的参数\n  v_dataset[0] = d_distance_ratio; // 当前点位距离占线总长的比例\n  v_dataset[1] = a_Distance; // 当前顶点的距离\n  v_dataset[2] = d_texPixelLen; // 贴图的像素长度，根据地图层级缩放\n  v_dataset[3] = miter; // 线图层贴图部分的 v 坐标值 0 - 1\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);\n\n  float originSize = a_Size.x; // 固定高度\n  if (u_heightfixed < 1.0) {\n    originSize = project_float_meter(a_Size.x); // 高度随 zoom 调整\n  }\n\n  float wallHeight = originSize * miter;\n  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));\n\n  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);\n  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);\n\n  // 兼容 mapbox 在线高度上的效果表现基本一致\n  if (\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    // mapbox\n    // 保持高度相对不变\n    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);\n    if (u_heightfixed > 0.0) {\n      wallHeight *= mapboxZoomScale;\n    }\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'#define Animate 0.0\n#define LineTexture 1.0\n\n// line texture\n\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_icon_step: 100;\n  float u_heightfixed;\n  float u_linearColor: 0;\n  float u_line_texture;\n  float u_textureBlend;\n  float u_iconStepCount;\n  float u_time;\n};\n\n\nin vec2 v_iconMapUV;\nin vec4 v_color;\nin float v_blur;\nin vec4 v_dataset;\n\nout vec4 outputColor;\n\n#pragma include "picking"\n\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_dataset.r; // 当前点位距离占线总长的比例\n  float v = v_dataset.a;\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    outputColor = mix(u_sourceColor, u_targetColor, v);\n  } else { // 使用 color 方法传入的颜色\n     outputColor = v_color;\n  }\n\n  outputColor.a *= v_color.a; // 全局透明度\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      outputColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_dataset.g;      // 当前顶点的距离\n    float d_texPixelLen = v_dataset.b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_dataset.a;  // 线图层贴图部分的 v 坐标值\n\n    // 计算纹理间隔 start\n    float flag = 0.0;\n    if(u > 1.0/u_iconStepCount) {\n      flag = 1.0;\n    }\n    u = fract(u*u_iconStepCount);\n    // 计算纹理间隔 end\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n\n    // Tip: 判断纹理间隔\n    if(flag > 0.0) {\n      pattern = vec4(0.0);\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor = filterColor(outputColor + pattern);\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        outputColor = filterColor(pattern);\n    }\n  }\n\n\n  // blur - AA\n  if(v < v_blur) {\n    outputColor.a = mix(0.0, outputColor.a, v/v_blur);\n  } else if(v > 1.0 - v_blur) {\n    outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);\n  }\n\n  outputColor = filterColor(outputColor);\n}\n',triangulation:M.sN,defines:this.getDefines(),inject:this.getInject(),depth:{enable:!1},blend:this.getBlend()});case 2:return t=e.sent,e.abrupt("return",[t]);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:C.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:C.gl.DYNAMIC_DRAW,data:[],type:C.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:C.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:C.gl.STATIC_DRAW,data:[],type:C.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"distanceAndTotalAndMiter",type:C.AttributeType.Attribute,descriptor:{name:"a_Distance_Total_Miter",shaderLocation:this.attributeLocation.DISTANCE_MITER_TOTAL,buffer:{usage:C.gl.STATIC_DRAW,data:[],type:C.gl.FLOAT},size:3,update:function(e,t,n){return[n[3],n[4],n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:C.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:C.gl.DYNAMIC_DRAW,data:[],type:C.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),i}(w.Z),J={arc:L,arc3d:P,greatcircle:q,wall:$,line:K.Z,simple:Q,flowline:Z,earthArc3d:P},ee=function(e){g()(r,e);var t,n=y()(r);function r(){var e;c()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),b()(d()(e),"type","LineLayer"),b()(d()(e),"enableShaderEncodeStyles",["stroke","offsets","opacity","thetaOffset"]),b()(d()(e),"arrowInsertCount",0),b()(d()(e),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),e}return h()(r,[{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new J[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e;if(this.layerType)return this.layerType;var t=this.styleAttributeService.getLayerStyleAttribute("shape");return(null==t||null===(e=t.scale)||void 0===e?void 0:e.field)||"line"}},{key:"processData",value:function(e){if("simple"!==this.getModelType())return e;var t=[];return e.map((function(e){if(Array.isArray(e.coordinates)&&Array.isArray(e.coordinates[0])&&Array.isArray(e.coordinates[0][0])){var n=i()({},e);e.coordinates.map((function(e){t.push(i()(i()({},n),{},{coordinates:e}))}))}else t.push(e)})),t}}]),r}(x.Z)},937:function(e,t,n){"use strict";n.d(t,{Z:function(){return k}});var r=n(2786),i=n.n(r),o=n(6502),a=n.n(o),s=n(4351),u=n.n(s),l=n(8025),c=n.n(l),f=n(1133),h=n.n(f),p=n(1119),d=n.n(p),v=n(6413),g=n.n(v),m=n(5757),y=n.n(m),_=n(3491),b=n.n(_),x=n(2060),E=n.n(x),T=n(3769),A=n.n(T),S=n(7033),C=n(7193),R=n(8407),w=n(4659),M=n(8222),k=function(e){b()(o,e);var t,n,r=E()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),A()(d()(e),"textureEventFlag",!1),A()(d()(e),"texture",e.createTexture2D({data:new Uint8Array([0,0,0,0]),width:1,height:1})),A()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(0===e.textures.length&&(e.textures=[e.texture]),e.texture)return e.texture.update({data:e.iconService.getCanvas()}),void e.layer.render();e.texture=t({data:e.iconService.getCanvas(),mag:S.gl.NEAREST,min:S.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128})})),e}return h()(o,[{key:"attributeLocation",get:function(){return Object.assign(g()(y()(o.prototype),"attributeLocation",this),{MAX:g()(y()(o.prototype),"attributeLocation",this).MAX,SIZE:9,DISTANCE_INDEX:10,NORMAL:11,UV:12})}},{key:"getCommonUniformsInfo",value:function(){var e,t=this.layer.getLayerConfig(),n=t.sourceColor,r=t.targetColor,i=t.textureBlend,o=void 0===i?"normal":i,a=t.lineType,s=void 0===a?"solid":a,u=t.dashArray,l=void 0===u?[10,5,0,0]:u,c=t.lineTexture,f=void 0!==c&&c,h=t.iconStep,p=void 0===h?100:h,d=t.vertexHeightScale,v=void 0===d?20:d,g=t.strokeWidth,m=void 0===g?0:g,y=t.raisingHeight,_=void 0===y?0:y,b=t.heightfixed,x=void 0!==b&&b,E=t.linearDir,T=void 0===E?w.cA.VERTICAL:E,A=t.blur,S=void 0===A?[1,1,1,0]:A,R=l;("dash"!==s&&(R=[0,0,0,0]),2===R.length&&R.push(0,0),this.rendererService.getDirty()&&this.texture)&&(null===(e=this.texture)||void 0===e||e.bind());var M=this.layer.getLayerConfig().animateOption,k=0,L=[0,0,0,0],O=[0,0,0,0];n&&r&&(L=(0,C.CI)(n),O=(0,C.CI)(r),k=1);var I={u_animate:this.animateOption2Array(M),u_dash_array:R,u_blur:S,u_sourceColor:L,u_targetColor:O,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:p,u_heightfixed:Number(x),u_vertexScale:v,u_raisingHeight:Number(_),u_strokeWidth:m,u_textureBlend:o===w.qy.NORMAL?0:1,u_line_texture:f?1:0,u_linearDir:T===w.cA.VERTICAL?1:0,u_linearColor:k,u_time:this.layer.getLayerAnimateTime()||0};return this.getUniformsBufferInfo(I)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i,o,s,u,l;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0!==n&&n,i=this.getShaders(),o=i.frag,s=i.vert,u=i.type,this.layer.triangulation=M.sN,e.next=5,this.layer.buildLayerModel({moduleName:"line"+u,vertexShader:s,fragmentShader:o,triangulation:M.sN,defines:this.getDefines(),inject:this.getInject(),depth:{enable:r}});case 5:return l=e.sent,e.abrupt("return",[l]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getShaders",value:function(){return{frag:'// #extension GL_OES_standard_derivatives : enable\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array;\n  vec4 u_blur;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_icon_step: 100;\n  float u_heightfixed: 0.0;\n  float u_vertexScale: 1.0;\n  float u_raisingHeight: 0.0;\n  float u_strokeWidth: 0.0;\n  float u_textureBlend;\n  float u_line_texture;\n  float u_linearDir: 1.0;\n  float u_linearColor: 0;\n  float u_time;\n};\n\nin vec4 v_color;\nin vec4 v_stroke;\n// dash\nin vec4 v_dash_array;\nin float v_d_distance_ratio;\nin vec2 v_iconMapUV;\nin vec4 v_texture_data;\n\nout vec4 outputColor;\n#pragma include "picking"\n\n// [animate, duration, interval, trailLength],\nvoid main() {\n  if(u_dash_array!=vec4(0.0)){\n    float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {\n      // 虚线部分\n      discard;\n    };\n  }\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_texture_data.r; // 当前点位距离占线总长的比例\n  if(u_linearDir < 1.0) {\n    d_distance_ratio = v_texture_data.a;\n  }\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    outputColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);\n    outputColor.a *= v_color.a;\n  } else { // 使用 color 方法传入的颜色\n     outputColor = v_color;\n  }\n  // anti-alias\n  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      outputColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_texture_data.g;      // 当前顶点的距离\n    float d_texPixelLen = v_texture_data.b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_texture_data.a;  // 线图层贴图部分的 v 坐标值\n\n    // v = max(smoothstep(0.95, 1.0, v), v);\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n     vec4 pattern = texture(SAMPLER_2D(u_texture), uv);\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      outputColor += pattern;\n    } else { // replace\n        pattern.a *= v_color.a;\n        if(outputColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        outputColor = pattern;\n    }\n  } \n\n  float v = v_texture_data.a;\n  float strokeWidth = min(0.5, u_strokeWidth);\n  // 绘制 border\n  if(strokeWidth > 0.01) {\n    float borderOuterWidth = strokeWidth / 2.0;\n\n\n    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {\n      if(v > strokeWidth) { // 外侧\n        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);\n        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);\n        outputColor.rgb = mix(outputColor.rgb, v_stroke.rgb, linear);\n      } else if(v <= strokeWidth) {\n        float linear = smoothstep(0.0, 1.0, v/strokeWidth);\n        outputColor.rgb = mix(v_stroke.rgb, outputColor.rgb, linear);\n      }\n    }\n\n    if(v < borderOuterWidth) {\n      outputColor.a = mix(0.0, outputColor.a, v/borderOuterWidth);\n    } else if(v > 1.0 - borderOuterWidth) {\n      outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);\n    }\n  }\n\n  // blur\n  float blurV = v_texture_data.a;\n  if(blurV < 0.5) {\n    outputColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);\n  } else {\n    outputColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);\n  }\n  \n  outputColor = filterColor(outputColor);\n}\n',vert:'#define Animate (0.0)\n\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in vec2 a_Size;\nlayout(location = ATTRIBUTE_LOCATION_DISTANCE_INDEX) in vec3 a_DistanceAndIndexAndMiter;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec4 a_Normal_Total_Distance;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_iconMapUV;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n  vec4 u_dash_array;\n  vec4 u_blur;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  vec2 u_textSize;\n  float u_icon_step: 100;\n  float u_heightfixed: 0.0;\n  float u_vertexScale: 1.0;\n  float u_raisingHeight: 0.0;\n  float u_strokeWidth: 0.0;\n  float u_textureBlend;\n  float u_line_texture;\n  float u_linearDir: 1.0;\n  float u_linearColor: 0;\n  float u_time;\n};\n\nout vec4 v_color;\nout vec4 v_stroke;\n//dash\nout vec4 v_dash_array;\nout float v_d_distance_ratio;\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nout vec2 v_iconMapUV;\nout vec4 v_texture_data;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec2 a_DistanceAndIndex = a_DistanceAndIndexAndMiter.xy;\n  float a_Miter = a_DistanceAndIndexAndMiter.z;\n  vec3 a_Normal = a_Normal_Total_Distance.xyz;\n  float a_Total_Distance = a_Normal_Total_Distance.w;\n  //dash输出\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;\n  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;\n\n  // cal style mapping - 数据纹理映射部分的计算\n  float d_texPixelLen; // 贴图的像素长度，根据地图层级缩放\n  v_iconMapUV = a_iconMapUV;\n  d_texPixelLen = project_float_pixel(u_icon_step);\n\n  v_color = a_Color;\n  v_color.a *= opacity;\n  v_stroke = stroke;\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * a_Normal;\n\n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）\n  float linePixelSize = project_pixel(a_Size.x) * 2.0; // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2\n  float texV = lineOffsetWidth / linePixelSize; // 线图层贴图部分的 v 坐标值\n\n  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);\n  // 设置数据集的参数\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0), a_Position64Low);\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height\n  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]\n\n  // 兼容 mapbox 在线高度上的效果表现基本一致\n  if (\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    // mapbox\n    // 保持高度相对不变\n    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);\n    h *= mapboxZoomScale;\n    h += u_raisingHeight * mapboxZoomScale;\n    if (u_heightfixed > 0.0) {\n      lineHeight *= mapboxZoomScale;\n    }\n  }\n\n  gl_Position = project_common_position_to_clipspace(\n    vec4(project_pos.xy + offset, lineHeight + h, 1.0)\n  );\n\n  setPickingColor(a_PickingColor);\n}\n',type:""}}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:S.AttributeType.Attribute,descriptor:{name:"a_DistanceAndIndexAndMiter",shaderLocation:this.attributeLocation.DISTANCE_INDEX,buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:3,update:function(e,t,n,r,i,o){return void 0===o?[n[3],10,n[4]]:[n[3],o,n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal_total_distance",type:S.AttributeType.Attribute,descriptor:{name:"a_Normal_Total_Distance",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:S.gl.STATIC_DRAW,data:[],type:S.gl.FLOAT},size:4,update:function(e,t,n,r,o){return[].concat(i()(o),[n[5]])}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:this.attributeLocation.UV,buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.texture]||{x:0,y:0};return[n.x,n.y]}}})}}]),o}(R.Z)},7431:function(e,t,n){"use strict";n.d(t,{Z:function(){return R}});var r=n(6502),i=n.n(r),o=n(4351),a=n.n(o),s=n(8025),u=n.n(s),l=n(1133),c=n.n(l),f=n(1119),h=n.n(f),p=n(3491),d=n.n(p),v=n(2060),g=n.n(v),m=n(3769),y=n.n(m),_=n(6677),b=n(4450),x=n.n(b),E=n(7193),T=n(8407),A=n(8222),S=function(e){d()(o,e);var t,n,r=g()(o);function o(){return u()(this,o),r.apply(this,arguments)}return c()(o,[{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),x()(x()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.color,i=void 0===r?"#000":r,o={u_color:(0,E.CI)(i),u_opacity:n||1};return this.getUniformsBufferInfo(o)}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"mask",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_color;\n  float u_opacity;\n};\n\n#pragma include "projection"\n\nvoid main() {\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\n\n',fragmentShader:"layout(std140) uniform commonUniorm {\n  vec4 u_color;\n  float u_opacity;\n};\n\nout vec4 outputColor;\n\nvoid main() {\n  outputColor = u_color;\n  outputColor.a *= u_opacity;\n}\n",defines:this.getDefines(),triangulation:A.Qr,depth:{enable:!1},pick:!1});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),o}(T.Z),C={fill:S},R=function(e){d()(r,e);var t,n=g()(r);function r(){var e;u()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),y()(h()(e),"type","MaskLayer"),e}return c()(r,[{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new C[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getModelType",value:function(){return"fill"}}]),r}(_.Z)},428:function(e,t,n){"use strict";n.d(t,{Z:function(){return Q}});var r=n(2729),i=n.n(r),o=n(6502),a=n.n(o),s=n(4351),u=n.n(s),l=n(8025),c=n.n(l),f=n(1133),h=n.n(f),p=n(1119),d=n.n(p),v=n(3491),g=n.n(v),m=n(2060),y=n.n(m),_=n(3769),b=n.n(_),x=n(6677),E=n(6413),T=n.n(E),A=n(5757),S=n.n(A),C=n(2786),R=n.n(C),w=n(7033),M=n(8407),k=n(7193);function L(e){var t=e.coordinates;return{vertices:R()(t),indices:[0],size:t.length}}var O=function(e){g()(i,e);var t,n,r=y()(i);function i(){return c()(this,i),r.apply(this,arguments)}return h()(i,[{key:"attributeLocation",get:function(){return Object.assign(T()(S()(i.prototype),"attributeLocation",this),{MAX:T()(S()(i.prototype),"attributeLocation",this).MAX,SIZE:9})}},{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.blend,n=e.strokeOpacity,r=void 0===n?1:n,i=e.strokeWidth,o=void 0===i?0:i,a=e.stroke,s=void 0===a?"#fff":a,u={u_stroke_color:(0,k.CI)(s),u_additive:"additive"===t?1:0,u_stroke_opacity:r,u_stroke_width:o};return this.getUniformsBufferInfo(u)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=L,this.initUniformsBuffer(),e.next=4,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:'\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\n\nlayout(std140) uniform commonUniorm {\n  vec4 u_stroke_color;\n  float u_additive;\n  float u_stroke_opacity;\n  float u_stroke_width;\n};\n\nout vec4 v_color;\nout float v_blur;\nout float v_innerRadius;\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  v_blur = 1.0 - max(2.0 / a_Size, 0.05);\n  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);\n\n  vec2 offset = project_pixel(u_offsets);\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\n  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nlayout(std140) uniform commonUniorm {\n  vec4 u_stroke_color;\n  float u_additive;\n  float u_stroke_opacity;\n  float u_stroke_width;\n};\n\nin vec4 v_color;\nin float v_blur;\nin float v_innerRadius;\n\nout vec4 outputColor;\n\n#pragma include "picking"\nvoid main() {\n  vec2 center = vec2(0.5);\n\n  // Tip: 片元到中心点的距离 0 - 1\n  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;\n  // Tip: 片元的剪切成圆形\n  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);\n\n\n  if(v_innerRadius < 0.99) {\n    // 当存在 stroke 且 stroke > 0.01\n    float blurWidth = (1.0 - v_blur)/2.0;\n    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);\n    if(fragmengTocenter > v_innerRadius + blurWidth) {\n      outputColor = stroke;\n    } else if(fragmengTocenter > v_innerRadius - blurWidth){\n      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);\n      outputColor = mix(v_color, stroke, mixR);\n    } else {\n      outputColor = v_color;\n    }\n  } else {\n    // 当不存在 stroke 或 stroke <= 0.01\n    outputColor = v_color;\n  }\n\n  outputColor = filterColor(outputColor);\n  \n  if(u_additive > 0.0) {\n    outputColor *= circleClipOpacity;\n  } else {\n    outputColor.a *= circleClipOpacity;\n  }\n\n}\n',defines:this.getDefines(),inject:this.getInject(),triangulation:L,depth:{enable:!1},primitive:w.gl.POINTS});case 4:return t=e.sent,e.abrupt("return",[t]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),i}(M.Z),I=n(8222),P=n(7967),N=k.rU.isNumber,B=function(e){g()(i,e);var t,n,r=y()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),b()(d()(e),"raiseCount",0),b()(d()(e),"raiseRepeat",0),e}return h()(i,[{key:"attributeLocation",get:function(){return Object.assign(T()(S()(i.prototype),"attributeLocation",this),{MAX:T()(S()(i.prototype),"attributeLocation",this).MAX,SIZE:9,POS:10,NORMAL:11})}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=void 0===t?{enable:!1,speed:.01,repeat:!1}:t,r=e.opacity,i=void 0===r?1:r,o=e.sourceColor,a=e.targetColor,s=e.pickLight,u=void 0!==s&&s,l=e.heightfixed,c=void 0===l||l,f=e.opacityLinear,h=void 0===f?{enable:!1,dir:"up"}:f,p=e.lightEnable,d=void 0===p||p,v=0,g=[0,0,0,0],m=[0,0,0,0];if(o&&a&&(g=(0,k.CI)(o),m=(0,k.CI)(a),v=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var y=n.speed,_=void 0===y?.01:y;this.raiseCount+=_,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var b={u_sourceColor:g,u_targetColor:m,u_linearColor:v,u_pickLight:Number(u),u_heightfixed:Number(c),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:N(i)?i:1,u_opacitylinear:Number(h.enable),u_opacitylinear_dir:"up"===h.dir?1:0,u_lightEnable:Number(d)};return this.getUniformsBufferInfo(b)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t,n,r,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.animateOption.repeat,r=void 0===n?1:n,this.raiseRepeat=r,e.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:'precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in vec3 a_Size;\nlayout(location = ATTRIBUTE_LOCATION_POS) in vec3 a_Pos;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\n\nlayout(std140) uniform commonUniform {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor: 0;\n  float u_heightfixed: 0.0; // 默认不固定\n  float u_globel;\n  float u_r;\n  float u_pickLight: 0.0;\n  float u_opacitylinear: 0.0;\n  float u_opacitylinear_dir: 1.0;\n  float u_lightEnable: 1.0;\n};\n\nout vec4 v_color;\nout float v_lightWeight;\nout float v_barLinearZ;\n// 用于将在顶点着色器中计算好的样式值传递给片元\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) +\n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n  // cal style mapping - 数据纹理映射部分的计算\n  vec3 size = a_Size * a_Position;\n\n  // a_Position.z 是在构建网格的时候传入的标准值 0 - 1，在插值器插值可以获取 0～1 线性渐变的值\n  v_barLinearZ =  a_Position.z;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n  if(u_heightfixed < 1.0) { // 圆柱体不固定高度\n    //\n  } else {// 圆柱体固定高度 （ 处理 mapbox ）\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // 圆柱光照效果\n  float lightWeight = 1.0;\n  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n  v_lightWeight = lightWeight;\n  // 设置圆柱的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    v_color = mix(u_sourceColor, u_targetColor, v_barLinearZ);\n    v_color.rgb *= lightWeight;\n  } else { // 使用 color 方法传入的颜色\n     v_color = a_Color;\n  }\n  v_color.a *= u_opacity;\n\n\n  // 在地球模式下，将原本垂直于 xy 平面的圆柱调整姿态到适应圆的角度\n  //旋转矩阵mx，创建绕x轴旋转矩阵\n  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);\n  float xRadian = getXRadian(a_Pos.y, r);\n  float xcos = cos(xRadian);//求解旋转角度余弦值\n  float xsin = sin(xRadian);//求解旋转角度正弦值\n  mat4 mx = mat4(\n    1,0,0,0,\n    0,xcos,-xsin,0,\n    0,xsin,xcos,0,\n    0,0,0,1);\n\n  //旋转矩阵my，创建绕y轴旋转矩阵\n  float yRadian = getYRadian(a_Pos.x, a_Pos.z);\n  float ycos = cos(yRadian);//求解旋转角度余弦值\n  float ysin = sin(yRadian);//求解旋转角度正弦值\n  mat4 my = mat4(\n    ycos,0,-ysin,0,\n    0,1,0,0,\n    ysin,0,ycos,0,\n    0,0,0,1);\n\n  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);\n\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'precision highp float;\nin vec4 v_color;\n\n#pragma include "picking"\n\nlayout(std140) uniform commonUniform {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor: 0;\n  float u_heightfixed: 0.0; // 默认不固定\n  float u_globel;\n  float u_r;\n  float u_pickLight: 0.0;\n  float u_opacitylinear: 0.0;\n  float u_opacitylinear_dir: 1.0;\n  float u_lightEnable: 1.0;\n};\nin float v_lightWeight;\nin float v_barLinearZ;\nout vec4 outputColor;\nvoid main() {\n\n   outputColor = v_color;\n\n  // 开启透明度渐变\n  if(u_opacitylinear > 0.0) {\n    outputColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;\n  }\n\n  // picking\n  if(u_pickLight > 0.0) {\n    outputColor = filterColorAlpha(outputColor, v_lightWeight);\n  } else {\n    outputColor = filterColor(outputColor);\n  }\n}\n',triangulation:I.NM,depth:{enable:!0},defines:this.getDefines(),inject:this.getInject(),cull:{enable:!0,face:w.gl.FRONT},blend:this.getBlend()});case 4:return i=e.sent,e.abrupt("return",[i]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(e){var t=e.size;if(t){var n=[];return Array.isArray(t)&&(n=2===t.length?[t[0],t[0],t[1]]:t),Array.isArray(t)||(n=[t,t,t]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:w.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:w.gl.STATIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:w.AttributeType.Attribute,descriptor:{name:"a_Pos",shaderLocation:this.attributeLocation.POS,buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(e){var t=(0,k.SI)(e.coordinates);return(0,P.rq)([t[0],t[1]])}}})}}]),i}(M.Z),D=n(3420),U=n.n(D),F=n(3188),z=n(7703),G=function(e){g()(i,e);var t,n,r=y()(i);function i(){return c()(this,i),r.apply(this,arguments)}return h()(i,[{key:"attributeLocation",get:function(){return Object.assign(T()(S()(i.prototype),"attributeLocation",this),{MAX:T()(S()(i.prototype),"attributeLocation",this).MAX,SIZE:9,SHAPE:10,EXTRUDE:11})}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.strokeOpacity,n=void 0===t?1:t,r=e.strokeWidth,i=void 0===r?0:r,o=e.blend,a=e.blur,s=void 0===a?0:a;this.layer.getLayerConfig();var u={u_additive:"additive"===o?1:0,u_stroke_opacity:n,u_stroke_width:i,u_blur:s};return this.getUniformsBufferInfo(u)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=I.S,e.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_SHAPE) in float a_Shape;\nlayout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;\n\nlayout(std140) uniform commonUniform {\n  float u_additive;\n  float u_stroke_opacity : 1;\n  float u_stroke_width : 2;\n  float u_blur : 0.0;\n};\nout vec4 v_data;\nout vec4 v_color;\nout float v_radius;\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize 设置拾取大小\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n  // radius(16-bit)\n  v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);\n\n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + vec3(u_offsets,0.0), 1.0);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:"in vec4 v_data;\nin vec4 v_color;\nin float v_radius;\n\nlayout(std140) uniform commonUniform {\n  float u_additive;\n  float u_stroke_opacity : 1;\n  float u_stroke_width : 2;\n  float u_blur : 0.0;\n};\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\nout vec4 outputColor;\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n  vec4 strokeColor = u_stroke == vec4(0.0) ? v_color : u_stroke;\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + u_stroke_width);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  if(outer_df > antialiasblur + 0.018) discard;\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(u_stroke_width < 0.01) {\n    outputColor = vec4(v_color.rgb, v_color.a * u_opacity);\n  } else {\n    outputColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    outputColor *= opacity_t;\n    outputColor = filterColorAlpha(outputColor, outputColor.a);\n  } else {\n    outputColor.a *= opacity_t;\n    outputColor = filterColor(outputColor);\n  }\n}\n",triangulation:I.S,defines:this.getDefines(),inject:this.getInject(),depth:{enable:!0},blend:this.getBlend()});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:w.AttributeType.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(e,t,n,r){var i=U()(n,3),o=i[0],a=i[1],s=i[2],u=F.fromValues(0,0,1),l=F.fromValues(o,0,s),c=o>=0?F.angle(u,l):2*Math.PI-F.angle(u,l),f=2*Math.PI-Math.asin(a/100),h=z.create();z.rotateY(h,h,c),z.rotateX(h,h,f);var p=F.fromValues(1,1,0);F.transformMat4(p,p,h),F.normalize(p,p);var d=F.fromValues(-1,1,0);F.transformMat4(d,d,h),F.normalize(d,d);var v=F.fromValues(-1,-1,0);F.transformMat4(v,v,h),F.normalize(v,v);var g=F.fromValues(1,-1,0);F.transformMat4(g,g,h),F.normalize(g,g);var m=[].concat(R()(p),R()(d),R()(v),R()(g)),y=r%4*3;return[m[y],m[y+1],m[y+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:w.AttributeType.Attribute,descriptor:{name:"a_Shape",shaderLocation:this.attributeLocation.SHAPE,buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(t){var n=t.shape,r=void 0===n?2:n;return[e.layer.getLayerConfig().shape2d.indexOf(r)]}}})}}]),i}(M.Z),V=n(646),j=n(9110),H=n(4659),W=function(e){g()(i,e);var t,n,r=y()(i);function i(){var e;c()(this,i);for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return e=r.call.apply(r,[this].concat(n)),b()(d()(e),"meter2coord",1),b()(d()(e),"texture",void 0),b()(d()(e),"isMeter",!1),b()(d()(e),"radian",0),b()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void e.layerService.throttleRenderLayers();e.texture=t({data:e.iconService.getCanvas(),mag:w.gl.LINEAR,min:w.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128,mipmap:!0}),e.textures=[e.texture]})),e}return h()(i,[{key:"attributeLocation",get:function(){return Object.assign(T()(S()(i.prototype),"attributeLocation",this),{MAX:T()(S()(i.prototype),"attributeLocation",this).MAX,SIZE:9,EXTRUDE:10,UV:11})}},{key:"getCommonUniformsInfo",value:function(){var e,t=this.layer.getLayerConfig(),n=t.raisingHeight,r=void 0===n?0:n,i=t.heightfixed,o=void 0!==i&&i,a=t.unit,s=void 0===a?"pixel":a;this.rendererService.getDirty()&&(null===(e=this.texture)||void 0===e||e.bind());var u={u_textSize:[1024,this.iconService.canvasHeight||128],u_heightfixed:Number(o),u_raisingHeight:Number(r),u_size_unit:H.xg[s]};return this.getUniformsBufferInfo(u)}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),I.oX)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniform {\n  vec2 u_textSize;\n  float u_heightfixed;\n  float u_raisingHeight;\n  float u_size_unit;\n};\n\nout vec2 v_uv;\nout vec2 v_Iconuv;\nout float v_opacity;\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "rotation_2d"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  v_uv = (a_Extrude.xy + 1.0) / 2.0;\n  v_uv.y = 1.0 - v_uv.y;\n  v_Iconuv = a_Uv;\n  v_opacity = opacity;\n  float newSize = a_Size;\n  if (u_size_unit == 1.0) {\n    newSize = newSize * u_PixelsPerMeter.z;\n  }\n\n  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);\n  vec2 offset = extrude.xy * newSize + offsets;\n\n  offset = rotate_matrix(offset, rotation);\n\n  offset = project_pixel(offset);\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'in vec2 v_uv;// 本身的 uv 坐标\nin vec2 v_Iconuv;\nin float v_opacity;\nout vec4 outputColor;\n\nuniform sampler2D u_texture;\nlayout(std140) uniform commonUniform {\n  vec2 u_textSize;\n  float u_heightfixed: 0.0;\n  float u_raisingHeight: 0.0;\n  float u_size_unit;\n};\n\n#pragma include "scene_uniforms"\n#pragma include "sdf_2d"\n#pragma include "picking"\n\nvoid main() {\n  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;\n  outputColor = texture(SAMPLER_2D(u_texture), pos);\n  outputColor.a *= v_opacity;\n  outputColor = filterColor(outputColor);\n}\n',triangulation:I.oX,depth:{enable:!1},defines:this.getDefines(),inject:this.getInject(),cull:{enable:!0,face:w.gl.FRONT}});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e;this.iconService.off("imageUpdate",this.updateTexture),null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this;this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:w.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.shape]||{x:-64,y:-64};return[n.x,n.y]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:w.AttributeType.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),i}(M.Z),X=n(2686),Z=n(553),Y=function(e){g()(i,e);var t,n,r=y()(i);function i(){return c()(this,i),r.apply(this,arguments)}return h()(i,[{key:"attributeLocation",get:function(){return Object.assign(T()(S()(i.prototype),"attributeLocation",this),{MAX:T()(S()(i.prototype),"attributeLocation",this).MAX,SIZE:9,EXTRUDE:10})}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.blend,n=e.speed,r=void 0===n?1:n,i=e.unit,o=void 0===i?"pixel":i,a={u_additive:"additive"===t?1:0,u_size_unit:H.xg[o],u_speed:r,u_time:this.layer.getLayerAnimateTime()};return this.getUniformsBufferInfo(a)}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),I.oX)}},{key:"initModels",value:(n=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;\n\nlayout(std140) uniform commonUniorm {\n  float u_additive;\n  float u_size_unit;\n  float u_speed: 1.0;\n  float u_time;\n};\n\nout vec4 v_data;\nout vec4 v_color;\nout float v_radius;\nout vec2 v_extrude;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  float newSize = setPickingSize(a_Size);\n\n  float time = u_time * u_speed;\n  mat2 rotateMatrix = mat2(\n    cos(time), sin(time),\n    -sin(time), cos(time)\n  );\n  v_extrude = rotateMatrix * a_Extrude.xy;\n\n  v_color = a_Color;\n  v_color.a *= opacity;\n\n  float blur = 0.0;\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);\n\n  if(u_size_unit == 1.) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n  v_radius = newSize;\n\n  vec2 offset = (a_Extrude.xy * (newSize));\n\n  offset = project_pixel(offset);\n\n  v_data = vec4(a_Extrude.x, a_Extrude.y, antialiasblur, -1.0);\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nlayout(std140) uniform commonUniorm{\n  float u_additive;\n  float u_size_unit;\n  float u_speed: 1.0;\n  float u_time;\n};\nin vec4 v_data;\nin vec4 v_color;\nin float v_radius;\nin vec2 v_extrude;\n#pragma include "sdf_2d"\n#pragma include "picking"\n\nout vec4 outputColor;\n\nvoid main() {\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df = sdCircle(v_data.xy, 1.0);\n  float inner_df = sdCircle(v_data.xy, r);\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  outputColor = vec4(v_color.rgb, v_color.a);\n\n  if(u_additive > 0.0) {\n    outputColor *= opacity_t;\n  } else {\n    outputColor.a *= opacity_t;\n  }\n\n  if(outputColor.a > 0.0) {\n    outputColor = filterColor(outputColor);\n  }\n\n  vec2 extrude =  v_extrude;\n  vec2 dir = normalize(extrude);\n  vec2 baseDir = vec2(1.0, 0.0);\n  float pi = 3.14159265359;\n  float flag = sign(dir.y);\n  float rades = dot(dir, baseDir);\n  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;\n  // simple AA\n  if(radar_v > 0.99) {\n    radar_v = 1.0 - (radar_v - 0.99)/0.01;\n  }\n\n  outputColor.a *= radar_v;\n}\n',triangulation:I.oX,defines:this.getDefines(),inject:this.getInject(),depth:{enable:!1}});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:w.AttributeType.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:w.AttributeType.Attribute,descriptor:{shaderLocation:this.attributeLocation.SIZE,name:"a_Size",buffer:{usage:w.gl.DYNAMIC_DRAW,data:[],type:w.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),i}(M.Z),q=n(6088),K={fillImage:W,fill:j.Z,radar:Y,image:X.Z,normal:Z.Z,simplePoint:O,extrude:V.Z,text:q.Z,earthFill:G,earthExtrude:B},Q=function(e){g()(o,e);var t,n,r=y()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),b()(d()(e),"type","PointLayer"),b()(d()(e),"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),b()(d()(e),"enableDataEncodeStyles",["textOffset","textAnchor"]),b()(d()(e),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),e}return h()(o,[{key:"buildModels",value:(n=u()(a()().mark((function e(){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new K[t](this),e.next=5,this.initLayerModels();case 5:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"rebuildModels",value:(t=u()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.buildModels();case 2:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var e=this.shapeOption,t=e.field,n=e.values,r=this.getLayerConfig().shape2d,o=this.iconService.getIconMap();if(t&&-1!==(null==r?void 0:r.indexOf(t)))return"fill";if("text"===n)return"text";if(n&&n instanceof Array){var a,s=i()(n);try{for(s.s();!(a=s.n()).done;){var u=a.value;if("string"==typeof u&&o.hasOwnProperty(u))return"image"}}catch(e){s.e(e)}finally{s.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){return{fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}}[this.getModelType()]}},{key:"getModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=t.billboard,o=void 0===i||i,a=this.iconService.getIconMap(),s=e.find((function(e){return e.hasOwnProperty("shape")}));if(s){var u=s.shape;return"dot"===u?"normal":"simple"===u?"simplePoint":"radar"===u?"radar":"fillImage"===this.layerType||!1===o?"fillImage":-1!==(null==n?void 0:n.indexOf(u))?"GLOBEL"===this.mapService.version?"earthFill":"fill":-1!==(null==r?void 0:r.indexOf(u))?"GLOBEL"===this.mapService.version?"earthExtrude":"extrude":a.hasOwnProperty(u)?"image":"text"}return this.getModelTypeWillEmptyData()}}]),o}(x.Z)},646:function(e,t,n){"use strict";n.d(t,{Z:function(){return R}});var r=n(6502),i=n.n(r),o=n(4351),a=n.n(o),s=n(8025),u=n.n(s),l=n(1133),c=n.n(l),f=n(1119),h=n.n(f),p=n(6413),d=n.n(p),v=n(5757),g=n.n(v),m=n(3491),y=n.n(m),_=n(2060),b=n.n(_),x=n(3769),E=n.n(x),T=n(7033),A=n(7193),S=n(8407),C=n(8222),R=function(e){y()(o,e);var t,n,r=b()(o);function o(){var e;u()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),E()(h()(e),"raiseCount",0),E()(h()(e),"raiseRepeat",0),e}return c()(o,[{key:"attributeLocation",get:function(){return Object.assign(d()(g()(o.prototype),"attributeLocation",this),{MAX:d()(g()(o.prototype),"attributeLocation",this).MAX,SIZE:9,EXTRUDE:10,NORMAL:11})}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.animateOption,n=void 0===t?{enable:!1,speed:.01,repeat:!1}:t,r=e.sourceColor,i=e.targetColor,o=e.pickLight,a=void 0!==o&&o,s=e.heightfixed,u=void 0!==s&&s,l=e.opacityLinear,c=void 0===l?{enable:!1,dir:"up"}:l,f=e.lightEnable,h=void 0===f||f,p=0,d=[0,0,0,0],v=[0,0,0,0];if(r&&i&&(d=(0,A.CI)(r),v=(0,A.CI)(i),p=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var g=n.speed,m=void 0===g?.01:g;this.raiseCount+=m,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var y={u_pickLight:Number(a),u_heightfixed:Number(u),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:p,u_sourceColor:d,u_targetColor:v,u_opacitylinear:Number(c.enable),u_opacitylinear_dir:"up"===c.dir?1:0,u_lightEnable:Number(h)};return this.getUniformsBufferInfo(y)}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t,n,r,o,a,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.depth,r=void 0===n||n,o=t.animateOption.repeat,a=void 0===o?1:o,this.raiseRepeat=a,this.initUniformsBuffer(),e.next=5,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:'#define pi (3.1415926535)\n\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in vec3 a_Size;\nlayout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec4 a_Extrude;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\n\nlayout(std140) uniform commonUniforms {\n  float u_pickLight;\n  float u_heightfixed;\n  float u_r;\n  float u_linearColor;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_opacitylinear;\n  float u_opacitylinear_dir;\n  float u_lightEnable;\n};\nout vec4 v_color;\nout float v_lightWeight;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if (x > 0.0 && z > 0.0) {\n    return atan(x / z);\n  } else if (x > 0.0 && z <= 0.0) {\n    return atan(-z / x) + pi / 2.0;\n  } else if (x <= 0.0 && z <= 0.0) {\n    return pi + atan(x / z); //atan(x/z) +\n  } else {\n    return atan(z / -x) + pi * 3.0 / 2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y / r);\n}\n\nvoid main() {\n  vec3 size = a_Size * a_Position;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n\n  if (u_heightfixed < 1.0) {\n    // 圆柱体不固定高度\n  } else {\n    // 圆柱体固定高度 （ 处理 mapbox ）\n    if (\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    ) {\n      offset *= 4.0 / pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n  vec2 positions = a_Extrude.xy;\n  vec2 positions64Low = a_Extrude.zw;\n  vec4 project_pos = project_position(vec4(positions, 0.0, 1.0), positions64Low);\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // // 圆柱光照效果\n  float lightWeight = 1.0;\n\n  if (u_lightEnable > 0.0) {\n    // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n\n  v_lightWeight = lightWeight;\n\n  v_color = a_Color;\n\n  // 设置圆柱的底色\n  if (u_linearColor == 1.0) {\n    // 使用渐变颜色\n    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);\n    v_color.a = v_color.a * opacity;\n  } else {\n    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);\n  }\n\n  if (u_opacitylinear > 0.0) {\n    v_color.a *= u_opacitylinear_dir > 0.0 ? 1.0 - a_Position.z : a_Position.z;\n  }\n\n  gl_Position = project_common_position_to_clipspace(pos);\n\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'\nin vec4 v_color;\nin float v_lightWeight;\nout vec4 outputColor;\n\nlayout(std140) uniform commonUniforms {\n  float u_pickLight;\n  float u_heightfixed;\n  float u_r;\n  float u_linearColor;\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_opacitylinear;\n  float u_opacitylinear_dir;\n  float u_lightEnable;\n};\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nvoid main() {\n\n  outputColor = v_color;\n  // 开启透明度渐变\n  // picking\n  if(u_pickLight > 0.0) {\n    outputColor = filterColorAlpha(outputColor, v_lightWeight);\n  } else {\n    outputColor = filterColor(outputColor);\n  }\n}\n',triangulation:C.NM,defines:this.getDefines(),inject:this.getInject(),cull:{enable:!0,face:T.gl.FRONT},depth:{enable:r}});case 5:return s=e.sent,e.abrupt("return",[s]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:T.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:T.gl.DYNAMIC_DRAW,data:[],type:T.gl.FLOAT},size:3,update:function(e){var t=e.size;if(t){var n=[];return Array.isArray(t)&&(n=2===t.length?[t[0],t[0],t[1]]:t),Array.isArray(t)||(n=[t,t,t]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:T.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:T.gl.STATIC_DRAW,data:[],type:T.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:T.AttributeType.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:T.gl.DYNAMIC_DRAW,data:[],type:T.gl.FLOAT},size:4,update:function(e){var t=(0,A.SI)(e.coordinates);return[t[0],t[1],(0,A.Ks)(t[0]),(0,A.Ks)(t[1])]}}})}}]),o}(S.Z)},9110:function(e,t,n){"use strict";n.d(t,{Z:function(){return T}});var r=n(6502),i=n.n(r),o=n(4351),a=n.n(o),s=n(8025),u=n.n(s),l=n(1133),c=n.n(l),f=n(6413),h=n.n(f),p=n(5757),d=n.n(p),v=n(3491),g=n.n(v),m=n(2060),y=n.n(m),_=n(7033),b=n(8407),x=n(8222),E=n(4659),T=function(e){g()(o,e);var t,n,r=y()(o);function o(){return u()(this,o),r.apply(this,arguments)}return c()(o,[{key:"attributeLocation",get:function(){return Object.assign(h()(d()(o.prototype),"attributeLocation",this),{MAX:h()(d()(o.prototype),"attributeLocation",this).MAX,SIZE:9,SHAPE:10,EXTRUDE:11})}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.strokeOpacity,n=void 0===t?1:t,r=e.strokeWidth,i=void 0===r?0:r,o=e.blend,a=e.blur,s=void 0===a?0:a,u=e.raisingHeight,l=void 0===u?0:u,c=e.heightfixed,f=void 0!==c&&c,h=e.unit,p=void 0===h?"pixel":h,d=this.getAnimateUniforms().u_time;isNaN(d)&&(d=-1);var v={u_blur_height_fixed:[s,Number(l),Number(f)],u_stroke_width:i,u_additive:"additive"===o?1:0,u_stroke_opacity:n,u_size_unit:E.xg[p],u_time:d,u_animate:this.getAnimateUniforms().u_animate};return this.getUniformsBufferInfo(v)}},{key:"getAnimateUniforms",value:function(){var e=this.layer.getLayerConfig().animateOption,t=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(t),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),x.oX)}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t,n,r,o,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getShaders(),n=t.frag,r=t.vert,o=t.type,this.layer.triangulation=x.oX,this.initUniformsBuffer(),e.next=5,this.layer.buildLayerModel({moduleName:o,vertexShader:r,fragmentShader:n,defines:this.getDefines(),inject:this.getInject(),triangulation:x.oX,depth:{enable:!1}});case 5:return a=e.sent,e.abrupt("return",[a]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getShaders",value:function(){return{frag:"\nlayout(std140) uniform commonUniforms {\n  vec3 u_blur_height_fixed;\n  float u_stroke_width;\n  float u_additive;\n  float u_stroke_opacity;\n  float u_size_unit;\n  float u_time;\n  vec4 u_animate;\n};\n\nin vec4 v_color;\nin vec4 v_stroke;\nin vec4 v_data;\nin float v_radius;\n\n#pragma include \"scene_uniforms\"\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\nout vec4 outputColor;\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + u_stroke_width);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  float PI = 3.14159;\n  float N_RINGS = 3.0;\n  float FREQ = 1.0;\n\n  if(u_stroke_width < 0.01) {\n    outputColor = v_color;\n  } else {\n    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);\n  }\n  float intensity = 1.0;\n  if(u_time!=-1.0){\n    //wave相关逻辑\n    float d = length(v_data.xy);\n    if(d > 0.5) {\n      discard;\n    }\n    intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);\n  }\n\n  if(u_additive > 0.0) {\n    outputColor *= opacity_t;\n    outputColor *= intensity;//wave\n    outputColor = filterColorAlpha(outputColor, outputColor.a);\n  } else {\n    outputColor.a *= opacity_t;\n    outputColor.a *= intensity;//wave \n    outputColor = filterColor(outputColor);\n  }\n   // 作为 mask 模板时需要丢弃透明的像素\n  if(outputColor.a < 0.01) {\n    discard;\n  } \n}\n",vert:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_SHAPE) in float a_Shape;\nlayout(location = ATTRIBUTE_LOCATION_EXTRUDE) in vec3 a_Extrude;\n\nlayout(std140) uniform commonUniforms {\n  vec3 u_blur_height_fixed;\n  float u_stroke_width;\n  float u_additive;\n  float u_stroke_opacity;\n  float u_size_unit;\n  float u_time;\n  vec4 u_animate;\n};\n\nout vec4 v_color;\nout vec4 v_stroke;\nout vec4 v_data;\nout float v_radius;\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "rotation_2d"\n\nvoid main() {\n  // 透明度计算\n   v_stroke = stroke;\n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize 设置拾取大小\n  *  u_meter2coord 在等面积大小的时候设置单位\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n\n\n  // unpack color(vec2)\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  if(u_size_unit == 1.0) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n\n   v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);\n\n  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);\n\n  offset = project_pixel(offset);\n  offset = rotate_matrix(offset,rotation);\n\n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0), a_Position64Low);\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  float raisingHeight = u_blur_height_fixed.y;\n\n  if(u_blur_height_fixed.z < 1.0) { // false\n    raisingHeight = project_pixel(u_blur_height_fixed.y);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;\n    }\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',type:"pointFill"}}},{key:"animateOption2Array",value:function(e){return[e.enable?0:1,e.speed||1,e.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getLayerConfig().shape2d;this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:_.AttributeType.Attribute,descriptor:{name:"a_Extrude",shaderLocation:this.attributeLocation.EXTRUDE,buffer:{usage:_.gl.DYNAMIC_DRAW,data:[],type:_.gl.FLOAT},size:3,update:function(e,t,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:_.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:_.gl.DYNAMIC_DRAW,data:[],type:_.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:_.AttributeType.Attribute,descriptor:{name:"a_Shape",shaderLocation:this.attributeLocation.SHAPE,buffer:{usage:_.gl.DYNAMIC_DRAW,data:[],type:_.gl.FLOAT},size:1,update:function(t){var n=t.shape,r=void 0===n?2:n;return[e.indexOf(r)]}}})}}]),o}(b.Z)},2686:function(e,t,n){"use strict";n.d(t,{Z:function(){return w}});var r=n(6502),i=n.n(r),o=n(4351),a=n.n(o),s=n(4450),u=n.n(s),l=n(8025),c=n.n(l),f=n(1133),h=n.n(f),p=n(1119),d=n.n(p),v=n(6413),g=n.n(v),m=n(5757),y=n.n(m),_=n(3491),b=n.n(_),x=n(2060),E=n.n(x),T=n(3769),A=n.n(T),S=n(7033),C=n(8407),R=n(8222),w=function(e){b()(o,e);var t,n,r=E()(o);function o(){var e;c()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),A()(d()(e),"texture",void 0),A()(d()(e),"updateTexture",(function(){var t=e.rendererService.createTexture2D;if(e.texture)return e.texture.update({data:e.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void setTimeout((function(){e.layerService.throttleRenderLayers()}));e.texture=t({data:e.iconService.getCanvas(),mag:S.gl.LINEAR,min:S.gl.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:e.iconService.canvasHeight||128,mipmap:!0})})),e}return h()(o,[{key:"attributeLocation",get:function(){return Object.assign(g()(y()(o.prototype),"attributeLocation",this),{MAX:g()(y()(o.prototype),"attributeLocation",this).MAX,SIZE:9,UV:10})}},{key:"getUninforms",value:function(){var e;this.rendererService.getDirty()&&(null===(e=this.texture)||void 0===e||e.bind());var t=this.getCommonUniformsInfo(),n=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),u()(u()({},t.uniformsOption),n.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.raisingHeight,n=void 0===t?0:t,r=e.heightfixed,i=void 0!==r&&r,o={u_textSize:[1024,this.iconService.canvasHeight||128],u_raisingHeight:Number(n),u_heightfixed:Number(i),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(o)}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_textSize;\n  float u_raisingHeight;\n  float u_heightfixed;\n};\n\nout vec4 v_color;\nout vec2 v_uv;\nout float v_opacity;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  v_color = a_Color;\n  v_opacity = opacity;\n  v_uv = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\n\n  vec2 offset = project_pixel(offsets);\n\n  float raisingHeight = u_raisingHeight;\n  if (u_heightfixed < 1.0) {\n    // false\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n    if (\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    ) {\n      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',fragmentShader:'layout(std140) uniform commonUniforms {\n  vec2 u_textSize;\n  float u_raisingHeight;\n  float u_heightfixed;\n};\n\nuniform sampler2D u_texture;\n\nin vec4 v_color;\nin vec2 v_uv;\nin float v_opacity;\n\n#pragma include "picking"\n\nout vec4 outputColor;\n\nvoid main(){\n  vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\n  vec4 textureColor;\n\n  // Y = 0.299R + 0.587G + 0.114B // 亮度提取\n  \n  textureColor = texture(SAMPLER_2D(u_texture), pos);\n\n  // Tip: 去除边缘部分 mipmap 导致的混合变暗\n  float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);\n  if(fragmengTocenter >= 0.5) {\n        float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;\n        textureColor.a *= luma;\n  }\n  \n  if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\n        outputColor= textureColor;\n  }else {\n        outputColor= step(0.01, textureColor.z) * v_color;\n  }\n  outputColor.a *= v_opacity;\n  if (outputColor.a < 0.01) {\n      discard;\n  }\n  outputColor = filterColor(outputColor);\n}\n',triangulation:R.xH,defines:this.getDefines(),inject:this.getInject(),depth:{enable:!1},primitive:S.gl.POINTS});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){var e=this;this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:S.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?5:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:S.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:S.gl.DYNAMIC_DRAW,data:[],type:S.gl.FLOAT},size:2,update:function(t){var n=e.iconService.getIconMap()[t.shape]||{x:-64,y:-64};return[n.x,n.y]}}})}}]),o}(C.Z)},553:function(e,t,n){"use strict";n.d(t,{Z:function(){return A}});var r=n(6502),i=n.n(r),o=n(4351),a=n.n(o),s=n(8025),u=n.n(s),l=n(1133),c=n.n(l),f=n(6413),h=n.n(f),p=n(5757),d=n.n(p),v=n(3491),g=n.n(v),m=n(2060),y=n.n(m),_=n(2786),b=n.n(_),x=n(7033),E=n(8407);function T(e){var t=e.coordinates;return{vertices:b()(t),indices:[0],size:t.length}}var A=function(e){g()(o,e);var t,n,r=y()(o);function o(){return u()(this,o),r.apply(this,arguments)}return c()(o,[{key:"attributeLocation",get:function(){return Object.assign(h()(d()(o.prototype),"attributeLocation",this),{MAX:h()(d()(o.prototype),"attributeLocation",this).MAX,SIZE:9})}},{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getCommonUniformsInfo",value:function(){return this.getUniformsBufferInfo({u_size_scale:.5})}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.layer.triangulation=T,this.initUniformsBuffer(),e.next=4,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\n\nlayout(std140) uniform u_Common {\n  float u_size_scale;\n};\n\nout vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\n  gl_Position = project_common_position_to_clipspace(project_pos);\n\n  gl_PointSize = a_Size * u_size_scale * 2.0 * u_DevicePixelRatio;\n}\n',fragmentShader:"in vec4 v_color;\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n}",triangulation:T,defines:this.getDefines(),inject:this.getInject(),depth:{enable:!1},primitive:x.gl.POINTS,pick:!1});case 4:return t=e.sent,e.abrupt("return",[t]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"size",type:x.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:x.gl.DYNAMIC_DRAW,data:[],type:x.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?1:t;return Array.isArray(n)?[n[0]]:[n]}}})}}]),o}(E.Z)},6088:function(e,t,n){"use strict";n.d(t,{Z:function(){return W}});var r=n(2729),i=n.n(r),o=n(4450),a=n.n(o),s=n(6502),u=n.n(s),l=n(4351),c=n.n(l),f=n(8025),h=n.n(f),p=n(1133),d=n.n(p),v=n(1119),g=n.n(v),m=n(6413),y=n.n(m),_=n(5757),b=n.n(_),x=n(3491),E=n.n(x),T=n(2060),A=n.n(T),S=n(3769),C=n.n(S),R=n(2786),w=n.n(R),M=n(7033),k=n(7193),L=n(8407),O=n(8942),I=n(7703),P=function(){function e(t,n,r){h()(this,e),C()(this,"boxCells",[]),C()(this,"xCellCount",void 0),C()(this,"yCellCount",void 0),C()(this,"boxKeys",void 0),C()(this,"bboxes",void 0),C()(this,"width",void 0),C()(this,"height",void 0),C()(this,"xScale",void 0),C()(this,"yScale",void 0),C()(this,"boxUid",void 0);var i=this.boxCells;this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(n/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0}return d()(e,[{key:"insert",value:function(e,t,n,r,i){this.forEachCell(t,n,r,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}},{key:"query",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!1,i)}},{key:"hitTest",value:function(e,t,n,r,i){return this.queryHitTest(e,t,n,r,!0,i)}},{key:"insertBoxCell",value:function(e,t,n,r,i,o){this.boxCells[i].push(o)}},{key:"queryHitTest",value:function(e,t,n,r,i,o){if(n<0||e>this.width||r<0||t>this.height)return!i&&[];var a=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});return o?a.filter(o):a}var u={hitTest:i,seenUids:{box:{},circle:{}}};return this.forEachCell(e,t,n,r,this.queryCell,a,u,o),i?a.length>0:a}},{key:"queryCell",value:function(e,t,n,r,o,a,s,u){var l=s.seenUids,c=this.boxCells[o];if(null!==c){var f,h=this.bboxes,p=i()(c);try{for(p.s();!(f=p.n()).done;){var d=f.value;if(!l.box[d]){l.box[d]=!0;var v=4*d;if(e<=h[v+2]&&t<=h[v+3]&&n>=h[v+0]&&r>=h[v+1]&&(!u||u(this.boxKeys[d]))){if(s.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[d],x1:h[v],y1:h[v+1],x2:h[v+2],y2:h[v+3]})}}}}catch(e){p.e(e)}finally{p.f()}}return!1}},{key:"forEachCell",value:function(e,t,n,r,i,o,a,s){for(var u=this.convertToXCellCoord(e),l=this.convertToYCellCoord(t),c=this.convertToXCellCoord(n),f=this.convertToYCellCoord(r),h=u;h<=c;h++)for(var p=l;p<=f;p++){var d=this.xCellCount*p+h;if(i.call(this,e,t,n,r,d,o,a,s))return}}},{key:"convertToXCellCoord",value:function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}},{key:"convertToYCellCoord",value:function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}}]),e}(),N=function(){function e(t,n){h()(this,e),C()(this,"width",void 0),C()(this,"height",void 0),C()(this,"grid",void 0),C()(this,"viewportPadding",100),C()(this,"screenRightBoundary",void 0),C()(this,"screenBottomBoundary",void 0),C()(this,"gridRightBoundary",void 0),C()(this,"gridBottomBoundary",void 0),this.width=t,this.height=n,this.viewportPadding=Math.max(t,n),this.grid=new P(t+this.viewportPadding,n+this.viewportPadding,25),this.screenRightBoundary=t+this.viewportPadding,this.screenBottomBoundary=n+this.viewportPadding,this.gridRightBoundary=t+2*this.viewportPadding,this.gridBottomBoundary=n+2*this.viewportPadding}return d()(e,[{key:"placeCollisionBox",value:function(e){var t=e.x1+e.anchorPointX+this.viewportPadding,n=e.y1+e.anchorPointY+this.viewportPadding,r=e.x2+e.anchorPointX+this.viewportPadding,i=e.y2+e.anchorPointY+this.viewportPadding;return!this.isInsideGrid(t,n,r,i)||this.grid.hitTest(t,n,r,i)?{box:[]}:{box:[t,n,r,i]}}},{key:"insertCollisionBox",value:function(e,t){var n={featureIndex:t};this.grid.insert(n,e[0],e[1],e[2],e[3])}},{key:"project",value:function(e,t,n){var r=O.al(t,n,0,1),i=O.Ue(),o=I.fromValues.apply(I,w()(e));return O.fF(i,r,o),{x:(i[0]/i[3]+1)/2*this.width+this.viewportPadding,y:(-i[1]/i[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}}]),e}();function B(e){var t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0;break;default:t=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0;break;default:n=.5}return{horizontalAlign:t,verticalAlign:n}}function D(e,t,n,r,i){if(i){var o=e[r],a=o.glyph;if(a)for(var s=t[a].advance*o.scale,u=(e[r].x+s)*i,l=n;l<=r;l++)e[l].x-=u}}function U(e,t,n,r,o,a,s){var u,l=(t-n)*o,c=(-r*s+.5)*a,f=i()(e);try{for(f.s();!(u=f.n()).done;){var h=u.value;h.x+=l,h.y+=c}}catch(e){f.e(e)}finally{f.f()}}function F(e,t,n,r,i,o,a){var s=0,u=-8,l=0,c=e.positionedGlyphs,f="right"===o?1:"left"===o?0:.5,h=c.length;n.forEach((function(e){if(e.split("").forEach((function(e){var n=t[e];n&&(c.push({glyph:e,x:s,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a)})),c.length!==h){var n=s-a;l=Math.max(n,l),D(c,t,h,c.length-1,f)}s=0,u-=r+5}));var p=B(i),d=p.horizontalAlign,v=p.verticalAlign;U(c,f,d,v,l,r,n.length);var g=u- -8;e.top+=-v*g,e.bottom=e.top-g,e.left+=-d*l,e.right=e.left+l}function z(e,t,n,r,i,o,a){var s=0,u=-8,l=0,c=e.positionedGlyphs,f="right"===o?1:"left"===o?0:.5,h=c.length;n.forEach((function(e){var n=t[e];if(n&&(c.push({glyph:e,x:n.advance/2,y:u+0,vertical:!1,scale:1,metrics:n}),s+=n.advance+a),c.length!==h){var i=s-a;l=Math.max(i,l),D(c,t,h,c.length-1,f)}s=0,u-=r+5}));var p=B(i),d=p.horizontalAlign,v=p.verticalAlign;U(c,f,d,v,l,r,n.length);var g=u- -8;e.top+=-v*g,e.bottom=e.top-g,e.left+=-d*l,e.right=e.left+l}var G='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\n\nuniform sampler2D u_sdf_map;\nlayout(std140) uniform commonUniforms {\n  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n  vec2 u_sdf_map_size;\n  float u_raisingHeight: 0.0;\n  float u_stroke_width : 2;\n  float u_gamma_scale : 0.5;\n  float u_halo_blur : 0.5;\n};\n\nin vec2 v_uv;\nin float v_gamma_scale;\nin vec4 v_color;\nin vec4 v_stroke_color;\nin float v_fontScale;\n\nout vec4 outputColor;\n\n#pragma include "picking"\nvoid main() {\n  // get style data mapping\n\n  // get sdf from atlas\n  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;\n\n  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\n  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\n\n  highp float gamma_scaled = gamma * v_gamma_scale;\n\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));\n\n  outputColor.a *= alpha;\n   // 作为 mask 模板时需要丢弃透明的像素\n  if (outputColor.a < 0.01) {\n    discard;\n  }\n  outputColor = filterColor(outputColor);\n}\n',V='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\n\nlayout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_TEXT_OFFSETS) in vec2 a_textOffsets;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_tex;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n  vec2 u_sdf_map_size;\n  float u_raisingHeight: 0.0;\n  float u_stroke_width : 2;\n  float u_gamma_scale : 0.5;\n  float u_halo_blur : 0.5;\n};\n\nout vec2 v_uv;\nout float v_gamma_scale;\nout vec4 v_color;\nout vec4 v_stroke_color;\nout float v_fontScale;\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "rotation_2d"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_uv = a_tex / u_sdf_map_size;\n\n\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);\n\n  // 文本缩放比例\n  float fontScale = a_Size / FONT_SIZE;\n  v_fontScale = fontScale;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\n  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  vec2 offset = rotate_matrix(a_textOffsets,rotation);\n\n  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n\n  float raiseHeight = u_raisingHeight;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    raiseHeight = u_raisingHeight * mapboxZoomScale;\n  }\n\n  vec4 projected_position = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n\n  gl_Position = vec4(\n    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n  v_gamma_scale = gl_Position.w;\n  setPickingColor(a_PickingColor);\n\n}\n',j=k.rU.isEqual;function H(e){var t=this,n=e.id,r=[],i=[];if(!t.glyphInfoMap||!t.glyphInfoMap[n])return{vertices:[],indices:[],size:7};var o=t.glyphInfoMap[n].centroid,a=2===o.length?[o[0],o[1],0]:o;return t.glyphInfoMap[n].glyphQuads.forEach((function(e,t){r.push.apply(r,w()(a).concat([e.tex.x,e.tex.y+e.tex.height,e.tl.x,e.tl.y],w()(a),[e.tex.x+e.tex.width,e.tex.y+e.tex.height,e.tr.x,e.tr.y],w()(a),[e.tex.x+e.tex.width,e.tex.y,e.br.x,e.br.y],w()(a),[e.tex.x,e.tex.y,e.bl.x,e.bl.y])),i.push(0+4*t,1+4*t,2+4*t,2+4*t,3+4*t,0+4*t)})),{vertices:r,indices:i,size:7}}var W=function(e){E()(l,e);var t,n,r,o,s=A()(l);function l(){var e;h()(this,l);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=s.call.apply(s,[this].concat(n)),C()(g()(e),"glyphInfo",void 0),C()(g()(e),"glyphInfoMap",{}),C()(g()(e),"rawEncodeData",void 0),C()(g()(e),"texture",void 0),C()(g()(e),"currentZoom",-1),C()(g()(e),"extent",void 0),C()(g()(e),"textureHeight",0),C()(g()(e),"textCount",0),C()(g()(e),"preTextStyle",{}),C()(g()(e),"mapping",c()(u()().mark((function t(){return u()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.initGlyph(),e.updateTexture(),t.next=4,e.reBuildModel();case 4:case"end":return t.stop()}}),t)})))),e}return d()(l,[{key:"attributeLocation",get:function(){return Object.assign(y()(b()(l.prototype),"attributeLocation",this),{MAX:y()(b()(l.prototype),"attributeLocation",this).MAX,SIZE:9,TEXT_OFFSETS:10,UV:11})}},{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),a()(a()(a()({},e.uniformsOption),t.uniformsOption),{u_sdf_map:this.textures[0]})}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.stroke,n=void 0===t?"#fff":t,r=e.strokeWidth,i=void 0===r?0:r,o=e.halo,a=void 0===o?.5:o,s=e.gamma,u=void 0===s?2:s,l=e.raisingHeight,c=void 0===l?0:l,f=this.getFontServiceMapping(),h=this.getFontServiceCanvas();f&&Object.keys(f).length!==this.textCount&&h&&(this.updateTexture(),this.textCount=Object.keys(f).length),this.preTextStyle=this.getTextStyle();var p={u_stroke_color:(0,k.CI)(n),u_sdf_map_size:[(null==h?void 0:h.width)||1,(null==h?void 0:h.height)||1],u_raisingHeight:Number(c),u_stroke_width:i,u_gamma_scale:u,u_halo_blur:a};return this.getUniformsBufferInfo(p)}},{key:"initModels",value:(o=c()(u()().mark((function e(){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),this.initUniformsBuffer(),e.abrupt("return",this.buildModels());case 6:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"buildModels",value:(r=c()(u()().mark((function e(){var t,n,r,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.layer.getLayerConfig(),n=t.textAllowOverlap,r=void 0!==n&&n,this.initGlyph(),this.updateTexture(),r||this.filterGlyphs(),e.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:V,fragmentShader:G,defines:this.getDefines(),inject:this.getInject(),triangulation:H.bind(this),depth:{enable:!1}});case 6:return i=e.sent,e.abrupt("return",[i]);case 8:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"needUpdate",value:(n=c()(u()().mark((function e(){var t,n,r,i,o,a,s,l,c,f,h,p;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.getTextStyle(),n=t.textAllowOverlap,r=void 0!==n&&n,i=t.textAnchor,o=void 0===i?"center":i,a=t.textOffset,s=t.padding,l=t.fontFamily,c=t.fontWeight,j(s,this.preTextStyle.padding)&&j(a,this.preTextStyle.textOffset)&&j(o,this.preTextStyle.textAnchor)&&j(l,this.preTextStyle.fontFamily)&&j(c,this.preTextStyle.fontWeight)){e.next=5;break}return e.next=4,this.mapping();case 4:case 13:return e.abrupt("return",!0);case 5:if(!r){e.next=7;break}return e.abrupt("return",!1);case 7:if(f=this.mapService.getZoom(),h=this.mapService.getBounds(),p=(0,k.oO)(this.extent,h),!(Math.abs(this.currentZoom-f)>.5)&&p&&r===this.preTextStyle.textAllowOverlap){e.next=14;break}return e.next=13,this.reBuildModel();case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:M.AttributeType.Attribute,descriptor:{shaderLocation:this.attributeLocation.TEXT_OFFSETS,name:"a_textOffsets",buffer:{usage:M.gl.STATIC_DRAW,data:[],type:M.gl.FLOAT},size:2,update:function(e,t,n){return[n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:M.AttributeType.Attribute,descriptor:{name:"a_tex",shaderLocation:this.attributeLocation.UV,buffer:{usage:M.gl.DYNAMIC_DRAW,data:[],type:M.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:M.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:M.gl.DYNAMIC_DRAW,data:[],type:M.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?12:t;return Array.isArray(n)?[n[0]]:[n]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var e=this.mapService.getBounds();return(0,k.yA)(e,.5)}},{key:"initTextFont",value:function(){var e=this.getTextStyle(),t=e.fontWeight,n=e.fontFamily,r=this.rawEncodeData,o=[];r.forEach((function(e){var t=e.shape,n=void 0===t?"":t;n=n.toString();var r,a=i()(n);try{for(a.s();!(r=a.n()).done;){var s=r.value;-1===o.indexOf(s)&&o.push(s)}}catch(e){a.e(e)}finally{a.f()}})),this.fontService.setFontOptions({characterSet:o,fontWeight:t,fontFamily:n,iconfont:!1})}},{key:"initIconFontTex",value:function(){var e=this.getTextStyle(),t=e.fontWeight,n=e.fontFamily,r=this.rawEncodeData,i=[];r.forEach((function(e){var t=e.shape,n=void 0===t?"":t;n="".concat(n),-1===i.indexOf(n)&&i.push(n)})),this.fontService.setFontOptions({characterSet:i,fontWeight:t,fontFamily:n,iconfont:!0})}},{key:"getTextStyle",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r,o=e.textAllowOverlap,a=void 0!==o&&o,s=e.padding,u=void 0===s?[0,0]:s,l=e.textAnchor,c=void 0===l?"center":l,f=e.textOffset,h=void 0===f?[0,0]:f,p=e.opacity,d=void 0===p?1:p,v=e.strokeOpacity,g=void 0===v?1:v,m=e.strokeWidth,y=void 0===m?0:m,_=e.stroke;return{fontWeight:n,fontFamily:i,textAllowOverlap:a,padding:u,textAnchor:c,textOffset:h,opacity:d,strokeOpacity:g,strokeWidth:y,stroke:void 0===_?"#000":_}}},{key:"generateGlyphLayout",value:function(e){var t=this,n=this.getFontServiceMapping(),r=this.layer.getLayerConfig(),o=r.spacing,a=void 0===o?2:o,s=r.textAnchor,u=void 0===s?"center":s,l=r.textOffset,c=this.rawEncodeData;this.glyphInfo=c.map((function(r){var o=r.shape,s=void 0===o?"":o,c=r.id,f=r.size,h=void 0===f?1:f,p=r.textOffset?r.textOffset:l||[0,0],d=r.textAnchor?r.textAnchor:u||"center",v=function(e,t,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],s=arguments.length>7?arguments[7]:void 0,u=e.split("\n"),l=[],c={positionedGlyphs:l,top:a[1],bottom:a[1],left:a[0],right:a[0],lineCount:u.length,text:e};return s?z(c,t,u,n,r,i,o):F(c,t,u,n,r,i,o),!!l.length&&c}(s.toString(),n,h,d,"left",a,p,e),g=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,o=e.positionedGlyphs,a=void 0===o?[]:o,s=[],u=i()(a);try{for(u.s();!(t=u.n()).done;){var l=t.value,c=l.metrics,f=4,h=c.advance*l.scale/2,p=r?[l.x+h,l.y]:[0,0],d=r?[0,0]:[l.x+h+n[0],l.y+n[1]],v=(0-f)*l.scale-h+d[0],g=(0-f)*l.scale+d[1],m=v+c.width*l.scale,y=g+c.height*l.scale,_={x:v,y:g},b={x:m,y:g},x={x:v,y:y},E={x:m,y:y};s.push({tl:_,tr:b,bl:x,br:E,tex:c,glyphOffset:p})}}catch(e){u.e(e)}finally{u.f()}return s}(v,p,!1);return r.shaping=v,r.glyphQuads=g,r.centroid=(0,k.SI)(r.coordinates),t.glyphInfoMap[c]={shaping:v,glyphQuads:g,centroid:(0,k.SI)(r.coordinates)},r}))}},{key:"getFontServiceMapping",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r;return this.fontService.getMappingByKey("".concat(i,"_").concat(n))}},{key:"getFontServiceCanvas",value:function(){var e=this.layer.getLayerConfig(),t=e.fontWeight,n=void 0===t?"400":t,r=e.fontFamily,i=void 0===r?"sans-serif":r;return this.fontService.getCanvasByKey("".concat(i,"_").concat(n))}},{key:"filterGlyphs",value:function(){var e=this,t=this.layer.getLayerConfig(),n=t.padding,r=void 0===n?[0,0]:n,i=t.textAllowOverlap;if(!(void 0!==i&&i)){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var o=this.rendererService.getViewportSize(),a=o.width,s=o.height,u=new N(a,s);this.glyphInfo.filter((function(t){var n=t.shaping,i=t.id,o=void 0===i?0:i,a=t.centroid,s=t.size/16,l=e.mapService.lngLatToContainer(a),c=u.placeCollisionBox({x1:n.left*s-r[0],x2:n.right*s+r[0],y1:n.top*s-r[1],y2:n.bottom*s+r[1],anchorPointX:l.x,anchorPointY:l.y}).box;return!(!c||!c.length)&&(u.insertCollisionBox(c,o),!0)})).forEach((function(t){e.glyphInfoMap[t.id]=t}))}}},{key:"initGlyph",value:function(){var e=this.layer.getLayerConfig().iconfont,t=void 0!==e&&e;t?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(t)}},{key:"updateTexture",value:function(){var e=this.rendererService.createTexture2D,t=this.getFontServiceCanvas();this.textureHeight=t.height,this.texture&&this.texture.destroy(),this.texture=e({data:t,mag:M.gl.LINEAR,min:M.gl.LINEAR,width:t.width,height:t.height}),this.textures=[this.texture]}},{key:"reBuildModel",value:(t=c()(u()().mark((function e(){var t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.filterGlyphs(),e.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:V,fragmentShader:G,triangulation:H.bind(this),defines:this.getDefines(),inject:this.getInject(),depth:{enable:!1}});case 3:t=e.sent,this.layer.models=[t];case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),l}(L.Z)},6106:function(e,t,n){"use strict";n.d(t,{Z:function(){return X}});var r=n(6502),i=n.n(r),o=n(4351),a=n.n(o),s=n(8025),u=n.n(s),l=n(1133),c=n.n(l),f=n(1119),h=n.n(f),p=n(3491),d=n.n(p),v=n(2060),g=n.n(v),m=n(3769),y=n.n(m),_=n(6677),b=n(937),x=n(646),E=n(9110),T=n(2686),A=n(553),S=n(6088),C=n(4450),R=n.n(C),w=n(6413),M=n.n(w),k=n(5757),L=n.n(k),O=n(7033),I=n(7193),P=n(8407),N=n(8222);function B(e){return D.apply(this,arguments)}function D(){return(D=a()(i()().mark((function e(t){var n,r,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!window.createImageBitmap){e.next=14;break}return e.next=3,fetch(t);case 3:return n=e.sent,e.t0=createImageBitmap,e.next=7,n.blob();case 7:return e.t1=e.sent,e.next=10,(0,e.t0)(e.t1);case 10:return r=e.sent,e.abrupt("return",r);case 14:return o=new window.Image,e.abrupt("return",new Promise((function(e){o.onload=function(){return e(o)},o.src=t,o.crossOrigin="Anonymous"})));case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var U=function(e){d()(s,e);var t,n,r,o=g()(s);function s(){var e;u()(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=o.call.apply(o,[this].concat(n)),y()(h()(e),"texture",void 0),e}return c()(s,[{key:"attributeLocation",get:function(){return Object.assign(M()(L()(s.prototype),"attributeLocation",this),{MAX:M()(L()(s.prototype),"attributeLocation",this).MAX,SIZE:9,NORMAL:10,UV:11})}},{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),R()(R()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.mapTexture,n=e.heightfixed,r=void 0!==n&&n,i=e.raisingHeight,o=void 0===i?0:i,a=e.topsurface,s=void 0===a||a,u=e.sidesurface,l=void 0===u||u,c=e.sourceColor,f=e.targetColor,h=0,p=[1,1,1,1],d=[1,1,1,1];c&&f&&(p=(0,I.CI)(c),d=(0,I.CI)(f),h=1);var v={u_sourceColor:p,u_targetColor:d,u_linearColor:h,u_topsurface:Number(s),u_sidesurface:Number(l),u_heightfixed:Number(r),u_raisingHeight:Number(o)};return t&&this.texture&&(v.u_texture=this.texture,this.textures=[this.texture]),this.getUniformsBufferInfo(v)}},{key:"initModels",value:(r=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.loadTexture();case 2:return e.abrupt("return",this.buildModels());case 3:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"buildModels",value:(n=a()(i()().mark((function e(){var t,n,r,o,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getShaders(),n=t.frag,r=t.vert,o=t.type,this.initUniformsBuffer(),e.next=4,this.layer.buildLayerModel({moduleName:o,vertexShader:r,fragmentShader:n,depth:{enable:!0},defines:this.getDefines(),inject:this.getInject(),triangulation:N.Xz});case 4:return a=e.sent,e.abrupt("return",[a]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getShaders",value:function(){var e=this.layer.getLayerConfig(),t=e.pickLight;return e.mapTexture?{frag:'uniform sampler2D u_texture;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nin vec4 v_Color;\nin vec3 v_uvs;\nin vec2 v_texture_data;\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nout vec4 outputColor;\n\nvoid main() {\n  float opacity = u_opacity;\n  float isSide = v_texture_data.x;\n  float lightWeight = v_texture_data.y;\n  float topU = v_uvs[0];\n  float topV = 1.0 - v_uvs[1];\n  float sidey = v_uvs[2];\n\n  outputColor = texture(SAMPLER_2D(u_texture), vec2(topU, topV));\n  // Tip: 部分机型 GPU 计算精度兼容\n  if (isSide < 0.999) {// 是否是边缘\n    // side face\n    if (u_sidesurface < 1.0) {\n      discard;\n    }\n\n    if (u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      outputColor = linearColor;\n    } else {\n      outputColor = v_Color;\n    }\n  } else {\n     // top face\n    if (u_topsurface < 1.0) {\n      discard;\n    }\n  }\n  \n  outputColor.a *= opacity;\n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nout vec4 v_Color;\nout vec3 v_uvs;\nout vec2 v_texture_data;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos, a_Position64Low);\n  float lightWeight = calc_lighting(project_pos);\n  v_uvs = a_uvs;\n  v_Color = a_Color;\n  v_Color.a *= opacity;\n\n  v_texture_data = vec2(a_Position.z, lightWeight);\n\n  if (u_heightfixed > 0.0) {\n    // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if (\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    ) {\n      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudeTexture"}:t?{frag:'\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nin vec4 v_Color;\nin vec3 v_uvs;\nin vec2 v_texture_data;\nout vec4 outputColor;\n\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nvoid main() {\n  float isSide =  v_texture_data.x;\n  float sidey = v_uvs[2];\n  float lightWeight = v_texture_data.y;\n\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n    \n    if( u_linearColor == 1.0) {\n      // side use linear\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      outputColor = linearColor;\n    } else {\n      // side notuse linear\n       outputColor = v_Color;\n    }\n  } else {\n    // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n    outputColor = v_Color;\n  }\n\n  outputColor = filterColorAlpha(outputColor, lightWeight);\n}\n',vert:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nout vec4 v_Color;\nout vec3 v_uvs;\nout vec2 v_texture_data;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  v_uvs = a_uvs;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos, a_Position64Low);\n\n  if (u_heightfixed > 0.0) {\n    // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n    if (\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    ) {\n      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  float lightWeight = calc_lighting(project_pos);\n  v_texture_data = vec2(a_Position.z, lightWeight);\n\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrudePickLight"}:{frag:'layout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nin vec4 v_Color;\n#pragma include "scene_uniforms"\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    outputColor = v_Color;\n  \n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec3 a_uvs;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_sourceColor;\n  vec4 u_targetColor;\n  float u_linearColor;\n  float u_topsurface;\n  float u_sidesurface;\n  float u_heightfixed; // 默认不固定\n  float u_raisingHeight;\n};\n\nout vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  float isSide = a_Position.z;\n  float topU = a_uvs[0];\n  float topV = 1.0 - a_uvs[1];\n  float sidey = a_uvs[2];\n\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n\n  vec4 project_pos = project_position(pos, a_Position64Low);\n  float lightWeight = calc_lighting(project_pos);\n\n  if (u_heightfixed > 0.0) {\n    // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if (\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n      u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    ) {\n      float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  // Tip: 部分机型 GPU 计算精度兼容\n  if (isSide < 0.999) {\n    // side face\n    // if(u_sidesurface < 1.0) {\n    //   discard;\n    // }\n\n    if (u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      v_Color = linearColor;\n    } else {\n      v_Color = a_Color;\n    }\n\n  } else {\n    v_Color = a_Color;\n  }\n\n  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrude"}}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy(),this.textures=[]}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,t=e[2]-e[0],n=e[3]-e[1];this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uvs",type:O.AttributeType.Attribute,descriptor:{name:"a_uvs",shaderLocation:this.attributeLocation.UV,buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:3,update:function(r,i,o){var a=o[0],s=o[1];return[(a-e[0])/t,(s-e[1])/n,o[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:O.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:O.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?10:t;return Array.isArray(n)?[n[0]]:[n]}}})}},{key:"loadTexture",value:(t=a()(i()().mark((function e(){var t,n,r,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.layer.getLayerConfig(),n=t.mapTexture,r=this.rendererService.createTexture2D,this.texture=r({height:1,width:1}),!n){e.next=8;break}return e.next=6,B(n);case 6:o=e.sent,this.texture=r({data:o,width:o.width,height:o.height,wrapS:O.gl.CLAMP_TO_EDGE,wrapT:O.gl.CLAMP_TO_EDGE,min:O.gl.LINEAR,mag:O.gl.LINEAR});case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),s}(P.Z),F=function(e){d()(o,e);var t,n,r=g()(o);function o(){var e;u()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),y()(h()(e),"texture",void 0),e}return c()(o,[{key:"attributeLocation",get:function(){return Object.assign(M()(L()(o.prototype),"attributeLocation",this),{MAX:M()(L()(o.prototype),"attributeLocation",this).MAX,SIZE:9,NORMAL:10,EXTRUSION_BASE:11})}},{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),R()(R()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){return this.getUniformsBufferInfo({})}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t,n,r,o,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getShaders(),n=t.frag,r=t.vert,o=t.type,this.initUniformsBuffer(),e.next=4,this.layer.buildLayerModel({moduleName:o,vertexShader:r,fragmentShader:n,defines:this.getDefines(),inject:this.getInject(),triangulation:N.Xz,depth:{enable:!0}});case 4:return a=e.sent,e.abrupt("return",[a]);case 6:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getShaders",value:function(){return{frag:'\nin vec4 v_Color;\n#pragma include "scene_uniforms"\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n\n  outputColor = v_Color;\n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_SIZE) in float a_Size;\nlayout(location = ATTRIBUTE_LOCATION_NORMAL) in vec3 a_Normal;\n\nout vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);\n\n  vec4 project_pos = project_position(pos, a_Position64Low);\n  float lightWeight = calc_lighting(project_pos);\n  v_Color = a_Color;\n  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonExtrude"}}},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"normal",type:O.AttributeType.Attribute,descriptor:{name:"a_Normal",shaderLocation:this.attributeLocation.NORMAL,buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:3,update:function(e,t,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:O.AttributeType.Attribute,descriptor:{name:"a_Size",shaderLocation:this.attributeLocation.SIZE,buffer:{usage:O.gl.DYNAMIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(e){var t=e.size,n=void 0===t?10:t;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrusionBase",type:O.AttributeType.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:this.attributeLocation.EXTRUSION_BASE,buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:1,update:function(e){var t=e.extrusionBase;return[void 0===t?0:t]}}})}}]),o}(P.Z),z=function(e){d()(o,e);var t,n,r=g()(o);function o(){return u()(this,o),r.apply(this,arguments)}return c()(o,[{key:"attributeLocation",get:function(){return Object.assign(M()(L()(o.prototype),"attributeLocation",this),{MAX:M()(L()(o.prototype),"attributeLocation",this).MAX,LINEAR:9})}},{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),R()(R()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.raisingHeight,n=void 0===t?0:t,r=e.opacityLinear,i=void 0===r?{enable:!1,dir:"in"}:r,o={u_raisingHeight:Number(n),u_opacitylinear:Number(i.enable),u_dir:"in"===i.dir?1:0};return this.getUniformsBufferInfo(o)}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t,n,r,o,a,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelParams(),n=t.frag,r=t.vert,o=t.triangulation,a=t.type,this.initUniformsBuffer(),this.layer.triangulation=o,e.next=5,this.layer.buildLayerModel({moduleName:a,vertexShader:r,fragmentShader:n,defines:this.getDefines(),inject:this.getInject(),triangulation:o,primitive:O.gl.TRIANGLES,depth:{enable:!1}});case 5:return s=e.sent,e.abrupt("return",[s]);case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.registerPosition64LowAttribute();var e=this.layer.getLayerConfig().opacityLinear;(void 0===e?{enable:!1,dir:"in"}:e).enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:O.AttributeType.Attribute,descriptor:{name:"a_linear",shaderLocation:this.attributeLocation.LINEAR,buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:3,update:function(e,t,n){return[n[3],n[4],n[5]]}}})}},{key:"getModelParams",value:function(){var e=this.layer.getLayerConfig().opacityLinear;return(void 0===e?{enable:!1}:e).enable?{frag:'\nlayout(std140) uniform commonUniforms {\n  float u_raisingHeight;\n  float u_opacitylinear;\n  float u_dir;\n};\n\nin vec4 v_color;\nin vec3 v_linear;\nin vec2 v_pos;\nout vec4 outputColor;\n#pragma include "scene_uniforms"\n#pragma include "picking"\n\nvoid main() {\n  outputColor = v_color;\n  if (u_opacitylinear > 0.0) {\n    outputColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;\n  }\n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_LINEAR) in vec3 a_linear;\n\nlayout(std140) uniform commonUniforms {\n  float u_raisingHeight;\n  float u_opacitylinear;\n  float u_dir;\n};\n\nout vec4 v_color;\nout vec3 v_linear;\nout vec2 v_pos;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  if (u_opacitylinear > 0.0) {\n    v_linear = a_linear;\n    v_pos = a_Position.xy;\n  }\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\n  project_pos.z += u_raisingHeight;\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  setPickingColor(a_PickingColor);\n}\n',type:"polygonLinear",triangulation:N.T3}:{frag:'in vec4 v_color;\n#pragma include "scene_uniforms"\n#pragma include "picking"\nout vec4 outputColor;\nvoid main() {\n  outputColor = v_color;\n  outputColor = filterColor(outputColor);\n}\n',vert:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\n\nlayout(std140) uniform commonUniforms {\n  float u_raisingHeight;\n};\n\nout vec4 v_color;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\n\n  project_pos.z += u_raisingHeight;\n\n  if (\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n  ) {\n    float mapboxZoomScale = 4.0 / pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n\n',type:"polygonFill",triangulation:N.Qr}}}]),o}(P.Z),G=n(3420),V=n.n(G),j=function(e){d()(o,e);var t,n,r=g()(o);function o(){var e;u()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),y()(h()(e),"texture1",void 0),y()(h()(e),"texture2",void 0),y()(h()(e),"texture3",void 0),e}return c()(o,[{key:"attributeLocation",get:function(){return Object.assign(M()(L()(o.prototype),"attributeLocation",this),{MAX:M()(L()(o.prototype),"attributeLocation",this).MAX,UV:9})}},{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),R()(R()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.watercolor,n=void 0===t?"#6D99A8":t,r=e.watercolor2,i=void 0===r?"#0F121C":r,o={u_watercolor:(0,I.CI)(n),u_watercolor2:(0,I.CI)(i),u_time:this.layer.getLayerAnimateTime(),u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3};return this.textures=[this.texture1,this.texture2,this.texture3],this.getUniformsBufferInfo(o)}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_uv;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_watercolor;\n  vec4 u_watercolor2;\n  float u_time;\n};\n\nout vec2 v_uv;\nout float v_opacity;\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n  v_opacity = opacity;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\n\n',fragmentShader:"\nlayout(std140) uniform commonUniforms {\n  vec4 u_watercolor;\n  vec4 u_watercolor2;\n  float u_time;\n};\n\nin vec2 v_uv;\nin float v_opacity;\nout vec4 outputColor;\n\nfloat coast2water_fadedepth = 0.10;\nfloat large_waveheight      = .750; // change to adjust the \"heavy\" waves\nfloat large_wavesize        = 3.4;  // factor to adjust the large wave size\nfloat small_waveheight      = 0.6;  // change to adjust the small random waves\nfloat small_wavesize        = 0.5;   // factor to ajust the small wave size\nfloat water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)\nfloat water_glossylight_fact= 120.; // range [1..200]\nfloat particle_amount       = 70.;\n\nvec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights\n#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun\n\nuniform sampler2D u_texture1;\nuniform sampler2D u_texture2;\nuniform sampler2D u_texture3;\n\n  \n\nfloat hash( float n ) {\n    return fract(sin(n)*43758.5453123);\n}\n\n// 2d noise function\nfloat noise1( in vec2 x ) {\n  vec2 p  = floor(x);\n  vec2 f  = smoothstep(0.0, 1.0, fract(x));\n  float n = p.x + p.y*57.0;\n  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\n    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);\n}\n\nfloat noise(vec2 p) {\n    return texture(SAMPLER_2D(u_texture2),p*vec2(1./256.)).x;\n}\n\nvec4 highness(vec2 p) {\n    vec4 t = texture(SAMPLER_2D(u_texture1),fract(p));\n    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;\n    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);\n}\n\nfloat height_map( vec2 p ) {\n    vec4 height=highness(p);\n    /*\n    height = -0.5+\n        0.5*smoothstep(-100.,0.,-height)+\n        2.75*smoothstep(0.,2.,height)+\n        1.75*smoothstep(2.,4.,height)+\n        2.75*smoothstep(4.,16.,height)+\n        1.5*smoothstep(16.,1000.,height);\n    */\n\n    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );\n    //p = p*6.;\n    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;\n    f += 0.2500*noise( p ); p = m*p*1.32;\n    f += 0.1666*noise( p ); p = m*p*1.11;\n    f += 0.0834*noise( p ); p = m*p*1.12;\n    f += 0.0634*noise( p ); p = m*p*1.13;\n    f += 0.0444*noise( p ); p = m*p*1.14;\n    f += 0.0274*noise( p ); p = m*p*1.15;\n    f += 0.0134*noise( p ); p = m*p*1.16;\n    f += 0.0104*noise( p ); p = m*p*1.17;\n    f += 0.0084*noise( p );\n    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;\n        const float FLAT_LEVEL = 0.92525;\n        //f = f*0.25+height*0.75;\n    if (f<FLAT_LEVEL)\n        f = f;\n    else\n        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase\n    return clamp(f, 0., 10.);\n}\n\nvec3 plasma_quintic( float x ) {\n    x = clamp( x, 0.0, 1.0);\n    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3\n    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7\n    return vec3(\n        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),\n        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),\n        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );\n}\n\nvec4 color(vec2 p){\n    vec4 c1 = vec4(1.7,1.6,.9,1);\n    vec4 c2 = vec4(.2,.94,.1,1);\n    vec4 c3 = vec4(.3,.2,.0,1);\n    vec4 c4 = vec4(.99,.99,1.6,1);\n    vec4 v = highness(p);\n    float los = smoothstep(0.1,1.1,v.b);\n    float his = smoothstep(3.5,6.5,v.b);\n    float ces = smoothstep(1.,5.,v.a);\n    vec4 lo = mix(c1,c2,los);\n    vec4 hi = mix(c3,c4,his);\n    vec4 ce = mix(lo,hi,ces);\n\n    return vec4(plasma_quintic(ces),1).ragb;\n}\n\nvec3 terrain_map( vec2 p )\n{\n  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture(SAMPLER_2D(u_texture3), fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'\n}\n\nconst mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );\n\nfloat water_map( vec2 p, float height ) {\n    vec2 p2 = p*large_wavesize;\n    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );\n    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );\n\n    // coarse crossing 'ocean' waves...\n    float f = 0.6000*noise( p );\n    f += 0.2500*noise( p*m );\n    f += 0.1666*noise( p*m*m );\n    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;\n\n    p *= small_wavesize;\n    f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<9; i++)\n    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }\n    \n    return wave+f*small_waveheight;\n}\n\nfloat nautic(vec2 p) {\n    p *= 18.;\n    float f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }\n    return pow(1.-f, 5.);\n}\n\nfloat particles(vec2 p) {\n    p *= 200.;\n    float f = 0.;\n    float amp = 1.0, s = 1.5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }\n    return pow(f*.35, 7.)*particle_amount;\n}\n\nfloat test_shadow( vec2 xy, float height) {\n    vec3 r0 = vec3(xy, height);\n    vec3 rd = normalize( light - r0 );\n    \n    float hit = 1.0;\n    float t   = 0.001;\n    for (int j=1; j<25; j++)\n    {\n        vec3 p = r0 + t*rd;\n        float h = height_map( p.xy );\n        float height_diff = p.z - h;\n        if (height_diff<0.0)\n        {\n            return 0.0;\n        }\n        t += 0.01+height_diff*.02;\n        hit = min(hit, 2.*height_diff/t); // soft shaddow   \n    }\n    return hit;\n}\n\nvec3 CalcTerrain(vec2 uv, float height) {\n    vec3 col = terrain_map( uv );\n    vec2 iResolution = vec2(512.);\n    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);\n    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);\n    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);\n    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);\n    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));\n    vec3 r0 = vec3(uv, height);\n    vec3 rd = normalize( light - r0 );\n    float grad = dot(norm, rd);\n    col *= grad+pow(grad, 8.);\n    float terrainshade = test_shadow( uv, height );\n    col = mix(col*.25, col, terrainshade);\n    return col;\n}\n\n\nvoid main() {\n  vec3 watercolor = u_watercolor.rgb;\n  vec3 watercolor2 = u_watercolor2.rgb;\n  vec2 uv = v_uv;\n  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)\n  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;\n  float height = height_map( uv );\n  vec3 col;\n\n    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);\n    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);\n    if (height > level)\n    {\n        col = CalcTerrain(uv, height);\n    }\n    if (height <= level)\n    {\n        vec2 dif = vec2(.0, .01);\n        vec2 pos = uv*15. + vec2(u_time*.01);\n        float h1 = water_map(pos-dif,waveheight);\n        float h2 = water_map(pos+dif,waveheight);\n        float h3 = water_map(pos-dif.yx,waveheight);\n        float h4 = water_map(pos+dif.yx,waveheight);\n        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane\n        uv += normwater.xy*.002*(level-height);\n        \n        col = CalcTerrain(uv, height);\n\n        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);\n        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);\n        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;\n        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));\n\n        vec3 r0 = vec3(uv, WATER_LEVEL);\n        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position\n        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction\n        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          \n        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights\n        float gradpos  = dot(vec3(0., 0., 1.), rd);\n        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          \n        float watershade  = test_shadow( uv, level );\n        watercolor *= 2.2+watershade;\n        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;\n        watercolor /= (1.+specular1*1.25);\n        watercolor += watershade*specular2*water_specularcolor;\n        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));\n        \n        col = mix(col, watercolor, coastfade);\n    }\n    \n  outputColor = vec4(col, v_opacity);  \n}\n",defines:this.getDefines(),inject:this.getInject(),triangulation:N.Qr,primitive:O.gl.TRIANGLES,depth:{enable:!1}});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e,t,n;null===(e=this.texture1)||void 0===e||e.destroy(),null===(t=this.texture2)||void 0===t||t.destroy(),null===(n=this.texture3)||void 0===n||n.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,t=V()(e,4),n=t[0],r=t[1],i=t[2],o=t[3],a=i-n,s=o-r;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:O.AttributeType.Attribute,descriptor:{name:"a_uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:2,update:function(e,t,i){var o=V()(i,2),u=o[0],l=o[1];return[(u-n)/a,(l-r)/s]}}})}},{key:"loadTexture",value:function(){var e,t,n,r=this,i=this.rendererService.createTexture2D,o={height:0,width:0};function a(e){return i({data:e,width:e.width,height:e.height,wrapS:O.gl.MIRRORED_REPEAT,wrapT:O.gl.MIRRORED_REPEAT,min:O.gl.LINEAR,mag:O.gl.LINEAR})}this.texture1=i(o),this.texture2=i(o),this.texture3=i(o),e=function(e){r.texture1=a(e[0]),r.texture2=a(e[1]),r.texture3=a(e[2]),r.layerService.reRender()},t=0,n=[],["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"].map((function(r){var i=new Image;i.crossOrigin="",i.src=r,n.push(i),i.onload=function(){3==++t&&e(n)}}))}}]),o}(P.Z),H=function(e){d()(o,e);var t,n,r=g()(o);function o(){var e;u()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),y()(h()(e),"texture",void 0),e}return c()(o,[{key:"attributeLocation",get:function(){return Object.assign(M()(L()(o.prototype),"attributeLocation",this),{MAX:M()(L()(o.prototype),"attributeLocation",this).MAX,UV:9})}},{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),R()(R()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig().speed,t={u_speed:void 0===e?.5:e,u_time:this.layer.getLayerAnimateTime(),u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(t)}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadTexture(),e.abrupt("return",this.buildModels());case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),e.next=3,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_COLOR) in vec4 a_Color;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_uv;\n\nlayout(std140) uniform commonUniforms {\n  float u_speed;\n  float u_time;\n};\nout vec4 v_Color;\nout vec2 v_uv;\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n  v_Color = a_Color;\n  v_Color.a *= opacity;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n}\n\n',fragmentShader:"uniform sampler2D u_texture;\nlayout(std140) uniform commonUniforms {\n  float u_speed;\n  float u_time;\n};\n\nout vec4 outputColor;\n\n\nin vec4 v_Color;\nin vec2 v_uv;\n\nfloat rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }\n\nfloat water(vec3 p) {\n  float t = u_time * u_speed;\n  p.z += t * 2.; p.x += t * 2.;\n  vec3 c1 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;\n  p.z += t * 3.; p.x += t * 0.52;\n  vec3 c2 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;\n  p.z += t * 4.; p.x += t * 0.8;\n  vec3 c3 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;\n  c1 += c2 - c3;\n  float z = (c1.x + c1.y + c1.z) / 3.;\n  return p.y + z / 4.;\n}\n\nfloat map(vec3 p) {\n  float d = 100.0;\n  d = water(p);\n  return d;\n}\n\nfloat intersect(vec3 ro, vec3 rd) {\n  float d = 0.0;\n  for (int i = 0; i <= 100; i++) {\n    float h = map(ro + rd * d);\n    if (h < 0.1) return  d;\n    d += h;\n  }\n  return 0.0;\n}\n\nvec3 norm(vec3 p) {\n  float eps = .1;\n  return normalize(vec3(\n    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),\n    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),\n    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))\n  ));\n} \n\nfloat calSpc() {\n  vec3 l1 = normalize(vec3(1, 1, 1));\n  vec3 ro = vec3(-3, 20, -8);\n  vec3 rc = vec3(0, 0, 0);\n  vec3 ww = normalize(rc - ro);\n  vec3 uu = normalize(cross(vec3(0,1,0), ww));\n  vec3 vv = normalize(cross(rc - ro, uu));\n  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);\n  float d = intersect(ro, rd);\n  vec3 p = ro + rd * d;\n  vec3 n = norm(p);\n  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);\n  return spc;\n}\n\nvoid main() {\n\n  outputColor = v_Color;\n  float spc = calSpc();\n  outputColor += spc * 0.4;\n}\n",triangulation:N.Qr,defines:this.getDefines(),inject:this.getInject(),primitive:O.gl.TRIANGLES,depth:{enable:!1},pickingEnabled:!1,diagnosticDerivativeUniformityEnabled:!1});case 3:return t=e.sent,e.abrupt("return",[t]);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){var e=this.layer.getSource().extent,t=V()(e,4),n=t[0],r=t[1],i=t[2],o=t[3],a=i-n,s=o-r;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:O.AttributeType.Attribute,descriptor:{name:"a_uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:O.gl.STATIC_DRAW,data:[],type:O.gl.FLOAT},size:2,update:function(e,t,i){var o=V()(i,2),u=o[0],l=o[1];return[(u-n)/a,(l-r)/s]}}})}},{key:"loadTexture",value:function(){var e=this,t=this.layer.getLayerConfig().waterTexture,n=this.rendererService.createTexture2D;this.texture=n({height:1,width:1});var r=new Image;r.crossOrigin="",t?(console.warn("L7 recommend：https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),r.src=t):r.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",r.onload=function(){e.texture=n({data:r,width:r.width,height:r.height,wrapS:O.gl.MIRRORED_REPEAT,wrapT:O.gl.MIRRORED_REPEAT,min:O.gl.LINEAR,mag:O.gl.LINEAR}),e.layerService.reRender()}}}]),o}(P.Z),W={fill:z,line:b.Z,extrude:U,text:S.Z,point_fill:E.Z,point_image:T.Z,point_normal:A.Z,point_extrude:x.Z,water:H,ocean:j,extrusion:F},X=function(e){d()(r,e);var t,n=g()(r);function r(){var e;u()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),y()(h()(e),"type","PolygonLayer"),y()(h()(e),"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"]),e}return c()(r,[{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new W[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getModelType",value:function(){var e,t=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null==t||null===(e=t.scale)||void 0===e?void 0:e.field;return"fill"!==n&&n?"extrude"===n?"extrude":"extrusion"===n?"extrusion":"water"===n?"water":"ocean"===n?"ocean":"line"===n?"line":this.getPointModelType():"fill"}},{key:"getPointModelType",value:function(){var e=this.getEncodedData(),t=this.getLayerConfig(),n=t.shape2d,r=t.shape3d,i=this.iconService.getIconMap(),o=e.find((function(e){return e.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"point_normal":-1!==(null==n?void 0:n.indexOf(a))?"point_fill":-1!==(null==r?void 0:r.indexOf(a))?"point_extrude":i.hasOwnProperty(a)?"point_image":"text"}return"fill"}}]),r}(_.Z)},7303:function(e,t,n){"use strict";n.d(t,{Z:function(){return F}});var r=n(6502),i=n.n(r),o=n(4351),a=n.n(o),s=n(8025),u=n.n(s),l=n(1133),c=n.n(l),f=n(1119),h=n.n(f),p=n(3491),d=n.n(p),v=n(2060),g=n.n(v),m=n(3769),y=n.n(m),_=n(6677),b=n(1344),x=n(4450),E=n.n(x),T=n(6413),A=n.n(T),S=n(5757),C=n.n(S),R=n(7033),w=n(7193),M=n(8407),k=n(8222),L=function(e){d()(s,e);var t,n,r,o=g()(s);function s(){var e;u()(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=o.call.apply(o,[this].concat(n)),y()(h()(e),"texture",void 0),y()(h()(e),"colorTexture",void 0),e}return c()(s,[{key:"attributeLocation",get:function(){return Object.assign(A()(C()(s.prototype),"attributeLocation",this),{MAX:A()(C()(s.prototype),"attributeLocation",this).MAX,UV:9})}},{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),E()(E()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.clampLow,i=void 0===r||r,o=e.clampHigh,a=void 0===o||o,s=e.noDataValue,u=void 0===s?-9999999:s,l=e.domain,c=e.rampColors,f=l||(0,w.ZB)(c);this.colorTexture=this.layer.textureService.getColorTexture(c,f);var h={u_domain:f,u_opacity:n||1,u_noDataValue:u,u_clampLow:i?1:0,u_clampHigh:(void 0!==a?a:i)?1:0,u_rasterTexture:this.texture,u_colorTexture:this.colorTexture};return this.textures=[this.texture,this.colorTexture],this.getUniformsBufferInfo(h)}},{key:"getRasterData",value:(r=a()(i()().mark((function e(t){var n,r,o,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t.data)){e.next=4;break}return e.abrupt("return",{data:t.data,width:t.width,height:t.height});case 4:return e.next=6,t.data;case 6:return n=e.sent,r=n.rasterData,o=n.width,a=n.height,e.abrupt("return",{data:Array.from(r),width:o,height:a});case 11:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"initModels",value:(n=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.buildModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){var t,n,r,o,a,s,u,l,c,f;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),t=this.layer.getSource(),n=this.rendererService,r=n.createTexture2D,o=n.queryVerdorInfo,a=t.data.dataArray[0],e.next=6,this.getRasterData(a);case 6:return s=e.sent,u=s.data,l=s.width,c=s.height,this.texture=r({data:new Float32Array(u),width:l,height:c,format:"WebGL1"===o()?R.gl.LUMINANCE:R.gl.RED,type:R.gl.FLOAT,alignment:1}),e.next=13,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_domain;\n  float u_opacity;\n  float u_noDataValue;\n  float u_clampLow;\n  float u_clampHigh;\n};\n\nout vec2 v_texCoord;\n\n#pragma include "projection"\n\nvoid main() {\n  v_texCoord = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));\n}\n',fragmentShader:"layout(std140) uniform commonUniforms {\n  vec2 u_domain;\n  float u_opacity;\n  float u_noDataValue;\n  float u_clampLow;\n  float u_clampHigh;\n};\n\nuniform sampler2D u_rasterTexture;\nuniform sampler2D u_colorTexture;\n\nin vec2 v_texCoord;\n\nbool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }\n\nout vec4 outputColor;\n\nvoid main() {\n  // Can use any component here since u_rasterTexture is under luminance format.\n  float value = texture(SAMPLER_2D(u_rasterTexture), vec2(v_texCoord.x, v_texCoord.y)).r;\n  if (value == u_noDataValue || isnan_emu(value)) {\n    discard;\n  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {\n    discard;\n  } else {\n    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);\n    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(normalisedValue, 0));\n    \n    outputColor = color;\n    outputColor.a = outputColor.a * u_opacity ;\n    if (outputColor.a < 0.01)\n      discard;\n  }\n}\n",defines:this.getDefines(),triangulation:k.iC,primitive:R.gl.TRIANGLES,depth:{enable:!1},pickingEnabled:!1});case 13:return f=e.sent,e.abrupt("return",[f]);case 15:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e,t;null===(e=this.texture)||void 0===e||e.destroy(),null===(t=this.colorTexture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:R.AttributeType.Attribute,descriptor:{shaderLocation:this.attributeLocation.UV,name:"a_Uv",buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),s}(M.Z),O=n(1409),I=n.n(O),P=["data"],N=["rasterData"],B=function(e){d()(s,e);var t,n,r,o=g()(s);function s(){var e;u()(this,s);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e=o.call.apply(o,[this].concat(n)),y()(h()(e),"texture",void 0),y()(h()(e),"dataOption",{}),e}return c()(s,[{key:"attributeLocation",get:function(){return Object.assign(A()(C()(s.prototype),"attributeLocation",this),{MAX:A()(C()(s.prototype),"attributeLocation",this).MAX,UV:9})}},{key:"getUninforms",value:function(){var e=this.getCommonUniformsInfo(),t=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),E()(E()({},e.uniformsOption),t.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=void 0===t?1:t,r=e.noDataValue,i=void 0===r?0:r,o=this.dataOption,a=o.rMinMax,s=void 0===a?[0,255]:a,u=o.gMinMax,l=void 0===u?[0,255]:u,c=o.bMinMax,f={u_rminmax:s,u_gminmax:l,u_bminmax:void 0===c?[0,255]:c,u_opacity:n||1,u_noDataValue:i,u_texture:this.texture};return this.textures=[this.texture],this.getUniformsBufferInfo(f)}},{key:"getRasterData",value:(r=a()(i()().mark((function e(t){var n,r,o,a,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Array.isArray(t.data)){e.next=4;break}return n=t.data,r=I()(t,P),this.dataOption=r,e.abrupt("return",E()({data:n},r));case 4:return e.next=6,t.data;case 6:if(o=e.sent,a=o.rasterData,s=I()(o,N),this.dataOption=s,!Array.isArray(a)){e.next=14;break}return e.abrupt("return",E()({data:a},s));case 14:return e.abrupt("return",E()({data:Array.from(a)},s));case 15:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"initModels",value:(n=a()(i()().mark((function e(){var t,n,r,o,a,s,u,l;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),t=this.layer.getSource(),n=this.rendererService.createTexture2D,r=t.data.dataArray[0],e.next=6,this.getRasterData(r);case 6:return o=e.sent,a=o.data,s=o.width,u=o.height,this.texture=n({data:new Float32Array(a),width:s,height:u,format:R.gl.RGB,type:R.gl.FLOAT}),e.next=13,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_POSITION_64LOW) in vec2 a_Position64Low;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  vec2 u_rminmax;\n  vec2 u_gminmax;\n  vec2 u_bminmax;\n  float u_opacity;\n  float u_noDataValue;\n};\n\nout vec2 v_texCoord;\n\n#pragma include "projection"\n\nvoid main() {\n  v_texCoord = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0), a_Position64Low);\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));\n}\n',fragmentShader:"uniform sampler2D u_texture;\nlayout(std140) uniform commonUniforms {\n vec2 u_rminmax;\n vec2 u_gminmax;\n vec2 u_bminmax;\n float u_opacity;\n float u_noDataValue;\n};\n\nin vec2 v_texCoord;\n\nout vec4 outputColor;\n\nvoid main() {\n\n  vec3 rgb = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y)).rgb;\n\n  if(rgb == vec3(u_noDataValue)) {\n    outputColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n    outputColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);\n  }\n\n  if(outputColor.a < 0.01)\n    discard;\n \n}",defines:this.getDefines(),triangulation:k.iC,primitive:R.gl.TRIANGLES,depth:{enable:!1},pickingEnabled:!1});case 13:return l=e.sent,e.abrupt("return",[l]);case 15:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"buildModels",value:(t=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:R.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),s}(M.Z),D=function(e){d()(o,e);var t,n,r=g()(o);function o(){var e;u()(this,o);for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return e=r.call.apply(r,[this].concat(n)),y()(h()(e),"texture",void 0),e}return c()(o,[{key:"attributeLocation",get:function(){return Object.assign(A()(C()(o.prototype),"attributeLocation",this),{MAX:A()(C()(o.prototype),"attributeLocation",this).MAX,UV:9})}},{key:"getCommonUniformsInfo",value:function(){var e=this.layer.getLayerConfig(),t=e.opacity,n=e.clampLow,r=void 0===n||n,i=e.clampHigh,o=void 0===i||i,a=e.noDataValue,s=void 0===a?-9999999:a,u=e.domain,l=e.rampColors,c=e.colorTexture,f=e.rScaler,h=void 0===f?6553.6:f,p=e.gScaler,d=void 0===p?25.6:p,v=e.bScaler,g=void 0===v?.1:v,m=e.offset,y=void 0===m?1e4:m,_=u||(0,w.ZB)(l),b=c;c?this.layer.textureService.setColorTexture(c,l,_):b=this.layer.textureService.getColorTexture(l,_);var x={u_unpack:[h,d,g,y],u_domain:_,u_opacity:t||1,u_noDataValue:s,u_clampLow:r,u_clampHigh:void 0!==o?o:r,u_texture:this.texture,u_colorTexture:b};return this.textures=[this.texture,b],this.getUniformsBufferInfo(x)}},{key:"initModels",value:(n=a()(i()().mark((function e(){var t,n,r,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.initUniformsBuffer(),t=this.layer.getSource(),n=this.rendererService.createTexture2D,e.next=5,t.data.images;case 5:return r=e.sent,this.texture=n({data:r[0],width:r[0].width,height:r[0].height,min:R.gl.LINEAR,mag:R.gl.LINEAR}),e.next=9,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:'layout(location = ATTRIBUTE_LOCATION_POSITION) in vec3 a_Position;\nlayout(location = ATTRIBUTE_LOCATION_UV) in vec2 a_Uv;\n\nlayout(std140) uniform commonUniforms {\n  vec4 u_unpack;\n  vec2 u_domain;\n  float u_opacity;\n  float u_noDataValue;\n  float u_clampLow;\n  float u_clampHigh;\n};\nout vec2 v_texCoord;\n#pragma include "projection"\n\nvoid main() {\n  v_texCoord = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0.0, 1.0));\n}\n',fragmentShader:"uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nlayout(std140) uniform commonUniforms {\n vec4 u_unpack;\n vec2 u_domain;\n float u_opacity;\n float u_noDataValue;\n float u_clampLow;\n float u_clampHigh;\n};\n\nin vec2 v_texCoord;\nout vec4 outputColor;\n\n\nfloat getElevation(vec2 coord, float bias) {\n    // Convert encoded elevation value to meters\n    vec4 data =  texture(SAMPLER_2D(u_texture), coord,bias) * 255.0;\n    data.a = -1.0;\n    return dot(data, u_unpack);\n}\n\nvec4 getColor(float value) {\n   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);\n    vec2 coord = vec2(normalisedValue, 0);\n    return  texture(SAMPLER_2D(u_colorTexture), coord);\n}\n\nvoid main() {\n  float value = getElevation(v_texCoord,0.0);\n  if (value == u_noDataValue) {\n    outputColor = vec4(0.0, 0, 0, 0.0);\n  } else if ((u_clampLow < 0.5 && value < u_domain[0]) || (u_clampHigh < 0.5 && value > u_domain[1])) {\n     outputColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n   \n    outputColor = getColor(value);\n    outputColor.a =  outputColor.a * u_opacity ;\n      if(outputColor.a < 0.01)\n      discard;\n  }\n}\n",defines:this.getDefines(),triangulation:k.iC,primitive:R.gl.TRIANGLES,depth:{enable:!1}});case 9:return o=e.sent,e.abrupt("return",[o]);case 11:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"clearModels",value:function(){var e;null===(e=this.texture)||void 0===e||e.destroy()}},{key:"buildModels",value:(t=a()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.initModels());case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"registerBuiltinAttributes",value:function(){this.registerPosition64LowAttribute(),this.styleAttributeService.registerStyleAttribute({name:"uv",type:R.AttributeType.Attribute,descriptor:{name:"a_Uv",shaderLocation:this.attributeLocation.UV,buffer:{usage:R.gl.DYNAMIC_DRAW,data:[],type:R.gl.FLOAT},size:2,update:function(e,t,n){return[n[3],n[4]]}}})}}]),o}(M.Z),U={raster:L,rasterRgb:B,raster3d:L,rasterTerrainRgb:D},F=function(e){d()(r,e);var t,n=g()(r);function r(){var e;u()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),y()(h()(e),"type","RasterLayer"),e}return c()(r,[{key:"buildModels",value:(t=a()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getModelType(),this.layerModel=new U[t](this),e.next=4,this.initLayerModels();case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getDefaultConfig",value:function(){return{raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}}[this.getModelType()]}},{key:"getModelType",value:function(){switch(this.layerSource.getParserType()){case"raster":default:return"raster";case"rasterRgb":case"rgb":return"rasterRgb";case"image":return"rasterTerrainRgb"}}},{key:"getLegend",value:function(e){if("color"!==e)return{type:void 0,field:void 0,items:[]};var t=this.getLayerConfig().rampColors;return(0,b.I)(t,e)}}]),r}(_.Z)},1767:function(e,t,n){"use strict";n.d(t,{Z:function(){return oe}});var r=n(6502),i=n.n(r),o=n(4351),a=n.n(o),s=n(8025),u=n.n(s),l=n(1133),c=n.n(l),f=n(3769),h=n.n(f),p=n(7193),d=n(2786),v=n.n(d),g=function(){function e(t){var n=t.rendererService,r=t.layerService,i=t.parent;u()(this,e),h()(this,"tileResource",new Map),h()(this,"rendererService",void 0),h()(this,"layerService",void 0),h()(this,"parent",void 0),h()(this,"layerTiles",[]),this.rendererService=n,this.layerService=r,this.parent=i}var t;return c()(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(e){return this.layerTiles.some((function(t){return t.key===e}))}},{key:"addTile",value:function(e){this.layerTiles.push(e)}},{key:"getTile",value:function(e){return this.layerTiles.find((function(t){return t.key===e}))}},{key:"getVisibleTileBylngLat",value:function(e){return this.layerTiles.find((function(t){return t.isLoaded&&t.visible&&t.lnglatInBounds(e)}))}},{key:"removeTile",value:function(e){var t=this.layerTiles.findIndex((function(t){return t.key===e})),n=this.layerTiles.splice(t,1);n[0]&&n[0].destroy()}},{key:"updateTileVisible",value:function(e){var t=this.getTile(e.key);if(e.isVisible)if(e.parent){var n=this.isChildrenLoaded(e.parent);null==t||t.updateVisible(n)}else null==t||t.updateVisible(!0);else if(e.parent){var r=this.isChildrenLoaded(e.parent);null==t||t.updateVisible(!r)}else null==t||t.updateVisible(!1)}},{key:"isParentLoaded",value:function(e){var t=e.parent;if(!t)return!0;var n=this.getTile(null==t?void 0:t.key);return!(null==n||!n.isLoaded)}},{key:"isChildrenLoaded",value:function(e){var t=this,n=null==e?void 0:e.children;return 0===n.length||n.every((function(e){var n=t.getTile(null==e?void 0:e.key);return!n||!0===(null==n?void 0:n.isLoaded)}))}},{key:"render",value:(t=a()(i()().mark((function e(){var t,n,r=this;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getRenderLayers(),n=t.map(function(){var e=a()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.layerService.renderTileLayer(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=4,Promise.all(n);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getRenderLayers",value:function(){var e=this.layerTiles.filter((function(e){return e.visible&&e.isLoaded})),t=[];return e.map((function(e){return t.push.apply(t,v()(e.getLayers()))})),t}},{key:"getLayers",value:function(){var e=this.layerTiles.filter((function(e){return e.isLoaded})),t=[];return e.map((function(e){return t.push.apply(t,v()(e.getLayers()))})),t}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach((function(e){return e.destroy()})),this.tileResource.clear()}}]),e}(),m=n(3420),y=n.n(m),_=n(4450),b=n.n(_),x=n(23),E=n(7564),T=n(7436);var A=function(e,t,n){void 0===n&&(n={});var r=(0,T.wA)(e),i=(0,T.wA)(t),o=E.union(r.coordinates,i.coordinates);return 0===o.length?null:1===o.length?(0,x.yu)(o[0],n.properties):(0,x.tw)(o,n.properties)},S=function(){function e(){u()(this,e)}return c()(e,[{key:"getCombineFeature",value:function(e){var t=null,n=e[0];return e.map((function(e){var n=x.yu(e.coordinates);t=null===t?n:A(t,n)})),n&&(t.properties=b()({},n)),t}}]),e}(),C="select",R="active",w=function(){function e(t){var n=t.layerService,r=t.tileLayerService,i=t.parent;u()(this,e),h()(this,"layerService",void 0),h()(this,"tileLayerService",void 0),h()(this,"tileSourceService",void 0),h()(this,"parent",void 0),h()(this,"tilePickID",new Map),this.layerService=n,this.tileLayerService=r,this.parent=i,this.tileSourceService=new S}var t;return c()(e,[{key:"pickRender",value:function(e){var t=this.tileLayerService.getVisibleTileBylngLat(e.lngLat);if(t){var n=t.getMainLayer();null==n||n.layerPickService.pickRender(e)}}},{key:"pick",value:(t=a()(i()().mark((function e(t,n){var r,o,a,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.parent.getContainer(),o=r.pickingService,"RasterLayer"!==t.type){e.next=8;break}if(!(a=this.tileLayerService.getVisibleTileBylngLat(n.lngLat))||void 0===a.getMainLayer()){e.next=7;break}return s=a.getMainLayer(),e.abrupt("return",s.layerPickService.pickRasterLayer(s,n,this.parent));case 7:return e.abrupt("return",!1);case 8:return this.pickRender(n),e.abrupt("return",o.pickFromPickingFBO(t,n));case 10:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"selectFeature",value:function(e){var t=y()(e,3),n=t[0],r=t[1],i=t[2],o=this.color2PickId(n,r,i);this.tilePickID.set(C,o),this.updateHighLight(n,r,i,C)}},{key:"highlightPickedFeature",value:function(e){var t=y()(e,3),n=t[0],r=t[1],i=t[2],o=this.color2PickId(n,r,i);this.tilePickID.set(R,o),this.updateHighLight(n,r,i,R)}},{key:"updateHighLight",value:function(e,t,n,r){this.tileLayerService.tiles.map((function(i){var o=i.getMainLayer();switch(r){case C:null==o||o.hooks.beforeSelect.call([e,t,n]);break;case R:null==o||o.hooks.beforeHighlight.call([e,t,n])}}))}},{key:"setPickState",value:function(){var e=this.tilePickID.get(C),t=this.tilePickID.get(R);if(e){var n=this.pickId2Color(e),r=y()(n,3),i=r[0],o=r[1],a=r[2];this.updateHighLight(i,o,a,C)}else if(t){var s=this.pickId2Color(t),u=y()(s,3),l=u[0],c=u[1],f=u[2];this.updateHighLight(l,c,f,R)}else;}},{key:"color2PickId",value:function(e,t,n){return(0,p.W0)(new Uint8Array([e,t,n]))}},{key:"pickId2Color",value:function(e){return(0,p.Z6)(e)}},{key:"getFeatureById",value:function(e){var t=this.tileLayerService.getTiles().filter((function(e){return e.visible})),n=[];return t.forEach((function(t){n.push.apply(n,v()(t.getFeatureById(e)))})),n}},{key:"pickRasterLayer",value:function(){return!1}}]),e}(),M=n(7033),k=n(3491),L=n.n(k),O=n(2060),I=n.n(O),P=n(7492),N=n(428),B=n(1119),D=n.n(B),U=n(3262),F=n(6106);var z=function(e){L()(s,e);var t,n,r,o=I()(s);function s(e,t){var n;return u()(this,s),n=o.call(this),h()(D()(n),"x",void 0),h()(D()(n),"y",void 0),h()(D()(n),"z",void 0),h()(D()(n),"key",void 0),h()(D()(n),"parent",void 0),h()(D()(n),"sourceTile",void 0),h()(D()(n),"visible",!0),h()(D()(n),"layers",[]),h()(D()(n),"isLoaded",!1),h()(D()(n),"tileMaskLayers",[]),h()(D()(n),"tileMask",void 0),n.parent=t,n.sourceTile=e,n.x=e.x,n.y=e.y,n.z=e.z,n.key="".concat(n.x,"_").concat(n.y,"_").concat(n.z),n}return c()(s,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(e){var t=y()(this.sourceTile.bounds,4),n=t[0],r=t[1],i=t[2],o=t[3],a=e.lng,s=e.lat;return a>=n&&a<=i&&s>=r&&s<=o}},{key:"getLayerOptions",value:function(){var e,t,n=this.parent.getLayerConfig();return b()(b()({},n),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:(t=this.parent.type,-1!==["PolygonLayer","LineLayer"].indexOf(t)),mask:n.mask||0!==(null===(e=n.maskLayers)||void 0===e?void 0:e.length)&&n.enableMask})}},{key:"getMaskLayer",value:function(){var e=this,t=this.parent.getLayerConfig().maskLayers,n=[];return null==t||t.forEach((function(t){if(!t.tileLayer)return n.push(t),t;var r=t.tileLayer.getTile(e.sourceTile.key),i=null==r?void 0:r.getLayers()[0];i&&n.push(i)})),n}},{key:"addTileMask",value:(r=a()(i()().mark((function e(){var t,n,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new F.Z({name:"mask",visible:!0,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").color("#0f0").style({opacity:.5}),n=(0,M.createLayerContainer)(this.parent.container),t.setContainer(n),e.next=5,t.init();case 5:return this.tileMask=t,void 0!==(r=this.getMainLayer())&&(r.tileMask=t),e.abrupt("return",t);case 9:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"addMask",value:(n=a()(i()().mark((function e(t,n){var r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,M.createLayerContainer)(this.parent.container),n.setContainer(r),e.next=4,n.init();case 4:t.addMask(n),this.tileMaskLayers.push(n);case 6:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"addLayer",value:(t=a()(i()().mark((function e(t){var n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isTileLayer=!0,n=(0,M.createLayerContainer)(this.parent.container),t.setContainer(n),this.layers.push(t),e.next=6,t.init();case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"updateVisible",value:function(e){this.visible=e,this.updateOptions("visible",e)}},{key:"updateOptions",value:function(e,t){this.layers.forEach((function(n){n.updateLayerConfig(h()({},e,t))}))}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(e){return[]}},{key:"getFeatureById",value:function(e){return[]}},{key:"destroy",value:function(){var e;null===(e=this.tileMask)||void 0===e||e.destroy(),this.layers.forEach((function(e){return e.destroy()}))}}]),s}(U.EventEmitter),G=function(e){L()(r,e);var t,n=I()(r);function r(){return u()(this,r),n.apply(this,arguments)}return c()(r,[{key:"initTileLayer",value:(t=a()(i()().mark((function e(){var t,n,r,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.getSourceOption(),n=t.data.features[0].properties,r=(new P.Z).source(t.data,t.options).size(1).shape("line").color("red"),o=new N.Z({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([n],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),e.next=6,this.addLayer(r);case 6:return e.next=8,this.addLayer(o);case 8:this.isLoaded=!0;case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:{type:"FeatureCollection",features:this.sourceTile.data.layers.testTile.features},options:{parser:{type:"geojson"},transforms:e.transforms}}}}]),r}(z),V=n(3281),j=function(e){L()(r,e);var t,n=I()(r);function r(){return u()(this,r),n.apply(this,arguments)}return c()(r,[{key:"initTileLayer",value:(t=a()(i()().mark((function e(){var t,n,r,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),o=new V.Z(b()({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,i=e;o[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(o);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:e.transforms}}}}]),r}(z),H=n(7431),W=function(e){L()(r,e);var t,n=I()(r);function r(){return u()(this,r),n.apply(this,arguments)}return c()(r,[{key:"initTileLayer",value:(t=a()(i()().mark((function e(){var t,n,r,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),o=new H.Z(b()({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,i=e;o[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(o);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getFeatures",value:function(e){return e?this.sourceTile.data.getTileData(e):[]}},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.parent.getLayerConfig(),n=t.sourceLayer,r=t.featureId;return{data:{type:"FeatureCollection",features:this.getFeatures(n)},options:{parser:{type:"geojson",featureId:r},transforms:e.transforms}}}}]),r}(z),X=n(1409),Z=n.n(X),Y=n(7303),q=["rasterData"],K=function(e){L()(r,e);var t,n=I()(r);function r(){return u()(this,r),n.apply(this,arguments)}return c()(r,[{key:"initTileLayer",value:(t=a()(i()().mark((function e(){var t,n,r,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),o=new Y.Z(b()({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,i=e;o[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(o);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.sourceTile.data.data,n=t.rasterData,r=Z()(t,q);return{data:n,options:{parser:b()({type:"rasterRgb",extent:this.sourceTile.bounds},r),transforms:e.transforms}}}}]),r}(z),Q=function(e){L()(r,e);var t,n=I()(r);function r(){return u()(this,r),n.apply(this,arguments)}return c()(r,[{key:"initTileLayer",value:(t=a()(i()().mark((function e(){var t,n,r,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),o=new Y.Z(b()({},n)).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,i=e;o[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=7,this.addLayer(o);case 7:this.isLoaded=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:e.transforms}}}}]),r}(z),$=["rasterData"],J={positions:[0,1],colors:["#000","#fff"]},ee=function(e){L()(r,e);var t,n=I()(r);function r(){var e;u()(this,r);for(var t=arguments.length,i=new Array(t),o=0;o<t;o++)i[o]=arguments[o];return e=n.call.apply(n,[this].concat(i)),h()(D()(e),"colorTexture",void 0),e}return c()(r,[{key:"initTileLayer",value:(t=a()(i()().mark((function e(){var t,n,r,o,a,s,u;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),o=this.getLayerOptions(),a=o.rampColors,s=o.domain,this.colorTexture=this.parent.textureService.getColorTexture(a,s),u=new Y.Z(b()(b()({},n),{},{colorTexture:this.colorTexture})).source(r.data,r.options),t&&Object.keys(t).forEach((function(e){var n,r,i=e;u[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=9,this.addLayer(u);case 9:this.isLoaded=!0;case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.sourceTile.data.data,n=t.rasterData,r=Z()(t,$);return{data:n,options:{parser:b()({type:"raster",extent:this.sourceTile.bounds},r),transforms:e.transforms}}}},{key:"styleUpdate",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n,o=i.rampColors,a=void 0===o?J:o,s=i.domain;this.colorTexture=this.parent.textureService.getColorTexture(a,s||(0,p.ZB)(a)),this.layers.forEach((function(t){return t.style({colorTexture:e.colorTexture})}))}},{key:"destroy",value:function(){this.layers.forEach((function(e){return e.destroy()}))}}]),r}(z),te=function(e){L()(r,e);var t,n=I()(r);function r(){return u()(this,r),n.apply(this,arguments)}return c()(r,[{key:"initTileLayer",value:(t=a()(i()().mark((function e(){var t,n,r,o,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),i=this.parent.type,r="PolygonLayer"===i?F.Z:"LineLayer"===i?P.Z:N.Z,o=this.getSourceOption()){e.next=8;break}return this.isLoaded=!0,this.emit("loaded"),e.abrupt("return");case 8:return a=new r(b()({},n)).source(o.data,o.options),Object.keys(t).forEach((function(e){var n,r,i=e;a[i](null===(n=t[i])||void 0===n?void 0:n.field,null===(r=t[i])||void 0===r?void 0:r.values)})),e.next=12,this.addLayer(a);case 12:if(!n.tileMask){e.next=15;break}return e.next=15,this.addTileMask();case 15:this.setLayerMinMaxZoom(a),this.isLoaded=!0,this.emit("loaded");case 18:case"end":return e.stop()}var i}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"getSourceOption",value:function(){var e=this.parent.getSource(),t=this.parent.getLayerConfig(),n=t.sourceLayer,r=void 0===n?"defaultLayer":n,i=t.featureId,o=void 0===i?"id":i;return{data:{type:"FeatureCollection",features:this.getFeatures(r)},options:{parser:{type:"geojson",featureId:o},transforms:e.transforms}}}},{key:"setLayerMinMaxZoom",value:function(e){"text"===e.getModelType()&&e.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(e){return this.sourceTile.data.getTileData(e)}},{key:"getFeatureById",value:function(e){var t=this.getMainLayer();return t?t.getSource().data.dataArray.filter((function(t){return t._id===e})):[]}}]),r}(z);function ne(e){switch(e.type){case"PolygonLayer":case"LineLayer":case"PointLayer":return te;case"TileDebugLayer":return G;case"MaskLayer":return W;case"RasterLayer":switch(e.getSource().parser.dataType){case M.RasterTileType.RGB:case M.RasterTileType.CUSTOMRGB:return K;case M.RasterTileType.ARRAYBUFFER:case M.RasterTileType.CUSTOMARRAYBUFFER:return ee;case M.RasterTileType.TERRAINRGB:case M.RasterTileType.CUSTOMTERRAINRGB:return Q;default:return j}default:return te}}var re=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask","addMask","removeMask"],ie=p.rU.debounce,oe=function(){function e(t){var n=this;u()(this,e),h()(this,"parent",void 0),h()(this,"tileLayerService",void 0),h()(this,"mapService",void 0),h()(this,"layerService",void 0),h()(this,"rendererService",void 0),h()(this,"pickingService",void 0),h()(this,"tilePickService",void 0),h()(this,"tilesetManager",void 0),h()(this,"initedTileset",!1),h()(this,"lastViewStates",void 0),h()(this,"mapchange",(function(){var e;if(!1!==n.parent.isVisible()){var t=n.getCurrentView(),r=t.latLonBounds,i=t.zoom;n.lastViewStates&&n.lastViewStates.zoom===i&&n.lastViewStates.latLonBounds.toString()===r.toString()||(n.lastViewStates={zoom:i,latLonBounds:r},null===(e=n.tilesetManager)||void 0===e||e.throttleUpdate(i,r))}})),h()(this,"viewchange",ie(this.mapchange,24)),this.parent=t;var r=this.parent.getContainer();this.rendererService=r.rendererService,this.layerService=r.layerService,this.mapService=r.mapService,this.pickingService=r.pickingService,this.tileLayerService=new g({rendererService:this.rendererService,layerService:this.layerService,parent:t}),this.tilePickService=new w({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:t}),this.parent.setLayerPickService(this.tilePickService),this.proxy(t),this.initTileSetManager()}var t;return c()(e,[{key:"initTileSetManager",value:function(){var e,t=this.parent.getSource();if(this.tilesetManager=t.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),!1!==this.parent.isVisible()){var n=this.getCurrentView(),r=n.latLonBounds,i=n.zoom;null===(e=this.tilesetManager)||void 0===e||e.update(i,r)}}},{key:"getCurrentView",value:function(){var e=this.mapService.getBounds();return{latLonBounds:[e[0][0],e[0][1],e[1][0],e[1][1]],zoom:this.mapService.getZoom()}}},{key:"bindTilesetEvent",value:function(){var e=this;this.tilesetManager.on("tile-loaded",(function(e){})),this.tilesetManager.on("tile-unload",(function(t){e.tileUnLoad(t)})),this.tilesetManager.on("tile-error",(function(t,n){e.tileError(t)})),this.tilesetManager.on("tile-update",(function(){e.tileUpdate()})),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(e){return this.tileLayerService.getTile(e)}},{key:"tileLoaded",value:function(e){}},{key:"tileError",value:function(e){console.warn("error:",e)}},{key:"destroy",value:function(){var e;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),null===(e=this.tilesetManager)||void 0===e||e.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var e;this.tilesetManager.clear();var t=this.getCurrentView(),n=t.latLonBounds,r=t.zoom;null===(e=this.tilesetManager)||void 0===e||e.update(r,n)}},{key:"tileUnLoad",value:function(e){this.tileLayerService.removeTile(e.key)}},{key:"tileUpdate",value:(t=a()(i()().mark((function e(){var t,n,r,o=this;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.tilesetManager){e.next=2;break}return e.abrupt("return");case 2:return t=this.parent.getMinZoom(),n=this.parent.getMaxZoom(),r=this.tilesetManager.tiles.filter((function(e){return e.isLoaded})).filter((function(e){return e.isVisibleChange})).filter((function(e){return e.data})).filter((function(e){return e.z>=t&&e.z<n})),e.next=7,Promise.all(r.map(function(){var e=a()(i()().mark((function e(t){var n,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.tileLayerService.hasTile(t.key)){e.next=9;break}return n=ne(o.parent),r=new n(t,o.parent),e.next=5,r.initTileLayer();case 5:o.tilePickService.setPickState(),0!==r.getLayers().length&&(o.tileLayerService.addTile(r),o.tileLayerService.updateTileVisible(t),o.layerService.reRender()),e.next=12;break;case 9:o.tileLayerService.updateTileVisible(t),o.tilePickService.setPickState(),o.layerService.reRender();case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 7:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setPickState",value:function(e){}},{key:"pickRender",value:function(e){this.tilePickService.pickRender(e)}},{key:"selectFeature",value:function(e){this.tilePickService.selectFeature(e)}},{key:"highlightPickedFeature",value:function(e){this.tilePickService.highlightPickedFeature(e)}},{key:"proxy",value:function(e){var t=this;re.forEach((function(n){var r=e[n].bind(e);e[n]=function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return r.apply(void 0,o),t.getLayers().map((function(e){e[n].apply(e,o)})),"style"===n&&t.getTiles().forEach((function(e){return e.styleUpdate.apply(e,o)})),e}}))}}]),e}()},6068:function(e,t,n){"use strict";n.d(t,{y:function(){return a}});var r=n(3769),i=n.n(r),o=n(7033),a=i()(i()(i()(i()(i()(i()({},o.BlendType.additive,{enable:!0,func:{srcRGB:o.gl.ONE,dstRGB:o.gl.ONE,srcAlpha:1,dstAlpha:1}}),o.BlendType.none,{enable:!1}),o.BlendType.normal,{enable:!0,func:{srcRGB:o.gl.SRC_ALPHA,dstRGB:o.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),o.BlendType.subtractive,{enable:!0,func:{srcRGB:o.gl.ONE,dstRGB:o.gl.ONE,srcAlpha:o.gl.ZERO,dstAlpha:o.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:o.gl.FUNC_SUBTRACT,alpha:o.gl.FUNC_SUBTRACT}}),o.BlendType.max,{enable:!0,func:{srcRGB:o.gl.ONE,dstRGB:o.gl.ONE},equation:{rgb:o.gl.MAX_EXT}}),o.BlendType.min,{enable:!0,func:{srcRGB:o.gl.ONE,dstRGB:o.gl.ONE},equation:{rgb:o.gl.MIN_EXT}})},1344:function(e,t,n){"use strict";n.d(t,{I:function(){return o}});var r=n(3769),i=n.n(r);function o(e,t){return{type:e.type,field:"value",items:e.positions.map((function(n,r){return i()(i()({},t,r>=e.colors.length?null:e.colors[r]),"value",n)}))}}},1819:function(e,t,n){"use strict";n.d(t,{Gp:function(){return Xe},zr:function(){return Ne},rh:function(){return v},IY:function(){return Pn},lg:function(){return Er},nb:function(){return Tr},DP:function(){return Ar},b6:function(){return Hn},D5:function(){return Zn},H0:function(){return ar},pc:function(){return er},Qs:function(){return fr},yh:function(){return xr}});var r=n(8025),i=n.n(r),o=n(1133),a=n.n(o),s=n(3491),u=n.n(s),l=n(2060),c=n.n(l),f=n(4450),h=n.n(f),p=n(3769),d=n.n(p),v=function(){function e(t){i()(this,e),d()(this,"configService",void 0),d()(this,"config",void 0),this.config=t}return a()(e,[{key:"setContainer",value:function(e,t){this.configService=e.globalConfigService,e.mapConfig=h()(h()({},this.config),{},{id:t}),e.mapService=new(this.getServiceConstructor())(e)}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),g=n(3420),m=n.n(g),y=n(6805),_=n.n(y),b=n(2786),x=n.n(b),E=n(6502),A=n.n(E),S=n(1409),C=n.n(S),R=n(4351),w=n.n(R),M=n(1119),k=n.n(M),L=n(6413),O=n.n(L),I=n(5757),P=n.n(I),N=n(879),B=n.n(N),D=n(7033),U=n(7193),F=n(7703),z=n(3188),G=n(3262),V=function(){function e(t){i()(this,e),d()(this,"size",1e4),this.size=t||1e4}return a()(e,[{key:"setSize",value:function(e){this.size=e}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(e){return(180+e)/360*this.size}},{key:"mercatorYfromLat",value:function(e){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(e){return e/this.size*360-180}},{key:"latFromMercatorY",value:function(e){var t=180-360*(1-e/this.size);return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}},{key:"project",value:function(e){return[this.mercatorXfromLng(e[0]),this.mercatorYfromLat(e[1])]}},{key:"unproject",value:function(e){return[this.lngFromMercatorX(e[0]),this.latFromMercatorY(e[1])]}}]),e}(),j=function(){function e(t){i()(this,e),d()(this,"map",void 0),d()(this,"simpleMapCoord",new V),d()(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),d()(this,"config",void 0),d()(this,"configService",void 0),d()(this,"coordinateSystemService",void 0),d()(this,"eventEmitter",void 0),d()(this,"markerContainer",void 0),d()(this,"mapContainer",void 0),d()(this,"cameraChangedCallback",void 0),this.config=t.mapConfig,this.configService=t.globalConfigService,this.coordinateSystemService=t.coordinateSystemService,this.eventEmitter=new G.EventEmitter}return a()(e,[{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"updateView",value:function(e){var t;this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:e.bearing,center:e.center,viewportHeight:e.viewportHeight,pitch:e.pitch,viewportWidth:e.viewportWidth,zoom:e.zoom}),this.updateCoordinateSystemService(),null===(t=this.cameraChangedCallback)||void 0===t||t.call(this,this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var e=this.config.offsetCoordinate,t=void 0===e||e;this.viewport.getZoom()>12&&t?this.coordinateSystemService.setCoordinateSystem(D.CoordinateSystem.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(D.CoordinateSystem.LNGLAT)}},{key:"creatMapContainer",value:function(e){return"string"==typeof e?document.getElementById(e):e}},{key:"getMapStyleValue",value:function(e){var t;return null!==(t=this.getMapStyleConfig()[e])&&void 0!==t?t:e}},{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"getMapContainer",value:function(){return this.mapContainer}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"getCanvasOverlays",value:function(){}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e,t){this.eventEmitter.once(e,t)}},{key:"meterToCoord",value:function(e,t){return 1}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners()}}]),e}();function H(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function W(e){return W="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(e)}function X(e){var t=function(e,t){if("object"!=W(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=W(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==W(t)?t:t+""}function Z(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,X(r.key),r)}}function Y(e,t,n){return t&&Z(e.prototype,t),n&&Z(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function q(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function K(e,t){if(t&&("object"==W(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return q(e)}function Q(e){return Q=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Q(e)}function $(e,t){return $=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$(e,t)}function J(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return J(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?J(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var te=n(8942);function ne(e,t){var n=te.fF([],t,e);return te.bA(n,n,1/n[3]),n}var re=n(2621);function ie(e,t){if(!e)throw new Error(t||"viewport-mercator-project: assertion failed.")}var oe=Math.PI,ae=oe/4,se=oe/180,ue=180/oe,le=4003e4;function ce(e){return Math.pow(2,e)}function fe(e,t){var n=ee(e,2),r=n[0],i=n[1];ie(Number.isFinite(r)&&Number.isFinite(t)),ie(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var o=i*se;return[(t*=512)*(r*se+oe)/(2*oe),t*(oe-Math.log(Math.tan(ae+.5*o)))/(2*oe)]}function he(e,t){var n=ee(e,2),r=n[0],i=n[1],o=r/(t*=512)*(2*oe)-oe,a=2*(Math.atan(Math.exp(oe-i/t*(2*oe)))-ae);return[o*ue,a*ue]}function pe(e){var t=e.latitude,n=e.longitude,r=e.zoom,i=e.scale,o=e.highPrecision,a=void 0!==o&&o;i=void 0!==i?i:ce(r),ie(Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(i));var s={},u=512*i,l=Math.cos(t*se),c=u/360,f=c/l,h=u/le/l;if(s.pixelsPerMeter=[h,-h,h],s.metersPerPixel=[1/h,-1/h,1/h],s.pixelsPerDegree=[c,-f,h],s.degreesPerPixel=[1/c,-1/f,1/h],a){var p=se*Math.tan(t*se)/l,d=c*p/2,v=u/le*p,g=v/f*h;s.pixelsPerDegree2=[0,-d,v],s.pixelsPerMeter2=[g,0,g]}return s}function de(e){var t=e.height,n=e.pitch,r=e.bearing,i=e.altitude,o=e.center,a=void 0===o?null:o,s=e.flipY,u=void 0!==s&&s,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return F.translate(l,l,[0,0,-i]),F.scale(l,l,[1,1,1/t]),F.rotateX(l,l,-n*se),F.rotateZ(l,l,r*se),u&&F.scale(l,l,[1,-1,1]),a&&F.translate(l,l,z.negate([],a)),l}function ve(e){var t=e.width,n=e.height,r=e.pitch,i=function(e){var t=e.width,n=e.height,r=e.altitude,i=void 0===r?1.5:r,o=e.pitch,a=void 0===o?0:o,s=e.nearZMultiplier,u=void 0===s?1:s,l=e.farZMultiplier,c=void 0===l?1:l,f=a*se,h=Math.atan(.5/i),p=Math.sin(h)*i/Math.sin(Math.PI/2-f-h),d=Math.cos(Math.PI/2-f)*p+i;return{fov:2*Math.atan(n/2/i),aspect:t/n,focalDistance:i,near:u,far:d*c}}({width:t,height:n,altitude:e.altitude,pitch:r,nearZMultiplier:e.nearZMultiplier,farZMultiplier:e.farZMultiplier}),o=i.fov,a=i.aspect,s=i.near,u=i.far;return F.perspective([],o,a,s,u)}function ge(e,t){var n=ee(e,3),r=n[0],i=n[1],o=n[2],a=void 0===o?0:o;return ie(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a)),ne(t,[r,i,a,1])}function me(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=ee(e,3),i=r[0],o=r[1],a=r[2];if(ie(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a)){var s=ne(t,[i,o,a,1]);return s}var u=ne(t,[i,o,0,1]),l=ne(t,[i,o,1,1]),c=u[2],f=l[2],h=c===f?0:((n||0)-c)/(f-c);return re.t7([],u,l,h)}var ye=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_e=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.width,r=t.height,i=t.viewMatrix,o=void 0===i?ye:i,a=t.projectionMatrix,s=void 0===a?ye:a;H(this,e),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=s;var u=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];F.multiply(u,u,this.projectionMatrix),F.multiply(u,u,this.viewMatrix),this.viewProjectionMatrix=u;var l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];F.scale(l,l,[this.width/2,-this.height/2,1]),F.translate(l,l,[1,-1,0]),F.multiply(l,l,this.viewProjectionMatrix);var c=F.invert([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],l);if(!c)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=l,this.pixelUnprojectionMatrix=c,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return Y(e,[{key:"equals",value:function(t){return t instanceof e&&(t.width===this.width&&t.height===this.height&&F.equals(t.projectionMatrix,this.projectionMatrix)&&F.equals(t.viewMatrix,this.viewMatrix))}},{key:"project",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=this.projectPosition(e),o=ge(i,this.pixelProjectionMatrix),a=ee(o,2),s=a[0],u=a[1],l=r?u:this.height-u;return 2===e.length?[s,l]:[s,l,o[2]]}},{key:"unproject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,r=void 0===n||n,i=t.targetZ,o=ee(e,3),a=o[0],s=o[1],u=o[2],l=r?s:this.height-s,c=i&&i*this.pixelsPerMeter,f=me([a,l,u],this.pixelUnprojectionMatrix,c),h=this.unprojectPosition(f),p=ee(h,3),d=p[0],v=p[1],g=p[2];return Number.isFinite(u)?[d,v,g]:Number.isFinite(i)?[d,v,i]:[d,v]}},{key:"projectPosition",value:function(e){var t=ee(this.projectFlat(e),2);return[t[0],t[1],(e[2]||0)*this.pixelsPerMeter]}},{key:"unprojectPosition",value:function(e){var t=ee(this.unprojectFlat(e),2);return[t[0],t[1],(e[2]||0)/this.pixelsPerMeter]}},{key:"projectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]||this.scale;return e}},{key:"unprojectFlat",value:function(e){arguments.length>1&&void 0!==arguments[1]||this.scale;return e}}]),e}();function be(e){var t=e.width,n=e.height,r=e.bounds,i=e.minExtent,o=void 0===i?0:i,a=e.maxZoom,s=void 0===a?24:a,u=e.padding,l=void 0===u?0:u,c=e.offset,f=void 0===c?[0,0]:c,h=ee(r,2),p=ee(h[0],2),d=p[0],v=p[1],g=ee(h[1],2),m=g[0],y=g[1];if(Number.isFinite(l)){l={top:l,bottom:l,left:l,right:l}}else ie(Number.isFinite(l.top)&&Number.isFinite(l.bottom)&&Number.isFinite(l.left)&&Number.isFinite(l.right));var _=new xe({width:t,height:n,longitude:0,latitude:0,zoom:0}),b=_.project([d,y]),x=_.project([m,v]),E=[Math.max(Math.abs(x[0]-b[0]),o),Math.max(Math.abs(x[1]-b[1]),o)],T=[t-l.left-l.right-2*Math.abs(f[0]),n-l.top-l.bottom-2*Math.abs(f[1])];ie(T[0]>0&&T[1]>0);var A=T[0]/E[0],S=T[1]/E[1],C=(l.right-l.left)/2/A,R=(l.bottom-l.top)/2/S,w=[(x[0]+b[0])/2+C,(x[1]+b[1])/2+R],M=_.unproject(w),k=_.zoom+Math.log2(Math.abs(Math.min(A,S)));return{longitude:M[0],latitude:M[1],zoom:Math.min(k,s)}}var xe=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,i=n.height,o=n.latitude,a=void 0===o?0:o,s=n.longitude,u=void 0===s?0:s,l=n.zoom,c=void 0===l?0:l,f=n.pitch,h=void 0===f?0:f,p=n.bearing,d=void 0===p?0:p,v=n.altitude,g=void 0===v?1.5:v,m=n.nearZMultiplier,y=n.farZMultiplier;H(this,t),r=r||1,i=i||1;var _=ce(c);g=Math.max(.75,g);var b=fe([u,a],_);b[2]=0;var x=ve({width:r,height:i,pitch:h,bearing:d,altitude:g,nearZMultiplier:m||1/i,farZMultiplier:y||1.01}),E=de({height:i,center:b,pitch:h,bearing:d,altitude:g,flipY:!0});return(e=K(this,Q(t).call(this,{width:r,height:i,viewMatrix:E,projectionMatrix:x}))).latitude=a,e.longitude=u,e.zoom=c,e.pitch=h,e.bearing=d,e.altitude=g,e.scale=_,e.center=b,e.pixelsPerMeter=pe(q(q(e))).pixelsPerMeter[2],Object.freeze(q(q(e))),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$(e,t)}(t,e),Y(t,[{key:"projectFlat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return fe(e,t)}},{key:"unprojectFlat",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return he(e,t)}},{key:"getMapCenterByLngLatPosition",value:function(e){var t=e.lngLat,n=me(e.pos,this.pixelUnprojectionMatrix),r=fe(t,this.scale),i=re.IH([],r,re.tk([],n));return he(re.IH([],this.center,i),this.scale)}},{key:"getLocationAtPoint",value:function(e){var t=e.lngLat,n=e.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:n})}},{key:"fitBounds",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,o=be(Object.assign({width:r,height:i,bounds:e},n)),a=o.longitude,s=o.latitude,u=o.zoom;return new t({width:r,height:i,longitude:a,latitude:s,zoom:u})}}]),t}(_e),Ee=function(){function e(){i()(this,e),d()(this,"viewport",new xe)}return a()(e,[{key:"syncWithMapCamera",value:function(e){var t=e.center,n=e.zoom,r=e.pitch,i=e.bearing,o=e.viewportHeight,a=e.viewportWidth,s={width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing};this.viewport=new xe(h()(h()({},s),{},{width:a,height:o,longitude:t&&t[0],latitude:t&&t[1],zoom:n,pitch:r,bearing:i}))}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),Te=function(e){return e.GAODE="GAODE",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function Ae(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={top:0,right:0,bottom:0,left:0};if("number"==typeof e)return{top:e,right:e,bottom:e,left:e};if(Array.isArray(e)){if(4===e.length)return{top:e[0],right:e[1],bottom:e[2],left:e[3]};if(2===e.length)return{top:e[0],right:e[1],bottom:e[0],left:e[1]}}return h()(h()({},t),e)}var Se={normal:"amap://styles/normal",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true",fresh:"amap://styles/fresh",grey:"amap://styles/grey",graffiti:"amap://styles/graffiti",macaron:"amap://styles/macaron",darkblue:"amap://styles/darkblue",wine:"amap://styles/wine"},Ce=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".amap-logo {\n  display: none !important;\n}\n.amap-copyright {\n  display: none !important;\n}\n.amap-overlays {\n  z-index: 3 !important;\n}\n");var Re="f59bcf249433f8b05caaee19f349b3d7",we={contextmenu:"rightclick",camerachange:"viewchange"},Me=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"viewport",new Ee),d()(k()(e),"version",Te.GAODE),d()(k()(e),"handleCameraChanged",(function(){var t=e.getViewState();e.updateView(t)})),e}return a()(r,[{key:"getType",value:function(){return"amap"}},{key:"init",value:(t=w()(A()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,f,p,d,v,g,m;return A()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.config,n=t.id,r=t.style,i=void 0===r?"light":r,o=t.minZoom,a=void 0===o?0:o,s=t.maxZoom,u=void 0===s?24:s,l=t.token,c=void 0===l?Re:l,f=t.mapInstance,p=t.plugin,d=void 0===p?[]:p,v=C()(t,Ce),window.AMap||f){e.next=5;break}return d.push("Map3D"),e.next=5,B().load({key:c,version:"2.0",plugins:d});case 5:if(!f){e.next=11;break}this.map=f,this.mapContainer=this.map.getContainer(),this.map.on("viewchange",this.handleCameraChanged),e.next=21;break;case 11:if((g=h()({mapStyle:this.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},v)).zoom&&(g.zoom+=1),c===Re&&(window._AMapSecurityConfig={securityJsCode:"2653011adeb04230b3a26cc9a780a800"},console.warn("%c".concat(this.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;")),n){e.next=16;break}throw Error("No container id specified");case 16:window.forceWebGL=!0,this.mapContainer=this.creatMapContainer(n),m=new AMap.Map(this.mapContainer,g),this.map=m,m.on("viewchange",this.handleCameraChanged);case 21:this.syncInitViewPort();case 22:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"syncInitViewPort",value:function(){var e=this.getViewState();this.updateView(e)}},{key:"getViewState",value:function(){var e=function(e){var t=e._view.getOptions(),n=t.center,r=t.zoom;return{center:n,zoom:r}}(this.map),t=e.center,n=e.zoom;return{center:t,viewportWidth:this.map.getContainer().clientWidth,viewportHeight:this.map.getContainer().clientHeight,bearing:-this.map.getRotation(),pitch:this.map.getPitch(),zoom:n-1}}},{key:"creatMapContainer",value:function(e){var t=O()(P()(r.prototype),"creatMapContainer",this).call(this,e),n=document.createElement("div");return n.style.cssText+="\n       position: absolute;\n       top: 0;\n       height: 100%;\n       width: 100%;\n     ",n.id=U.rU.uniqueId("l7_amap_div"),t.appendChild(n),n}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"addMarkerContainer",value:function(){if(this.map){var e=this.map.getContainer();if(null!==e){var t=e.getElementsByClassName("amap-maps")[0];t.style.zIndex="auto",this.markerContainer=U.SO.create("div","l7-marker-container2",t)}}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getCanvasOverlays",value:function(){var e;return null===(e=this.mapContainer)||void 0===e?void 0:e.querySelector(".amap-overlays")}},{key:"on",value:function(e,t){-1!==D.MapServiceEvent.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(we[e]||e,t)}},{key:"off",value:function(e,t){-1!==D.MapServiceEvent.indexOf(e)?this.eventEmitter.off(e,t):this.map.off(we[e]||e,t)}},{key:"getSize",value:function(){var e=this.map.getSize();return[e.getWidth(),e.getHeight()]}},{key:"getMinZoom",value:function(){return this.map.getZooms()[0]-1}},{key:"getMaxZoom",value:function(){return this.map.getZooms()[1]-1}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"getCenter",value:function(e){if(null!=e&&e.padding){var t=this.getCenter(),n=Ae(e.padding),r=this.lngLatToPixel([t.lng,t.lat]),i=[(n.right-n.left)/2,(n.bottom-n.top)/2];return this.pixelToLngLat([r.x-i[0],r.y-i[1]])}var o=this.map.getCenter();return{lng:o.getLng(),lat:o.getLat()}}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var e=this.map.getBounds(),t=e.getNorthEast(),n=e.getSouthWest(),r=this.getCenter(),i=r.lng>t.getLng()||r.lng<n.getLng()?180-t.getLng():t.getLng();return[[r.lng<n.getLng()?n.getLng()-180:n.getLng(),n.getLat()],[i,t.getLat()]]}},{key:"getMapContainer",value:function(){return this.mapContainer}},{key:"getMapCanvasContainer",value:function(){var e;return null===(e=this.map.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-maps")[0]}},{key:"getMapStyleConfig",value:function(){return Se}},{key:"getMapStyleValue",value:function(e){return this.getMapStyleConfig()[e]||e}},{key:"getMapStyle",value:function(){return this.map.getMapStyle()}},{key:"setMapStyle",value:function(e){this.map.setMapStyle(this.getMapStyleValue(e))}},{key:"setRotation",value:function(e){return this.map.setRotation(e)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy(e,t)}},{key:"fitBounds",value:function(e){this.map.setBounds(new AMap.Bounds([e[0][0],e[0][1],e[1][0],e[1][1]]),!0)}},{key:"setZoomAndCenter",value:function(e,t){this.map.setZoomAndCenter(e+1,t)}},{key:"setCenter",value:function(e,t){if(null!=t&&t.padding){var n=Ae(t.padding),r=this.lngLatToPixel(e),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],o=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(e)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"setZoom",value:function(e){return this.map.setZoom(e+1)}},{key:"setMaxZoom",value:function(e){throw new Error("Method not implemented.")}},{key:"setMinZoom",value:function(e){throw new Error("Method not implemented.")}},{key:"setMapStatus",value:function(e){this.map.setStatus(e)}},{key:"meterToCoord",value:function(e,t){var n=AMap.GeometryUtil.distance(_()(AMap.LngLat,x()(e)),_()(AMap.LngLat,x()(t))),r=U.TG.apply(void 0,x()(e)),i=m()(r,2),o=i[0],a=i[1],s=U.TG.apply(void 0,x()(t)),u=m()(s,2),l=u[0],c=u[1];return Math.sqrt(Math.pow(o-l,2)+Math.pow(a-c,2))/n}},{key:"pixelToLngLat",value:function(e){var t=this.map.pixelToLngLat(new AMap.Pixel(e[0],e[1]));return{lng:t.getLng(),lat:t.getLat()}}},{key:"lngLatToPixel",value:function(e){var t=this.map.lnglatToPixel(e);return{x:t.getX(),y:t.getY()}}},{key:"containerToLngLat",value:function(e){var t=new AMap.Pixel(e[0],e[1]),n=this.map.containerToLngLat(t);return{lng:null==n?void 0:n.getLng(),lat:null==n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(e){var t=this.map.lngLatToContainer(e);return{x:t.getX(),y:t.getY()}}},{key:"lngLatToMercator",value:function(e,t){var n=m()(e,2),r=n[0],i=n[1],o=(0,U.TG)(r,i),a=m()(o,2);return{x:a[0],y:a[1],z:t}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=F.create();return F.translate(o,o,z.fromValues(i[0],i[1],t)),F.scale(o,o,z.fromValues(r[0],r[1],r[2])),F.rotateX(o,o,n[0]),F.rotateY(o,o,n[1]),F.rotateZ(o,o,n[2]),o}},{key:"exportMap",value:function(e){var t,n=null===(t=this.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-layer")[0];return"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"destroy",value:function(){var e;O()(P()(r.prototype),"destroy",this).call(this),null===(e=this.mapContainer)||void 0===e||null===(e=e.parentNode)||void 0===e||e.removeChild(this.mapContainer),delete window.initAMap;var t=document.getElementById("amap-script");t&&document.head.removeChild(t),this.map.destroy()}}]),r}(j);var ke=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return Me}}]),n}(v),Le=n(5116),Oe=n.n(Le),Ie={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},Pe={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},Ne=function(){function e(t){var n=this;i()(this,e),d()(this,"version","DEFAUlTMAP"),d()(this,"map",void 0),d()(this,"simpleMapCoord",new V),d()(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),d()(this,"config",void 0),d()(this,"configService",void 0),d()(this,"coordinateSystemService",void 0),d()(this,"eventEmitter",void 0),d()(this,"markerContainer",void 0),d()(this,"cameraChangedCallback",void 0),d()(this,"$mapContainer",void 0),d()(this,"handleCameraChanged",(function(e){var t=n.map.getCenter(),r=t.lat,i=t.lng;n.emit("mapchange"),n.viewport.syncWithMapCamera({bearing:n.map.getBearing(),center:[i,r],viewportHeight:n.map.transform.height,pitch:n.map.getPitch(),viewportWidth:n.map.transform.width,zoom:n.map.getZoom(),cameraHeight:0}),n.updateCoordinateSystemService(),n.cameraChangedCallback(n.viewport)})),this.config=t.mapConfig,this.configService=t.globalConfigService,this.coordinateSystemService=t.coordinateSystemService,this.eventEmitter=new G.EventEmitter}return a()(e,[{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"addMarkerContainer",value:function(){var e=this.map.getCanvasContainer();this.markerContainer=U.SO.create("div","l7-marker-container",e),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"getCanvasOverlays",value:function(){}},{key:"on",value:function(e,t){-1!==D.MapServiceEvent.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(Pe[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(Pe[e]||e,t),this.eventEmitter.off(e,t)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if("SIMPLE"===this.version)return this.simpleMapCoord.getSize();var e=this.map.transform;return[e.width,e.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(e){return this.map.setZoom(e)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(e){this.map.setCenter(e)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(e){this.map.setBearing(e)}},{key:"zoomIn",value:function(e,t){this.map.zoomIn(e,t)}},{key:"zoomOut",value:function(e,t){this.map.zoomOut(e,t)}},{key:"setPitch",value:function(e){return this.map.setPitch(e)}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy([e,t])}},{key:"fitBounds",value:function(e,t){this.map.fitBounds(e,t)}},{key:"setMaxZoom",value:function(e){this.map.setMaxZoom(e)}},{key:"setMinZoom",value:function(e){this.map.setMinZoom(e)}},{key:"setMapStatus",value:function(e){!0===e.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===e.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===e.dragEnable&&this.map.dragPan.disable(),!0===e.dragEnable&&this.map.dragPan.enable(),!1===e.rotateEnable&&this.map.dragRotate.disable(),!0===e.dragEnable&&this.map.dragRotate.enable(),!1===e.keyboardEnable&&this.map.keyboard.disable(),!0===e.keyboardEnable&&this.map.keyboard.enable(),!1===e.zoomEnable&&this.map.scrollZoom.disable(),!0===e.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(e,t){this.map.flyTo({zoom:e,center:t})}},{key:"setMapStyle",value:function(e){var t;null===(t=this.map)||void 0===t||t.setStyle(this.getMapStyleValue(e))}},{key:"meterToCoord",value:function(e,t){return 1}},{key:"pixelToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToPixel",value:function(e){return this.map.project(e)}},{key:"containerToLngLat",value:function(e){return this.map.unproject(e)}},{key:"lngLatToContainer",value:function(e){return this.map.project(e)}},{key:"getMapStyle",value:function(){try{var e,t=null!==(e=this.map.getStyle().sprite)&&void 0!==e?e:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(t)?null==t?void 0:t.replace(/\/\w+$/,"").replace(/sprites/,"styles"):t}catch(e){return""}}},{key:"getMapStyleConfig",value:function(){return Ie}},{key:"getMapStyleValue",value:function(e){var t;return null!==(t=this.getMapStyleConfig()[e])&&void 0!==t?t:e}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(e){var t,n=null===(t=this.map)||void 0===t?void 0:t.getCanvas();return"jpg"===e?null==n?void 0:n.toDataURL("image/jpeg"):null==n?void 0:n.toDataURL("image/png")}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"creatMapContainer",value:function(e){var t=e;return"string"==typeof e&&(t=document.getElementById(e)),t}},{key:"updateView",value:function(e){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:e.bearing,center:e.center,viewportHeight:e.viewportHeight,pitch:e.pitch,viewportWidth:e.viewportWidth,zoom:e.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var e=this.config.offsetCoordinate,t=void 0===e||e;this.viewport.getZoom()>12&&t?this.coordinateSystemService.setCoordinateSystem(D.CoordinateSystem.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(D.CoordinateSystem.LNGLAT)}}]),e}();if(!window)throw Error("BMapGL JSAPI can only be used in Browser.");var Be=function(e){return e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed",e}(Be||{}),De={key:"",BMapGL:{version:"1.0"}},Ue={BMapGL:Be.notload},Fe=[],ze=function(e){if("function"==typeof e){if(Ue.BMapGL===Be.loaded)return void e(window.BMapGL);Fe.push(e)}},Ge=function(e){return new Promise((function(t,n){if(Ue.BMapGL===Be.failed)n("");else if(Ue.BMapGL===Be.notload){var r=e.key,i=e.version;if(!r)return void n("请填写key");De.key=r,De.BMapGL.version=i||De.BMapGL.version,Ue.BMapGL=Be.loading;var o=document.body||document.head;window.___onBMapGLAPILoaded=function(e){if(delete window.___onBMapGLAPILoaded,e)Ue.BMapGL=Be.failed,n(e);else for(Ue.BMapGL=Be.loaded;Fe.length;)Fe.splice(0,1)[0](window.BMapGL)};var a=document.createElement("script");a.type="text/javascript",a.src="https://api.map.baidu.com/api?type=webgl&v=".concat(De.BMapGL.version,"&ak=").concat(De.key,"&callback=___onBMapGLAPILoaded"),a.onerror=function(e){Ue.BMapGL=Be.failed,n(e)},o.appendChild(a),ze(t)}else if(Ue.BMapGL===Be.loaded){if(e.key&&e.key!==De.key)return void n("多个不一致的 key");if(e.version&&e.version!==De.BMapGL.version)return void n("不允许多个版本 JSAPI 混用");t(window.BMapGL)}else{if(e.key&&e.key!==De.key)return void n("多个不一致的 key");if(e.version&&e.version!==De.BMapGL.version)return void n("不允许多个版本 JSAPI 混用");ze(t)}}))},Ve=["id","center","zoom","token","mapInstance","version","mapSize","minZoom","maxZoom"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".BMap_cpyCtrl .anchorBL {\n  display: none !important;\n}\n\n.anchorBL {\n  display: none !important;\n}\n");var je={mapmove:"moving",contextmenu:"rightclick",camerachange:"update",zoomchange:"zoomend"},He="zLhopYPPERGtpGOgimcdKcCimGRyyIsh",We=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"viewport",void 0),d()(k()(e),"styleConfig",{normal:[]}),d()(k()(e),"currentStyle","normal"),d()(k()(e),"evtCbProxyMap",new Map),d()(k()(e),"handleCameraChanged",(function(){e.emit("mapchange");var t=e.getMap(),n=t.getCenter(),r={center:[n.lng,n.lat],viewportHeight:t.getContainer().clientHeight,viewportWidth:t.getContainer().clientWidth,bearing:360-t.getHeading(),pitch:t.getTilt(),zoom:t.getZoom()-1.75};e.viewport.syncWithMapCamera(r),e.updateCoordinateSystemService(),e.cameraChangedCallback(e.viewport)})),e}return a()(r,[{key:"getMap",value:function(){return this.map}},{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"init",value:(t=w()(A()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,f,p,d,v,g,m,y,_,b,E,T,S,R,w,M=this;return A()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.viewport=new Ee,t=this.config,n=t.id,r=t.center,i=void 0===r?[121.30654632240122,31.25744185633306]:r,o=t.zoom,a=void 0===o?12:o,s=t.token,u=void 0===s?He:s,l=t.mapInstance,c=t.version,f=void 0===c?"1.0":c,p=t.mapSize,d=void 0===p?1e4:p,v=t.minZoom,g=void 0===v?0:v,m=t.maxZoom,y=void 0===m?21:m,_=C()(t,Ve),this.viewport=new Ee,this.version=f,this.simpleMapCoord.setSize(d),window.BMapGL||l){e.next=8;break}return e.next=8,Ge({key:u,version:"1.0"});case 8:if(!l){e.next=17;break}this.map=l,this.$mapContainer=this.map.getContainer(),b=new BMapGL.Point(i[0],i[1]),this.map.isLoaded()||this.map.centerAndZoom(b,a),this.initMapByConfig(this.config),this.map.on("update",this.handleCameraChanged),e.next=32;break;case 17:if(E=h()({enableWheelZoom:!0,minZoom:g,maxZoom:y},_),u===He&&console.warn("%c".concat(this.configService.getSceneWarninfo("MapToken"),"!"),"color: #873bf4;font-weigh:900;font-size: 16px;"),n){e.next=21;break}throw Error("No container id specified");case 21:T=U.SO.getContainer(n),S=x()(T.childNodes),R=new BMapGL.Map(T,E),this.$mapContainer=R.getContainer(),S.forEach((function(e){M.$mapContainer.appendChild(e)})),S=null,this.map=R,w=new BMapGL.Point(i[0],i[1]),this.map.centerAndZoom(w,a),this.initMapByConfig(this.config),R.on("update",this.handleCameraChanged);case 32:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){this.getMap().destroy()}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"addMarkerContainer",value:function(){}},{key:"getMarkerContainer",value:function(){return this.map.getPanes().markerPane}},{key:"getCanvasOverlays",value:function(){var e;return null===(e=this.getMap().getContainer().querySelector("#platform"))||void 0===e?void 0:e.lastChild}},{key:"on",value:function(e,t){if(-1===D.MapServiceEvent.indexOf(e)){var n=this.evtCbProxyMap.get(e);if(n||this.evtCbProxyMap.set(e,n=new Map),!n.get(t)){var r=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];!n[0]||"object"!==Oe()(n[0])||n[0].lngLat||n[0].lnglat||(n[0].lngLat=n[0].latlng||n[0].latLng),t.apply(void 0,n)};n.set(t,r),this.map.on(je[e]||e,r)}}else this.eventEmitter.on(e,t)}},{key:"off",value:function(e,t){var n,r;if(-1===D.MapServiceEvent.indexOf(e)){var i=null===(n=this.evtCbProxyMap.get(e))||void 0===n?void 0:n.get(t);i&&(null===(r=this.evtCbProxyMap.get(e))||void 0===r||r.delete(t),this.map.off(je[e]||e,i))}else this.eventEmitter.off(e,t)}},{key:"once",value:function(e,t){this.eventEmitter.once(e,t)}},{key:"getContainer",value:function(){return this.getMap().getContainer()}},{key:"getSize",value:function(){var e=this.getMap().getSize();return[e.width,e.height]}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"getType",value:function(){return"bmap"}},{key:"getZoom",value:function(){return this.getMap().getZoom()}},{key:"getCenter",value:function(e){if(null!=e&&e.padding){var t=this.getCenter(),n=Ae(e.padding),r=this.lngLatToPixel([t.lng,t.lat]),i=[(n.right-n.left)/2,(n.bottom-n.top)/2];return this.pixelToLngLat([r.x-i[0],r.y-i[1]])}var o=this.map.getCenter();return{lng:o.lng,lat:o.lat}}},{key:"getPitch",value:function(){return this.getMap().getTilt()}},{key:"getRotation",value:function(){return 360-this.getMap().getHeading()}},{key:"getBounds",value:function(){var e=this.getMap().getBounds(),t=e.getNorthEast(),n=e.getSouthWest();return[[n.lng,n.lat],[t.lng,t.lat]]}},{key:"getMapContainer",value:function(){return this.getMap().getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.getMap().getContainer()}},{key:"getMapStyleConfig",value:function(){return this.styleConfig}},{key:"getMapStyleValue",value:function(e){return this.styleConfig[e]}},{key:"setMapStyle",value:function(e){if(this.currentStyle!==e){var t=Array.isArray(e)?e:this.styleConfig[e]||e;return Array.isArray(t)?(this.map.setMapStyleV2({styleJson:t}),void(this.currentStyle=e)):"string"==typeof t?(this.map.setMapStyleV2({styleId:t}),void(this.currentStyle=e)):void 0}}},{key:"setRotation",value:function(e){this.getMap().setHeading(e)}},{key:"zoomIn",value:function(){this.getMap().zoomIn()}},{key:"zoomOut",value:function(){this.getMap().zoomOut()}},{key:"panTo",value:function(e){this.getMap().panTo(new BMapGL.Point(e[0],e[1]))}},{key:"panBy",value:function(e,t){this.getMap().panBy(e,t)}},{key:"fitBounds",value:function(e,t){this.map.setViewport(e.map((function(e){return new BMapGL.Point(e[0],e[1])})),t)}},{key:"setZoomAndCenter",value:function(e,t){var n=m()(t,2),r=n[0],i=n[1];this.getMap().centerAndZoom(new BMapGL.Point(r,i),e+1.75)}},{key:"setCenter",value:function(e,t){var n=m()(e,2),r=n[0],i=n[1],o={lng:r,lat:i};if(null!=t&&t.padding){var a=Ae(t.padding),s=this.lngLatToPixel([r,i]),u=[(a.right-a.left)/2,(a.bottom-a.top)/2];o=this.pixelToLngLat([s.x+u[0],s.y+u[1]])}this.getMap().setCenter(new BMapGL.Point(o.lng,o.lat))}},{key:"setPitch",value:function(e){this.getMap().setTilt(e)}},{key:"setZoom",value:function(e){this.getMap().setZoom(e)}},{key:"setMapStatus",value:function(e){var t=this,n=this.getMap();Object.keys(e).map((function(r){switch(r){case"doubleClickZoom":e.doubleClickZoom?n.enableDoubleClickZoom():n.disableDoubleClickZoom();break;case"dragEnable":e.dragEnable?n.enableDragging():n.disableDragging();break;case"keyboardEnable":e.keyboardEnable?n.enableKeyboard():n.disableKeyboard();break;case"resizeEnable":e.resizeEnable?n.enableAutoResize():n.disableAutoResize();break;case"rotateEnable":e.rotateEnable?(n.enableRotate(),n.enableRotateGestures()):(n.disableRotate(),n.disableRotateGestures());break;case"zoomEnable":e.zoomEnable?(t.map.enableDoubleClickZoom(),t.map.enableScrollWheelZoom(),t.map.enablePinchToZoom()):(t.map.disableDoubleClickZoom(),t.map.disableScrollWheelZoom(),t.map.disablePinchToZoom());break;case"showIndoorMap":n.setDisplayOptions({indoor:!!e.showIndoorMap})}}))}},{key:"meterToCoord",value:function(e,t){var n=this.getMap().getDistance(_()(BMapGL.Point,x()(e)),_()(BMapGL.Point,x()(t))),r=this.lngLatToCoord(e),i=m()(r,2),o=i[0],a=i[1],s=this.lngLatToCoord(t),u=m()(s,2),l=u[0],c=u[1];return Math.sqrt(Math.pow(o-l,2)+Math.pow(a-c,2))/n}},{key:"pixelToLngLat",value:function(e){var t=m()(e,2),n=t[0],r=t[1],i=this.getMap().pixelToPoint(new BMapGL.Pixel(n,r));return{lng:i.lng,lat:i.lat}}},{key:"lngLatToPixel",value:function(e){var t=m()(e,2),n=t[0],r=t[1],i=this.getMap().pointToPixel(new BMapGL.Point(n,r));return{x:i.x,y:i.y}}},{key:"containerToLngLat",value:function(e){var t=m()(e,2),n=t[0],r=t[1],i=this.getMap().overlayPixelToPoint(new BMapGL.Pixel(n,r));return{lng:i.lng,lat:i.lat}}},{key:"lngLatToContainer",value:function(e){var t=m()(e,2),n=t[0],r=t[1],i=this.getMap().pointToOverlayPixel(new BMapGL.Point(n,r));return{x:i.x,y:i.y}}},{key:"lngLatToCoord",value:function(e){var t=m()(e,2),n=t[0],r=t[1],i=this.getMap().pointToPixel(new BMapGL.Point(n,r));return[i.x,-i.y]}},{key:"lngLatToCoords",value:function(e){var t=this;return e.map((function(e){return Array.isArray(e[0])?t.lngLatToCoords(e):t.lngLatToCoord(e)}))}},{key:"lngLatToMercator",value:function(e,t){var n=m()(e,2),r=n[0],i=n[1],o=this.getMap().lnglatToMercator(r,i),a=m()(o,2);return{x:a[0],y:a[1],z:t}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=F.create();return F.translate(o,o,z.fromValues(i[0],i[1],t)),F.scale(o,o,z.fromValues(r[0],r[1],r[2])),F.rotateX(o,o,n[0]),F.rotateY(o,o,n[1]),F.rotateZ(o,o,n[2]),o}},{key:"getCustomCoordCenter",value:function(){throw new Error("Method not implemented.")}},{key:"exportMap",value:function(e){var t=this.getMap()._webglPainter._canvas;return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"hideLogo",value:function(){var e=this.map.getContainer();e&&U.SO.addClass(e,"bmap-contianer--hide-logo")}},{key:"initMapByConfig",value:function(e){var t=e.style,n=e.pitch,r=void 0===n?0:n,i=e.rotation,o=void 0===i?0:i,a=e.logoVisible,s=void 0===a||a;t&&this.setMapStyle(t),r&&this.setPitch(r),o&&this.setRotation(o),!1===s&&this.hideLogo()}}]),r}(Ne),Xe=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return We}}]),n}(v),Ze=n(3990),Ye=n.n(Ze),qe=function(e,t,n){return e+n*(t-e)};function Ke(e,t,n){return Math.min(n,Math.max(t,e))}function Qe(e,t,n){var r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}var $e=1;function Je(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,o=n;i<o.length;i++){var a=o[i];for(var s in a)e[s]=a[s]}return e}function et(e,t,n,r){var i=new(Ye())(e,t,n,r);return function(e){return i.solve(e)}}var tt=et(.25,.1,.25,1),nt={};function rt(e){return e*Math.PI/180}var it=6371008.8,ot=function(){function e(t,n){if(i()(this,e),d()(this,"lng",void 0),d()(this,"lat",void 0),isNaN(t)||isNaN(n))throw new Error("Invalid LngLat object: (".concat(t,", ").concat(n,")"));if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return a()(e,[{key:"wrap",value:function(){return new e(Qe(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(e){var t=Math.PI/180,n=this.lat*t,r=e.lat*t,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return it*Math.acos(Math.min(i,1))}}],[{key:"convert",value:function(t){if(t instanceof e)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new e(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"===Oe()(t)&&null!==t)return new e(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),e}(),at=2*Math.PI*it;function st(e){return at*Math.cos(e*Math.PI/180)}function ut(e){return(180+e)/360}function lt(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function ct(e,t){return e/st(t)}function ft(e){var t=180-360*e;return 360/Math.PI*Math.atan(Math.exp(t*Math.PI/180))-90}var ht=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;i()(this,e),d()(this,"x",void 0),d()(this,"y",void 0),d()(this,"z",void 0),this.x=+t,this.y=+n,this.z=+r}return a()(e,[{key:"toLngLat",value:function(){return new ot(360*this.x-180,ft(this.y))}},{key:"toAltitude",value:function(){return e=this.z,t=this.y,e*st(ft(t));var e,t}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/at*(e=ft(this.y),1/Math.cos(e*Math.PI/180));var e}}],[{key:"fromLngLat",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=ot.convert(t);return new e(ut(r.lng),lt(r.lat),ct(n,r.lat))}}]),e}(),pt=n(521),dt=n.n(pt),vt=function(){function e(t,n){i()(this,e),d()(this,"_ne",void 0),d()(this,"_sw",void 0),t&&(n?this.setSouthWest(t).setNorthEast(n):Array.isArray(t)&&(4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1])))}return a()(e,[{key:"setNorthEast",value:function(e){return this._ne=e instanceof ot?new ot(e.lng,e.lat):ot.convert(e),this}},{key:"setSouthWest",value:function(e){return this._sw=e instanceof ot?new ot(e.lng,e.lat):ot.convert(e),this}},{key:"extend",value:function(t){var n,r,i=this._sw,o=this._ne;if(t instanceof ot)n=t,r=t;else{if(!(t instanceof e)){if(Array.isArray(t)){if(4===t.length||t.every(Array.isArray)){var a=t;return this.extend(e.convert(a))}var s=t;return this.extend(ot.convert(s))}return t&&("lng"in t||"lon"in t)&&"lat"in t?this.extend(ot.convert(t)):this}if(n=t._sw,r=t._ne,!n||!r)return this}return i||o?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),o.lng=Math.max(r.lng,o.lng),o.lat=Math.max(r.lat,o.lat)):(this._sw=new ot(n.lng,n.lat),this._ne=new ot(r.lng,r.lat)),this}},{key:"getCenter",value:function(){return new ot((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}},{key:"getSouthWest",value:function(){return this._sw}},{key:"getNorthEast",value:function(){return this._ne}},{key:"getNorthWest",value:function(){return new ot(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new ot(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this._sw.lng}},{key:"getSouth",value:function(){return this._sw.lat}},{key:"getEast",value:function(){return this._ne.lng}},{key:"getNorth",value:function(){return this._ne.lat}},{key:"toArray",value:function(){return[this._sw.toArray(),this._ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this._sw.toString(),", ").concat(this._ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this._sw&&this._ne)}},{key:"contains",value:function(e){var t=ot.convert(e),n=t.lng,r=t.lat,i=this._sw.lat<=r&&r<=this._ne.lat,o=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(o=this._sw.lng>=n&&n>=this._ne.lng),i&&o}}],[{key:"convert",value:function(t){return t instanceof e?t:new e(t)}},{key:"fromLngLat",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=40075017,i=360*n/r,o=i/Math.cos(Math.PI/180*t.lat);return new e(new ot(t.lng-o,t.lat-i),new ot(t.lng+o,t.lat+i))}}]),e}(),gt="AbortError";var mt,yt={now:"undefined"!=typeof performance&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:function(e){return new Promise((function(t,n){var r=requestAnimationFrame(t);e.signal.addEventListener("abort",(function(){cancelAnimationFrame(r),n(new Error(gt))}))}))},get prefersReducedMotion(){return!!window.matchMedia&&(null==mt&&(mt=window.matchMedia("(prefers-reduced-motion: reduce)")),mt.matches)}},_t=n(2729),bt=n.n(_t);function xt(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function Et(e,t,n){if(n&&n[e]){var r=n[e].indexOf(t);-1!==r&&n[e].splice(r,1)}}var Tt=a()((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};i()(this,e),d()(this,"type",void 0),Je(this,n),this.type=t})),At=function(e){u()(n,e);var t=c()(n);function n(e){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i()(this,n),r=t.call(this,"error",o),d()(k()(r),"error",void 0),r.error=e,r}return a()(n)}(Tt),St=function(e){u()(n,e);var t=c()(n);function n(e,r){var o;return i()(this,n),o=t.call(this),d()(k()(o),"transform",void 0),d()(k()(o),"handlers",void 0),d()(k()(o),"_moving",void 0),d()(k()(o),"_zooming",void 0),d()(k()(o),"_rotating",void 0),d()(k()(o),"_pitching",void 0),d()(k()(o),"_padding",void 0),d()(k()(o),"_bearingSnap",void 0),d()(k()(o),"_easeStart",void 0),d()(k()(o),"_easeOptions",void 0),d()(k()(o),"_easeId",void 0),d()(k()(o),"_onEaseFrame",void 0),d()(k()(o),"_onEaseEnd",void 0),d()(k()(o),"_easeFrameId",void 0),d()(k()(o),"_requestedCameraState",void 0),d()(k()(o),"transformCameraUpdate",void 0),d()(k()(o),"_renderFrameCallback",(function(){var e=Math.min((yt.now()-o._easeStart)/o._easeOptions.duration,1);o._onEaseFrame(o._easeOptions.easing(e)),e<1&&o._easeFrameId?o._easeFrameId=o._requestRenderFrame(o._renderFrameCallback):o.stop()})),o._moving=!1,o._zooming=!1,o.transform=e,o._bearingSnap=r.bearingSnap,o.on("moveend",(function(){delete o._requestedCameraState})),o}return a()(n,[{key:"getCenter",value:function(){return new ot(this.transform.center.lng,this.transform.center.lat)}},{key:"setCenter",value:function(e,t){return this.jumpTo({center:e},t)}},{key:"panBy",value:function(e,t,n){return e=dt().convert(e).mult(-1),this.panTo(this.transform.center,Je({offset:e},t),n)}},{key:"panTo",value:function(e,t,n){return this.easeTo(Je({center:e},t),n)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"setZoom",value:function(e,t){return this.jumpTo({zoom:e},t),this}},{key:"zoomTo",value:function(e,t,n){return this.easeTo(Je({zoom:e},t),n)}},{key:"zoomIn",value:function(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}},{key:"zoomOut",value:function(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"setBearing",value:function(e,t){return this.jumpTo({bearing:e},t),this}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(e,t){return this.jumpTo({padding:e},t),this}},{key:"rotateTo",value:function(e,t,n){return this.easeTo(Je({bearing:e},t),n)}},{key:"resetNorth",value:function(e,t){return this.rotateTo(0,Je({duration:1e3},e),t),this}},{key:"resetNorthPitch",value:function(e,t){return this.easeTo(Je({bearing:0,pitch:0,duration:1e3},e),t),this}},{key:"snapToNorth",value:function(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setPitch",value:function(e,t){return this.jumpTo({pitch:e},t),this}},{key:"cameraForBounds",value:function(e,t){e=vt.convert(e);var n=t&&t.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),n,t)}},{key:"_cameraForBoxAndBearing",value:function(e,t,n,r){var i={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=Je({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){var o=r.padding;r.padding={top:o,bottom:o,right:o,left:o}}r.padding=Je(i,r.padding);var a=this.transform,s=a.padding,u=new vt(e,t),l=a.project(u.getNorthWest()),c=a.project(u.getNorthEast()),f=a.project(u.getSouthEast()),h=a.project(u.getSouthWest()),p=rt(-n),d=l.rotate(p),v=c.rotate(p),g=f.rotate(p),m=h.rotate(p),y=new(dt())(Math.max(d.x,v.x,m.x,g.x),Math.max(d.y,v.y,m.y,g.y)),_=new(dt())(Math.min(d.x,v.x,m.x,g.x),Math.min(d.y,v.y,m.y,g.y)),b=y.sub(_),x=(a.width-(s.left+s.right+r.padding.left+r.padding.right))/b.x,E=(a.height-(s.top+s.bottom+r.padding.top+r.padding.bottom))/b.y;if(!(E<0||x<0)){var T,A=Math.min(a.scaleZoom(a.scale*Math.min(x,E)),r.maxZoom),S=dt().convert(r.offset),C=(r.padding.left-r.padding.right)/2,R=(r.padding.top-r.padding.bottom)/2,w=new(dt())(C,R).rotate(rt(n)),M=S.add(w).mult(a.scale/a.zoomScale(A));return{center:a.unproject(l.add(f).div(2).sub(M)),zoom:A,bearing:n}}nt[T="Map cannot fit within canvas with the given bounds, padding, and/or offset."]||("undefined"!=typeof console&&console.warn(T),nt[T]=!0)}},{key:"fitBounds",value:function(e,t,n){return this._fitInternal(this.cameraForBounds(e,t),t,n)}},{key:"fitScreenCoordinates",value:function(e,t,n,r,i){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(dt().convert(e)),this.transform.pointLocation(dt().convert(t)),n,r),r,i)}},{key:"_fitInternal",value:function(e,t,n){return e?(delete(t=Je(e,t)).padding,t.linear?this.easeTo(t,n):this.flyTo(t,n)):this}},{key:"jumpTo",value:function(e,t){this.stop();var n=this._getTransformForUpdate(),r=!1,i=!1,o=!1;return"zoom"in e&&n.zoom!==+e.zoom&&(r=!0,n.zoom=+e.zoom),void 0!==e.center&&(n.center=ot.convert(e.center)),"bearing"in e&&n.bearing!==+e.bearing&&(i=!0,n.bearing=+e.bearing),"pitch"in e&&n.pitch!==+e.pitch&&(o=!0,n.pitch=+e.pitch),null==e.padding||n.isPaddingEqual(e.padding)||(n.padding=e.padding),this._applyUpdatedTransform(n),this.fire(new Tt("movestart",t)).fire(new Tt("move",t)),r&&this.fire(new Tt("zoomstart",t)).fire(new Tt("zoom",t)).fire(new Tt("zoomend",t)),i&&this.fire(new Tt("rotatestart",t)).fire(new Tt("rotate",t)).fire(new Tt("rotateend",t)),o&&this.fire(new Tt("pitchstart",t)).fire(new Tt("pitch",t)).fire(new Tt("pitchend",t)),this.fire(new Tt("moveend",t))}},{key:"calculateCameraOptionsFromTo",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=ht.fromLngLat(e,t),o=ht.fromLngLat(n,r),a=o.x-i.x,s=o.y-i.y,u=o.z-i.z,l=Math.hypot(a,s,u);if(0===l)throw new Error("Can't calculate camera options with same From and To");var c=Math.hypot(a,s),f=this.transform.scaleZoom(this.transform.cameraToCenterDistance/l/this.transform.tileSize),h=180*Math.atan2(a,-s)/Math.PI,p=180*Math.acos(c/l)/Math.PI;return p=u<0?90-p:90+p,{center:o.toLngLat(),zoom:f,pitch:p,bearing:h}}},{key:"easeTo",value:function(e,t){var n,r=this;this._stop(!1,e.easeId),(!1===(e=Je({offset:[0,0],duration:500,easing:tt},e)).animate||!e.essential&&yt.prefersReducedMotion)&&(e.duration=0);var i=this._getTransformForUpdate(),o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),l="bearing"in e?this._normalizeBearing(e.bearing,a):a,c="pitch"in e?+e.pitch:s,f="padding"in e?e.padding:i.padding,h=dt().convert(e.offset),p=i.centerPoint.add(h),d=i.pointLocation(p),v=i.getConstrained(ot.convert(e.center||d),null!==(n=e.zoom)&&void 0!==n?n:o),g=v.center,m=v.zoom;this._normalizeCenter(g);var y,_,b=i.project(d),x=i.project(g).sub(b),E=i.zoomScale(m-o);e.around&&(y=ot.convert(e.around),_=i.locationPoint(y));var T={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||m!==o,this._rotating=this._rotating||a!==l,this._pitching=this._pitching||c!==s,this._padding=!i.isPaddingEqual(f),this._easeId=e.easeId,this._prepareEase(t,e.noMoveStart,T),this._ease((function(e){if(r._zooming&&(i.zoom=qe(o,m,e)),r._rotating&&(i.bearing=qe(a,l,e)),r._pitching&&(i.pitch=qe(s,c,e)),r._padding&&(i.interpolatePadding(u,f,e),p=i.centerPoint.add(h)),y)i.setLocationAtPoint(y,_);else{var n=i.zoomScale(i.zoom-o),d=m>o?Math.min(2,E):Math.max(.5,E),v=Math.pow(d,1-e),g=i.unproject(b.add(x.mult(e*v)).mult(n));i.setLocationAtPoint(i.renderWorldCopies?g.wrap():g,p)}r._applyUpdatedTransform(i),r._fireMoveEvents(t)}),(function(e){r._afterEase(t,e)}),e),this}},{key:"_prepareEase",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._moving=!0,t||n.moving||this.fire(new Tt("movestart",e)),this._zooming&&!n.zooming&&this.fire(new Tt("zoomstart",e)),this._rotating&&!n.rotating&&this.fire(new Tt("rotatestart",e)),this._pitching&&!n.pitching&&this.fire(new Tt("pitchstart",e))}},{key:"_getTransformForUpdate",value:function(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}},{key:"_applyUpdatedTransform",value:function(e){if(this.transformCameraUpdate){var t=e.clone(),n=this.transformCameraUpdate(t),r=n.center,i=n.zoom,o=n.pitch,a=n.bearing,s=n.elevation;r&&(t.center=r),void 0!==i&&(t.zoom=i),void 0!==o&&(t.pitch=o),void 0!==a&&(t.bearing=a),void 0!==s&&(t.elevation=s),this.transform.apply(t)}}},{key:"_fireMoveEvents",value:function(e){this.fire(new Tt("move",e)),this._zooming&&this.fire(new Tt("zoom",e)),this._rotating&&this.fire(new Tt("rotate",e)),this._pitching&&this.fire(new Tt("pitch",e))}},{key:"_afterEase",value:function(e,t){if(!this._easeId||!t||this._easeId!==t){delete this._easeId;var n=this._zooming,r=this._rotating,i=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new Tt("zoomend",e)),r&&this.fire(new Tt("rotateend",e)),i&&this.fire(new Tt("pitchend",e)),this.fire(new Tt("moveend",e))}}},{key:"flyTo",value:function(e,t){var n,r=this;if(!e.essential&&yt.prefersReducedMotion){var i=function(e,t){for(var n={},r=0;r<t.length;r++){var i=t[r];i in e&&(n[i]=e[i])}return n}(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,t)}this.stop(),e=Je({offset:[0,0],speed:1.2,curve:1.42,easing:tt},e);var o=this._getTransformForUpdate(),a=this.getZoom(),s=this.getBearing(),u=this.getPitch(),l=this.getPadding(),c="bearing"in e?this._normalizeBearing(e.bearing,s):s,f="pitch"in e?+e.pitch:u,h="padding"in e?e.padding:o.padding,p=dt().convert(e.offset),d=o.centerPoint.add(p),v=o.pointLocation(d),g=o.getConstrained(ot.convert(e.center||v),null!==(n=e.zoom)&&void 0!==n?n:a),m=g.center,y=g.zoom;this._normalizeCenter(m);var _=o.zoomScale(y-a),b=o.project(v),x=o.project(m).sub(b),E=e.curve,T=Math.max(o.width,o.height),A=T/_,S=x.mag();if("minZoom"in e){var C=Ke(Math.min(e.minZoom,a,y),o.minZoom,o.maxZoom),R=T/o.zoomScale(C-a);E=Math.sqrt(R/S*2)}var w=E*E;function M(e){var t=(A*A-T*T+(e?-1:1)*w*w*S*S)/(2*(e?A:T)*w*S);return Math.log(Math.sqrt(t*t+1)-t)}function k(e){return(Math.exp(e)-Math.exp(-e))/2}function L(e){return(Math.exp(e)+Math.exp(-e))/2}var O=M(!1),I=function(e){return L(O)/L(O+E*e)},P=function(e){return T*((L(O)*(k(t=O+E*e)/L(t))-k(O))/w)/S;var t},N=(M(!0)-O)/E;if(Math.abs(S)<1e-6||!isFinite(N)){if(Math.abs(T-A)<1e-6)return this.easeTo(e,t);var B=A<T?-1:1;N=Math.abs(Math.log(A/T))/E,P=function(){return 0},I=function(e){return Math.exp(B*E*e)}}if("duration"in e)e.duration=+e.duration;else{var D="screenSpeed"in e?+e.screenSpeed/E:+e.speed;e.duration=1e3*N/D}return e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==c,this._pitching=f!==u,this._padding=!o.isPaddingEqual(h),this._prepareEase(t,!1),this._ease((function(e){var n=e*N,i=1/I(n);o.zoom=1===e?y:a+o.scaleZoom(i),r._rotating&&(o.bearing=qe(s,c,e)),r._pitching&&(o.pitch=qe(u,f,e)),r._padding&&(o.interpolatePadding(l,h,e),d=o.centerPoint.add(p));var v=1===e?m:o.unproject(b.add(x.mult(P(n))).mult(i));o.setLocationAtPoint(o.renderWorldCopies?v.wrap():v,d),r._applyUpdatedTransform(o),r._fireMoveEvents(t)}),(function(){r._afterEase(t)}),e),this}},{key:"isEasing",value:function(){return!!this._easeFrameId}},{key:"stop",value:function(){return this._stop()}},{key:"_stop",value:function(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var n=this._onEaseEnd;delete this._onEaseEnd,n.call(this,t)}var r;e||(null===(r=this.handlers)||void 0===r||r.stop(!1));return this}},{key:"_ease",value:function(e,t,n){!1===n.animate||0===n.duration?(e(1),t()):(this._easeStart=yt.now(),this._easeOptions=n,this._onEaseFrame=e,this._onEaseEnd=t,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}},{key:"_normalizeBearing",value:function(e,t){e=Qe(e,-180,180);var n=Math.abs(e-t);return Math.abs(e-360-t)<n&&(e-=360),Math.abs(e+360-t)<n&&(e+=360),e}},{key:"_normalizeCenter",value:function(e){var t=this.transform;if(t.renderWorldCopies&&!t.lngRange){var n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}}}]),n}(function(){function e(){i()(this,e),d()(this,"_listeners",void 0),d()(this,"_oneTimeListeners",void 0),d()(this,"_eventedParent",void 0),d()(this,"_eventedParentData",void 0)}return a()(e,[{key:"on",value:function(e,t){return this._listeners=this._listeners||{},xt(e,t,this._listeners),this}},{key:"off",value:function(e,t){return Et(e,t,this._listeners),Et(e,t,this._oneTimeListeners),this}},{key:"once",value:function(e,t){var n=this;return t?(this._oneTimeListeners=this._oneTimeListeners||{},xt(e,t,this._oneTimeListeners),this):new Promise((function(t){return n.once(e,t)}))}},{key:"fire",value:function(e,t){"string"==typeof e&&(e=new Tt(e,t||{}));var n=e.type;if(this.listens(n)){e.target=this;var r,i=this._listeners&&this._listeners[n]?this._listeners[n].slice():[],o=bt()(i);try{for(o.s();!(r=o.n()).done;){r.value.call(this,e)}}catch(e){o.e(e)}finally{o.f()}var a,s=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[],u=bt()(s);try{for(u.s();!(a=u.n()).done;){var l=a.value;Et(n,l,this._oneTimeListeners),l.call(this,e)}}catch(e){u.e(e)}finally{u.f()}var c=this._eventedParent;c&&(Je(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),c.fire(e))}else e instanceof At&&console.error(e.error);return this}},{key:"emit",value:function(e,t){return this.fire(e,t)}},{key:"listens",value:function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}},{key:"setEventedParent",value:function(e,t){return e&&(this._eventedParent=e),this._eventedParentData=t,this}}]),e}()),Ct=n(3794);var Rt,wt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(i()(this,e),d()(this,"top",void 0),d()(this,"bottom",void 0),d()(this,"left",void 0),d()(this,"right",void 0),isNaN(t)||t<0||isNaN(n)||n<0||isNaN(r)||r<0||isNaN(o)||o<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=n,this.left=r,this.right=o}return a()(e,[{key:"interpolate",value:function(e,t,n){return null!=t.top&&null!=e.top&&(this.top=qe(e.top,t.top,n)),null!=t.bottom&&null!=e.bottom&&(this.bottom=qe(e.bottom,t.bottom,n)),null!=t.left&&null!=e.left&&(this.left=qe(e.left,t.left,n)),null!=t.right&&null!=e.right&&(this.right=qe(e.right,t.right,n)),this}},{key:"getCenter",value:function(e,t){var n=Ke((this.left+e-this.right)/2,0,e),r=Ke((this.top+t-this.bottom)/2,0,t);return new(dt())(n,r)}},{key:"equals",value:function(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}},{key:"clone",value:function(){return new e(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),e}(),Mt=85.051129,kt=function(){function e(t,n,r,o,a){i()(this,e),d()(this,"tileSize",void 0),d()(this,"tileZoom",void 0),d()(this,"lngRange",void 0),d()(this,"latRange",void 0),d()(this,"scale",void 0),d()(this,"width",void 0),d()(this,"height",void 0),d()(this,"angle",void 0),d()(this,"rotationMatrix",void 0),d()(this,"pixelsToGLUnits",void 0),d()(this,"cameraToCenterDistance",void 0),d()(this,"mercatorMatrix",void 0),d()(this,"projMatrix",void 0),d()(this,"invProjMatrix",void 0),d()(this,"alignedProjMatrix",void 0),d()(this,"pixelMatrix",void 0),d()(this,"pixelMatrix3D",void 0),d()(this,"pixelMatrixInverse",void 0),d()(this,"glCoordMatrix",void 0),d()(this,"labelPlaneMatrix",void 0),d()(this,"minElevationForCurrentTile",void 0),d()(this,"_fov",void 0),d()(this,"_pitch",void 0),d()(this,"_zoom",void 0),d()(this,"_unmodified",void 0),d()(this,"_renderWorldCopies",void 0),d()(this,"_minZoom",void 0),d()(this,"_maxZoom",void 0),d()(this,"_minPitch",void 0),d()(this,"_maxPitch",void 0),d()(this,"_center",void 0),d()(this,"_elevation",void 0),d()(this,"_pixelPerMeter",void 0),d()(this,"_edgeInsets",void 0),d()(this,"_constraining",void 0),d()(this,"_posMatrixCache",void 0),d()(this,"_alignedPosMatrixCache",void 0),this.tileSize=512,this._renderWorldCopies=void 0===a||!!a,this._minZoom=t||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==o?60:o,this.setMaxBounds(),this.width=0,this.height=0,this._center=new ot(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new wt,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}return a()(e,[{key:"clone",value:function(){var t=new e(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.apply(this),t}},{key:"apply",value:function(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}},{key:"minZoom",get:function(){return this._minZoom},set:function(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}},{key:"minPitch",get:function(){return this._minPitch},set:function(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new(dt())(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(e){var t,n=-Qe(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=(t=new Ct.WT(4),Ct.WT!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t),function(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(n),u=Math.cos(n);e[0]=r*u+o*s,e[1]=i*u+a*s,e[2]=r*-s+o*u,e[3]=i*-s+a*u}(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(e){var t=Ke(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==t&&(this._unmodified=!1,this._pitch=t,this._calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(e){var t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._zoom=t,this.tileZoom=Math.max(0,Math.floor(t)),this.scale=this.zoomScale(t),this._constrain(),this._calcMatrices())}},{key:"center",get:function(){return this._center},set:function(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}},{key:"elevation",get:function(){return this._elevation},set:function(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}},{key:"padding",get:function(){return this._edgeInsets.toJSON()},set:function(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}},{key:"centerPoint",get:function(){return this._edgeInsets.getCenter(this.width,this.height)}},{key:"isPaddingEqual",value:function(e){return this._edgeInsets.equals(e)}},{key:"interpolatePadding",value:function(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this._constrain(),this._calcMatrices()}},{key:"coveringZoomLevel",value:function(e){var t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}},{key:"resize",value:function(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}},{key:"unmodified",get:function(){return this._unmodified}},{key:"zoomScale",value:function(e){return Math.pow(2,e)}},{key:"scaleZoom",value:function(e){return Math.log(e)/Math.LN2}},{key:"project",value:function(e){var t=Ke(e.lat,-85.051129,Mt);return new(dt())(ut(e.lng)*this.worldSize,lt(t)*this.worldSize)}},{key:"unproject",value:function(e){return new ht(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}},{key:"point",get:function(){return this.project(this.center)}},{key:"getCameraPosition",value:function(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}},{key:"setLocationAtPoint",value:function(e,t){var n=this.pointCoordinate(t),r=this.pointCoordinate(this.centerPoint),i=this.locationCoordinate(e),o=new ht(i.x-(n.x-r.x),i.y-(n.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"locationPoint",value:function(e){return this.coordinatePoint(this.locationCoordinate(e))}},{key:"pointLocation",value:function(e){return this.coordinateLocation(this.pointCoordinate(e))}},{key:"locationCoordinate",value:function(e){return ht.fromLngLat(e)}},{key:"coordinateLocation",value:function(e){return e&&e.toLngLat()}},{key:"pointCoordinate",value:function(e){var t=[e.x,e.y,0,1],n=[e.x,e.y,1,1];te.fF(t,t,this.pixelMatrixInverse),te.fF(n,n,this.pixelMatrixInverse);var r=t[3],i=n[3],o=t[1]/r,a=n[1]/i,s=t[2]/r,u=n[2]/i,l=s===u?0:(0-s)/(u-s);return new ht(qe(t[0]/r,n[0]/i,l)/this.worldSize,qe(o,a,l)/this.worldSize)}},{key:"coordinatePoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.pixelMatrix,r=[e.x*this.worldSize,e.y*this.worldSize,t,1];return te.fF(r,r,n),new(dt())(r[0]/r[3],r[1]/r[3])}},{key:"getBounds",value:function(){var e=Math.max(0,this.height/2-this.getHorizon());return(new vt).extend(this.pointLocation(new(dt())(0,e))).extend(this.pointLocation(new(dt())(this.width,e))).extend(this.pointLocation(new(dt())(this.width,this.height))).extend(this.pointLocation(new(dt())(0,this.height)))}},{key:"getMaxBounds",value:function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new vt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}},{key:"getHorizon",value:function(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}},{key:"setMaxBounds",value:function(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Mt])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"getConstrained",value:function(e,t){t=Ke(+t,this.minZoom,this.maxZoom);var n={center:new ot(e.lng,e.lat),zoom:t},r=this.lngRange;if(!this._renderWorldCopies&&null===r){var i=180-1e-10;r=[-i,i]}var o=this.tileSize*this.zoomScale(n.zoom),a=0,s=o,u=0,l=o,c=0,f=0,h=this.size,p=h.x,d=h.y;if(this.latRange){var v=this.latRange;a=lt(v[1])*o,(s=lt(v[0])*o)-a<d&&(c=d/(s-a))}r&&(u=Qe(ut(r[0])*o,0,o),(l=Qe(ut(r[1])*o,0,o))<u&&(l+=o),l-u<p&&(f=p/(l-u)));var g,m,y=this.project.call({worldSize:o},e),_=y.x,b=y.y,x=Math.max(f||0,c||0);if(x){var E=new(dt())(f?(l+u)/2:_,c?(s+a)/2:b);return n.center=this.unproject.call({worldSize:o},E).wrap(),n.zoom+=this.scaleZoom(x),n}if(this.latRange){var T=d/2;b-T<a&&(m=a+T),b+T>s&&(m=s-T)}if(r){var A=(u+l)/2,S=_;this._renderWorldCopies&&(S=Qe(_,A-o/2,A+o/2));var C=p/2;S-C<u&&(g=u+C),S+C>l&&(g=l-C)}if(void 0!==g||void 0!==m){var R,w,M=new(dt())(null!==(R=g)&&void 0!==R?R:_,null!==(w=m)&&void 0!==w?w:b);n.center=this.unproject.call({worldSize:o},M).wrap()}return n}},{key:"_constrain",value:function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e=this._unmodified,t=this.getConstrained(this.center,this.zoom),n=t.center,r=t.zoom;this.center=n,this.zoom=r,this._unmodified=e,this._constraining=!1}}},{key:"_calcMatrices",value:function(){if(this.height){var e=this._fov/2,t=this.centerOffset,n=this.point.x,r=this.point.y;this.cameraToCenterDistance=.5/Math.tan(e)*this.height,this._pixelPerMeter=ct(1,this.center.lat)*this.worldSize;var i=F.identity(new Float64Array(16));F.scale(i,i,[this.width/2,-this.height/2,1]),F.translate(i,i,[1,-1,0]),this.labelPlaneMatrix=i,i=F.identity(new Float64Array(16)),F.scale(i,i,[1,-1,1]),F.translate(i,i,[-1,-1,0]),F.scale(i,i,[2/this.width,2/this.height,1]),this.glCoordMatrix=i;var o=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),a=Math.min(this.elevation,this.minElevationForCurrentTile),s=o-a*this._pixelPerMeter/Math.cos(this._pitch),u=a<0?s:o,l=Math.PI/2+this._pitch,c=this._fov*(.5+t.y/this.height),f=Math.sin(c)*u/Math.sin(Ke(Math.PI-l-c,.01,Math.PI-.01)),h=this.getHorizon(),p=2*Math.atan(h/this.cameraToCenterDistance)*(.5+t.y/(2*h)),d=Math.sin(p)*u/Math.sin(Ke(Math.PI-l-p,.01,Math.PI-.01)),v=Math.min(f,d),g=1.01*(Math.cos(Math.PI/2-this._pitch)*v+u),m=this.height/50;i=new Float64Array(16),F.perspective(i,this._fov,this.width/this.height,m,g),i[8]=2*-t.x/this.width,i[9]=2*t.y/this.height,F.scale(i,i,[1,-1,1]),F.translate(i,i,[0,0,-this.cameraToCenterDistance]),F.rotateX(i,i,this._pitch),F.rotateZ(i,i,this.angle),F.translate(i,i,[-n,-r,0]),this.mercatorMatrix=F.scale([],i,[this.worldSize,this.worldSize,this.worldSize]),F.scale(i,i,[1,1,this._pixelPerMeter]),this.pixelMatrix=F.multiply(new Float64Array(16),this.labelPlaneMatrix,i),F.translate(i,i,[0,0,-this.elevation]),this.projMatrix=i,this.invProjMatrix=F.invert([],i),this.pixelMatrix3D=F.multiply(new Float64Array(16),this.labelPlaneMatrix,i);var y=this.width%2/2,_=this.height%2/2,b=Math.cos(this.angle),x=Math.sin(this.angle),E=n-Math.round(n)+b*y+x*_,T=r-Math.round(r)+b*_+x*y,A=new Float64Array(i);if(F.translate(A,A,[E>.5?E-1:E,T>.5?T-1:T,0]),this.alignedProjMatrix=A,!(i=F.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=i,this._posMatrixCache={},this._alignedPosMatrixCache={}}}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new(dt())(0,0)),t=[e.x*this.worldSize,e.y*this.worldSize,0,1];return te.fF(t,t,this.pixelMatrix)[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var e=this._pitch,t=Math.tan(e)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new(dt())(0,t))}},{key:"getCameraQueryGeometry",value:function(e){var t=this.getCameraPoint();if(1===e.length)return[e[0],t];var n,r=t.x,i=t.y,o=t.x,a=t.y,s=bt()(e);try{for(s.s();!(n=s.n()).done;){var u=n.value;r=Math.min(r,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y)}}catch(e){s.e(e)}finally{s.f()}return[new(dt())(r,i),new(dt())(o,i),new(dt())(o,a),new(dt())(r,a),new(dt())(r,i)]}},{key:"lngLatToCameraDepth",value:function(e,t){var n=this.locationCoordinate(e),r=[n.x*this.worldSize,n.y*this.worldSize,t,1];return te.fF(r,r,this.projMatrix),r[2]/r[3]}}]),e}(),Lt=function(){function e(){i()(this,e)}return a()(e,null,[{key:"testProp",value:function(t){if(!e.docStyle)return t[0];for(var n=0;n<t.length;n++)if(t[n]in e.docStyle)return t[n];return t[0]}},{key:"create",value:function(e,t,n){var r=window.document.createElement(e);return void 0!==t&&(r.className=t),n&&n.appendChild(r),r}},{key:"createNS",value:function(e,t){return window.document.createElementNS(e,t)}},{key:"disableDrag",value:function(){e.docStyle&&e.selectProp&&(e.userSelect=e.docStyle[e.selectProp],e.docStyle[e.selectProp]="none")}},{key:"enableDrag",value:function(){e.docStyle&&e.selectProp&&(e.docStyle[e.selectProp]=e.userSelect)}},{key:"setTransform",value:function(t,n){t.style[e.transformProp]=n}},{key:"addEventListener",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r?e.addEventListener(t,n,r):e.addEventListener(t,n,r.capture)}},{key:"removeEventListener",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r?e.removeEventListener(t,n,r):e.removeEventListener(t,n,r.capture)}},{key:"suppressClickInternal",value:function(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",e.suppressClickInternal,!0)}},{key:"suppressClick",value:function(){window.addEventListener("click",e.suppressClickInternal,!0),window.setTimeout((function(){window.removeEventListener("click",e.suppressClickInternal,!0)}),0)}},{key:"getScale",value:function(e){var t=e.getBoundingClientRect();return{x:t.width/e.offsetWidth||1,y:t.height/e.offsetHeight||1,boundingClientRect:t}}},{key:"getPoint",value:function(e,t,n){var r=t.boundingClientRect;return new(dt())((n.clientX-r.left)/t.x-e.clientLeft,(n.clientY-r.top)/t.y-e.clientTop)}},{key:"mousePos",value:function(t,n){var r=e.getScale(t);return e.getPoint(t,r,n)}},{key:"touchPos",value:function(t,n){for(var r=[],i=e.getScale(t),o=0;o<n.length;o++)r.push(e.getPoint(t,i,n[o]));return r}},{key:"mouseButton",value:function(e){return e.button}},{key:"remove",value:function(e){e.parentNode&&e.parentNode.removeChild(e)}}]),e}();Rt=Lt,d()(Lt,"docStyle","undefined"!=typeof window&&window.document&&window.document.documentElement.style),d()(Lt,"userSelect",void 0),d()(Lt,"selectProp",Rt.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"])),d()(Lt,"transformProp",Rt.testProp(["transform","WebkitTransform"]));var Ot=function(){function e(t){i()(this,e),d()(this,"_map",void 0),this._map=t}return a()(e,[{key:"transform",get:function(){return this._map._requestedCameraState||this._map.transform}},{key:"center",get:function(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}},{key:"zoom",get:function(){return this.transform.zoom}},{key:"pitch",get:function(){return this.transform.pitch}},{key:"bearing",get:function(){return this.transform.bearing}},{key:"unproject",value:function(e){return this.transform.pointLocation(dt().convert(e))}}]),e}(),It=function(){function e(t,n){i()(this,e),d()(this,"_map",void 0),d()(this,"_tr",void 0),d()(this,"_el",void 0),d()(this,"_container",void 0),d()(this,"_enabled",void 0),d()(this,"_active",void 0),d()(this,"_startPos",void 0),d()(this,"_lastPos",void 0),d()(this,"_box",void 0),d()(this,"_clickTolerance",void 0),this._map=t,this._tr=new Ot(t),this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=n.clickTolerance||1}return a()(e,[{key:"isEnabled",value:function(){return!!this._enabled}},{key:"isActive",value:function(){return!!this._active}},{key:"enable",value:function(){this.isEnabled()||(this._enabled=!0)}},{key:"disable",value:function(){this.isEnabled()&&(this._enabled=!1)}},{key:"mousedown",value:function(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(Lt.disableDrag(),this._startPos=this._lastPos=t,this._active=!0)}},{key:"mousemoveWindow",value:function(e,t){if(this._active){var n=t;if(!(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)){var r=this._startPos;this._lastPos=n,this._box||(this._box=Lt.create("div","l7-boxzoom",this._container),this._container.classList.add("l7-crosshair"),this._fireEvent("boxzoomstart",e));var i=Math.min(r.x,n.x),o=Math.max(r.x,n.x),a=Math.min(r.y,n.y),s=Math.max(r.y,n.y);Lt.setTransform(this._box,"translate(".concat(i,"px,").concat(a,"px)")),this._box.style.width="".concat(o-i,"px"),this._box.style.height="".concat(s-a,"px")}}}},{key:"mouseupWindow",value:function(e,t){var n=this;if(this._active&&0===e.button){var r=this._startPos,i=t;if(this.reset(),Lt.suppressClick(),r.x!==i.x||r.y!==i.y)return this._map.fire(new Tt("boxzoomend",{originalEvent:e})),{cameraAnimation:function(e){return e.fitScreenCoordinates(r,i,n._tr.bearing,{linear:!0})}};this._fireEvent("boxzoomcancel",e)}}},{key:"keydown",value:function(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}},{key:"reset",value:function(){this._active=!1,this._container.classList.remove("l7-crosshair"),this._box&&(Lt.remove(this._box),this._box=null),Lt.enableDrag(),delete this._startPos,delete this._lastPos}},{key:"_fireEvent",value:function(e,t){return this._map.fire(new Tt(e,{originalEvent:t}))}}]),e}(),Pt=function(){function e(t){i()(this,e),d()(this,"_tr",void 0),d()(this,"_enabled",void 0),d()(this,"_active",void 0),this._tr=new Ot(t),this.reset()}return a()(e,[{key:"reset",value:function(){this._active=!1}},{key:"dblclick",value:function(e,t){var n=this;return e.preventDefault(),{cameraAnimation:function(r){r.easeTo({duration:300,zoom:n._tr.zoom+(e.shiftKey?-1:1),around:n._tr.unproject(t)},{originalEvent:e})}}}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}}]),e}(),Nt=function(){function e(t,n){i()(this,e),d()(this,"_options",void 0),d()(this,"_map",void 0),d()(this,"_container",void 0),d()(this,"_bypassKey",-1!==navigator.userAgent.indexOf("Mac")?"metaKey":"ctrlKey"),d()(this,"_enabled",void 0),this._map=t,this._options=n,this._enabled=!1}return a()(e,[{key:"isActive",value:function(){return!1}},{key:"reset",value:function(){}},{key:"_setupUI",value:function(){if(!this._container){var e=this._map.getCanvasContainer();e.classList.add("l7-cooperative-gestures"),this._container=Lt.create("div","l7-cooperative-gesture-screen",e);var t=document.createElement("div");t.className="l7-desktop-message",t.textContent="Missing UI string",this._container.appendChild(t);var n=document.createElement("div");n.className="l7-mobile-message",n.textContent="Missing UI string",this._container.appendChild(n),this._container.setAttribute("aria-hidden","true")}}},{key:"_destoryUI",value:function(){this._container&&(Lt.remove(this._container),this._map.getCanvasContainer().classList.remove("l7-cooperative-gestures"));delete this._container}},{key:"enable",value:function(){this._setupUI(),this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this._destoryUI()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"touchmove",value:function(e){this._onCooperativeGesture(1===e.touches.length)}},{key:"wheel",value:function(e){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!e[this._bypassKey])}},{key:"_onCooperativeGesture",value:function(e){var t=this;this._enabled&&e&&(this._container.classList.add("l7-show"),setTimeout((function(){t._container.classList.remove("l7-show")}),100))}}]),e}(),Bt={panStep:100,bearingStep:15,pitchStep:10},Dt=function(){function e(t){i()(this,e),d()(this,"_tr",void 0),d()(this,"_enabled",void 0),d()(this,"_active",void 0),d()(this,"_panStep",void 0),d()(this,"_bearingStep",void 0),d()(this,"_pitchStep",void 0),d()(this,"_rotationDisabled",void 0),this._tr=new Ot(t);var n=Bt;this._panStep=n.panStep,this._bearingStep=n.bearingStep,this._pitchStep=n.pitchStep,this._rotationDisabled=!1}return a()(e,[{key:"reset",value:function(){this._active=!1}},{key:"keydown",value:function(e){var t=this;if(!(e.altKey||e.ctrlKey||e.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),o=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),o=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),a=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(r=0,i=0),{cameraAnimation:function(s){var u=t._tr;s.easeTo({duration:300,easeId:"keyboardHandler",easing:Ut,zoom:n?Math.round(u.zoom)+n*(e.shiftKey?2:1):u.zoom,bearing:u.bearing+r*t._bearingStep,pitch:u.pitch+i*t._pitchStep,offset:[-o*t._panStep,-a*t._panStep],center:u.center},{originalEvent:e})}}}}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}},{key:"disableRotation",value:function(){this._rotationDisabled=!0}},{key:"enableRotation",value:function(){this._rotationDisabled=!1}}]),e}();function Ut(e){return e*(2-e)}var Ft=function(e){u()(n,e);var t=c()(n);function n(e,r,o){var a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};i()(this,n),a=t.call(this,e,s),d()(k()(a),"target",void 0),d()(k()(a),"originalEvent",void 0),d()(k()(a),"point",void 0),d()(k()(a),"lngLat",void 0),d()(k()(a),"_defaultPrevented",void 0);var u=Lt.mousePos(r.getCanvasContainer(),o),l=r.unproject(u);return a.point=u,a.lngLat=l,a.originalEvent=o,a._defaultPrevented=!1,a.target=r,a}return a()(n,[{key:"preventDefault",value:function(){this._defaultPrevented=!0}},{key:"defaultPrevented",get:function(){return this._defaultPrevented}}]),n}(Tt),zt=function(e){u()(n,e);var t=c()(n);function n(e,r,o){var a;i()(this,n),a=t.call(this,e),d()(k()(a),"target",void 0),d()(k()(a),"originalEvent",void 0),d()(k()(a),"lngLat",void 0),d()(k()(a),"point",void 0),d()(k()(a),"points",void 0),d()(k()(a),"lngLats",void 0),d()(k()(a),"_defaultPrevented",void 0);var s="touchend"===e?o.changedTouches:o.touches,u=Lt.touchPos(r.getCanvasContainer(),s),l=u.map((function(e){return r.unproject(e)})),c=u.reduce((function(e,t,n,r){return e.add(t.div(r.length))}),new(dt())(0,0)),f=r.unproject(c);return a.target=r,a.points=u,a.point=c,a.lngLats=l,a.lngLat=f,a.originalEvent=o,a._defaultPrevented=!1,a}return a()(n,[{key:"preventDefault",value:function(){this._defaultPrevented=!0}},{key:"defaultPrevented",get:function(){return this._defaultPrevented}}]),n}(Tt),Gt=function(e){u()(n,e);var t=c()(n);function n(e,r,o){var a;return i()(this,n),a=t.call(this,e),d()(k()(a),"target",void 0),d()(k()(a),"originalEvent",void 0),d()(k()(a),"_defaultPrevented",void 0),a.target=r,a._defaultPrevented=!1,a.originalEvent=o,a}return a()(n,[{key:"preventDefault",value:function(){this._defaultPrevented=!0}},{key:"defaultPrevented",get:function(){return this._defaultPrevented}}]),n}(Tt),Vt=function(){function e(t,n){i()(this,e),d()(this,"_mousedownPos",void 0),d()(this,"_clickTolerance",void 0),d()(this,"_map",void 0),this._map=t,this._clickTolerance=n.clickTolerance}return a()(e,[{key:"reset",value:function(){delete this._mousedownPos}},{key:"wheel",value:function(e){return this._firePreventable(new Gt(e.type,this._map,e))}},{key:"mousedown",value:function(e,t){return this._mousedownPos=t,this._firePreventable(new Ft(e.type,this._map,e))}},{key:"mouseup",value:function(e){this._map.fire(new Ft(e.type,this._map,e))}},{key:"click",value:function(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||this._map.fire(new Ft(e.type,this._map,e))}},{key:"dblclick",value:function(e){return this._firePreventable(new Ft(e.type,this._map,e))}},{key:"mouseover",value:function(e){this._map.fire(new Ft(e.type,this._map,e))}},{key:"mouseout",value:function(e){this._map.fire(new Ft(e.type,this._map,e))}},{key:"touchstart",value:function(e){return this._firePreventable(new zt(e.type,this._map,e))}},{key:"touchmove",value:function(e){this._map.fire(new zt(e.type,this._map,e))}},{key:"touchend",value:function(e){this._map.fire(new zt(e.type,this._map,e))}},{key:"touchcancel",value:function(e){this._map.fire(new zt(e.type,this._map,e))}},{key:"_firePreventable",value:function(e){if(this._map.fire(e),e.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){}},{key:"disable",value:function(){}}]),e}(),jt=function(){function e(t){i()(this,e),d()(this,"_map",void 0),d()(this,"_delayContextMenu",void 0),d()(this,"_ignoreContextMenu",void 0),d()(this,"_contextMenuEvent",void 0),this._map=t}return a()(e,[{key:"reset",value:function(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}},{key:"mousemove",value:function(e){this._map.fire(new Ft(e.type,this._map,e))}},{key:"mousedown",value:function(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}},{key:"mouseup",value:function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ft("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}},{key:"contextmenu",value:function(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Ft(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){}},{key:"disable",value:function(){}}]),e}(),Ht=function(){function e(t){i()(this,e),d()(this,"contextmenu",void 0),d()(this,"mousedown",void 0),d()(this,"mousemoveWindow",void 0),d()(this,"mouseup",void 0),d()(this,"touchstart",void 0),d()(this,"touchmoveWindow",void 0),d()(this,"touchend",void 0),d()(this,"_clickTolerance",void 0),d()(this,"_moveFunction",void 0),d()(this,"_activateOnStart",void 0),d()(this,"_active",void 0),d()(this,"_enabled",void 0),d()(this,"_moved",void 0),d()(this,"_lastPoint",void 0),d()(this,"_moveStateManager",void 0),this._enabled=!!t.enable,this._moveStateManager=t.moveStateManager,this._clickTolerance=t.clickTolerance||1,this._moveFunction=t.move,this._activateOnStart=!!t.activateOnStart,t.assignEvents(this),this.reset()}return a()(e,[{key:"reset",value:function(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}},{key:"_move",value:function(){var e=this._moveFunction.apply(this,arguments);if(e.bearingDelta||e.pitchDelta||e.around||e.panDelta)return this._active=!0,e}},{key:"dragStart",value:function(e,t){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=t.length?t[0]:t,this._activateOnStart&&this._lastPoint&&(this._active=!0))}},{key:"dragMove",value:function(e,t){if(this.isEnabled()){var n=this._lastPoint;if(n)if(e.preventDefault(),this._moveStateManager.isValidMoveEvent(e)){var r=t.length?t[0]:t;if(this._moved||!(r.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=r,this._move(n,r)}else this.reset(e)}}},{key:"dragEnd",value:function(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&Lt.suppressClick(),this.reset(e))}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}},{key:"getClickTolerance",value:function(){return this._clickTolerance}}]),e}(),Wt=d()(d()({},0,1),2,2);var Xt=function(){function e(t){i()(this,e),d()(this,"_eventButton",void 0),d()(this,"_correctEvent",void 0),this._correctEvent=t.checkCorrectEvent}return a()(e,[{key:"startMove",value:function(e){var t=Lt.mouseButton(e);this._eventButton=t}},{key:"endMove",value:function(e){delete this._eventButton}},{key:"isValidStartEvent",value:function(e){return this._correctEvent(e)}},{key:"isValidMoveEvent",value:function(e){return!function(e,t){var n=Wt[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this._eventButton)}},{key:"isValidEndEvent",value:function(e){return Lt.mouseButton(e)===this._eventButton}}]),e}(),Zt=function(e){e.mousedown=e.dragStart,e.mousemoveWindow=e.dragMove,e.mouseup=e.dragEnd,e.contextmenu=function(e){e.preventDefault()}},Yt=4.000244140625,qt=function(){function e(t,n){var r=this;i()(this,e),d()(this,"_map",void 0),d()(this,"_tr",void 0),d()(this,"_enabled",void 0),d()(this,"_active",void 0),d()(this,"_zooming",void 0),d()(this,"_aroundCenter",void 0),d()(this,"_around",void 0),d()(this,"_aroundPoint",void 0),d()(this,"_type",void 0),d()(this,"_lastValue",void 0),d()(this,"_timeout",void 0),d()(this,"_finishTimeout",void 0),d()(this,"_lastWheelEvent",void 0),d()(this,"_lastWheelEventTime",void 0),d()(this,"_startZoom",void 0),d()(this,"_targetZoom",void 0),d()(this,"_delta",void 0),d()(this,"_easing",void 0),d()(this,"_prevEase",void 0),d()(this,"_frameId",void 0),d()(this,"_triggerRenderFrame",void 0),d()(this,"_defaultZoomRate",void 0),d()(this,"_wheelZoomRate",void 0),d()(this,"_onTimeout",(function(e){r._type="wheel",r._delta-=r._lastValue,r._active||r._start(e)})),this._map=t,this._tr=new Ot(t),this._triggerRenderFrame=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}return a()(e,[{key:"setZoomRate",value:function(e){this._defaultZoomRate=e}},{key:"setWheelZoomRate",value:function(e){this._wheelZoomRate=e}},{key:"isEnabled",value:function(){return!!this._enabled}},{key:"isActive",value:function(){return!!this._active||void 0!==this._finishTimeout}},{key:"isZooming",value:function(){return!!this._zooming}},{key:"enable",value:function(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around)}},{key:"disable",value:function(){this.isEnabled()&&(this._enabled=!1)}},{key:"wheel",value:function(e){if(this.isEnabled()&&(!this._map.cooperativeGestures.isEnabled()||e[this._map.cooperativeGestures._bypassKey])){var t=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,n=yt.now(),r=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==t&&t%Yt==0?this._type="wheel":0!==t&&Math.abs(t)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=t,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*t)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,t+=this._lastValue)),e.shiftKey&&t&&(t/=4),this._type&&(this._lastWheelEvent=e,this._delta-=t,this._active||this._start(e)),e.preventDefault()}}},{key:"_start",value:function(e){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var t=Lt.mousePos(this._map.getCanvasContainer(),e),n=this._tr;t.y>n.transform.height/2-n.transform.getHorizon()?this._around=ot.convert(this._aroundCenter?n.center:n.unproject(t)):this._around=ot.convert(n.center),this._aroundPoint=n.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}}},{key:"renderFrame",value:function(){var e=this;if(this._frameId&&(this._frameId=null,this.isActive())){var t=this._tr.transform;if(0!==this._delta){var n="wheel"===this._type&&Math.abs(this._delta)>Yt?this._wheelZoomRate:this._defaultZoomRate,r=2/(1+Math.exp(-Math.abs(this._delta*n)));this._delta<0&&0!==r&&(r=1/r);var i="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(i*r))),"wheel"===this._type&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var o,a="number"==typeof this._targetZoom?this._targetZoom:t.zoom,s=this._startZoom,u=this._easing,l=!1;if("wheel"===this._type&&s&&u){var c=Math.min((yt.now()-this._lastWheelEventTime)/200,1),f=u(c);o=qe(s,a,f),c<1?this._frameId||(this._frameId=!0):l=!0}else o=a,l=!0;return this._active=!0,l&&(this._active=!1,this._finishTimeout=setTimeout((function(){e._zooming=!1,e._triggerRenderFrame(),delete e._targetZoom,delete e._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!l,zoomDelta:o-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}}},{key:"_smoothOutEasing",value:function(e){var t=tt;if(this._prevEase){var n=this._prevEase,r=(yt.now()-n.start)/n.duration,i=n.easing(r+.01)-n.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01;t=et(o,Math.sqrt(.0729-o*o),.25,1)}return this._prevEase={start:yt.now(),duration:e,easing:t},t}},{key:"reset",value:function(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}]),e}(),Kt=function(){function e(t,n){i()(this,e),d()(this,"_clickZoom",void 0),d()(this,"_tapZoom",void 0),this._clickZoom=t,this._tapZoom=n}return a()(e,[{key:"enable",value:function(){this._clickZoom.enable(),this._tapZoom.enable()}},{key:"disable",value:function(){this._clickZoom.disable(),this._tapZoom.disable()}},{key:"isEnabled",value:function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}},{key:"isActive",value:function(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}]),e}(),Qt=function(){function e(t,n,r){i()(this,e),d()(this,"_el",void 0),d()(this,"_mousePan",void 0),d()(this,"_touchPan",void 0),d()(this,"_inertiaOptions",void 0),this._el=t,this._mousePan=n,this._touchPan=r}return a()(e,[{key:"enable",value:function(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}},{key:"isActive",value:function(){return this._mousePan.isActive()||this._touchPan.isActive()}}]),e}(),$t=function(){function e(t,n,r){i()(this,e),d()(this,"_mouseRotate",void 0),d()(this,"_mousePitch",void 0),d()(this,"_pitchWithRotate",void 0),this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=r}return a()(e,[{key:"enable",value:function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}},{key:"disable",value:function(){this._mouseRotate.disable(),this._mousePitch.disable()}},{key:"isEnabled",value:function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}},{key:"isActive",value:function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}]),e}(),Jt=function(){function e(t,n,r,o){i()(this,e),d()(this,"_el",void 0),d()(this,"_touchZoom",void 0),d()(this,"_touchRotate",void 0),d()(this,"_tapDragZoom",void 0),d()(this,"_rotationDisabled",void 0),d()(this,"_enabled",void 0),this._el=t,this._touchZoom=n,this._touchRotate=r,this._tapDragZoom=o,this._rotationDisabled=!1,this._enabled=!0}return a()(e,[{key:"enable",value:function(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this._rotationDisabled=!0,this._touchRotate.disable()}},{key:"enableRotation",value:function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}]),e}();function en(e,t){if(e.length!==t.length)throw new Error("The number of touches and points are not equal - touches ".concat(e.length,", points ").concat(t.length));for(var n={},r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}var tn=function(){function e(t){i()(this,e),d()(this,"numTouches",void 0),d()(this,"centroid",void 0),d()(this,"startTime",void 0),d()(this,"aborted",void 0),d()(this,"touches",void 0),this.reset(),this.numTouches=t.numTouches}return a()(e,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(e,t,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),n.length===this.numTouches&&(this.centroid=function(e){var t,n=new(dt())(0,0),r=bt()(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;n._add(i)}}catch(e){r.e(e)}finally{r.f()}return n.div(e.length)}(t),this.touches=en(n,t)))}},{key:"touchmove",value:function(e,t,n){if(!this.aborted&&this.centroid){var r=en(n,t);for(var i in this.touches){var o=this.touches[i],a=r[i];(!a||a.dist(o)>30)&&(this.aborted=!0)}}}},{key:"touchend",value:function(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}}}]),e}(),nn=function(){function e(t){i()(this,e),d()(this,"singleTap",void 0),d()(this,"numTaps",void 0),d()(this,"lastTime",void 0),d()(this,"lastTap",void 0),d()(this,"count",void 0),this.singleTap=new tn(t),this.numTaps=t.numTaps,this.reset()}return a()(e,[{key:"reset",value:function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(e,t,n){this.singleTap.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.singleTap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this.singleTap.touchend(e,t,n);if(r){var i=e.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(i&&o||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}]),e}(),rn=function(){function e(){i()(this,e),d()(this,"_enabled",void 0),d()(this,"_active",void 0),d()(this,"_swipePoint",void 0),d()(this,"_swipeTouch",void 0),d()(this,"_tapTime",void 0),d()(this,"_tapPoint",void 0),d()(this,"_tap",void 0),this._tap=new nn({numTouches:1,numTaps:1}),this.reset()}return a()(e,[{key:"reset",value:function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}},{key:"touchstart",value:function(e,t,n){if(!this._swipePoint)if(this._tapTime){var r=t[0],i=e.timeStamp-this._tapTime<500,o=this._tapPoint.dist(r)<30;i&&o?n.length>0&&(this._swipePoint=r,this._swipeTouch=n[0].identifier):this.reset()}else this._tap.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;var r=t[0],i=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){if(this._tapTime)this._swipePoint&&0===n.length&&this.reset();else{var r=this._tap.touchend(e,t,n);r&&(this._tapTime=e.timeStamp,this._tapPoint=r)}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}}]),e}(),on=function(){function e(t){i()(this,e),d()(this,"_tr",void 0),d()(this,"_enabled",void 0),d()(this,"_active",void 0),d()(this,"_zoomIn",void 0),d()(this,"_zoomOut",void 0),this._tr=new Ot(t),this._zoomIn=new nn({numTouches:1,numTaps:2}),this._zoomOut=new nn({numTouches:2,numTaps:1}),this.reset()}return a()(e,[{key:"reset",value:function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}},{key:"touchstart",value:function(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this,i=this._zoomIn.touchend(e,t,n),o=this._zoomOut.touchend(e,t,n),a=this._tr;return i?(this._active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:a.zoom+1,around:a.unproject(i)},{originalEvent:e})}}):o?(this._active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:a.zoom-1,around:a.unproject(o)},{originalEvent:e})}}):void 0}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}}]),e}(),an=function(){function e(t,n){i()(this,e),d()(this,"_enabled",void 0),d()(this,"_active",void 0),d()(this,"_touches",void 0),d()(this,"_clickTolerance",void 0),d()(this,"_sum",void 0),d()(this,"_map",void 0),this._clickTolerance=t.clickTolerance||1,this._map=n,this.reset()}return a()(e,[{key:"reset",value:function(){this._active=!1,this._touches={},this._sum=new(dt())(0,0)}},{key:"minTouchs",value:function(){return this._map.cooperativeGestures.isEnabled()?2:1}},{key:"touchstart",value:function(e,t,n){return this._calculateTransform(e,t,n)}},{key:"touchmove",value:function(e,t,n){if(this._active&&!(n.length<this.minTouchs()))return e.preventDefault(),this._calculateTransform(e,t,n)}},{key:"touchend",value:function(e,t,n){this._calculateTransform(e,t,n),this._active&&n.length<this.minTouchs()&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"_calculateTransform",value:function(e,t,n){n.length>0&&(this._active=!0);var r=en(n,t),i=new(dt())(0,0),o=new(dt())(0,0),a=0;for(var s in r){var u=r[s],l=this._touches[s];l&&(i._add(u),o._add(u.sub(l)),a++,r[s]=u)}if(this._touches=r,!(a<this.minTouchs())&&o.mag()){var c=o.div(a);if(this._sum._add(c),!(this._sum.mag()<this._clickTolerance))return{around:i.div(a),panDelta:c}}}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}}]),e}(),sn=function(){function e(){i()(this,e),d()(this,"_enabled",void 0),d()(this,"_active",void 0),d()(this,"_firstTwoTouches",void 0),d()(this,"_vector",void 0),d()(this,"_startVector",void 0),d()(this,"_aroundCenter",void 0),this.reset()}return a()(e,[{key:"reset",value:function(){this._active=!1,delete this._firstTwoTouches}},{key:"touchstart",value:function(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))}},{key:"touchmove",value:function(e,t,n){if(this._firstTwoTouches){e.preventDefault();var r=m()(this._firstTwoTouches,2),i=r[0],o=r[1],a=un(n,t,i),s=un(n,t,o);if(a&&s){var u=this._aroundCenter?null:a.add(s).div(2);return this._move([a,s],u,e)}}}},{key:"touchend",value:function(e,t,n){if(this._firstTwoTouches){var r=m()(this._firstTwoTouches,2),i=r[0],o=r[1],a=un(n,t,i),s=un(n,t,o);a&&s||(this._active&&Lt.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return!!this._enabled}},{key:"isActive",value:function(){return!!this._active}}]),e}();function un(e,t,n){for(var r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function ln(e,t){return Math.log(e/t)/Math.LN2}var cn=function(e){u()(n,e);var t=c()(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),d()(k()(e),"_distance",void 0),d()(k()(e),"_startDistance",void 0),e}return a()(n,[{key:"reset",value:function(){O()(P()(n.prototype),"reset",this).call(this),delete this._distance,delete this._startDistance}},{key:"_start",value:function(e){this._startDistance=this._distance=e[0].dist(e[1])}},{key:"_move",value:function(e,t){var n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(ln(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ln(this._distance,n),pinchAround:t}}}]),n}(sn);function fn(e,t){return 180*e.angleWith(t)/Math.PI}var hn=function(e){u()(n,e);var t=c()(n);function n(){var e;i()(this,n);for(var r=arguments.length,o=new Array(r),a=0;a<r;a++)o[a]=arguments[a];return e=t.call.apply(t,[this].concat(o)),d()(k()(e),"_minDiameter",void 0),e}return a()(n,[{key:"reset",value:function(){O()(P()(n.prototype),"reset",this).call(this),delete this._minDiameter,delete this._startVector,delete this._vector}},{key:"_start",value:function(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}},{key:"_move",value:function(e,t,n){var r=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:fn(this._vector,r),pinchAround:t}}},{key:"_isBelowThreshold",value:function(e){this._minDiameter=Math.min(this._minDiameter,e.mag());var t=25/(Math.PI*this._minDiameter)*360,n=fn(e,this._startVector);return Math.abs(n)<t}}]),n}(sn);function pn(e){return Math.abs(e.y)>Math.abs(e.x)}var dn=function(e){u()(n,e);var t=c()(n);function n(e){var r;return i()(this,n),r=t.call(this),d()(k()(r),"_valid",void 0),d()(k()(r),"_firstMove",void 0),d()(k()(r),"_lastPoints",void 0),d()(k()(r),"_map",void 0),d()(k()(r),"_currentTouchCount",0),r._map=e,r}return a()(n,[{key:"reset",value:function(){O()(P()(n.prototype),"reset",this).call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints}},{key:"touchstart",value:function(e,t,r){O()(P()(n.prototype),"touchstart",this).call(this,e,t,r),this._currentTouchCount=r.length}},{key:"_start",value:function(e){this._lastPoints=e,pn(e[0].sub(e[1]))&&(this._valid=!1)}},{key:"_move",value:function(e,t,n){if(!(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)){var r=e[0].sub(this._lastPoints[0]),i=e[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(r,i,n.timeStamp),this._valid){this._lastPoints=e,this._active=!0;return{pitchDelta:-.5*((r.y+i.y)/2)}}}}},{key:"gestureBeginsVertically",value:function(e,t,n){if(void 0!==this._valid)return this._valid;var r=e.mag()>=2,i=t.mag()>=2;if(r||i){if(!r||!i)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;var o=e.y>0==t.y>0;return pn(e)&&pn(t)&&o}}}]),n}(sn),vn={linearity:.3,easing:et(0,0,.3,1)},gn=Je({deceleration:2500,maxSpeed:1400},vn),mn=Je({deceleration:20,maxSpeed:1400},vn),yn=Je({deceleration:1e3,maxSpeed:360},vn),_n=Je({deceleration:1e3,maxSpeed:90},vn),bn=function(){function e(t){i()(this,e),d()(this,"_map",void 0),d()(this,"_inertiaBuffer",void 0),this._map=t,this.clear()}return a()(e,[{key:"clear",value:function(){this._inertiaBuffer=[]}},{key:"record",value:function(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:yt.now(),settings:e})}},{key:"_drainInertiaBuffer",value:function(){for(var e=this._inertiaBuffer,t=yt.now();e.length>0&&t-e[0].time>160;)e.shift()}},{key:"_onMoveEnd",value:function(e){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){var t,n={zoom:0,bearing:0,pitch:0,pan:new(dt())(0,0),pinchAround:void 0,around:void 0},r=bt()(this._inertiaBuffer);try{for(r.s();!(t=r.n()).done;){var i=t.value.settings;n.zoom+=i.zoomDelta||0,n.bearing+=i.bearingDelta||0,n.pitch+=i.pitchDelta||0,i.panDelta&&n.pan._add(i.panDelta),i.around&&(n.around=i.around),i.pinchAround&&(n.pinchAround=i.pinchAround)}}catch(e){r.e(e)}finally{r.f()}var o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,a={};if(n.pan.mag()){var s=En(n.pan.mag(),o,Je({},gn,e||{}));a.offset=n.pan.mult(s.amount/n.pan.mag()),a.center=this._map.transform.center,xn(a,s)}if(n.zoom){var u=En(n.zoom,o,mn);a.zoom=this._map.transform.zoom+u.amount,xn(a,u)}if(n.bearing){var l=En(n.bearing,o,yn);a.bearing=this._map.transform.bearing+Ke(l.amount,-179,179),xn(a,l)}if(n.pitch){var c=En(n.pitch,o,_n);a.pitch=this._map.transform.pitch+c.amount,xn(a,c)}if(a.zoom||a.bearing){var f=void 0===n.pinchAround?n.around:n.pinchAround;a.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),Je(a,{noMoveStart:!0})}}}]),e}();function xn(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function En(e,t,n){var r=n.maxSpeed,i=n.linearity,o=n.deceleration,a=Ke(e*i/(t/1e3),-r,r),s=Math.abs(a)/(o*i);return{easing:n.easing,duration:1e3*s,amount:a*(s/2)}}var Tn=function(e){return e.zoom||e.drag||e.pitch||e.rotate},An=function(e){u()(n,e);var t=c()(n);function n(e,r){var o;return i()(this,n),o=t.call(this,e),d()(k()(o),"type","renderFrame"),d()(k()(o),"timeStamp",void 0),o.timeStamp=r,o}return a()(n)}(Tt);function Sn(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var Cn=function(){function e(t,n){var r=this;i()(this,e),d()(this,"_map",void 0),d()(this,"_el",void 0),d()(this,"_handlers",void 0),d()(this,"_eventsInProgress",void 0),d()(this,"_frameId",void 0),d()(this,"_inertia",void 0),d()(this,"_bearingSnap",void 0),d()(this,"_handlersById",void 0),d()(this,"_updatingCamera",void 0),d()(this,"_changes",void 0),d()(this,"_zoom",void 0),d()(this,"_previousActiveHandlers",void 0),d()(this,"_listeners",void 0),d()(this,"handleWindowEvent",(function(e){r.handleEvent(e,"".concat(e.type,"Window"))})),d()(this,"handleEvent",(function(e,t){if("blur"!==e.type){r._updatingCamera=!0;var n,i="renderFrame"===e.type?void 0:e,o={needsRenderFrame:!1},a={},s={},u=e.touches,l=u?r._getMapTouches(u):void 0,c=l?Lt.touchPos(r._map.getCanvasContainer(),l):Lt.mousePos(r._map.getCanvasContainer(),e),f=bt()(r._handlers);try{for(f.s();!(n=f.n()).done;){var h=n.value,p=h.handlerName,d=h.handler,v=h.allowed;if(d.isEnabled()){var g=void 0;r._blockedByActive(s,v,p)?d.reset():d[t||e.type]&&(g=d[t||e.type](e,c,l),r.mergeHandlerResult(o,a,g,p,i),g&&g.needsRenderFrame&&r._triggerRenderFrame()),(g||d.isActive())&&(s[p]=d)}}}catch(e){f.e(e)}finally{f.f()}var m={};for(var y in r._previousActiveHandlers)s[y]||(m[y]=i);r._previousActiveHandlers=s,(Object.keys(m).length||Sn(o))&&(r._changes.push([o,a,m]),r._triggerRenderFrame()),(Object.keys(s).length||Sn(o))&&r._map._stop(!0),r._updatingCamera=!1;var _=o.cameraAnimation;_&&(r._inertia.clear(),r._fireEvents({},{},!0),r._changes=[],_(r._map))}else r.stop(!0)})),this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new bn(t),this._bearingSnap=n.bearingSnap||7,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(n);var o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[window,"blur",void 0]];var a,s=bt()(this._listeners);try{for(s.s();!(a=s.n()).done;){var u=m()(a.value,3),l=u[0],c=u[1],f=u[2];Lt.addEventListener(l,c,l===document?this.handleWindowEvent:this.handleEvent,f)}}catch(e){s.e(e)}finally{s.f()}}return a()(e,[{key:"destroy",value:function(){var e,t=bt()(this._listeners);try{for(t.s();!(e=t.n()).done;){var n=m()(e.value,3),r=n[0],i=n[1],o=n[2];Lt.removeEventListener(r,i,r===document?this.handleWindowEvent:this.handleEvent,o)}}catch(e){t.e(e)}finally{t.f()}}},{key:"_addDefaultHandlers",value:function(e){var t=this,n=this._map,r=n.getCanvasContainer();this._add("mapEvent",new Vt(n,e));var i=n.boxZoom=new It(n,e);this._add("boxZoom",i),e.interactive&&e.boxZoom&&i.enable();var o=n.cooperativeGestures=new Nt(n,e.cooperativeGestures);this._add("cooperativeGestures",o),e.cooperativeGestures&&o.enable();var a=new on(n),s=new Pt(n);n.doubleClickZoom=new Kt(s,a),this._add("tapZoom",a),this._add("clickZoom",s),e.interactive&&e.doubleClickZoom&&n.doubleClickZoom.enable();var u=new rn;this._add("tapDragZoom",u);var l=n.touchPitch=new dn(n);this._add("touchPitch",l),e.interactive&&e.touchPitch&&n.touchPitch.enable(e.touchPitch);var c,f,h,p,d,v,g=(f=(c=e).enable,h=c.clickTolerance,p=c.bearingDegreesPerPixelMoved,d=void 0===p?.8:p,v=new Xt({checkCorrectEvent:function(e){return 0===Lt.mouseButton(e)&&e.ctrlKey||2===Lt.mouseButton(e)}}),new Ht({clickTolerance:h,move:function(e,t){return{bearingDelta:(t.x-e.x)*d}},moveStateManager:v,enable:f,assignEvents:Zt})),m=function(e){var t=e.enable,n=e.clickTolerance,r=e.pitchDegreesPerPixelMoved,i=void 0===r?-.5:r,o=new Xt({checkCorrectEvent:function(e){return 0===Lt.mouseButton(e)&&e.ctrlKey||2===Lt.mouseButton(e)}});return new Ht({clickTolerance:n,move:function(e,t){return{pitchDelta:(t.y-e.y)*i}},moveStateManager:o,enable:t,assignEvents:Zt})}(e);n.dragRotate=new $t(e,g,m),this._add("mouseRotate",g,["mousePitch"]),this._add("mousePitch",m,["mouseRotate"]),e.interactive&&e.dragRotate&&n.dragRotate.enable();var y=function(e){var t=e.enable,n=e.clickTolerance,r=new Xt({checkCorrectEvent:function(e){return 0===Lt.mouseButton(e)&&!e.ctrlKey}});return new Ht({clickTolerance:n,move:function(e,t){return{around:t,panDelta:t.sub(e)}},activateOnStart:!0,moveStateManager:r,enable:t,assignEvents:Zt})}(e),_=new an(e,n);n.dragPan=new Qt(r,y,_),this._add("mousePan",y),this._add("touchPan",_,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&n.dragPan.enable(e.dragPan);var b=new hn,x=new cn;n.touchZoomRotate=new Jt(r,x,b,u),this._add("touchRotate",b,["touchPan","touchZoom"]),this._add("touchZoom",x,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&n.touchZoomRotate.enable(e.touchZoomRotate);var E=n.scrollZoom=new qt(n,(function(){return t._triggerRenderFrame()}));this._add("scrollZoom",E,["mousePan"]),e.interactive&&e.scrollZoom&&n.scrollZoom.enable(e.scrollZoom);var T=n.keyboard=new Dt(n);this._add("keyboard",T),e.interactive&&e.keyboard&&n.keyboard.enable(),this._add("blockableMapEvent",new jt(n))}},{key:"_add",value:function(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t}},{key:"stop",value:function(e){if(!this._updatingCamera){var t,n=bt()(this._handlers);try{for(n.s();!(t=n.n()).done;){t.value.handler.reset()}}catch(e){n.e(e)}finally{n.f()}this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}},{key:"isActive",value:function(){var e,t=bt()(this._handlers);try{for(t.s();!(e=t.n()).done;){if(e.value.handler.isActive())return!0}}catch(e){t.e(e)}finally{t.f()}return!1}},{key:"isZooming",value:function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this._eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean(Tn(this._eventsInProgress))||this.isZooming()}},{key:"_blockedByActive",value:function(e,t,n){for(var r in e)if(r!==n&&(!t||t.indexOf(r)<0))return!0;return!1}},{key:"_getMapTouches",value:function(e){var t,n=[],r=bt()(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,o=i.target;this._el.contains(o)&&n.push(i)}}catch(e){r.e(e)}finally{r.f()}return n}},{key:"mergeHandlerResult",value:function(e,t,n,r,i){if(n){Je(e,n);var o={handlerName:r,originalEvent:n.originalEvent||i};void 0!==n.zoomDelta&&(t.zoom=o),void 0!==n.panDelta&&(t.drag=o),void 0!==n.pitchDelta&&(t.pitch=o),void 0!==n.bearingDelta&&(t.rotate=o)}}},{key:"_applyChanges",value:function(){var e,t={},n={},r={},i=bt()(this._changes);try{for(i.s();!(e=i.n()).done;){var o=m()(e.value,3),a=o[0],s=o[1],u=o[2];a.panDelta&&(t.panDelta=(t.panDelta||new(dt())(0,0))._add(a.panDelta)),a.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(t.around=a.around),void 0!==a.pinchAround&&(t.pinchAround=a.pinchAround),a.noInertia&&(t.noInertia=a.noInertia),Je(n,s),Je(r,u)}}catch(e){i.e(e)}finally{i.f()}this._updateMapTransform(t,n,r),this._changes=[]}},{key:"_updateMapTransform",value:function(e,t,n){var r=this._map,i=r._getTransformForUpdate();if(!Sn(e))return this._fireEvents(t,n,!0);var o=e.panDelta,a=e.zoomDelta,s=e.bearingDelta,u=e.pitchDelta,l=e.pinchAround,c=e.around;void 0!==l&&(c=l),r._stop(!0),c=c||r.transform.centerPoint;var f=i.pointLocation(o?c.sub(o):c);s&&(i.bearing+=s),u&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(f,c),r._applyUpdatedTransform(i),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(t,n,!0)}},{key:"_fireEvents",value:function(e,t,n){var r=this,i=Tn(this._eventsInProgress),o=Tn(e),a={};for(var s in e){var u=e[s].originalEvent;this._eventsInProgress[s]||(a["".concat(s,"start")]=u),this._eventsInProgress[s]=e[s]}for(var l in!i&&o&&this._fireEvent("movestart",o.originalEvent),a)this._fireEvent(l,a[l]);for(var c in o&&this._fireEvent("move",o.originalEvent),e){var f=e[c].originalEvent;this._fireEvent(c,f)}var h,p={};for(var d in this._eventsInProgress){var v=this._eventsInProgress[d],g=v.handlerName,m=v.originalEvent;this._handlersById[g].isActive()||(delete this._eventsInProgress[d],h=t[g]||m,p["".concat(d,"end")]=h)}for(var y in p)this._fireEvent(y,p[y]);var _=Tn(this._eventsInProgress);if(n&&((i||o)&&!_)){this._updatingCamera=!0;var b=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),x=function(e){return 0!==e&&-r._bearingSnap<e&&e<r._bearingSnap};!b||!b.essential&&yt.prefersReducedMotion?(this._map.fire(new Tt("moveend",{originalEvent:h})),x(this._map.getBearing())&&this._map.resetNorth()):(x(b.bearing||this._map.getBearing())&&(b.bearing=0),b.freezeElevation=!0,this._map.easeTo(b,{originalEvent:h})),this._updatingCamera=!1}}},{key:"_fireEvent",value:function(e,t){this._map.fire(new Tt(e,t?{originalEvent:t}:{}))}},{key:"_requestFrame",value:function(){var e=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(t){delete e._frameId,e.handleEvent(new An("renderFrame",t)),e._applyChanges()}))}},{key:"_triggerRenderFrame",value:function(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}]),e}(),Rn=function(){function e(){i()(this,e),d()(this,"_queue",void 0),d()(this,"_id",void 0),d()(this,"_cleared",void 0),d()(this,"_currentlyRunning",void 0),this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}return a()(e,[{key:"add",value:function(e){var t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}},{key:"remove",value:function(e){var t,n=this._currentlyRunning,r=n?this._queue.concat(n):this._queue,i=bt()(r);try{for(i.s();!(t=i.n()).done;){var o=t.value;if(o.id===e)return void(o.cancelled=!0)}}catch(e){i.e(e)}finally{i.f()}}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");var t=this._currentlyRunning=this._queue;this._queue=[];var n,r=bt()(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.cancelled&&(i.callback(e),this._cleared))break}}catch(e){r.e(e)}finally{r.f()}this._cleared=!1,this._currentlyRunning=!1}},{key:"clear",value:function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}]),e}();!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".l7-map {\n  font:\n    12px/20px 'Helvetica Neue',\n    Arial,\n    Helvetica,\n    sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: grab;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  touch-action: none;\n}\n\n.l7-canvas-container.l7-touch-drag-pan.l7-cooperative-gestures,\n.l7-canvas-container.l7-touch-drag-pan.l7-cooperative-gestures .l7-canvas {\n  touch-action: pan-x pan-y;\n}\n\n.l7-cooperative-gesture-screen {\n  background: rgba(0 0 0 / 40%);\n  position: absolute;\n  inset: 0;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: white;\n  padding: 1rem;\n  font-size: 1.4em;\n  line-height: 1.2;\n  opacity: 0;\n  pointer-events: none;\n  transition: opacity 1s ease 1s;\n  z-index: 99999;\n}\n\n.l7-cooperative-gesture-screen.l7-show {\n  opacity: 1;\n  transition: opacity 0.05s;\n}\n\n.l7-cooperative-gesture-screen .l7-mobile-message {\n  display: none;\n}\n\n@media (hover: none), (width <= 480px) {\n  .l7-cooperative-gesture-screen .l7-desktop-message {\n    display: none;\n  }\n\n  .l7-cooperative-gesture-screen .l7-mobile-message {\n    display: block;\n  }\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right {\n  position: absolute;\n  pointer-events: none;\n  z-index: 2;\n}\n.l7-ctrl-top-left {\n  top: 0;\n  left: 0;\n}\n.l7-ctrl-top-right {\n  top: 0;\n  right: 0;\n}\n.l7-ctrl-bottom-left {\n  bottom: 0;\n  left: 0;\n}\n.l7-ctrl-bottom-right {\n  right: 0;\n  bottom: 0;\n}\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl {\n  margin: 10px 0 0 10px;\n  float: left;\n}\n.l7-ctrl-top-right .l7-ctrl {\n  margin: 10px 10px 0 0;\n  float: right;\n}\n.l7-ctrl-bottom-left .l7-ctrl {\n  margin: 0 0 10px 10px;\n  float: left;\n}\n.l7-ctrl-bottom-right .l7-ctrl {\n  margin: 0 10px 10px 0;\n  float: right;\n}\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n  cursor: crosshair;\n}\n\n.l7-boxzoom {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 0;\n  height: 0;\n  background: #fff;\n  border: 2px dotted #202020;\n  opacity: 0.5;\n  z-index: 10;\n}\n");var wn={interactive:!0,bearingSnap:7,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,fadeDuration:300,clickTolerance:3,pitchWithRotate:!0},Mn=function(e){u()(n,e);var t=c()(n);function n(e){var r;i()(this,n);var o=h()(h()({},wn),e);if(null!=o.minZoom&&null!=o.maxZoom&&o.minZoom>o.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=o.minPitch&&null!=o.maxPitch&&o.minPitch>o.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=o.minPitch&&o.minPitch<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(null!=o.maxPitch&&o.maxPitch>85)throw new Error("maxPitch must be less than or equal to ".concat(85));var a=new kt(o.minZoom,o.maxZoom,o.minPitch,o.maxPitch,o.renderWorldCopies);if(r=t.call(this,a,{bearingSnap:o.bearingSnap}),d()(k()(r),"_container",void 0),d()(k()(r),"_canvasContainer",void 0),d()(k()(r),"_interactive",void 0),d()(k()(r),"_frameRequest",void 0),d()(k()(r),"_loaded",void 0),d()(k()(r),"_idleTriggered",!1),d()(k()(r),"_fullyLoaded",void 0),d()(k()(r),"_trackResize",void 0),d()(k()(r),"_resizeObserver",void 0),d()(k()(r),"_preserveDrawingBuffer",void 0),d()(k()(r),"_failIfMajorPerformanceCaveat",void 0),d()(k()(r),"_fadeDuration",void 0),d()(k()(r),"_crossSourceCollisions",void 0),d()(k()(r),"_crossFadingFactor",1),d()(k()(r),"_collectResourceTiming",void 0),d()(k()(r),"_renderTaskQueue",new Rn),d()(k()(r),"_mapId",$e++),d()(k()(r),"_removed",void 0),d()(k()(r),"_clickTolerance",void 0),d()(k()(r),"scrollZoom",void 0),d()(k()(r),"boxZoom",void 0),d()(k()(r),"dragRotate",void 0),d()(k()(r),"dragPan",void 0),d()(k()(r),"keyboard",void 0),d()(k()(r),"doubleClickZoom",void 0),d()(k()(r),"touchZoomRotate",void 0),d()(k()(r),"touchPitch",void 0),d()(k()(r),"cooperativeGestures",void 0),d()(k()(r),"_onMapScroll",(function(e){if(e.target===r._container)return r._container.scrollTop=0,r._container.scrollLeft=0,!1})),r._interactive=o.interactive,r._trackResize=!0===o.trackResize,r._bearingSnap=o.bearingSnap,r._fadeDuration=o.fadeDuration,r._clickTolerance=o.clickTolerance,"string"==typeof o.container){if(r._container=document.getElementById(o.container),!r._container)throw new Error("Container '".concat(o.container,"' not found."))}else{if(!(o.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");r._container=o.container}if(o.maxBounds&&r.setMaxBounds(o.maxBounds),r._setupContainer(),r.on("move",(function(){return r._update()})).on("moveend",(function(){return r._update()})).on("zoom",(function(){return r._update()})).once("idle",(function(){r._idleTriggered=!0})),"undefined"!=typeof window){var s=!1,u=U.rU.throttle((function(e){r._trackResize&&!r._removed&&r.resize(e)._update()}),50);r._resizeObserver=new ResizeObserver((function(e){s?u(e):s=!0})),r._resizeObserver.observe(r._container)}return r.handlers=new Cn(k()(r),o),r.jumpTo({center:o.center,zoom:o.zoom,bearing:o.bearing,pitch:o.pitch}),o.bounds&&(r.resize(),r.fitBounds(o.bounds,Je({},o.fitBoundsOptions,{duration:0}))),r.resize(),r}return a()(n,[{key:"_getMapId",value:function(){return this._mapId}},{key:"calculateCameraOptionsFromTo",value:function(e,t,r,i){return O()(P()(n.prototype),"calculateCameraOptionsFromTo",this).call(this,e,t,r,i)}},{key:"resize",value:function(e){var t,n=this._containerDimensions(),r=n[0],i=n[1];this.transform.resize(r,i),null===(t=this._requestedCameraState)||void 0===t||t.resize(r,i);var o=!this._moving;return o&&(this.stop(),this.fire(new Tt("movestart",e)).fire(new Tt("move",e))),this.fire(new Tt("resize",e)),o&&this.fire(new Tt("moveend",e)),this}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(e){return this.transform.setMaxBounds(e&&vt.convert(e)),this._update()}},{key:"setMinZoom",value:function(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between ".concat(-2," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to ".concat(0));if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between ".concat(0," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(e){if((e=null==e?60:e)>85)throw new Error("maxPitch must be less than or equal to ".concat(85));if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(e){this.transform.renderWorldCopies=e}},{key:"project",value:function(e){return this.transform.locationPoint(ot.convert(e))}},{key:"unproject",value:function(e){return this.transform.pointLocation(dt().convert(e))}},{key:"isMoving",value:function(){var e;return this._moving||(null===(e=this.handlers)||void 0===e?void 0:e.isMoving())}},{key:"isZooming",value:function(){var e;return this._zooming||(null===(e=this.handlers)||void 0===e?void 0:e.isZooming())}},{key:"isRotating",value:function(){var e;return this._rotating||(null===(e=this.handlers)||void 0===e?void 0:e.isRotating())}},{key:"on",value:function(e,t){return O()(P()(n.prototype),"on",this).call(this,e,t)}},{key:"once",value:function(e,t){return O()(P()(n.prototype),"once",this).call(this,e,t)}},{key:"off",value:function(e,t){return O()(P()(n.prototype),"off",this).call(this,e,t)}},{key:"getContainer",value:function(){return this._container}},{key:"getCanvasContainer",value:function(){return this._canvasContainer}},{key:"_containerDimensions",value:function(){var e=0,t=0;return this._container&&(e=this._container.clientWidth||400,t=this._container.clientHeight||300),[e,t]}},{key:"_setupContainer",value:function(){var e=this._container;e.classList.add("l7-map");var t=this._canvasContainer=Lt.create("div","l7-canvas-container",e);this._interactive&&t.classList.add("l7-interactive"),this._container.addEventListener("scroll",this._onMapScroll,!1)}},{key:"_update",value:function(){return this.triggerRepaint(),this}},{key:"_requestRenderFrame",value:function(e){return this._update(),this._renderTaskQueue.add(e)}},{key:"_cancelRenderFrame",value:function(e){this._renderTaskQueue.remove(e)}},{key:"_render",value:function(e){if(this._renderTaskQueue.run(e),!this._removed)return this.fire(new Tt("render")),this.isMoving()||this.fire(new Tt("idle")),this}},{key:"remove",value:function(){var e;this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.handlers.destroy(),delete this.handlers,null===(e=this._resizeObserver)||void 0===e||e.disconnect(),Lt.remove(this._canvasContainer),this._container.classList.remove("l7-map"),this._removed=!0,this.fire(new Tt("remove"))}},{key:"triggerRepaint",value:function(){var e=this;this._frameRequest||(this._frameRequest=new AbortController,yt.frameAsync(this._frameRequest).then((function(t){e._frameRequest=null,e._render(t)})).catch((function(){})))}},{key:"getCameraTargetElevation",value:function(){return this.transform.elevation}}]),n}(St),kn=function(){function e(){i()(this,e),d()(this,"xzReg",.6*-Math.PI),d()(this,"yReg",.2*Math.PI),d()(this,"earthCameraRadius",200),d()(this,"earthCameraZoom",1),d()(this,"cameraPosition",z.create()),d()(this,"viewport",void 0),d()(this,"projectionMatrix",F.create()),d()(this,"modelMatrix",F.create()),d()(this,"viewMatrix",F.create()),d()(this,"viewProjectionMatrix",F.create()),d()(this,"ViewProjectionMatrixUncentered",F.create()),d()(this,"viewUncenteredMatrix",F.create())}return a()(e,[{key:"syncWithMapCamera",value:function(e){var t=e.viewportHeight,n=void 0===t?1:t,r=e.viewportWidth,i=(void 0===r?1:r)/n;F.perspective(this.projectionMatrix,20,i,.1,1e4);var o=this.earthCameraRadius*Math.cos(this.xzReg),a=this.earthCameraRadius*Math.sin(this.xzReg),s=this.earthCameraRadius*Math.sin(this.yReg);this.cameraPosition=z.fromValues(o,s,a),z.normalize(this.cameraPosition,this.cameraPosition),z.multiply(this.cameraPosition,this.cameraPosition,z.fromValues(this.earthCameraRadius,this.earthCameraRadius,this.earthCameraRadius)),z.scale(this.cameraPosition,this.cameraPosition,this.earthCameraZoom);var u=z.create();z.cross(u,this.cameraPosition,z.fromValues(0,1,0));var l=z.fromValues(0,1,0);z.cross(l,u,this.cameraPosition);var c=z.fromValues(0,0,0);F.lookAt(this.viewMatrix,this.cameraPosition,c,l),this.viewUncenteredMatrix=F.clone(this.viewMatrix),F.multiply(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),F.multiply(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"rotateY",value:function(e){this.xzReg+=e*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"rotateX",value:function(e){this.yReg+=e*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"scaleZoom",value:function(e){this.earthCameraZoom+=e,this.earthCameraZoom=Math.max(this.earthCameraZoom,.6)}},{key:"getZoom",value:function(){return 4}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[0,0]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return this.modelMatrix}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(e,t){return this.viewport.projectFlat(e,t)}}]),e}(),Ln=["id","style","rotation"],On={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},In=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"version","GLOBEL"),d()(k()(e),"dragging",!1),d()(k()(e),"viewport",void 0),d()(k()(e),"handleCameraChanging",void 0),d()(k()(e),"handleCameraTimer",void 0),d()(k()(e),"handleCameraChanged",(function(t){e.emit("mapchange");e.handleCameraChanging=!0,e.handleCameraTimer&&clearTimeout(e.handleCameraTimer),e.handleCameraTimer=setTimeout((function(){e.handleCameraChanging=!1}),2e3);var n=.02;t.type&&t.originalEvent&&("wheel"===t.originalEvent.type&&e.viewport.scaleZoom(.01*Math.sign(t.originalEvent.wheelDelta)*-1),Math.abs(t.originalEvent.movementX)>Math.abs(t.originalEvent.movementY)?t.originalEvent.movementX>0?e.viewport.rotateY(n):t.originalEvent.movementX<0&&e.viewport.rotateY(-.02):t.originalEvent.movementY>0?e.viewport.rotateX(n):t.originalEvent.movementY<0&&e.viewport.rotateX(-.02));var r=e.config.offsetCoordinate,i=void 0===r||r;e.viewport.syncWithMapCamera({viewportHeight:e.map.transform.height,viewportWidth:e.map.transform.width}),e.viewport.getZoom()>12&&i?e.coordinateSystemService.setCoordinateSystem(D.CoordinateSystem.LNGLAT_OFFSET):e.coordinateSystemService.setCoordinateSystem(D.CoordinateSystem.LNGLAT),e.cameraChangedCallback(e.viewport)})),e}return a()(r,[{key:"lngLatToMercator",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getModelMatrix",value:function(e,t,n,r,i){throw new Error("Method not implemented.")}},{key:"on",value:function(e,t){-1!==D.MapServiceEvent.indexOf(e)?this.eventEmitter.on(e,t):this.map.on(On[e]||e,t)}},{key:"off",value:function(e,t){this.map.off(On[e]||e,t),this.eventEmitter.off(e,t)}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var e=this.map.transform;return[e.width,e.height]}},{key:"getType",value:function(){return"earth"}},{key:"init",value:(t=w()(A()().mark((function e(){var t,n,r,i,o,a;return A()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,t.style,i=t.rotation,o=void 0===i?0:i,a=C()(t,Ln),this.viewport=new kn,this.$mapContainer=this.creatMapContainer(r),this.map=new Mn(h()({container:this.$mapContainer,bearing:o},a)),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged({});case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e;null===(e=this.$mapContainer)||void 0===e||null===(e=e.parentNode)||void 0===e||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"getCanvasOverlays",value:function(){}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"rotateY",value:function(e){var t=e||{},n=t.force,r=void 0!==n&&n,i=t.reg,o=void 0===i?.01:i;this.handleCameraChanging&&!r||this.viewport&&(this.viewport.rotateY(o),this.viewport.syncWithMapCamera({viewportHeight:this.map.transform.height,viewportWidth:this.map.transform.width}),this.cameraChangedCallback(this.viewport))}}]),r}(Ne),Pn=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return In}}]),n}(v);if(!window)throw Error("Google Map JSAPI can only be used in Browser.");var Nn=function(e){return e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed",e}(Nn||{}),Bn={key:""},Dn={GMap:Nn.notload},Un=[],Fn=function(e){if("function"==typeof e){if(Dn.GMap===Nn.loaded)return void e(window.google.maps.Map);Un.push(e)}},zn=function(e){return new Promise((function(t,n){if(Dn.GMap===Nn.failed)n("");else if(Dn.GMap===Nn.notload){var r=e.key;if(!r)return void n("请填写key");Bn.key=r,Dn.GMap=Nn.loading,window.initMap=function(e){if(delete window.initMap,e)Dn.GMap=Nn.failed,n(e);else for(Dn.GMap=Nn.loaded;Un.length;)Un.splice(0,1)[0](window.google.maps.Map)};var i=document.createElement("script");i.type="text/javascript",i.async=!1,i.src="https://maps.googleapis.com/maps/api/js?key=".concat(Bn.key,"&callback=initMap"),i.onerror=function(e){Dn.GMap=Nn.failed,n(e)},(document.body||document.head).appendChild(i),Fn(t)}else if(Dn.GMap===Nn.loaded){if(e.key&&e.key!==Bn.key)return void n("多个不一致的 key");Fn(t)}}))},Gn=["id","mapInstance","center","token","minZoom","maxZoom","logoVisible"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}("img[src*='//mapapi.qq.com/web/jsapi/logo/logo_def.png'],.logo-text\n{\n  display: none !important;\n}\n");var Vn={mapmove:"center_changed",camerachange:["drag","pan","rotate","tilt","zoom_changed"],zoomchange:"zoom_changed",dragging:"drag"},jn=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"viewport",null),d()(k()(e),"evtCbProxyMap",new Map),d()(k()(e),"handleCameraChanged",(function(){e.emit("mapchange");var t=e.map,n=t.getCenter(),r=n.lng,i=n.lat,o={center:[r(),i()],viewportHeight:t.getDiv().clientHeight,viewportWidth:t.getDiv().clientWidth,bearing:t.getHeading(),pitch:t.getTilt(),zoom:t.getZoom()-1};e.viewport.syncWithMapCamera(o),e.updateCoordinateSystemService(),e.cameraChangedCallback(e.viewport)})),e}return a()(r,[{key:"init",value:(t=w()(A()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,f,p,d,v,g,m,y;return A()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.viewport=new Ee,n=this.config,r=n.id,i=n.mapInstance,o=n.center,a=void 0===o?[121.30654632240122,31.25744185633306]:o,s=n.token,u=void 0===s?"AIzaSyDBDCfl4pvuDtaazdCog3LmhA7CQLhmcRE":s,l=n.minZoom,c=void 0===l?3:l,f=n.maxZoom,p=void 0===f?18:f,d=n.logoVisible,v=void 0===d||d,g=C()(n,Gn),null!==(t=window.google)&&void 0!==t&&null!==(t=t.maps)&&void 0!==t&&t.Map||i){e.next=5;break}return e.next=5,zn({key:u});case 5:if(!i){e.next=11;break}this.map=i,this.$mapContainer=this.map.getDiv(),!1===v&&this.hideLogo(),e.next=18;break;case 11:if(r){e.next=13;break}throw Error("No container id specified");case 13:m=U.SO.getContainer(r),y=new google.maps.Map(m,h()({maxZoom:p,minZoom:c,zoomControl:!1,fullscreenControl:!1,center:new google.maps.LatLng(a[1],a[0])},g)),this.map=y,this.$mapContainer=y.getDiv(),!1===v&&this.hideLogo();case 18:google.maps.event.addListener(this.map,"drag",this.handleCameraChanged),google.maps.event.addListener(this.map,"pan",this.handleCameraChanged),google.maps.event.addListener(this.map,"rotate",this.handleCameraChanged),google.maps.event.addListener(this.map,"idle",this.handleCameraChanged),google.maps.event.addListener(this.map,"zoom_changed",this.handleCameraChanged),this.handleCameraChanged();case 24:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){this.map.setMap(null)}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"addMarkerContainer",value:function(){}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getCanvasOverlays",value:function(){return this.map.getDiv()}},{key:"on",value:function(e,t){var n=this;if(-1!==D.MapServiceEvent.indexOf(e))this.eventEmitter.on(e,t);else{var r=function(e){var r=n.evtCbProxyMap.get(e);if(r||n.evtCbProxyMap.set(e,r=new Map),!r.get(t)){var i=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];!n[0]||"object"!==Oe()(n[0])||n[0].lngLat||n[0].lnglat||(n[0].lngLat=n[0].latlng||n[0].latLng),t.apply(void 0,n)};r.set(t,i),n.map.on(e,i)}};Array.isArray(Vn[e])?Vn[e].forEach((function(t){r(t||e)})):r(Vn[e]||e)}}},{key:"off",value:function(e,t){var n=this;if(-1===D.MapServiceEvent.indexOf(e)){var r=function(r){var i,o,a=null===(i=n.evtCbProxyMap.get(e))||void 0===i?void 0:i.get(t);a&&(null===(o=n.evtCbProxyMap.get(r))||void 0===o||o.delete(t),n.map.off(r,a))};Array.isArray(Vn[e])?Vn[e].forEach((function(t){r(t||e)})):r(Vn[e]||e)}else this.eventEmitter.off(e,t)}},{key:"once",value:function(){throw new Error("Method not implemented.")}},{key:"getContainer",value:function(){return this.map.getDiv()}},{key:"getSize",value:function(){return[this.map.width,this.map.height]}},{key:"getMinZoom",value:function(){return this.map.transform._minZoom}},{key:"getMaxZoom",value:function(){return this.map.transform._maxZoom}},{key:"getType",value:function(){return"googlemap"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getCenter",value:function(){var e=this.map.getCenter(),t=e.lng,n=e.lat;return{lng:t(),lat:n()}}},{key:"getPitch",value:function(){return this.map.getTilt()}},{key:"getRotation",value:function(){return this.map.getHeading()}},{key:"getBounds",value:function(){var e=this.map.getBounds(),t=null==e?void 0:e.getNorthEast(),n=null==e?void 0:e.getSouthWest();return[[n.lng(),n.lat()],[t.lng(),t.lat()]]}},{key:"getMapContainer",value:function(){return this.map.getDiv()}},{key:"getMapCanvasContainer",value:function(){var e;return null===(e=this.map.getDiv())||void 0===e?void 0:e.getElementsByTagName("canvas")[0]}},{key:"getMapStyleConfig",value:function(){throw new Error("Method not implemented.")}},{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"setMapStyle",value:function(e){this.map.setMapStyleId(e)}},{key:"setRotation",value:function(e){this.map.setHeading(e)}},{key:"zoomIn",value:function(){var e=this.map.getZoom();this.map.setZoom(e+1)}},{key:"zoomOut",value:function(){var e=this.map.getZoom();this.map.setZoom(e-1)}},{key:"panTo",value:function(e){var t=m()(e,2),n=t[0],r=t[1];this.map.panTo({lat:r,lng:n})}},{key:"panBy",value:function(e,t){this.map.panBy(e,t)}},{key:"fitBounds",value:function(e,t){var n=m()(e,2),r=n[0],i=n[1],o=new google.maps.LatLngBounds({lat:r[1],lng:r[0]},{lat:i[1],lng:i[0]});this.map.fitBounds(o,t)}},{key:"setZoomAndCenter",value:function(e,t){var n=m()(t,2),r=n[0],i=n[1];this.map.setZoom(e),this.map.setCenter({lat:i,lng:r})}},{key:"setCenter",value:function(e){var t=m()(e,2),n=t[0],r=t[1];this.map.setCenter({lat:r,lng:n})}},{key:"setPitch",value:function(e){this.map.setTilt(e)}},{key:"setZoom",value:function(e){this.map.setZoom(e)}},{key:"setMapStatus",value:function(e){var t=this;Object.keys(e).map((function(n){switch(n){case"doubleClickZoom":t.map.setOptions({gestureHandling:e.doubleClickZoom?"auto":"none"});break;case"dragEnable":t.map.setOptions({draggable:e.dragEnable});break;case"rotateEnable":break;case"zoomEnable":t.map.setOptions({zoomControl:e.zoomEnable});break;case"keyboardEnable":case"resizeEnable":case"showIndoorMap":throw Error("Options may not be supported")}}))}},{key:"meterToCoord",value:function(e,t){var n=m()(e,2),r=n[0],i=n[1],o=m()(t,2),a=o[0],s=o[1],u=google.maps.geometry.spherical.computeDistanceBetween([new google.maps.LatLng(i,r),new google.maps.LatLng(s,a)]),l=this.lngLatToCoord([r,i]),c=m()(l,2),f=c[0],h=c[1],p=this.lngLatToCoord([a,s]),d=m()(p,2),v=d[0],g=d[1];return Math.sqrt(Math.pow(f-v,2)+Math.pow(h-g,2))/u}},{key:"pixelToLngLat",value:function(e){var t=m()(e,2),n=t[0],r=t[1],i=this.map.getCenter(),o=i.lng,a=i.lat,s=this.lngLatToPixel([o(),a()]),u=s.x,l=s.y,c=this.lngLatToContainer([o(),a()]),f=c.x,h=c.y,p=this.map.unprojectFromContainer(new google.maps.Point(f+(n-u),h+(r-l))),d=p.lng,v=p.lat;return this.containerToLngLat([d,v])}},{key:"lngLatToPixel",value:function(e){var t=m()(e,2),n=t[0],r=t[1],i=new google.maps.LatLng(r,n),o=this.map.getProjection().fromLatLngToPoint(i);return{x:o.x,y:o.y}}},{key:"containerToLngLat",value:function(e){var t,n=m()(e,2),r=n[0],i=n[1],o=new google.maps.Point(r,i),a=null===(t=this.map.getProjection())||void 0===t?void 0:t.fromPointToLatLng(o);return{lng:a.lng(),lat:a.lat()}}},{key:"lngLatToContainer",value:function(e){var t,n,r=m()(e,2),i=r[0],o=r[1],a=new google.maps.LatLng(o,i),s=null===(t=this.map.getProjection())||void 0===t||null===(n=t.fromLatLngToContainerPixel)||void 0===n?void 0:n.call(t,a);return{x:s.x,y:s.y}}},{key:"lngLatToCoord",value:function(e){var t=m()(e,2),n=t[0],r=t[1],i=this.lngLatToPixel([n,r]);return[i.x,-i.y]}},{key:"lngLatToCoords",value:function(e){var t=this;return e.map((function(e){return Array.isArray(e[0])?t.lngLatToCoords(e):t.lngLatToCoord(e)}))}},{key:"lngLatToMercator",value:function(e,t){var n=ht.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=F.create();return F.translate(o,o,z.fromValues(i[0],i[1],t)),F.scale(o,o,z.fromValues(r[0],r[1],r[2])),F.rotateX(o,o,n[0]),F.rotateY(o,o,n[1]),F.rotateZ(o,o,n[2]),o}},{key:"getCustomCoordCenter",value:function(){throw new Error("Method not implemented.")}},{key:"exportMap",value:function(e){var t=this.getMapCanvasContainer();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"rotateY",value:function(){throw new Error("Method not implemented.")}},{key:"hideLogo",value:function(){var e=this.map.getDiv();e&&U.SO.addClass(e,"tmap-contianer--hide-logo")}}]),r}(Ne),Hn=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return jn}}]),n}(v),Wn=["id","style","rotation","mapInstance","version","mapSize","interactive"],Xn=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"version",Te.DEFAULT),d()(k()(e),"viewport",void 0),e}return a()(r,[{key:"lngLatToCoord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(e,0),r=n.x,i=n.y;return[r-t.x,i-t.y]}},{key:"lngLatToMercator",value:function(e,t){var n=ht.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=ht.fromLngLat(e,t),a=o.meterInMercatorCoordinateUnits(),s=F.create();return F.translate(s,s,z.fromValues(o.x-i.x,o.y-i.y,o.z||0-i.z)),F.scale(s,s,z.fromValues(a*r[0],-a*r[1],a*r[2])),F.rotateX(s,s,n[0]),F.rotateY(s,s,n[1]),F.rotateZ(s,s,n[2]),s}},{key:"init",value:(t=w()(A()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,f,p,d,v=this;return A()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,t.style,i=t.rotation,o=void 0===i?0:i,a=t.mapInstance,s=t.version,u=void 0===s?"DEFAULTMAP":s,l=t.mapSize,c=void 0===l?1e4:l,f=t.interactive,p=void 0===f||f,d=C()(t,Wn),this.viewport=new Ee,this.version=u,this.simpleMapCoord.setSize(c),"SIMPLE"===u&&d.center&&(d.center=this.simpleMapCoord.unproject(d.center)),a?(this.map=a,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new Mn(h()({container:this.$mapContainer,bearing:o},d))),this.map.on("load",(function(){v.handleCameraChanged()})),p&&this.map.on("move",this.handleCameraChanged),setTimeout((function(){v.handleCameraChanged()}),100),this.handleCameraChanged();case 10:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"creatMapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",t.appendChild(n),n}},{key:"exportMap",value:function(e){return""}},{key:"setMapStyle",value:function(e){}},{key:"getCanvasOverlays",value:function(){return this.getContainer()}}]),r}(Ne),Zn=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return Xn}}]),n}(v),Yn=n(5012),qn=n.n(Yn),Kn=["id","attributionControl","style","token","rotation","mapInstance"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{flex-direction:column-reverse}.mapboxgl-popup-anchor-left{flex-direction:row}.mapboxgl-popup-anchor-right{flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:\"\";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px;box-sizing:border-box;box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}"),window.mapboxgl=qn();var Qn=0,$n="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",Jn=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"version","MAPBOX"),d()(k()(e),"viewport",void 0),e}return a()(r,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(e,0),r=n.x,i=n.y;return[r-t.x,i-t.y]}},{key:"lngLatToMercator",value:function(e,t){var n=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=window.mapboxgl.MercatorCoordinate.fromLngLat(e,t),a=o.meterInMercatorCoordinateUnits(),s=F.create();return F.translate(s,s,z.fromValues(o.x-i.x,o.y-i.y,o.z||0-i.z)),F.scale(s,s,z.fromValues(a*r[0],-a*r[1],a*r[2])),F.rotateX(s,s,n[0]),F.rotateY(s,s,n[1]),F.rotateZ(s,s,n[2]),s}},{key:"init",value:(t=w()(A()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,f,p,d,v=this;return A()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.attributionControl,o=void 0!==i&&i,a=t.style,s=void 0===a?"light":a,u=t.token,l=void 0===u?$n:u,c=t.rotation,f=void 0===c?0:c,p=t.mapInstance,d=C()(t,Kn),this.viewport=new Ee,p||window.mapboxgl||console.error(this.configService.getSceneWarninfo("SDK")),l!==$n||"blank"===s||window.mapboxgl.accessToken||p||console.warn(this.configService.getSceneWarninfo("MapToken")),p||window.mapboxgl.accessToken||(window.mapboxgl.accessToken=l),p?(this.map=p,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new window.mapboxgl.Map(h()({container:this.$mapContainer,style:this.getMapStyleValue(s),attributionControl:o,bearing:f},d))),this.map.on("load",(function(){v.handleCameraChanged()})),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e;null===(e=this.$mapContainer)||void 0===e||null===(e=e.parentNode)||void 0===e||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"getCanvasOverlays",value:function(){var e;return null===(e=this.getMapContainer())||void 0===e?void 0:e.querySelector(".mapboxgl-canvas-container")}},{key:"meterToCoord",value:function(e,t){var n=new(qn().LngLat)(e[0],e[1]),r=new(qn().LngLat)(t[0],t[1]),i=n.distanceTo(r),o=qn().MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),a=qn().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),s=o.x,u=o.y,l=a.x,c=a.y;return 4194304*Math.sqrt(Math.pow(s-l,2)+Math.pow(u-c,2))*2/i}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"creatMapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_mapbox_div"+Qn++,t.appendChild(n),n}}]),r}(Ne);!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".mapboxgl-ctrl-logo {\n  display: none !important;\n}\n");var er=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return Jn}}]),n}(v),tr=n(9427),nr=n.n(tr),rr=["id","attributionControl","style","rotation","mapInstance"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}(".maplibregl-map{-webkit-tap-highlight-color:rgb(0 0 0/0);font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative}.maplibregl-canvas{left:0;position:absolute;top:0}.maplibregl-map:-moz-full-screen{height:100%;width:100%}.maplibregl-map:-ms-fullscreen{height:100%;width:100%}.maplibregl-map:fullscreen{height:100%;width:100%}.maplibregl-ctrl-group button.maplibregl-ctrl-compass{touch-action:none}.maplibregl-canvas-container.maplibregl-interactive,.maplibregl-ctrl-group button.maplibregl-ctrl-compass{cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.maplibregl-canvas-container.maplibregl-interactive.maplibregl-track-pointer{cursor:pointer}.maplibregl-canvas-container.maplibregl-interactive:active,.maplibregl-ctrl-group button.maplibregl-ctrl-compass:active{cursor:grabbing}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-canvas-container.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:pinch-zoom}.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan,.maplibregl-canvas-container.maplibregl-touch-zoom-rotate.maplibregl-touch-drag-pan .maplibregl-canvas{touch-action:none}.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures,.maplibregl-canvas-container.maplibregl-touch-drag-pan.maplibregl-cooperative-gestures .maplibregl-canvas{touch-action:pan-x pan-y}.maplibregl-ctrl-bottom-left,.maplibregl-ctrl-bottom-right,.maplibregl-ctrl-top-left,.maplibregl-ctrl-top-right{pointer-events:none;position:absolute;z-index:2}.maplibregl-ctrl-top-left{left:0;top:0}.maplibregl-ctrl-top-right{right:0;top:0}.maplibregl-ctrl-bottom-left{bottom:0;left:0}.maplibregl-ctrl-bottom-right{bottom:0;right:0}.maplibregl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.maplibregl-ctrl-top-left .maplibregl-ctrl{float:left;margin:10px 0 0 10px}.maplibregl-ctrl-top-right .maplibregl-ctrl{float:right;margin:10px 10px 0 0}.maplibregl-ctrl-bottom-left .maplibregl-ctrl{float:left;margin:0 0 10px 10px}.maplibregl-ctrl-bottom-right .maplibregl-ctrl{float:right;margin:0 10px 10px 0}.maplibregl-ctrl-group{background:#fff;border-radius:4px}.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.maplibregl-ctrl-group:not(:empty){box-shadow:0 0 0 2px ButtonText}}.maplibregl-ctrl-group button{background-color:transparent;border:0;box-sizing:border-box;cursor:pointer;display:block;height:29px;outline:none;padding:0;width:29px}.maplibregl-ctrl-group button+button{border-top:1px solid #ddd}.maplibregl-ctrl button .maplibregl-ctrl-icon{background-position:50%;background-repeat:no-repeat;display:block;height:100%;width:100%}@media (-ms-high-contrast:active){.maplibregl-ctrl-icon{background-color:transparent}.maplibregl-ctrl-group button+button{border-top:1px solid ButtonText}}.maplibregl-ctrl button::-moz-focus-inner{border:0;padding:0}.maplibregl-ctrl-attrib-button:focus,.maplibregl-ctrl-group button:focus{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl button:disabled{cursor:not-allowed}.maplibregl-ctrl button:disabled .maplibregl-ctrl-icon{opacity:.25}.maplibregl-ctrl button:not(:disabled):hover{background-color:rgb(0 0 0/5%)}.maplibregl-ctrl-group button:focus:focus-visible{box-shadow:0 0 2px 2px #0096ff}.maplibregl-ctrl-group button:focus:not(:focus-visible){box-shadow:none}.maplibregl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.maplibregl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.maplibregl-ctrl-group button:focus:only-child{border-radius:inherit}.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-zoom-out .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-zoom-in .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-fullscreen .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-shrink .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23999' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-compass .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 29 29'%3E%3Cpath d='m10.5 14 4-8 4 8h-8z'/%3E%3Cpath fill='%23ccc' d='m10.5 16 4 8 4-8h-8z'/%3E%3C/svg%3E\")}}.maplibregl-ctrl button.maplibregl-ctrl-terrain .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%23333' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-terrain-enabled .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='22' height='22' fill='%2333b5e5' viewBox='0 0 22 22'%3E%3Cpath d='m1.754 13.406 4.453-4.851 3.09 3.09 3.281 3.277.969-.969-3.309-3.312 3.844-4.121 6.148 6.886h1.082v-.855l-7.207-8.07-4.84 5.187L6.169 6.57l-5.48 5.965v.871ZM.688 16.844h20.625v1.375H.688Zm0 0'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23333' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23aaa' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1 9-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-waiting .maplibregl-ctrl-icon{-webkit-animation:maplibregl-spin 2s linear infinite;animation:maplibregl-spin 2s linear infinite}@media (-ms-high-contrast:active){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23fff' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23999' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1 9-9z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-active-error .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e58978' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%2333b5e5' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate.maplibregl-ctrl-geolocate-background-error .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23e54e33' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.maplibregl-ctrl button.maplibregl-ctrl-geolocate .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.maplibregl-ctrl button.maplibregl-ctrl-geolocate:disabled .maplibregl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='29' height='29' fill='%23666' viewBox='0 0 20 20'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 0 0 5.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 0 0 9 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 0 0 3.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0 0 11 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 1 1 0 7 3.5 3.5 0 1 1 0-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath fill='red' d='m14 5 1 1-9 9-1-1 9-9z'/%3E%3C/svg%3E\")}}@-webkit-keyframes maplibregl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes maplibregl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.maplibregl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.255 1.255 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.255 1.255 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5.11 5.11 0 0 1 .314-.787l.009-.016a4.623 4.623 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.548 4.548 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4.314.319.566.676.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.416 2.416 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.448 2.448 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675c.211.2.381.43.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.76 4.76 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.407 3.407 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.255 1.255 0 0 1 .689 1.004 4.73 4.73 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528 0 .343-.02.694-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.815 5.815 0 0 1-.548-2.512c0-.286.017-.567.053-.843a1.255 1.255 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.778 4.778 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.47 4.47 0 0 1-1.935-.424 1.252 1.252 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.402 2.402 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.703 4.703 0 0 1-1.782 1.884 4.767 4.767 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.47 4.47 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a4.983 4.983 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.255 1.255 0 0 1-1.115.676h-.098a1.255 1.255 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15c.329-.237.574-.499.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267c-.088-.22-.264-.438-.526-.658l-.032-.028a3.16 3.16 0 0 0-.668-.428l-.27-.12a3.293 3.293 0 0 0-1.235-.23c-.757 0-1.415.163-1.974.493a3.36 3.36 0 0 0-1.3 1.382c-.297.593-.444 1.284-.444 2.074 0 .8.17 1.503.51 2.107a3.795 3.795 0 0 0 1.382 1.381 3.883 3.883 0 0 0 1.893.477c.53 0 1.015-.11 1.455-.33zm-2.789-5.38c-.384.45-.575 1.038-.575 1.762 0 .735.186 1.332.559 1.794.384.45.933.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.17 2.17 0 0 0 .468-.29l.178-.161a2.163 2.163 0 0 0 .397-.561c.163-.333.244-.717.244-1.15v-.115c0-.472-.098-.894-.296-1.267l-.043-.077a2.211 2.211 0 0 0-.633-.709l-.13-.086-.047-.028a2.099 2.099 0 0 0-1.073-.285c-.702 0-1.244.231-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.958.958 0 0 0-.353-.389.851.851 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.626 2.626 0 0 0 .331.423c.213.22.464.402.755.548l.173.074c.433.17.93.255 1.49.255.68 0 1.295-.165 1.844-.493a3.447 3.447 0 0 0 1.316-1.4c.329-.603.493-1.299.493-2.089 0-1.273-.33-2.243-.988-2.913-.658-.68-1.52-1.02-2.584-1.02-.598 0-1.124.115-1.575.347a2.807 2.807 0 0 0-.415.262l-.199.166a3.35 3.35 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138c.137.193.297.36.48.5l.155.11.053.034c.34.197.713.297 1.119.297.714 0 1.262-.225 1.645-.675.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.29 0-.569.053-.835.16a2.366 2.366 0 0 0-.284.136 1.99 1.99 0 0 0-.363.254 2.237 2.237 0 0 0-.46.569l-.082.162a2.56 2.56 0 0 0-.213 1.072v.115c0 .471.098.894.296 1.267l.135.211zm.964-.818a1.11 1.11 0 0 0 .367.385.937.937 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a.995.995 0 0 0-.503.135l-.012.007a.859.859 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.43 1.43 0 0 0 .14.66zm15.7-6.222c.232-.23.346-.516.346-.856a1.053 1.053 0 0 0-.345-.79 1.175 1.175 0 0 0-.84-.329c-.34 0-.625.11-.855.33a1.053 1.053 0 0 0-.346.79c0 .34.115.625.346.855.23.23.516.346.856.346.34 0 .62-.115.839-.346zm4.337 9.314.033-1.332c.128.269.324.518.59.747l.098.081a3.727 3.727 0 0 0 .316.224l.223.122a3.21 3.21 0 0 0 1.44.322 3.785 3.785 0 0 0 1.875-.477 3.52 3.52 0 0 0 1.382-1.366c.352-.593.526-1.29.526-2.09 0-.79-.147-1.48-.444-2.073a3.235 3.235 0 0 0-1.283-1.399c-.549-.34-1.195-.51-1.942-.51a3.476 3.476 0 0 0-1.527.344l-.086.043-.165.09a3.412 3.412 0 0 0-.33.214c-.288.21-.507.446-.656.707a1.893 1.893 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.482 2.482 0 0 0 .566.7c.078.065.159.125.245.18l.144.08a2.105 2.105 0 0 0 .975.232c.713 0 1.262-.225 1.645-.675.384-.46.576-1.053.576-1.778 0-.734-.192-1.327-.576-1.777-.373-.46-.921-.692-1.645-.692a2.18 2.18 0 0 0-1.015.235c-.147.075-.285.17-.415.282l-.15.142a2.086 2.086 0 0 0-.42.594c-.149.32-.223.685-.223 1.1v.115c0 .47.097.89.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.868.868 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.13 1.13 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013c.23-.087.472-.134.724-.14l.069-.002c.329 0 .542.033.642.099l.247-1.794c-.13-.066-.37-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2.086 2.086 0 0 0-.411.148 2.18 2.18 0 0 0-.4.249 2.482 2.482 0 0 0-.485.499 2.659 2.659 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884c0-.364.053-.678.159-.943a1.49 1.49 0 0 1 .466-.636 2.52 2.52 0 0 1 .399-.253 2.19 2.19 0 0 1 .224-.099zm9.784 2.656.05-.922c0-1.162-.285-2.062-.856-2.698-.559-.647-1.42-.97-2.584-.97-.746 0-1.415.163-2.007.493a3.462 3.462 0 0 0-1.4 1.382c-.329.604-.493 1.306-.493 2.106 0 .714.143 1.371.428 1.975.285.593.73 1.07 1.332 1.432.604.351 1.355.526 2.255.526.649 0 1.204-.062 1.668-.185l.044-.012.135-.04c.409-.122.736-.263.984-.421l-.542-1.267c-.2.108-.415.199-.642.274l-.297.087c-.34.088-.773.131-1.3.131-.636 0-1.135-.147-1.497-.444a1.573 1.573 0 0 1-.192-.193c-.244-.294-.415-.705-.512-1.234l-.004-.021h5.43zm-5.427-1.256-.003.022h3.752v-.138c-.007-.485-.104-.857-.288-1.118a1.056 1.056 0 0 0-.156-.176c-.307-.285-.746-.428-1.316-.428-.657 0-1.155.202-1.494.604-.253.3-.417.712-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81c-.68 0-1.311-.16-1.893-.478a3.795 3.795 0 0 1-1.381-1.382c-.34-.604-.51-1.306-.51-2.106 0-.79.147-1.482.444-2.074a3.364 3.364 0 0 1 1.3-1.382c.559-.33 1.217-.494 1.974-.494a3.293 3.293 0 0 1 1.234.231 3.341 3.341 0 0 1 .97.575c.264.22.44.439.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332c-.186.395-.526.746-1.02 1.053a3.167 3.167 0 0 1-1.662.444zm.296-1.482c.626 0 1.152-.214 1.58-.642.428-.44.642-1.01.642-1.711v-.115c0-.472-.098-.894-.296-1.267a2.211 2.211 0 0 0-.807-.872 2.098 2.098 0 0 0-1.119-.313c-.702 0-1.245.231-1.629.692-.384.45-.575 1.037-.575 1.76 0 .736.186 1.333.559 1.795.384.45.933.675 1.645.675zm6.521-6.237h1.711v1.4c.604-1.065 1.547-1.597 2.83-1.597 1.064 0 1.926.34 2.584 1.02.659.67.988 1.641.988 2.914 0 .79-.164 1.487-.493 2.09a3.456 3.456 0 0 1-1.316 1.399 3.51 3.51 0 0 1-1.844.493c-.636 0-1.19-.11-1.662-.329a2.665 2.665 0 0 1-1.086-.97l.017 5.134h-1.728V9.242zm4.048 6.22c.714 0 1.262-.224 1.645-.674.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.395 0-.768.098-1.12.296-.34.187-.613.46-.822.823-.197.351-.296.763-.296 1.234v.115c0 .472.098.894.296 1.267.209.362.483.647.823.855.34.197.713.297 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.159 1.159 0 0 1-.856-.346 1.165 1.165 0 0 1-.346-.856 1.053 1.053 0 0 1 .346-.79c.23-.219.516-.329.856-.329.329 0 .609.11.839.33a1.053 1.053 0 0 1 .345.79 1.159 1.159 0 0 1-.345.855c-.22.23-.5.346-.84.346zm7.875 9.133a3.167 3.167 0 0 1-1.662-.444c-.482-.307-.817-.658-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283c.186-.438.548-.812 1.086-1.119a3.486 3.486 0 0 1 1.778-.477c.746 0 1.393.17 1.942.51a3.235 3.235 0 0 1 1.283 1.4c.297.592.444 1.282.444 2.072 0 .8-.175 1.498-.526 2.09a3.52 3.52 0 0 1-1.382 1.366 3.785 3.785 0 0 1-1.876.477zm-.296-1.481c.713 0 1.26-.225 1.645-.675.384-.46.577-1.053.577-1.778 0-.734-.193-1.327-.577-1.776-.373-.46-.921-.692-1.645-.692a2.115 2.115 0 0 0-1.58.659c-.428.428-.642.992-.642 1.694v.115c0 .473.098.895.296 1.267a2.385 2.385 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481c.176-.505.46-.91.856-1.217a2.14 2.14 0 0 1 1.349-.46c.351 0 .593.032.724.098l-.247 1.794c-.099-.066-.313-.099-.642-.099-.516 0-.988.164-1.416.494-.417.329-.626.855-.626 1.58v3.883h-1.777V9.242zm9.534 7.718c-.9 0-1.651-.175-2.255-.526-.603-.362-1.047-.84-1.332-1.432a4.567 4.567 0 0 1-.428-1.975c0-.8.164-1.502.493-2.106a3.462 3.462 0 0 1 1.4-1.382c.592-.33 1.262-.494 2.007-.494 1.163 0 2.024.324 2.584.97.57.637.856 1.537.856 2.7 0 .296-.017.603-.05.92h-5.43c.12.67.356 1.153.708 1.45.362.296.86.443 1.497.443.526 0 .96-.044 1.3-.131a4.123 4.123 0 0 0 .938-.362l.542 1.267c-.274.175-.647.329-1.119.46-.472.132-1.042.197-1.711.197zm1.596-4.558c.01-.68-.137-1.158-.444-1.432-.307-.285-.746-.428-1.316-.428-1.152 0-1.815.62-1.991 1.86h3.752z'/%3E%3Cg fill-rule='evenodd' stroke-width='1.036'%3E%3Cpath fill='%23000' fill-opacity='.4' d='m8.166 16.146-.002.002a1.54 1.54 0 0 1-2.009 0l-.002-.002-.043-.034-.002-.002-.199-.162H4.377a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659H8.411l-.202.164zm-1.121-.905a.29.29 0 0 0 .113.023.286.286 0 0 0 .189-.07l.077-.063c.634-.508 4.672-3.743 4.672-7.575 0-2.55-2.215-4.625-4.938-4.625S2.221 5.006 2.221 7.556c0 3.225 2.86 6.027 4.144 7.137h.004l.04.038.484.4.077.063a.628.628 0 0 0 .074.047zm-2.52-.548a16.898 16.898 0 0 1-1.183-1.315C2.187 11.942.967 9.897.967 7.555c0-3.319 2.855-5.88 6.192-5.88 3.338 0 6.193 2.561 6.193 5.881 0 2.34-1.22 4.387-2.376 5.822a16.898 16.898 0 0 1-1.182 1.315h.15a1.912 1.912 0 0 1 1.914 1.914v1.84a1.912 1.912 0 0 1-1.914 1.914H4.377a1.912 1.912 0 0 1-1.914-1.914v-1.84a1.912 1.912 0 0 1 1.914-1.914zm3.82-6.935c0 .692-.55 1.222-1.187 1.222s-1.185-.529-1.185-1.222.548-1.222 1.185-1.222c.638 0 1.186.529 1.186 1.222zm-1.186 2.477c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477zm2.048 7.71H5.114v-.838h4.093z'/%3E%3Cpath fill='%23e1e3e9' d='M2.222 7.555c0-2.55 2.214-4.625 4.937-4.625 2.723 0 4.938 2.075 4.938 4.625 0 3.832-4.038 7.068-4.672 7.575l-.077.063a.286.286 0 0 1-.189.07.286.286 0 0 1-.188-.07l-.077-.063c-.634-.507-4.672-3.743-4.672-7.575zm4.937 2.68c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477z'/%3E%3Cpath fill='%23fff' d='M4.377 15.948a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659zm4.83 1.16H5.114v.838h4.093z'/%3E%3C/g%3E%3C/svg%3E\");background-repeat:no-repeat;cursor:pointer;display:block;height:23px;margin:0 0 -4px -4px;overflow:hidden;width:88px}a.maplibregl-ctrl-logo.maplibregl-compact{width:14px}@media (-ms-high-contrast:active){a.maplibregl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.255 1.255 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.255 1.255 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5.11 5.11 0 0 1 .314-.787l.009-.016a4.623 4.623 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.548 4.548 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4.314.319.566.676.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.416 2.416 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.448 2.448 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675c.211.2.381.43.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.76 4.76 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.407 3.407 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.255 1.255 0 0 1 .689 1.004 4.73 4.73 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528 0 .343-.02.694-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.815 5.815 0 0 1-.548-2.512c0-.286.017-.567.053-.843a1.255 1.255 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.778 4.778 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.47 4.47 0 0 1-1.935-.424 1.252 1.252 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.402 2.402 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.703 4.703 0 0 1-1.782 1.884 4.767 4.767 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.47 4.47 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a4.983 4.983 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.255 1.255 0 0 1-1.115.676h-.098a1.255 1.255 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15c.329-.237.574-.499.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267c-.088-.22-.264-.438-.526-.658l-.032-.028a3.16 3.16 0 0 0-.668-.428l-.27-.12a3.293 3.293 0 0 0-1.235-.23c-.757 0-1.415.163-1.974.493a3.36 3.36 0 0 0-1.3 1.382c-.297.593-.444 1.284-.444 2.074 0 .8.17 1.503.51 2.107a3.795 3.795 0 0 0 1.382 1.381 3.883 3.883 0 0 0 1.893.477c.53 0 1.015-.11 1.455-.33zm-2.789-5.38c-.384.45-.575 1.038-.575 1.762 0 .735.186 1.332.559 1.794.384.45.933.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.17 2.17 0 0 0 .468-.29l.178-.161a2.163 2.163 0 0 0 .397-.561c.163-.333.244-.717.244-1.15v-.115c0-.472-.098-.894-.296-1.267l-.043-.077a2.211 2.211 0 0 0-.633-.709l-.13-.086-.047-.028a2.099 2.099 0 0 0-1.073-.285c-.702 0-1.244.231-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.958.958 0 0 0-.353-.389.851.851 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.626 2.626 0 0 0 .331.423c.213.22.464.402.755.548l.173.074c.433.17.93.255 1.49.255.68 0 1.295-.165 1.844-.493a3.447 3.447 0 0 0 1.316-1.4c.329-.603.493-1.299.493-2.089 0-1.273-.33-2.243-.988-2.913-.658-.68-1.52-1.02-2.584-1.02-.598 0-1.124.115-1.575.347a2.807 2.807 0 0 0-.415.262l-.199.166a3.35 3.35 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138c.137.193.297.36.48.5l.155.11.053.034c.34.197.713.297 1.119.297.714 0 1.262-.225 1.645-.675.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.29 0-.569.053-.835.16a2.366 2.366 0 0 0-.284.136 1.99 1.99 0 0 0-.363.254 2.237 2.237 0 0 0-.46.569l-.082.162a2.56 2.56 0 0 0-.213 1.072v.115c0 .471.098.894.296 1.267l.135.211zm.964-.818a1.11 1.11 0 0 0 .367.385.937.937 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a.995.995 0 0 0-.503.135l-.012.007a.859.859 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.43 1.43 0 0 0 .14.66zm15.7-6.222c.232-.23.346-.516.346-.856a1.053 1.053 0 0 0-.345-.79 1.175 1.175 0 0 0-.84-.329c-.34 0-.625.11-.855.33a1.053 1.053 0 0 0-.346.79c0 .34.115.625.346.855.23.23.516.346.856.346.34 0 .62-.115.839-.346zm4.337 9.314.033-1.332c.128.269.324.518.59.747l.098.081a3.727 3.727 0 0 0 .316.224l.223.122a3.21 3.21 0 0 0 1.44.322 3.785 3.785 0 0 0 1.875-.477 3.52 3.52 0 0 0 1.382-1.366c.352-.593.526-1.29.526-2.09 0-.79-.147-1.48-.444-2.073a3.235 3.235 0 0 0-1.283-1.399c-.549-.34-1.195-.51-1.942-.51a3.476 3.476 0 0 0-1.527.344l-.086.043-.165.09a3.412 3.412 0 0 0-.33.214c-.288.21-.507.446-.656.707a1.893 1.893 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.482 2.482 0 0 0 .566.7c.078.065.159.125.245.18l.144.08a2.105 2.105 0 0 0 .975.232c.713 0 1.262-.225 1.645-.675.384-.46.576-1.053.576-1.778 0-.734-.192-1.327-.576-1.777-.373-.46-.921-.692-1.645-.692a2.18 2.18 0 0 0-1.015.235c-.147.075-.285.17-.415.282l-.15.142a2.086 2.086 0 0 0-.42.594c-.149.32-.223.685-.223 1.1v.115c0 .47.097.89.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.868.868 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.13 1.13 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013c.23-.087.472-.134.724-.14l.069-.002c.329 0 .542.033.642.099l.247-1.794c-.13-.066-.37-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2.086 2.086 0 0 0-.411.148 2.18 2.18 0 0 0-.4.249 2.482 2.482 0 0 0-.485.499 2.659 2.659 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884c0-.364.053-.678.159-.943a1.49 1.49 0 0 1 .466-.636 2.52 2.52 0 0 1 .399-.253 2.19 2.19 0 0 1 .224-.099zm9.784 2.656.05-.922c0-1.162-.285-2.062-.856-2.698-.559-.647-1.42-.97-2.584-.97-.746 0-1.415.163-2.007.493a3.462 3.462 0 0 0-1.4 1.382c-.329.604-.493 1.306-.493 2.106 0 .714.143 1.371.428 1.975.285.593.73 1.07 1.332 1.432.604.351 1.355.526 2.255.526.649 0 1.204-.062 1.668-.185l.044-.012.135-.04c.409-.122.736-.263.984-.421l-.542-1.267c-.2.108-.415.199-.642.274l-.297.087c-.34.088-.773.131-1.3.131-.636 0-1.135-.147-1.497-.444a1.573 1.573 0 0 1-.192-.193c-.244-.294-.415-.705-.512-1.234l-.004-.021h5.43zm-5.427-1.256-.003.022h3.752v-.138c-.007-.485-.104-.857-.288-1.118a1.056 1.056 0 0 0-.156-.176c-.307-.285-.746-.428-1.316-.428-.657 0-1.155.202-1.494.604-.253.3-.417.712-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81c-.68 0-1.311-.16-1.893-.478a3.795 3.795 0 0 1-1.381-1.382c-.34-.604-.51-1.306-.51-2.106 0-.79.147-1.482.444-2.074a3.364 3.364 0 0 1 1.3-1.382c.559-.33 1.217-.494 1.974-.494a3.293 3.293 0 0 1 1.234.231 3.341 3.341 0 0 1 .97.575c.264.22.44.439.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332c-.186.395-.526.746-1.02 1.053a3.167 3.167 0 0 1-1.662.444zm.296-1.482c.626 0 1.152-.214 1.58-.642.428-.44.642-1.01.642-1.711v-.115c0-.472-.098-.894-.296-1.267a2.211 2.211 0 0 0-.807-.872 2.098 2.098 0 0 0-1.119-.313c-.702 0-1.245.231-1.629.692-.384.45-.575 1.037-.575 1.76 0 .736.186 1.333.559 1.795.384.45.933.675 1.645.675zm6.521-6.237h1.711v1.4c.604-1.065 1.547-1.597 2.83-1.597 1.064 0 1.926.34 2.584 1.02.659.67.988 1.641.988 2.914 0 .79-.164 1.487-.493 2.09a3.456 3.456 0 0 1-1.316 1.399 3.51 3.51 0 0 1-1.844.493c-.636 0-1.19-.11-1.662-.329a2.665 2.665 0 0 1-1.086-.97l.017 5.134h-1.728V9.242zm4.048 6.22c.714 0 1.262-.224 1.645-.674.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.395 0-.768.098-1.12.296-.34.187-.613.46-.822.823-.197.351-.296.763-.296 1.234v.115c0 .472.098.894.296 1.267.209.362.483.647.823.855.34.197.713.297 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.159 1.159 0 0 1-.856-.346 1.165 1.165 0 0 1-.346-.856 1.053 1.053 0 0 1 .346-.79c.23-.219.516-.329.856-.329.329 0 .609.11.839.33a1.053 1.053 0 0 1 .345.79 1.159 1.159 0 0 1-.345.855c-.22.23-.5.346-.84.346zm7.875 9.133a3.167 3.167 0 0 1-1.662-.444c-.482-.307-.817-.658-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283c.186-.438.548-.812 1.086-1.119a3.486 3.486 0 0 1 1.778-.477c.746 0 1.393.17 1.942.51a3.235 3.235 0 0 1 1.283 1.4c.297.592.444 1.282.444 2.072 0 .8-.175 1.498-.526 2.09a3.52 3.52 0 0 1-1.382 1.366 3.785 3.785 0 0 1-1.876.477zm-.296-1.481c.713 0 1.26-.225 1.645-.675.384-.46.577-1.053.577-1.778 0-.734-.193-1.327-.577-1.776-.373-.46-.921-.692-1.645-.692a2.115 2.115 0 0 0-1.58.659c-.428.428-.642.992-.642 1.694v.115c0 .473.098.895.296 1.267a2.385 2.385 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481c.176-.505.46-.91.856-1.217a2.14 2.14 0 0 1 1.349-.46c.351 0 .593.032.724.098l-.247 1.794c-.099-.066-.313-.099-.642-.099-.516 0-.988.164-1.416.494-.417.329-.626.855-.626 1.58v3.883h-1.777V9.242zm9.534 7.718c-.9 0-1.651-.175-2.255-.526-.603-.362-1.047-.84-1.332-1.432a4.567 4.567 0 0 1-.428-1.975c0-.8.164-1.502.493-2.106a3.462 3.462 0 0 1 1.4-1.382c.592-.33 1.262-.494 2.007-.494 1.163 0 2.024.324 2.584.97.57.637.856 1.537.856 2.7 0 .296-.017.603-.05.92h-5.43c.12.67.356 1.153.708 1.45.362.296.86.443 1.497.443.526 0 .96-.044 1.3-.131a4.123 4.123 0 0 0 .938-.362l.542 1.267c-.274.175-.647.329-1.119.46-.472.132-1.042.197-1.711.197zm1.596-4.558c.01-.68-.137-1.158-.444-1.432-.307-.285-.746-.428-1.316-.428-1.152 0-1.815.62-1.991 1.86h3.752z'/%3E%3Cg fill-rule='evenodd' stroke-width='1.036'%3E%3Cpath fill='%23000' fill-opacity='.4' d='m8.166 16.146-.002.002a1.54 1.54 0 0 1-2.009 0l-.002-.002-.043-.034-.002-.002-.199-.162H4.377a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659H8.411l-.202.164zm-1.121-.905a.29.29 0 0 0 .113.023.286.286 0 0 0 .189-.07l.077-.063c.634-.508 4.672-3.743 4.672-7.575 0-2.55-2.215-4.625-4.938-4.625S2.221 5.006 2.221 7.556c0 3.225 2.86 6.027 4.144 7.137h.004l.04.038.484.4.077.063a.628.628 0 0 0 .074.047zm-2.52-.548a16.898 16.898 0 0 1-1.183-1.315C2.187 11.942.967 9.897.967 7.555c0-3.319 2.855-5.88 6.192-5.88 3.338 0 6.193 2.561 6.193 5.881 0 2.34-1.22 4.387-2.376 5.822a16.898 16.898 0 0 1-1.182 1.315h.15a1.912 1.912 0 0 1 1.914 1.914v1.84a1.912 1.912 0 0 1-1.914 1.914H4.377a1.912 1.912 0 0 1-1.914-1.914v-1.84a1.912 1.912 0 0 1 1.914-1.914zm3.82-6.935c0 .692-.55 1.222-1.187 1.222s-1.185-.529-1.185-1.222.548-1.222 1.185-1.222c.638 0 1.186.529 1.186 1.222zm-1.186 2.477c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477zm2.048 7.71H5.114v-.838h4.093z'/%3E%3Cpath fill='%23e1e3e9' d='M2.222 7.555c0-2.55 2.214-4.625 4.937-4.625 2.723 0 4.938 2.075 4.938 4.625 0 3.832-4.038 7.068-4.672 7.575l-.077.063a.286.286 0 0 1-.189.07.286.286 0 0 1-.188-.07l-.077-.063c-.634-.507-4.672-3.743-4.672-7.575zm4.937 2.68c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477z'/%3E%3Cpath fill='%23fff' d='M4.377 15.948a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659zm4.83 1.16H5.114v.838h4.093z'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.maplibregl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='88' height='23' fill='none'%3E%3Cpath fill='%23000' fill-opacity='.4' fill-rule='evenodd' d='M17.408 16.796h-1.827l2.501-12.095h.198l3.324 6.533.988 2.19.988-2.19 3.258-6.533h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.929 5.644h-.098l-2.914-5.644-.757-1.71-.345 1.71zm1.958-3.42-.726 3.663a1.255 1.255 0 0 1-1.232 1.011h-1.827a1.255 1.255 0 0 1-1.229-1.509l2.501-12.095a1.255 1.255 0 0 1 1.23-1.001h.197a1.255 1.255 0 0 1 1.12.685l3.19 6.273 3.125-6.263a1.255 1.255 0 0 1 1.123-.695h.181a1.255 1.255 0 0 1 1.227.991l1.443 6.71a5.11 5.11 0 0 1 .314-.787l.009-.016a4.623 4.623 0 0 1 1.777-1.887c.782-.46 1.668-.667 2.611-.667a4.548 4.548 0 0 1 1.7.32l.306.134c.21-.16.474-.256.759-.256h1.694a1.255 1.255 0 0 1 1.212.925 1.255 1.255 0 0 1 1.212-.925h1.711c.284 0 .545.094.755.252.613-.3 1.312-.45 2.075-.45 1.356 0 2.557.445 3.482 1.4.314.319.566.676.763 1.064V4.701a1.255 1.255 0 0 1 1.255-1.255h1.86A1.255 1.255 0 0 1 54.44 4.7v9.194h2.217c.19 0 .37.043.532.118v-4.77c0-.356.147-.678.385-.906a2.416 2.416 0 0 1-.682-1.71c0-.665.267-1.253.735-1.7a2.448 2.448 0 0 1 1.722-.674 2.43 2.43 0 0 1 1.705.675c.211.2.381.43.504.683V4.7a1.255 1.255 0 0 1 1.255-1.255h1.744A1.255 1.255 0 0 1 65.812 4.7v3.335a4.76 4.76 0 0 1 1.526-.246c.938 0 1.817.214 2.59.69a4.47 4.47 0 0 1 1.67 1.743v-.98a1.255 1.255 0 0 1 1.256-1.256h1.777c.233 0 .451.064.639.174a3.407 3.407 0 0 1 1.567-.372c.346 0 .861.02 1.285.232a1.255 1.255 0 0 1 .689 1.004 4.73 4.73 0 0 1 .853-.588c.795-.44 1.675-.647 2.61-.647 1.385 0 2.65.39 3.525 1.396.836.938 1.168 2.173 1.168 3.528 0 .343-.02.694-.056 1.051a1.255 1.255 0 0 1-.947 1.09l.408.952a1.255 1.255 0 0 1-.477 1.552c-.418.268-.92.463-1.458.612-.613.171-1.304.244-2.049.244-1.06 0-2.043-.207-2.886-.698l-.015-.008c-.798-.48-1.419-1.135-1.818-1.963l-.004-.008a5.815 5.815 0 0 1-.548-2.512c0-.286.017-.567.053-.843a1.255 1.255 0 0 1-.333-.086l-.166-.004c-.223 0-.426.062-.643.228-.03.024-.142.139-.142.59v3.883a1.255 1.255 0 0 1-1.256 1.256h-1.777a1.255 1.255 0 0 1-1.256-1.256V15.69l-.032.057a4.778 4.778 0 0 1-1.86 1.833 5.04 5.04 0 0 1-2.484.634 4.47 4.47 0 0 1-1.935-.424 1.252 1.252 0 0 1-.764.258h-1.71a1.255 1.255 0 0 1-1.256-1.255V7.687a2.402 2.402 0 0 1-.428.625c.253.23.412.561.412.93v7.553a1.255 1.255 0 0 1-1.256 1.255h-1.843a1.25 1.25 0 0 1-.894-.373c-.228.23-.544.373-.894.373H51.32a1.255 1.255 0 0 1-1.256-1.255v-1.251l-.061.117a4.703 4.703 0 0 1-1.782 1.884 4.767 4.767 0 0 1-2.485.67 5.6 5.6 0 0 1-1.485-.188l.009 2.764a1.255 1.255 0 0 1-1.255 1.259h-1.729a1.255 1.255 0 0 1-1.255-1.255v-3.537a1.255 1.255 0 0 1-1.167.793h-1.679a1.25 1.25 0 0 1-.77-.263 4.47 4.47 0 0 1-1.945.429c-.885 0-1.724-.21-2.495-.632l-.017-.01a4.983 4.983 0 0 1-1.081-.836 1.255 1.255 0 0 1-1.254 1.312h-1.81a1.255 1.255 0 0 1-1.228-.99l-.782-3.625-2.044 3.939a1.255 1.255 0 0 1-1.115.676h-.098a1.255 1.255 0 0 1-1.116-.68l-2.061-3.994zM35.92 16.63l.207-.114.223-.15c.329-.237.574-.499.735-.785l.061-.118.033 1.332h1.678V9.242h-1.694l-.033 1.267c-.088-.22-.264-.438-.526-.658l-.032-.028a3.16 3.16 0 0 0-.668-.428l-.27-.12a3.293 3.293 0 0 0-1.235-.23c-.757 0-1.415.163-1.974.493a3.36 3.36 0 0 0-1.3 1.382c-.297.593-.444 1.284-.444 2.074 0 .8.17 1.503.51 2.107a3.795 3.795 0 0 0 1.382 1.381 3.883 3.883 0 0 0 1.893.477c.53 0 1.015-.11 1.455-.33zm-2.789-5.38c-.384.45-.575 1.038-.575 1.762 0 .735.186 1.332.559 1.794.384.45.933.675 1.645.675a2.25 2.25 0 0 0 .934-.19 2.17 2.17 0 0 0 .468-.29l.178-.161a2.163 2.163 0 0 0 .397-.561c.163-.333.244-.717.244-1.15v-.115c0-.472-.098-.894-.296-1.267l-.043-.077a2.211 2.211 0 0 0-.633-.709l-.13-.086-.047-.028a2.099 2.099 0 0 0-1.073-.285c-.702 0-1.244.231-1.629.692zm2.316 2.706c.163-.17.28-.407.28-.83v-.114c0-.292-.06-.508-.15-.68a.958.958 0 0 0-.353-.389.851.851 0 0 0-.464-.127c-.4 0-.56.114-.664.239l-.01.012c-.148.174-.275.45-.275.945 0 .506.122.801.27.99.097.11.266.224.68.224.303 0 .504-.09.687-.269zm7.545 1.705a2.626 2.626 0 0 0 .331.423c.213.22.464.402.755.548l.173.074c.433.17.93.255 1.49.255.68 0 1.295-.165 1.844-.493a3.447 3.447 0 0 0 1.316-1.4c.329-.603.493-1.299.493-2.089 0-1.273-.33-2.243-.988-2.913-.658-.68-1.52-1.02-2.584-1.02-.598 0-1.124.115-1.575.347a2.807 2.807 0 0 0-.415.262l-.199.166a3.35 3.35 0 0 0-.64.82V9.242h-1.712v11.553h1.729l-.017-5.134zm.53-1.138c.137.193.297.36.48.5l.155.11.053.034c.34.197.713.297 1.119.297.714 0 1.262-.225 1.645-.675.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.29 0-.569.053-.835.16a2.366 2.366 0 0 0-.284.136 1.99 1.99 0 0 0-.363.254 2.237 2.237 0 0 0-.46.569l-.082.162a2.56 2.56 0 0 0-.213 1.072v.115c0 .471.098.894.296 1.267l.135.211zm.964-.818a1.11 1.11 0 0 0 .367.385.937.937 0 0 0 .476.118c.423 0 .59-.117.687-.23.159-.194.28-.478.28-.95 0-.53-.133-.8-.266-.952l-.021-.025c-.078-.094-.231-.221-.68-.221a.995.995 0 0 0-.503.135l-.012.007a.859.859 0 0 0-.335.343c-.073.133-.132.324-.132.614v.115a1.43 1.43 0 0 0 .14.66zm15.7-6.222c.232-.23.346-.516.346-.856a1.053 1.053 0 0 0-.345-.79 1.175 1.175 0 0 0-.84-.329c-.34 0-.625.11-.855.33a1.053 1.053 0 0 0-.346.79c0 .34.115.625.346.855.23.23.516.346.856.346.34 0 .62-.115.839-.346zm4.337 9.314.033-1.332c.128.269.324.518.59.747l.098.081a3.727 3.727 0 0 0 .316.224l.223.122a3.21 3.21 0 0 0 1.44.322 3.785 3.785 0 0 0 1.875-.477 3.52 3.52 0 0 0 1.382-1.366c.352-.593.526-1.29.526-2.09 0-.79-.147-1.48-.444-2.073a3.235 3.235 0 0 0-1.283-1.399c-.549-.34-1.195-.51-1.942-.51a3.476 3.476 0 0 0-1.527.344l-.086.043-.165.09a3.412 3.412 0 0 0-.33.214c-.288.21-.507.446-.656.707a1.893 1.893 0 0 0-.099.198l.082-1.283V4.701h-1.744v12.095zm.473-2.509a2.482 2.482 0 0 0 .566.7c.078.065.159.125.245.18l.144.08a2.105 2.105 0 0 0 .975.232c.713 0 1.262-.225 1.645-.675.384-.46.576-1.053.576-1.778 0-.734-.192-1.327-.576-1.777-.373-.46-.921-.692-1.645-.692a2.18 2.18 0 0 0-1.015.235c-.147.075-.285.17-.415.282l-.15.142a2.086 2.086 0 0 0-.42.594c-.149.32-.223.685-.223 1.1v.115c0 .47.097.89.293 1.26zm2.616-.293c.157-.191.28-.479.28-.967 0-.51-.13-.79-.276-.961l-.021-.026c-.082-.1-.232-.225-.67-.225a.868.868 0 0 0-.681.279l-.012.011c-.154.155-.274.38-.274.807v.115c0 .285.057.499.144.669a1.13 1.13 0 0 0 .367.405c.137.082.28.123.455.123.423 0 .59-.118.686-.23zm8.266-3.013c.23-.087.472-.134.724-.14l.069-.002c.329 0 .542.033.642.099l.247-1.794c-.13-.066-.37-.099-.717-.099a2.3 2.3 0 0 0-.545.063 2.086 2.086 0 0 0-.411.148 2.18 2.18 0 0 0-.4.249 2.482 2.482 0 0 0-.485.499 2.659 2.659 0 0 0-.32.581l-.05.137v-1.48h-1.778v7.553h1.777v-3.884c0-.364.053-.678.159-.943a1.49 1.49 0 0 1 .466-.636 2.52 2.52 0 0 1 .399-.253 2.19 2.19 0 0 1 .224-.099zm9.784 2.656.05-.922c0-1.162-.285-2.062-.856-2.698-.559-.647-1.42-.97-2.584-.97-.746 0-1.415.163-2.007.493a3.462 3.462 0 0 0-1.4 1.382c-.329.604-.493 1.306-.493 2.106 0 .714.143 1.371.428 1.975.285.593.73 1.07 1.332 1.432.604.351 1.355.526 2.255.526.649 0 1.204-.062 1.668-.185l.044-.012.135-.04c.409-.122.736-.263.984-.421l-.542-1.267c-.2.108-.415.199-.642.274l-.297.087c-.34.088-.773.131-1.3.131-.636 0-1.135-.147-1.497-.444a1.573 1.573 0 0 1-.192-.193c-.244-.294-.415-.705-.512-1.234l-.004-.021h5.43zm-5.427-1.256-.003.022h3.752v-.138c-.007-.485-.104-.857-.288-1.118a1.056 1.056 0 0 0-.156-.176c-.307-.285-.746-.428-1.316-.428-.657 0-1.155.202-1.494.604-.253.3-.417.712-.494 1.234zm-27.053 2.77V4.7h-1.86v12.095h5.333V15.15zm7.103-5.908v7.553h-1.843V9.242h1.843z'/%3E%3Cpath fill='%23fff' d='m19.63 11.151-.757-1.71-.345 1.71-1.12 5.644h-1.827L18.083 4.7h.197l3.325 6.533.988 2.19.988-2.19L26.839 4.7h.181l2.6 12.095h-1.81l-1.218-5.644-.362-1.71-.658 1.71-2.93 5.644h-.098l-2.913-5.644zm14.836 5.81c-.68 0-1.311-.16-1.893-.478a3.795 3.795 0 0 1-1.381-1.382c-.34-.604-.51-1.306-.51-2.106 0-.79.147-1.482.444-2.074a3.364 3.364 0 0 1 1.3-1.382c.559-.33 1.217-.494 1.974-.494a3.293 3.293 0 0 1 1.234.231 3.341 3.341 0 0 1 .97.575c.264.22.44.439.527.659l.033-1.267h1.694v7.553H37.18l-.033-1.332c-.186.395-.526.746-1.02 1.053a3.167 3.167 0 0 1-1.662.444zm.296-1.482c.626 0 1.152-.214 1.58-.642.428-.44.642-1.01.642-1.711v-.115c0-.472-.098-.894-.296-1.267a2.211 2.211 0 0 0-.807-.872 2.098 2.098 0 0 0-1.119-.313c-.702 0-1.245.231-1.629.692-.384.45-.575 1.037-.575 1.76 0 .736.186 1.333.559 1.795.384.45.933.675 1.645.675zm6.521-6.237h1.711v1.4c.604-1.065 1.547-1.597 2.83-1.597 1.064 0 1.926.34 2.584 1.02.659.67.988 1.641.988 2.914 0 .79-.164 1.487-.493 2.09a3.456 3.456 0 0 1-1.316 1.399 3.51 3.51 0 0 1-1.844.493c-.636 0-1.19-.11-1.662-.329a2.665 2.665 0 0 1-1.086-.97l.017 5.134h-1.728V9.242zm4.048 6.22c.714 0 1.262-.224 1.645-.674.385-.46.576-1.048.576-1.762 0-.746-.192-1.338-.576-1.777-.372-.45-.92-.675-1.645-.675-.395 0-.768.098-1.12.296-.34.187-.613.46-.822.823-.197.351-.296.763-.296 1.234v.115c0 .472.098.894.296 1.267.209.362.483.647.823.855.34.197.713.297 1.119.297z'/%3E%3Cpath fill='%23e1e3e9' d='M51.325 4.7h1.86v10.45h3.473v1.646h-5.333zm7.12 4.542h1.843v7.553h-1.843zm.905-1.415a1.159 1.159 0 0 1-.856-.346 1.165 1.165 0 0 1-.346-.856 1.053 1.053 0 0 1 .346-.79c.23-.219.516-.329.856-.329.329 0 .609.11.839.33a1.053 1.053 0 0 1 .345.79 1.159 1.159 0 0 1-.345.855c-.22.23-.5.346-.84.346zm7.875 9.133a3.167 3.167 0 0 1-1.662-.444c-.482-.307-.817-.658-1.004-1.053l-.033 1.332h-1.71V4.701h1.743v4.657l-.082 1.283c.186-.438.548-.812 1.086-1.119a3.486 3.486 0 0 1 1.778-.477c.746 0 1.393.17 1.942.51a3.235 3.235 0 0 1 1.283 1.4c.297.592.444 1.282.444 2.072 0 .8-.175 1.498-.526 2.09a3.52 3.52 0 0 1-1.382 1.366 3.785 3.785 0 0 1-1.876.477zm-.296-1.481c.713 0 1.26-.225 1.645-.675.384-.46.577-1.053.577-1.778 0-.734-.193-1.327-.577-1.776-.373-.46-.921-.692-1.645-.692a2.115 2.115 0 0 0-1.58.659c-.428.428-.642.992-.642 1.694v.115c0 .473.098.895.296 1.267a2.385 2.385 0 0 0 .807.872 2.1 2.1 0 0 0 1.119.313zm5.927-6.237h1.777v1.481c.176-.505.46-.91.856-1.217a2.14 2.14 0 0 1 1.349-.46c.351 0 .593.032.724.098l-.247 1.794c-.099-.066-.313-.099-.642-.099-.516 0-.988.164-1.416.494-.417.329-.626.855-.626 1.58v3.883h-1.777V9.242zm9.534 7.718c-.9 0-1.651-.175-2.255-.526-.603-.362-1.047-.84-1.332-1.432a4.567 4.567 0 0 1-.428-1.975c0-.8.164-1.502.493-2.106a3.462 3.462 0 0 1 1.4-1.382c.592-.33 1.262-.494 2.007-.494 1.163 0 2.024.324 2.584.97.57.637.856 1.537.856 2.7 0 .296-.017.603-.05.92h-5.43c.12.67.356 1.153.708 1.45.362.296.86.443 1.497.443.526 0 .96-.044 1.3-.131a4.123 4.123 0 0 0 .938-.362l.542 1.267c-.274.175-.647.329-1.119.46-.472.132-1.042.197-1.711.197zm1.596-4.558c.01-.68-.137-1.158-.444-1.432-.307-.285-.746-.428-1.316-.428-1.152 0-1.815.62-1.991 1.86h3.752z'/%3E%3Cg fill-rule='evenodd' stroke-width='1.036'%3E%3Cpath fill='%23000' fill-opacity='.4' d='m8.166 16.146-.002.002a1.54 1.54 0 0 1-2.009 0l-.002-.002-.043-.034-.002-.002-.199-.162H4.377a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659H8.411l-.202.164zm-1.121-.905a.29.29 0 0 0 .113.023.286.286 0 0 0 .189-.07l.077-.063c.634-.508 4.672-3.743 4.672-7.575 0-2.55-2.215-4.625-4.938-4.625S2.221 5.006 2.221 7.556c0 3.225 2.86 6.027 4.144 7.137h.004l.04.038.484.4.077.063a.628.628 0 0 0 .074.047zm-2.52-.548a16.898 16.898 0 0 1-1.183-1.315C2.187 11.942.967 9.897.967 7.555c0-3.319 2.855-5.88 6.192-5.88 3.338 0 6.193 2.561 6.193 5.881 0 2.34-1.22 4.387-2.376 5.822a16.898 16.898 0 0 1-1.182 1.315h.15a1.912 1.912 0 0 1 1.914 1.914v1.84a1.912 1.912 0 0 1-1.914 1.914H4.377a1.912 1.912 0 0 1-1.914-1.914v-1.84a1.912 1.912 0 0 1 1.914-1.914zm3.82-6.935c0 .692-.55 1.222-1.187 1.222s-1.185-.529-1.185-1.222.548-1.222 1.185-1.222c.638 0 1.186.529 1.186 1.222zm-1.186 2.477c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477zm2.048 7.71H5.114v-.838h4.093z'/%3E%3Cpath fill='%23e1e3e9' d='M2.222 7.555c0-2.55 2.214-4.625 4.937-4.625 2.723 0 4.938 2.075 4.938 4.625 0 3.832-4.038 7.068-4.672 7.575l-.077.063a.286.286 0 0 1-.189.07.286.286 0 0 1-.188-.07l-.077-.063c-.634-.507-4.672-3.743-4.672-7.575zm4.937 2.68c1.348 0 2.442-1.11 2.442-2.478S8.507 5.28 7.159 5.28 4.72 6.39 4.72 7.758s1.092 2.477 2.44 2.477z'/%3E%3Cpath fill='%23fff' d='M4.377 15.948a.657.657 0 0 0-.659.659v1.84a.657.657 0 0 0 .659.659h5.565a.657.657 0 0 0 .659-.659v-1.84a.657.657 0 0 0-.659-.659zm4.83 1.16H5.114v.838h4.093z'/%3E%3C/g%3E%3C/svg%3E\")}}.maplibregl-ctrl.maplibregl-ctrl-attrib{background-color:hsla(0,0%,100%,.5);margin:0;padding:0 5px}@media screen{.maplibregl-ctrl-attrib.maplibregl-compact{background-color:#fff;border-radius:12px;box-sizing:content-box;margin:10px;min-height:20px;padding:2px 24px 2px 0;position:relative}.maplibregl-ctrl-attrib.maplibregl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact-show,.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact-show{border-radius:12px;padding:2px 8px 2px 28px}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-inner{display:none}.maplibregl-ctrl-attrib-button{background-color:hsla(0,0%,100%,.5);background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E\");border:0;border-radius:12px;box-sizing:border-box;cursor:pointer;display:none;height:24px;outline:none;position:absolute;right:0;top:0;width:24px}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button{-webkit-appearance:none;-moz-appearance:none;appearance:none;list-style:none}.maplibregl-ctrl-attrib summary.maplibregl-ctrl-attrib-button::-webkit-details-marker{display:none}.maplibregl-ctrl-bottom-left .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-top-left .maplibregl-ctrl-attrib-button{left:0}.maplibregl-ctrl-attrib.maplibregl-compact .maplibregl-ctrl-attrib-button,.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-inner{display:block}.maplibregl-ctrl-attrib.maplibregl-compact-show .maplibregl-ctrl-attrib-button{background-color:rgb(0 0 0/5%)}.maplibregl-ctrl-bottom-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;right:0}.maplibregl-ctrl-top-right>.maplibregl-ctrl-attrib.maplibregl-compact:after{right:0;top:0}.maplibregl-ctrl-top-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{left:0;top:0}.maplibregl-ctrl-bottom-left>.maplibregl-ctrl-attrib.maplibregl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill='%23fff' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.maplibregl-ctrl-attrib.maplibregl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' fill-rule='evenodd' viewBox='0 0 20 20'%3E%3Cpath d='M4 10a6 6 0 1 0 12 0 6 6 0 1 0-12 0m5-3a1 1 0 1 0 2 0 1 1 0 1 0-2 0m0 3a1 1 0 1 1 2 0v3a1 1 0 1 1-2 0'/%3E%3C/svg%3E\")}}.maplibregl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.maplibregl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.maplibregl-attrib-empty{display:none}.maplibregl-ctrl-scale{background-color:hsla(0,0%,100%,.75);border:2px solid #333;border-top:#333;box-sizing:border-box;color:#333;font-size:10px;padding:0 5px}.maplibregl-popup{display:flex;left:0;pointer-events:none;position:absolute;top:0;will-change:transform}.maplibregl-popup-anchor-top,.maplibregl-popup-anchor-top-left,.maplibregl-popup-anchor-top-right{flex-direction:column}.maplibregl-popup-anchor-bottom,.maplibregl-popup-anchor-bottom-left,.maplibregl-popup-anchor-bottom-right{flex-direction:column-reverse}.maplibregl-popup-anchor-left{flex-direction:row}.maplibregl-popup-anchor-right{flex-direction:row-reverse}.maplibregl-popup-tip{border:10px solid transparent;height:0;width:0;z-index:1}.maplibregl-popup-anchor-top .maplibregl-popup-tip{align-self:center;border-bottom-color:#fff;border-top:none}.maplibregl-popup-anchor-top-left .maplibregl-popup-tip{align-self:flex-start;border-bottom-color:#fff;border-left:none;border-top:none}.maplibregl-popup-anchor-top-right .maplibregl-popup-tip{align-self:flex-end;border-bottom-color:#fff;border-right:none;border-top:none}.maplibregl-popup-anchor-bottom .maplibregl-popup-tip{align-self:center;border-bottom:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-tip{align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-tip{align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.maplibregl-popup-anchor-left .maplibregl-popup-tip{align-self:center;border-left:none;border-right-color:#fff}.maplibregl-popup-anchor-right .maplibregl-popup-tip{align-self:center;border-left-color:#fff;border-right:none}.maplibregl-popup-close-button{background-color:transparent;border:0;border-radius:0 3px 0 0;cursor:pointer;position:absolute;right:0;top:0}.maplibregl-popup-close-button:hover{background-color:rgb(0 0 0/5%)}.maplibregl-popup-content{background:#fff;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);padding:15px 10px;pointer-events:auto;position:relative}.maplibregl-popup-anchor-top-left .maplibregl-popup-content{border-top-left-radius:0}.maplibregl-popup-anchor-top-right .maplibregl-popup-content{border-top-right-radius:0}.maplibregl-popup-anchor-bottom-left .maplibregl-popup-content{border-bottom-left-radius:0}.maplibregl-popup-anchor-bottom-right .maplibregl-popup-content{border-bottom-right-radius:0}.maplibregl-popup-track-pointer{display:none}.maplibregl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.maplibregl-map:hover .maplibregl-popup-track-pointer{display:flex}.maplibregl-map:active .maplibregl-popup-track-pointer{display:none}.maplibregl-marker{left:0;position:absolute;top:0;will-change:transform}.maplibregl-user-location-dot,.maplibregl-user-location-dot:before{background-color:#1da1f2;border-radius:50%;height:15px;width:15px}.maplibregl-user-location-dot:before{-webkit-animation:maplibregl-user-location-dot-pulse 2s infinite;animation:maplibregl-user-location-dot-pulse 2s infinite;content:\"\";position:absolute}.maplibregl-user-location-dot:after{border:2px solid #fff;border-radius:50%;box-shadow:0 0 3px rgba(0,0,0,.35);box-sizing:border-box;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px}@-webkit-keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}70%{opacity:0;-webkit-transform:scale(3);transform:scale(3)}to{opacity:0;-webkit-transform:scale(1);transform:scale(1)}}@keyframes maplibregl-user-location-dot-pulse{0%{opacity:1;-webkit-transform:scale(1);transform:scale(1)}70%{opacity:0;-webkit-transform:scale(3);transform:scale(3)}to{opacity:0;-webkit-transform:scale(1);transform:scale(1)}}.maplibregl-user-location-dot-stale{background-color:#aaa}.maplibregl-user-location-dot-stale:after{display:none}.maplibregl-user-location-accuracy-circle{background-color:#1da1f233;border-radius:100%;height:1px;width:1px}.maplibregl-crosshair,.maplibregl-crosshair .maplibregl-interactive,.maplibregl-crosshair .maplibregl-interactive:active{cursor:crosshair}.maplibregl-boxzoom{background:#fff;border:2px dotted #202020;height:0;left:0;opacity:.5;position:absolute;top:0;width:0}.maplibregl-cooperative-gesture-screen{align-items:center;background:rgba(0,0,0,.4);color:#fff;display:flex;font-size:1.4em;inset:0;justify-content:center;line-height:1.2;opacity:0;padding:1rem;pointer-events:none;position:absolute;transition:opacity 1s ease 1s;z-index:99999}.maplibregl-cooperative-gesture-screen.maplibregl-show{opacity:1;transition:opacity .05s}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:none}@media (hover:none),(width <= 480px){.maplibregl-cooperative-gesture-screen .maplibregl-desktop-message{display:none}.maplibregl-cooperative-gesture-screen .maplibregl-mobile-message{display:block}}.maplibregl-pseudo-fullscreen{height:100%!important;left:0!important;position:fixed!important;top:0!important;width:100%!important;z-index:99999}"),window.maplibregl=nr();var ir=0,or=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"version",Te.MAPBOX),d()(k()(e),"viewport",void 0),e}return a()(r,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(e,0),r=n.x,i=n.y;return[r-t.x,i-t.y]}},{key:"lngLatToMercator",value:function(e,t){var n=window.maplibregl.MercatorCoordinate.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=window.maplibregl.MercatorCoordinate.fromLngLat(e,t),a=o.meterInMercatorCoordinateUnits(),s=F.create();return F.translate(s,s,z.fromValues(o.x-i.x,o.y-i.y,o.z||0-i.z)),F.scale(s,s,z.fromValues(a*r[0],-a*r[1],a*r[2])),F.rotateX(s,s,n[0]),F.rotateY(s,s,n[1]),F.rotateZ(s,s,n[2]),s}},{key:"init",value:(t=w()(A()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,f,p=this;return A()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.config,n=t.id,r=void 0===n?"map":n,i=t.attributionControl,o=void 0!==i&&i,a=t.style,s=void 0===a?"light":a,u=t.rotation,l=void 0===u?0:u,c=t.mapInstance,f=C()(t,rr),this.viewport=new Ee,c||window.maplibregl||console.error(this.configService.getSceneWarninfo("SDK")),c?(this.map=c,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new window.maplibregl.Map(h()({container:this.$mapContainer,style:this.getMapStyleValue(s),attributionControl:o,bearing:l},f))),this.map.on("load",(function(){p.handleCameraChanged()})),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 7:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){var e;null===(e=this.$mapContainer)||void 0===e||null===(e=e.parentNode)||void 0===e||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).emit.apply(t,[e].concat(r))}},{key:"once",value:function(e){for(var t,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(t=this.eventEmitter).once.apply(t,[e].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"getCanvasOverlays",value:function(){var e;return null===(e=this.getMapContainer())||void 0===e?void 0:e.querySelector(".maplibregl-canvas-container")}},{key:"meterToCoord",value:function(e,t){var n=new(nr().LngLat)(e[0],e[1]),r=new(nr().LngLat)(t[0],t[1]),i=n.distanceTo(r),o=nr().MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),a=nr().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),s=o.x,u=o.y,l=a.x,c=a.y;return 4194304*Math.sqrt(Math.pow(s-l,2)+Math.pow(u-c,2))*2/i}},{key:"exportMap",value:function(e){var t=this.map.getCanvas();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"creatMapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_mapbox_div"+ir++,t.appendChild(n),n}}]),r}(Ne),ar=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return or}}]),n}(v),sr=function(e){var t=e.tk;return new Promise((function(e){var n=document.createElement("script");n.type="text/javascript",n.src="https://api.tianditu.gov.cn/api?v=4.0&tk=".concat(t),n.onload=function(){console.log("TianDiTu API script loaded."),e(!0)},n.onerror=function(){console.error("Failed to load TianDiTu API script."),e(!1)},document.head.appendChild(n)}))},ur=0,lr={zoomchange:["Ge"]},cr=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"viewport",null),d()(k()(e),"evtCbProxyMap",new Map),d()(k()(e),"sceneContainer",void 0),d()(k()(e),"handleCameraChanged",(function(){e.emit("mapchange");var t=e.map,n=e.map.getCenter(),r={center:[n.lng,n.lat],viewportHeight:t.getContainer().clientHeight,viewportWidth:t.getContainer().clientWidth,bearing:360,pitch:0,zoom:t.getZoom()-1};e.viewport&&(e.viewport.syncWithMapCamera(r),e.updateCoordinateSystemService(),e.cameraChangedCallback(e.viewport))})),e}return a()(r,[{key:"addMarkerContainer",value:function(){var e=this.map.getContainer(),t=this.markerContainer=document.createElement("div");e.appendChild(t),t.setAttribute("tabindex","-1"),t.id="tdt-L7-marker",t.style.position="absolute",t.style.left="",t.style.top="",t.style.zIndex="600",t.style.width="0px",t.style.height="0px",t.style.overflow="visible"}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"resize",value:function(e){this.sceneContainer.style.width=e.newSize.x+"px",this.sceneContainer.style.height=e.newSize.y+"px"}},{key:"update",value:function(){var e=this.map.getBounds(),t=this.map.lngLatToLayerPoint({lng:e.getSouthWest().lng,lat:e.getNorthEast().lat}),n=t.x,r=t.y;this.sceneContainer.style.transition="",this.sceneContainer.style.transformOrigin="center",this.sceneContainer.style.transform="translate3d(".concat(n,"px, ").concat(r,"px, 0px) scale(1)"),this.markerContainer.style.transition="",this.markerContainer.style.transformOrigin="center",this.markerContainer.style.transform="translate3d(".concat(-n,"px, ").concat(-r,"px, 0px) scale(1)"),this.sceneContainer._tdt_pos=new T.Point(n,r),this.handleCameraChanged()}},{key:"getZoomScale",value:function(e,t){var n=this.map.options.IW;return t=void 0===t?this.map.getZoom():t,n.scale(e)/n.scale(t)}},{key:"zoomStartUpdate",value:function(e){var t=e.center,n=e.zoom,r=this.getZoomScale(n,this.map.getZoom()),i=T._Q.getPosition(this.sceneContainer),o=this.map.getSize().GQ(.5),a=this.map.options.IW.qW(this.map.getCenter(),n),s=this.map.options.IW.qW(t,n).DQ(a),u=new T.Point(o.x,o.y).GQ(-r);u.aQ(i),u.aQ(o),u.DQ(s),this.sceneContainer.style.transform="translate3d(".concat(u.x,"px,").concat(u.y,"px,0px) scale(").concat(r,")"),this.sceneContainer.style.transformOrigin="0 0",this.sceneContainer.style.transition="transform 0.25s cubic-bezier(0,0,0.25,1)",this.handleCameraChanged()}},{key:"getOverlayContainer",value:function(){var e,t=null===(e=this.map.getPanes())||void 0===e?void 0:e.overlayPane,n=document.createElement("div");t.parentElement.appendChild(n),n.id="tdt-L7";var r=this.map.getSize();return n.style.zIndex="200",n.style.width="".concat(r.x,"px"),n.style.height="".concat(r.y,"px"),this.sceneContainer=n,n}},{key:"init",value:(t=w()(A()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,f,h,p,d,v,g;return A()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.viewport=new Ee,t=this.config,n=t.id,r=t.mapInstance,i=t.center,o=void 0===i?[121.30654632240122,31.25744185633306]:i,a=t.token,s=void 0===a?"b15e548080c79819617367d3f6095c69":a,u=t.minZoom,l=void 0===u?1:u,c=t.maxZoom,f=void 0===c?18:c,h=t.zoom,p=void 0===h?3:h,window.T){e.next=5;break}return e.next=5,sr({tk:s});case 5:if(!r){e.next=15;break}this.map=r,this.map.centerAndZoom(new window.T.LngLat(o[0],o[1]),p),this.$mapContainer=this.map.getContainer(),d=new window.T.LngLat(o[0],o[1]),this.map.centerAndZoom(d,p),this.setMinZoom(l),this.setMaxZoom(f),e.next=22;break;case 15:if(n){e.next=17;break}throw Error("No container id specified");case 17:this.$mapContainer=this.creatMapContainer(n),v=new T.Map(this.$mapContainer,{center:window.T.LngLat(o[0],o[1]),minZoom:l,maxZoom:f,zoom:p,projection:"EPSG:900913"}),this.map=v,g=new window.T.Control.Zoom,v.addControl(g);case 22:this.map.getContainer().querySelector(".tdt-pane").style.zIndex=1,this.handleCameraChanged(),this.map.on("move",this.update,this),this.map.on("Ge",this.zoomStartUpdate,this),this.map.on("resize",this.resize,this);case 29:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){}},{key:"on",value:function(e,t){var n=this;if(-1!==D.MapServiceEvent.indexOf(e))this.eventEmitter.on(e,t);else{var r=function(e){var r=n.evtCbProxyMap.get(e);if(r||n.evtCbProxyMap.set(e,r=new Map),!r.get(t)){var i=function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];!r[0]||"object"!==Oe()(r[0])||r[0].lngLat||r[0].lnglat||(r[0].lngLat=r[0].latlng||r[0].latLng,r[0].map=n.map),t.apply(void 0,r)};r.set(t,i),n.map.on(e,i)}};Array.isArray(lr[e])?lr[e].forEach((function(t){r(t||e)})):r(lr[e]||e)}}},{key:"off",value:function(e,t){var n=this;if(-1===D.MapServiceEvent.indexOf(e)){var r=function(r){var i,o,a=null===(i=n.evtCbProxyMap.get(e))||void 0===i?void 0:i.get(t);a&&(null===(o=n.evtCbProxyMap.get(r))||void 0===o||o.delete(t),n.map.off(r,a))};Array.isArray(lr[e])?lr[e].forEach((function(t){r(t||e)})):r(lr[e]||e)}else this.eventEmitter.off(e,t)}},{key:"once",value:function(e,t){throw new Error("Method not implemented.")}},{key:"getMapContainer",value:function(){return this.map.getContainer()}},{key:"getType",value:function(){return"tdtmap"}},{key:"getMapCanvasContainer",value:function(){var e;return null===(e=this.map.getContainer())||void 0===e?void 0:e.getElementsByClassName("tdt-container")[0]}},{key:"getSize",value:function(){var e=this.map.getSize();return[e.x,e.y]}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(e){return this.map.setZoom(e)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(e){var t=window.T.LngLat(e[0],e[1]);this.map.centerAndZoom(t,this.map.getZoom())}},{key:"setZoomAndCenter",value:function(e,t){var n=window.T.LngLat(t[0],t[1]);this.map.centerAndZoom(n,e)}},{key:"getPitch",value:function(){return 0}},{key:"getRotation",value:function(){return 0}},{key:"setRotation",value:function(e){this.map.setBearing(e)}},{key:"zoomIn",value:function(e,t){this.map.zoomIn(e,t)}},{key:"zoomOut",value:function(e,t){this.map.zoomOut(e,t)}},{key:"panTo",value:function(e){this.map.panTo(e)}},{key:"panBy",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy([e,t])}},{key:"fitBounds",value:function(e){var t=m()(e,2),n=t[0],r=t[1];this.map.setViewport([new window.T.LngLat(n[0],n[1]),new window.T.LngLat(r[0],r[1])])}},{key:"setMaxZoom",value:function(e){this.map.setMaxZoom(e)}},{key:"setMinZoom",value:function(e){this.map.setMinZoom(e)}},{key:"setMapStatus",value:function(e){!0===e.doubleClickZoom&&this.map.enableDoubleClickZoom(),!1===e.doubleClickZoom&&this.map.disableDoubleClickZoom(),!1===e.dragEnable&&this.map.disableDrag(),!0===e.dragEnable&&this.map.enableDrag(),!1===e.keyboardEnable&&this.map.disableKeyboard(),!0===e.keyboardEnable&&this.map.enableKeyboard(),!1===e.zoomEnable&&this.map.disableScrollWheelZoom(),!0===e.zoomEnable&&this.map.enableScrollWheelZoom()}},{key:"getModelMatrix",value:function(){throw new Error("Method not implemented.")}},{key:"pixelToLngLat",value:function(e){var t=m()(e,2),n=t[0],r=t[1],i=this.map.layerPointToLngLat({x:n,y:r});return{lng:i.lng,lat:i.lat}}},{key:"lngLatToPixel",value:function(e){var t=m()(e,2),n=t[0],r=t[1],i=this.map.lngLatToLayerPoint({lng:n,lat:r});return{x:i.x,y:i.y}}},{key:"containerToLngLat",value:function(e){var t=m()(e,2),n=t[0],r=t[1],i=this.map.containerPointToLngLat({x:n,y:r});return{lng:i.lng,lat:i.lat}}},{key:"lngLatToContainer",value:function(e){var t=m()(e,2),n=t[0],r=t[1],i=this.map.lngLatToContainerPoint({lat:r,lng:n});return{x:i.x,y:i.y}}},{key:"lngLatToCoord",value:function(e){var t=m()(e,2),n=t[0],r=t[1],i=this.lngLatToPixel([n,r]);return[i.x,i.y]}},{key:"lngLatToCoords",value:function(e){var t=this;return e.map((function(e){return Array.isArray(e[0])?t.lngLatToCoords(e):t.lngLatToCoord(e)}))}},{key:"getBounds",value:function(){var e=this.map.getBounds(),t=e.getSouthWest(),n=e.getNorthEast();return[[t.lng,t.lat],[n.lng,n.lat]]}},{key:"lngLatToMercator",value:function(e,t){var n=ht.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getCustomCoordCenter",value:function(){throw new Error("Method not implemented.")}},{key:"creatMapContainer",value:function(e){var t=e;"string"==typeof e&&(t=document.getElementById(e));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_tdt_div"+ur++,t.appendChild(n),n}}]),r}(Ne),fr=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return cr}}]),n}(v);if(!window)throw Error("TMap JSAPI can only be used in Browser.");var hr=function(e){return e.notload="notload",e.loading="loading",e.loaded="loaded",e.failed="failed",e}(hr||{}),pr={key:"",version:"1.exp",libraries:[]},dr={TMap:hr.notload},vr=[],gr=function(e){if("function"==typeof e){if(dr.TMap===hr.loaded)return void e(window.TMap);vr.push(e)}},mr=function(e){return new Promise((function(t,n){if(dr.TMap===hr.failed)n("");else if(dr.TMap===hr.notload){var r=e.key,i=e.version,o=e.libraries;if(!r)return void n("请填写key");pr.key=r,pr.version=i||pr.version,pr.libraries=o||pr.libraries,dr.TMap=hr.loading,window._onTMapAPILoaded=function(e){if(delete window._onTMapAPILoaded,e)dr.TMap=hr.failed,n(e);else for(dr.TMap=hr.loaded;vr.length;)vr.splice(0,1)[0](window.TMap)};var a=document.createElement("script");a.type="text/javascript",a.async=!1,a.src="https://map.qq.com/api/gljs?callback=_onTMapAPILoaded&v="+pr.version+"&key="+r+"&plugin="+pr.libraries.join(","),a.onerror=function(e){dr.TMap=hr.failed,n(e)},(document.body||document.head).appendChild(a),gr(t)}else if(dr.TMap===hr.loaded){if(e.key&&e.key!==pr.key)return void n("多个不一致的 key");if(e.version&&e.version!==pr.version)return void n("不允许多个版本 JSAPI 混用");gr(t)}}))},yr=["id","mapInstance","center","token","version","libraries","minZoom","maxZoom","rotation","pitch","mapSize","logoVisible"];!function(e,t){var n="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,r="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram);if(!n&&!r&&(t||(t=document),t)){var i=t.head||t.getElementsByTagName("head")[0];if(!i){i=t.createElement("head");var o=t.body||t.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):t.documentElement.appendChild(i)}var a=t.createElement("style");a.type="text/css",a.styleSheet?a.styleSheet.cssText=e:a.appendChild(t.createTextNode(e)),i.appendChild(a)}}("img[src*='//mapapi.qq.com/web/jsapi/logo/logo_def.png'],.logo-text\n{\n  display: none !important;\n}\n\n.tencent-map > canvas + div {\n  z-index: 3 !important;\n}\n");var _r={mapmove:"center_changed",camerachange:["drag","pan","rotate","pitch","zoom"],zoomchange:"zoom",dragging:"drag"},br=function(e){u()(r,e);var t,n=c()(r);function r(){var e;i()(this,r);for(var t=arguments.length,o=new Array(t),a=0;a<t;a++)o[a]=arguments[a];return e=n.call.apply(n,[this].concat(o)),d()(k()(e),"viewport",null),d()(k()(e),"evtCbProxyMap",new Map),d()(k()(e),"handleCameraChanged",(function(){e.emit("mapchange");var t=e.map,n=t.getCenter(),r={center:[n.lng,n.lat],viewportHeight:t.getContainer().clientHeight,viewportWidth:t.getContainer().clientWidth,bearing:t.getHeading(),pitch:t.getPitch(),zoom:t.getZoom()-1};e.viewport.syncWithMapCamera(r),e.updateCoordinateSystemService(),e.cameraChangedCallback(e.viewport)})),e}return a()(r,[{key:"init",value:(t=w()(A()().mark((function e(){var t,n,r,i,o,a,s,u,l,c,f,p,d,v,g,m,y,_,b,x,E,T,S,R,w,M,k,L;return A()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.viewport=new Ee,n=this.config,r=n.id,i=n.mapInstance,o=n.center,a=void 0===o?[121.30654632240122,31.25744185633306]:o,s=n.token,u=void 0===s?"OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77":s,l=n.version,c=void 0===l?"1.exp":l,f=n.libraries,p=void 0===f?[]:f,d=n.minZoom,v=void 0===d?3:d,g=n.maxZoom,m=void 0===g?18:g,y=n.rotation,_=void 0===y?0:y,b=n.pitch,x=void 0===b?0:b,E=n.mapSize,T=void 0===E?1e4:E,S=n.logoVisible,R=void 0===S||S,w=C()(n,yr),window.TMap||i){e.next=5;break}return e.next=5,mr({key:u,version:c,libraries:p});case 5:if(!i){e.next=11;break}this.map=i,this.$mapContainer=this.map.getContainer(),!1===R&&this.hideLogo(),e.next=18;break;case 11:if(r){e.next=13;break}throw Error("No container id specified");case 13:M=U.SO.getContainer(r),k=new TMap.Map(M,h()({maxZoom:m,minZoom:v,rotation:_,pitch:x,showControl:!1,center:new TMap.LatLng(a[1],a[0])},w)),this.map=k,this.$mapContainer=k.getContainer(),!1===R&&this.hideLogo();case 18:this.map.canvasContainer.style.position="absolute",this.map.drawContainer.classList.add("tencent-map"),(L=null===(t=this.map.controlManager.controlContainer)||void 0===t?void 0:t.parentNode)&&(L.style.zIndex=2),this.simpleMapCoord.setSize(T),this.map.on("drag",this.handleCameraChanged),this.map.on("pan",this.handleCameraChanged),this.map.on("rotate",this.handleCameraChanged),this.map.on("pitch",this.handleCameraChanged),this.map.on("zoom",this.handleCameraChanged),this.handleCameraChanged();case 29:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"destroy",value:function(){this.map.destroy()}},{key:"onCameraChanged",value:function(e){this.cameraChangedCallback=e}},{key:"addMarkerContainer",value:function(){var e=this.map.getContainer();this.markerContainer=U.SO.create("div","l7-marker-container",e),this.markerContainer.setAttribute("tabindex","-1"),this.markerContainer.style.zIndex="2"}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(e,t){var n=this;if(-1!==D.MapServiceEvent.indexOf(e))this.eventEmitter.on(e,t);else{var r=function(e){var r=n.evtCbProxyMap.get(e);if(r||n.evtCbProxyMap.set(e,r=new Map),!r.get(t)){var i=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];!n[0]||"object"!==Oe()(n[0])||n[0].lngLat||n[0].lnglat||(n[0].lngLat=n[0].latlng||n[0].latLng),t.apply(void 0,n)};r.set(t,i),n.map.on(e,i)}};Array.isArray(_r[e])?_r[e].forEach((function(t){r(t||e)})):r(_r[e]||e)}}},{key:"off",value:function(e,t){var n=this;if(-1===D.MapServiceEvent.indexOf(e)){var r=function(r){var i,o,a=null===(i=n.evtCbProxyMap.get(e))||void 0===i?void 0:i.get(t);a&&(null===(o=n.evtCbProxyMap.get(r))||void 0===o||o.delete(t),n.map.off(r,a))};Array.isArray(_r[e])?_r[e].forEach((function(t){r(t||e)})):r(_r[e]||e)}else this.eventEmitter.off(e,t)}},{key:"once",value:function(){throw new Error("Method not implemented.")}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getSize",value:function(){return[this.map.width,this.map.height]}},{key:"getMinZoom",value:function(){return this.map.transform._minZoom}},{key:"getMaxZoom",value:function(){return this.map.transform._maxZoom}},{key:"getType",value:function(){return"tmap"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"getCenter",value:function(){var e=this.map.getCenter();return{lng:e.lng,lat:e.lat}}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getRotation()}},{key:"getBounds",value:function(){var e=this.map.getBounds().getNorthEast(),t=this.map.getBounds().getSouthWest();return[[t.lng,t.lat],[e.lng,e.lat]]}},{key:"getMapContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var e;return null===(e=this.map.getContainer())||void 0===e?void 0:e.getElementsByTagName("canvas")[0]}},{key:"getCanvasOverlays",value:function(){var e;return null===(e=this.getMapCanvasContainer())||void 0===e||null===(e=e.nextSibling)||void 0===e?void 0:e.firstChild}},{key:"getMapStyleConfig",value:function(){throw new Error("Method not implemented.")}},{key:"setBgColor",value:function(e){this.bgColor=e}},{key:"setMapStyle",value:function(e){this.map.setMapStyleId(e)}},{key:"setRotation",value:function(e){this.map.setRotation(e)}},{key:"zoomIn",value:function(){this.map.setZoom(this.getZoom()+1)}},{key:"zoomOut",value:function(){this.map.setZoom(this.getZoom()-1)}},{key:"panTo",value:function(e){var t=m()(e,2),n=t[0],r=t[1];this.map.panTo(new TMap.LatLng(r,n))}},{key:"panBy",value:function(e,t){this.map.panBy([e,t])}},{key:"fitBounds",value:function(e,t){var n=m()(e,2),r=n[0],i=n[1],o=new TMap.LatLng(r[1],r[0]),a=new TMap.LatLng(i[1],i[0]),s=new TMap.LatLngBounds(o,a);this.map.fitBounds(s,t)}},{key:"setZoomAndCenter",value:function(e,t){var n=m()(t,2),r=n[0],i=n[1];this.map.setCenter(new TMap.LatLng(i,r)),this.map.setZoom(e)}},{key:"setCenter",value:function(e){var t=m()(e,2),n=t[0],r=t[1];this.map.setCenter(new TMap.LatLng(r,n))}},{key:"setPitch",value:function(e){this.map.setPitch(e)}},{key:"setZoom",value:function(e){this.map.setZoom(e)}},{key:"setMapStatus",value:function(e){var t=this;Object.keys(e).map((function(n){switch(n){case"doubleClickZoom":t.map.setDoubleClickZoom(!!e.doubleClickZoom);break;case"dragEnable":t.map.setDraggable(!!e.dragEnable);break;case"rotateEnable":t.map.setRotatable(!!e.rotateEnable);break;case"zoomEnable":t.map.setDoubleClickZoom(!!e.zoomEnable),t.map.setScrollable(!!e.zoomEnable);break;case"keyboardEnable":case"resizeEnable":case"showIndoorMap":throw Error("Options may bot be supported")}}))}},{key:"meterToCoord",value:function(e,t){var n=m()(e,2),r=n[0],i=n[1],o=m()(t,2),a=o[0],s=o[1],u=TMap.geometry.computeDistance([new TMap.LatLng(i,r),new TMap.LatLng(s,a)]),l=this.lngLatToCoord([r,i]),c=m()(l,2),f=c[0],h=c[1],p=this.lngLatToCoord([a,s]),d=m()(p,2),v=d[0],g=d[1];return Math.sqrt(Math.pow(f-v,2)+Math.pow(h-g,2))/u}},{key:"pixelToLngLat",value:function(e){var t=m()(e,2),n=t[0],r=t[1],i=this.map.getCenter(),o=i.lng,a=i.lat,s=this.lngLatToPixel([o,a]),u=s.x,l=s.y,c=this.lngLatToContainer([o,a]),f=c.x,h=c.y,p=this.map.unprojectFromContainer(new TMap.Point(f+(n-u),h+(r-l))),d=p.lng,v=p.lat;return this.containerToLngLat([d,v])}},{key:"lngLatToPixel",value:function(e){var t=m()(e,2),n=t[0],r=t[1],i=this.map.projectToWorldPlane(new TMap.LatLng(r,n));return{x:i.x,y:i.y}}},{key:"containerToLngLat",value:function(e){var t=m()(e,2),n=t[0],r=t[1],i=this.map.unprojectFromContainer(new TMap.Point(n,r));return{lng:i.lng,lat:i.lat}}},{key:"lngLatToContainer",value:function(e){var t=m()(e,2),n=t[0],r=t[1],i=this.map.projectToContainer(new TMap.LatLng(r,n));return{x:i.x,y:i.y}}},{key:"lngLatToCoord",value:function(e){var t=m()(e,2),n=t[0],r=t[1],i=this.lngLatToPixel([n,r]);return[i.x,-i.y]}},{key:"lngLatToCoords",value:function(e){var t=this;return e.map((function(e){return Array.isArray(e[0])?t.lngLatToCoords(e):t.lngLatToCoord(e)}))}},{key:"lngLatToMercator",value:function(e,t){var n=ht.fromLngLat(e,t),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z;return{x:i,y:a,z:void 0===s?0:s}}},{key:"getModelMatrix",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(e),o=F.create();return F.translate(o,o,z.fromValues(i[0],i[1],t)),F.scale(o,o,z.fromValues(r[0],r[1],r[2])),F.rotateX(o,o,n[0]),F.rotateY(o,o,n[1]),F.rotateZ(o,o,n[2]),o}},{key:"getCustomCoordCenter",value:function(){throw new Error("Method not implemented.")}},{key:"exportMap",value:function(e){var t=this.getMapCanvasContainer();return"jpg"===e?null==t?void 0:t.toDataURL("image/jpeg"):null==t?void 0:t.toDataURL("image/png")}},{key:"rotateY",value:function(){throw new Error("Method not implemented.")}},{key:"hideLogo",value:function(){var e=this.map.getContainer();e&&U.SO.addClass(e,"tmap-contianer--hide-logo")}}]),r}(Ne),xr=function(e){u()(n,e);var t=c()(n);function n(){return i()(this,n),t.apply(this,arguments)}return a()(n,[{key:"getServiceConstructor",value:function(){return br}}]),n}(v),Er=ke,Tr=ke,Ar=ke},4230:function(e,t,n){"use strict";n.d(t,{x:function(){return Di}});var r,i=n(4450),o=n.n(i),a=n(3420),s=n.n(a),u=n(6502),l=n.n(u),c=n(4351),f=n.n(c),h=n(8025),p=n.n(h),d=n(1133),v=n.n(d),g=n(3769),m=n.n(g),y=n(8168),_=n(7033),b=n(7431),x=n(1767),E=n(6270),T=n.n(E),A=function(){function e(t,n){p()(this,e),m()(this,"attribute",void 0),m()(this,"buffer",void 0);var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return v()(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(e){this.buffer.subData(e)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),S=m()(m()(m()(m()(m()(m()(m()({},_.gl.POINTS,"points"),_.gl.LINES,"lines"),_.gl.LINE_LOOP,"line loop"),_.gl.LINE_STRIP,"line strip"),_.gl.TRIANGLES,"triangles"),_.gl.TRIANGLE_FAN,"triangle fan"),_.gl.TRIANGLE_STRIP,"triangle strip"),C=m()(m()(m()({},_.gl.STATIC_DRAW,"static"),_.gl.DYNAMIC_DRAW,"dynamic"),_.gl.STREAM_DRAW,"stream"),R=m()(m()(m()(m()(m()(m()({},_.gl.BYTE,"int8"),_.gl.INT,"int32"),_.gl.UNSIGNED_BYTE,"uint8"),_.gl.UNSIGNED_SHORT,"uint16"),_.gl.UNSIGNED_INT,"uint32"),_.gl.FLOAT,"float"),w=m()(m()(m()(m()(m()(m()(m()(m()(m()(m()({},_.gl.ALPHA,"alpha"),_.gl.LUMINANCE,"luminance"),_.gl.LUMINANCE_ALPHA,"luminance alpha"),_.gl.RGB,"rgb"),_.gl.RGBA,"rgba"),_.gl.RGBA4,"rgba4"),_.gl.RGB5_A1,"rgb5 a1"),_.gl.RGB565,"rgb565"),_.gl.DEPTH_COMPONENT,"depth"),_.gl.DEPTH_STENCIL,"depth stencil"),M=m()(m()(m()({},_.gl.DONT_CARE,"dont care"),_.gl.NICEST,"nice"),_.gl.FASTEST,"fast"),k=m()(m()(m()(m()(m()(m()({},_.gl.NEAREST,"nearest"),_.gl.LINEAR,"linear"),_.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),_.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),_.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),_.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),L=m()(m()(m()({},_.gl.REPEAT,"repeat"),_.gl.CLAMP_TO_EDGE,"clamp"),_.gl.MIRRORED_REPEAT,"mirror"),O=m()(m()({},_.gl.NONE,"none"),_.gl.BROWSER_DEFAULT_WEBGL,"browser"),I=m()(m()(m()(m()(m()(m()(m()(m()({},_.gl.NEVER,"never"),_.gl.ALWAYS,"always"),_.gl.LESS,"less"),_.gl.LEQUAL,"lequal"),_.gl.GREATER,"greater"),_.gl.GEQUAL,"gequal"),_.gl.EQUAL,"equal"),_.gl.NOTEQUAL,"notequal"),P=m()(m()(m()(m()(m()({},_.gl.FUNC_ADD,"add"),_.gl.MIN_EXT,"min"),_.gl.MAX_EXT,"max"),_.gl.FUNC_SUBTRACT,"subtract"),_.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),N=(r={},m()(m()(m()(m()(m()(m()(m()(m()(m()(m()(r,_.gl.ZERO,"zero"),_.gl.ONE,"one"),_.gl.SRC_COLOR,"src color"),_.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),_.gl.SRC_ALPHA,"src alpha"),_.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),_.gl.DST_COLOR,"dst color"),_.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),_.gl.DST_ALPHA,"dst alpha"),_.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),m()(m()(m()(m()(m()(r,_.gl.CONSTANT_COLOR,"constant color"),_.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),_.gl.CONSTANT_ALPHA,"constant alpha"),_.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),_.gl.SRC_ALPHA_SATURATE,"src alpha saturate")),B=m()(m()(m()(m()(m()(m()(m()(m()({},_.gl.NEVER,"never"),_.gl.ALWAYS,"always"),_.gl.LESS,"less"),_.gl.LEQUAL,"lequal"),_.gl.GREATER,"greater"),_.gl.GEQUAL,"gequal"),_.gl.EQUAL,"equal"),_.gl.NOTEQUAL,"notequal"),D=m()(m()(m()(m()(m()(m()(m()(m()({},_.gl.ZERO,"zero"),_.gl.KEEP,"keep"),_.gl.REPLACE,"replace"),_.gl.INVERT,"invert"),_.gl.INCR,"increment"),_.gl.DECR,"decrement"),_.gl.INCR_WRAP,"increment wrap"),_.gl.DECR_WRAP,"decrement wrap"),U=m()(m()({},_.gl.FRONT,"front"),_.gl.BACK,"back"),F=function(){function e(t,n){p()(this,e),m()(this,"buffer",void 0),m()(this,"isDestroyed",!1);var r=n.data,i=n.usage,o=n.type;this.buffer=t.buffer({data:r,usage:C[i||_.gl.STATIC_DRAW],type:R[o||_.gl.UNSIGNED_BYTE]})}return v()(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(e){var t=e.data,n=e.offset;this.buffer.subdata(t,n)}}]),e}(),z=function(){function e(t,n){p()(this,e),m()(this,"elements",void 0);var r=n.data,i=n.usage,o=n.type,a=n.count;this.elements=t.elements({data:r,usage:C[i||_.gl.STATIC_DRAW],type:R[o||_.gl.UNSIGNED_BYTE],count:a})}return v()(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(e){var t=e.data;this.elements.subdata(t)}},{key:"destroy",value:function(){}}]),e}(),G=function(){function e(t,n){p()(this,e),m()(this,"framebuffer",void 0);var r=n.width,i=n.height,o=n.color,a=n.colors,s={width:r,height:i};Array.isArray(a)&&(s.colors=a.map((function(e){return e.get()}))),o&&"boolean"!=typeof o&&(s.color=o.get()),this.framebuffer=t.framebuffer(s)}return v()(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.framebuffer.resize(t,n)}}]),e}(),V=n(5116),j=n.n(V);function H(e){return null==e}function W(e){return"number"==typeof e}var X=function(e,t,n){return e<t?t:e>n?n:e},Z=function(e,t){return Z=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},Z(e,t)};function Y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}Z(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var q=function(){return q=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},q.apply(this,arguments)};function K(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function Q(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function $(e,t){var n,r,i,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]},a=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return a.next=s(0),a.throw=s(1),a.return=s(2),"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(o=0)),o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!(i=o.trys,(i=i.length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}Object.create;function J(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function ee(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function te(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}Object.create;"function"==typeof SuppressedError&&SuppressedError;var ne,re,ie,oe,ae,se,ue,le,ce,fe,he,pe,de,ve,ge,me,ye,_e,be,xe,Ee,Te,Ae,Se,Ce,Re,we,Me=n(246);function ke(e,t,n){return e<<16|t<<8|n}function Le(e){return e>>>8&255}function Oe(e){return e>>>16&255}function Ie(e){return 255&e}function Pe(e){switch(e){case Se.F32:case Se.U32:case Se.S32:return 4;case Se.U16:case Se.S16:case Se.F16:return 2;case Se.U8:case Se.S8:return 1;default:throw new Error("whoops")}}function Ne(e){return Pe(Oe(e))}function Be(e){var t=Ie(e);if(t&Re.Depth)return xe.Depth;if(t&Re.Normalized)return xe.Float;var n=Oe(e);if(n===Se.F16||n===Se.F32)return xe.Float;if(n===Se.U8||n===Se.U16||n===Se.U32)return xe.Uint;if(n===Se.S8||n===Se.S16||n===Se.S32)return xe.Sint;throw new Error("whoops")}function De(e,t){if(void 0===t&&(t=""),!e)throw new Error("Assert fail: ".concat(t))}function Ue(e){if(null!=e)return e;throw new Error("Missing object")}function Fe(e,t){return e.r===t.r&&e.g===t.g&&e.b===t.b&&e.a===t.a}function ze(e,t){e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a}function Ge(e){return{r:e.r,g:e.g,b:e.b,a:e.a}}function Ve(e,t,n,r){return void 0===r&&(r=1),{r:e,g:t,b:n,a:r}}!function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"}(ne||(ne={})),function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool",e[e.RenderBundle=11]="RenderBundle"}(re||(re={})),function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"}(ie||(ie={})),function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"}(oe||(oe={})),function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"}(ae||(ae={})),function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"}(se||(se={})),function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"}(ue||(ue={})),function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"}(le||(le={})),function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"}(ce||(ce={})),function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"}(fe||(fe={})),function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"}(he||(he={})),function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"}(pe||(pe={})),function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"}(de||(de={})),function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"}(ve||(ve={})),function(e){e.LOADED="loaded"}(ge||(ge={})),function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"}(me||(me={})),function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET",e[e.STORAGE=4]="STORAGE"}(ye||(ye={})),function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"}(_e||(_e={})),function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"}(be||(be={})),function(e){e[e.Float=0]="Float",e[e.UnfilterableFloat=1]="UnfilterableFloat",e[e.Uint=2]="Uint",e[e.Sint=3]="Sint",e[e.Depth=4]="Depth"}(xe||(xe={})),function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"}(Ee||(Ee={})),function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"}(Te||(Te={})),function(e){e[e.OcclusionConservative=0]="OcclusionConservative"}(Ae||(Ae={})),function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"}(Se||(Se={})),function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"}(Ce||(Ce={})),function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget",e[e.Luminance=32]="Luminance"}(Re||(Re={})),function(e){e[e.ALPHA=ke(Se.U8,Ce.A,Re.None)]="ALPHA",e[e.U8_LUMINANCE=ke(Se.U8,Ce.A,Re.Luminance)]="U8_LUMINANCE",e[e.F16_LUMINANCE=ke(Se.F16,Ce.A,Re.Luminance)]="F16_LUMINANCE",e[e.F32_LUMINANCE=ke(Se.F32,Ce.A,Re.Luminance)]="F32_LUMINANCE",e[e.F16_R=ke(Se.F16,Ce.R,Re.None)]="F16_R",e[e.F16_RG=ke(Se.F16,Ce.RG,Re.None)]="F16_RG",e[e.F16_RGB=ke(Se.F16,Ce.RGB,Re.None)]="F16_RGB",e[e.F16_RGBA=ke(Se.F16,Ce.RGBA,Re.None)]="F16_RGBA",e[e.F32_R=ke(Se.F32,Ce.R,Re.None)]="F32_R",e[e.F32_RG=ke(Se.F32,Ce.RG,Re.None)]="F32_RG",e[e.F32_RGB=ke(Se.F32,Ce.RGB,Re.None)]="F32_RGB",e[e.F32_RGBA=ke(Se.F32,Ce.RGBA,Re.None)]="F32_RGBA",e[e.U8_R=ke(Se.U8,Ce.R,Re.None)]="U8_R",e[e.U8_R_NORM=ke(Se.U8,Ce.R,Re.Normalized)]="U8_R_NORM",e[e.U8_RG=ke(Se.U8,Ce.RG,Re.None)]="U8_RG",e[e.U8_RG_NORM=ke(Se.U8,Ce.RG,Re.Normalized)]="U8_RG_NORM",e[e.U8_RGB=ke(Se.U8,Ce.RGB,Re.None)]="U8_RGB",e[e.U8_RGB_NORM=ke(Se.U8,Ce.RGB,Re.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=ke(Se.U8,Ce.RGB,Re.sRGB|Re.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=ke(Se.U8,Ce.RGBA,Re.None)]="U8_RGBA",e[e.U8_RGBA_NORM=ke(Se.U8,Ce.RGBA,Re.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=ke(Se.U8,Ce.RGBA,Re.sRGB|Re.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=ke(Se.U16,Ce.R,Re.None)]="U16_R",e[e.U16_R_NORM=ke(Se.U16,Ce.R,Re.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=ke(Se.U16,Ce.RG,Re.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=ke(Se.U16,Ce.RGBA,Re.Normalized)]="U16_RGBA_NORM",e[e.U16_RGBA=ke(Se.U16,Ce.RGBA,Re.None)]="U16_RGBA",e[e.U16_RGB=ke(Se.U16,Ce.RGB,Re.None)]="U16_RGB",e[e.U16_RG=ke(Se.U16,Ce.RG,Re.None)]="U16_RG",e[e.U32_R=ke(Se.U32,Ce.R,Re.None)]="U32_R",e[e.U32_RG=ke(Se.U32,Ce.RG,Re.None)]="U32_RG",e[e.U32_RGB=ke(Se.U32,Ce.RGB,Re.None)]="U32_RGB",e[e.U32_RGBA=ke(Se.U32,Ce.RGBA,Re.None)]="U32_RGBA",e[e.S8_R=ke(Se.S8,Ce.R,Re.None)]="S8_R",e[e.S8_R_NORM=ke(Se.S8,Ce.R,Re.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=ke(Se.S8,Ce.RG,Re.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=ke(Se.S8,Ce.RGB,Re.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=ke(Se.S8,Ce.RGBA,Re.Normalized)]="S8_RGBA_NORM",e[e.S16_R=ke(Se.S16,Ce.R,Re.None)]="S16_R",e[e.S16_RG=ke(Se.S16,Ce.RG,Re.None)]="S16_RG",e[e.S16_RG_NORM=ke(Se.S16,Ce.RG,Re.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=ke(Se.S16,Ce.RGB,Re.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=ke(Se.S16,Ce.RGBA,Re.None)]="S16_RGBA",e[e.S16_RGBA_NORM=ke(Se.S16,Ce.RGBA,Re.Normalized)]="S16_RGBA_NORM",e[e.S32_R=ke(Se.S32,Ce.R,Re.None)]="S32_R",e[e.S32_RG=ke(Se.S32,Ce.RG,Re.None)]="S32_RG",e[e.S32_RGB=ke(Se.S32,Ce.RGB,Re.None)]="S32_RGB",e[e.S32_RGBA=ke(Se.S32,Ce.RGBA,Re.None)]="S32_RGBA",e[e.U16_RGBA_5551=ke(Se.U16_PACKED_5551,Ce.RGBA,Re.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=ke(Se.U16_PACKED_565,Ce.RGB,Re.Normalized)]="U16_RGB_565",e[e.BC1=ke(Se.BC1,Ce.RGBA,Re.Normalized)]="BC1",e[e.BC1_SRGB=ke(Se.BC1,Ce.RGBA,Re.Normalized|Re.sRGB)]="BC1_SRGB",e[e.BC2=ke(Se.BC2,Ce.RGBA,Re.Normalized)]="BC2",e[e.BC2_SRGB=ke(Se.BC2,Ce.RGBA,Re.Normalized|Re.sRGB)]="BC2_SRGB",e[e.BC3=ke(Se.BC3,Ce.RGBA,Re.Normalized)]="BC3",e[e.BC3_SRGB=ke(Se.BC3,Ce.RGBA,Re.Normalized|Re.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=ke(Se.BC4_UNORM,Ce.R,Re.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=ke(Se.BC4_SNORM,Ce.R,Re.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=ke(Se.BC5_UNORM,Ce.RG,Re.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=ke(Se.BC5_SNORM,Ce.RG,Re.Normalized)]="BC5_SNORM",e[e.D24=ke(Se.D24,Ce.R,Re.Depth)]="D24",e[e.D24_S8=ke(Se.D24S8,Ce.RG,Re.Depth|Re.Stencil)]="D24_S8",e[e.D32F=ke(Se.D32F,Ce.R,Re.Depth)]="D32F",e[e.D32F_S8=ke(Se.D32FS8,Ce.RG,Re.Depth|Re.Stencil)]="D32F_S8",e[e.U8_RGB_RT=ke(Se.U8,Ce.RGB,Re.RenderTarget|Re.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=ke(Se.U8,Ce.RGBA,Re.RenderTarget|Re.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=ke(Se.U8,Ce.RGBA,Re.RenderTarget|Re.Normalized|Re.sRGB)]="U8_RGBA_RT_SRGB"}(we||(we={}));var je=Ve(0,0,0,0),He=(Ve(0,0,0,1),Ve(1,1,1,0));Ve(1,1,1,1);function We(e){return!(!e||0!=(e&e-1))}function Xe(e,t){return null!=e?e:t}function Ze(e,t){var n=t-1;return e+n&~n}function Ye(e,t){e.blendDstFactor=t.blendDstFactor,e.blendSrcFactor=t.blendSrcFactor,e.blendMode=t.blendMode}function qe(e,t){return void 0===e&&(e={}),e.compare=t.compare,e.depthFailOp=t.depthFailOp,e.passOp=t.passOp,e.failOp=t.failOp,e.mask=t.mask,e}function Ke(e,t){return void 0===e&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),Ye(e.rgbBlendState,t.rgbBlendState),Ye(e.alphaBlendState,t.alphaBlendState),e.channelWriteMask=t.channelWriteMask,e}function Qe(e,t){e.length!==t.length&&(e.length=t.length);for(var n=0;n<t.length;n++)e[n]=Ke(e[n],t[n])}function $e(e){var t=Object.assign({},e);return t.attachmentsState=[],Qe(t.attachmentsState,e.attachmentsState),t.blendConstant=t.blendConstant&&Ge(t.blendConstant),t.stencilFront=qe(void 0,e.stencilFront),t.stencilBack=qe(void 0,e.stencilBack),t}var Je={blendMode:ue.ADD,blendSrcFactor:se.ONE,blendDstFactor:se.ZERO},et={attachmentsState:[{channelWriteMask:_e.ALL,rgbBlendState:Je,alphaBlendState:Je}],blendConstant:Ge(je),depthWrite:!0,depthCompare:ie.LEQUAL,stencilWrite:!1,stencilFront:{compare:ie.ALWAYS,passOp:be.KEEP,depthFailOp:be.KEEP,failOp:be.KEEP},stencilBack:{compare:ie.ALWAYS,passOp:be.KEEP,depthFailOp:be.KEEP,failOp:be.KEEP},cullMode:ae.NONE,frontFace:oe.CCW,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0};!function(e,t){void 0===e&&(e=null),void 0===t&&(t=et);var n=$e(t);null!==e&&function(e,t){void 0!==t.attachmentsState&&Qe(e.attachmentsState,t.attachmentsState),e.blendConstant&&t.blendConstant&&ze(e.blendConstant,t.blendConstant),e.depthCompare=Xe(t.depthCompare,e.depthCompare),e.depthWrite=Xe(t.depthWrite,e.depthWrite),e.stencilWrite=Xe(t.stencilWrite,e.stencilWrite),e.stencilFront&&t.stencilFront&&qe(e.stencilFront,t.stencilFront),e.stencilBack&&t.stencilBack&&qe(e.stencilBack,t.stencilBack),e.cullMode=Xe(t.cullMode,e.cullMode),e.frontFace=Xe(t.frontFace,e.frontFace),e.polygonOffset=Xe(t.polygonOffset,e.polygonOffset),e.polygonOffsetFactor=Xe(t.polygonOffsetFactor,e.polygonOffsetFactor),e.polygonOffsetUnits=Xe(t.polygonOffsetUnits,e.polygonOffsetUnits)}(n,e)}({depthCompare:ie.ALWAYS,depthWrite:!1},et);var tt,nt={texture:null,sampler:null,formatKind:xe.Float,dimension:me.TEXTURE_2D};function rt(e,t,n){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(!n(e[r],t[r]))return!1;return!0}function it(e,t){for(var n=Array(e.length),r=0;r<e.length;r++)n[r]=t(e[r]);return n}function ot(e,t){return e.texture===t.texture&&e.binding===t.binding}function at(e,t){return e.buffer===t.buffer&&e.size===t.size&&e.binding===t.binding&&e.offset===t.offset}function st(e,t){return null===e?null===t:null!==t&&(e.sampler===t.sampler&&e.texture===t.texture&&e.dimension===t.dimension&&e.formatKind===t.formatKind&&e.comparison===t.comparison)}function ut(e,t){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],e.storageBufferBindings=e.storageBufferBindings||[],e.storageTextureBindings=e.storageTextureBindings||[],t.samplerBindings=t.samplerBindings||[],t.uniformBufferBindings=t.uniformBufferBindings||[],t.storageBufferBindings=t.storageBufferBindings||[],t.storageTextureBindings=t.storageTextureBindings||[],e.samplerBindings.length===t.samplerBindings.length&&(!!rt(e.samplerBindings,t.samplerBindings,st)&&(!!rt(e.uniformBufferBindings,t.uniformBufferBindings,at)&&(!!rt(e.storageBufferBindings,t.storageBufferBindings,at)&&!!rt(e.storageTextureBindings,t.storageTextureBindings,ot))))}function lt(e,t){return e.blendMode==t.blendMode&&e.blendSrcFactor===t.blendSrcFactor&&e.blendDstFactor===t.blendDstFactor}function ct(e,t){return!!lt(e.rgbBlendState,t.rgbBlendState)&&(!!lt(e.alphaBlendState,t.alphaBlendState)&&e.channelWriteMask===t.channelWriteMask)}function ft(e,t){return e.compare==t.compare&&e.depthFailOp===t.depthFailOp&&e.failOp===t.failOp&&e.passOp===t.passOp&&e.mask===t.mask}function ht(e,t){return e.id===t.id}function pt(e,t){return e===t}function dt(e,t){return e.topology===t.topology&&(e.inputLayout===t.inputLayout&&(e.sampleCount===t.sampleCount&&(!(e.megaStateDescriptor&&t.megaStateDescriptor&&!function(e,t){return!(!rt(e.attachmentsState,t.attachmentsState,ct)||e.blendConstant&&t.blendConstant&&!Fe(e.blendConstant,t.blendConstant)||e.stencilFront&&t.stencilFront&&!ft(e.stencilFront,t.stencilFront)||e.stencilBack&&t.stencilBack&&!ft(e.stencilBack,t.stencilBack)||e.depthCompare!==t.depthCompare||e.depthWrite!==t.depthWrite||e.stencilWrite!==t.stencilWrite||e.cullMode!==t.cullMode||e.frontFace!==t.frontFace||e.polygonOffset!==t.polygonOffset||e.polygonOffsetFactor!==t.polygonOffsetFactor||e.polygonOffsetUnits!==t.polygonOffsetUnits)}(e.megaStateDescriptor,t.megaStateDescriptor))&&(!!ht(e.program,t.program)&&(!!rt(e.colorAttachmentFormats,t.colorAttachmentFormats,pt)&&e.depthStencilAttachmentFormat===t.depthStencilAttachmentFormat)))))}function vt(e,t){return e.offset===t.offset&&e.shaderLocation===t.shaderLocation&&e.format===t.format&&e.divisor===t.divisor}function gt(e,t){return H(e)?H(t):!H(t)&&(e.arrayStride===t.arrayStride&&e.stepMode===t.stepMode&&rt(e.attributes,t.attributes,vt))}function mt(e,t){return e.indexBufferFormat===t.indexBufferFormat&&(!!rt(e.vertexBufferDescriptors,t.vertexBufferDescriptors,gt)&&!!ht(e.program,t.program))}function yt(e){return{sampler:e.sampler,texture:e.texture,dimension:e.dimension,formatKind:e.formatKind,comparison:e.comparison}}function _t(e){var t=e.buffer,n=e.size;return{binding:e.binding,buffer:t,offset:e.offset,size:n}}function bt(e){return{binding:e.binding,texture:e.texture}}function xt(e){return{shaderLocation:e.shaderLocation,format:e.format,offset:e.offset,divisor:e.divisor}}function Et(e){return H(e)?e:{arrayStride:e.arrayStride,stepMode:e.stepMode,attributes:it(e.attributes,xt)}}var Tt=/([^[]*)(\[[0-9]+\])?/;function At(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};var t=e.match(Tt);if(!t||t.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:t[1],length:Number(t[2])||1,isArray:Boolean(t[2])}}function St(){var e=null;return function(t,n,r){var i=e!==r;return i&&(t.uniform1i(n,r),e=r),i}}function Ct(e,t,n,r){var i=null,o=null;return function(a,s,u){var l=t(u,n),c=l.length,f=!1;if(null===i)i=new Float32Array(c),o=c,f=!0;else{De(o===c,"Uniform length cannot change.");for(var h=0;h<c;++h)if(l[h]!==i[h]){f=!0;break}}return f&&(r(a,e,s,l),i.set(l)),f}}function Rt(e,t,n,r){e[t](n,r)}function wt(e,t,n,r){e[t](n,!1,r)}var Mt={},kt={},Lt={},Ot=[0];function It(e,t,n,r){1===t&&"boolean"==typeof e&&(e=e?1:0),Number.isFinite(e)&&(Ot[0]=e,e=Ot);var i=e.length;if(e instanceof n)return e;var o=r[i];o||(o=new n(i),r[i]=o);for(var a=0;a<i;a++)o[a]=e[a];return o}function Pt(e,t){return It(e,t,Float32Array,Mt)}function Nt(e,t){return It(e,t,Int32Array,kt)}function Bt(e,t){return It(e,t,Uint32Array,Lt)}var Dt=((tt={})[ne.FLOAT]=Ct.bind(null,"uniform1fv",Pt,1,Rt),tt[ne.FLOAT_VEC2]=Ct.bind(null,"uniform2fv",Pt,2,Rt),tt[ne.FLOAT_VEC3]=Ct.bind(null,"uniform3fv",Pt,3,Rt),tt[ne.FLOAT_VEC4]=Ct.bind(null,"uniform4fv",Pt,4,Rt),tt[ne.INT]=Ct.bind(null,"uniform1iv",Nt,1,Rt),tt[ne.INT_VEC2]=Ct.bind(null,"uniform2iv",Nt,2,Rt),tt[ne.INT_VEC3]=Ct.bind(null,"uniform3iv",Nt,3,Rt),tt[ne.INT_VEC4]=Ct.bind(null,"uniform4iv",Nt,4,Rt),tt[ne.BOOL]=Ct.bind(null,"uniform1iv",Nt,1,Rt),tt[ne.BOOL_VEC2]=Ct.bind(null,"uniform2iv",Nt,2,Rt),tt[ne.BOOL_VEC3]=Ct.bind(null,"uniform3iv",Nt,3,Rt),tt[ne.BOOL_VEC4]=Ct.bind(null,"uniform4iv",Nt,4,Rt),tt[ne.FLOAT_MAT2]=Ct.bind(null,"uniformMatrix2fv",Pt,4,wt),tt[ne.FLOAT_MAT3]=Ct.bind(null,"uniformMatrix3fv",Pt,9,wt),tt[ne.FLOAT_MAT4]=Ct.bind(null,"uniformMatrix4fv",Pt,16,wt),tt[ne.UNSIGNED_INT]=Ct.bind(null,"uniform1uiv",Bt,1,Rt),tt[ne.UNSIGNED_INT_VEC2]=Ct.bind(null,"uniform2uiv",Bt,2,Rt),tt[ne.UNSIGNED_INT_VEC3]=Ct.bind(null,"uniform3uiv",Bt,3,Rt),tt[ne.UNSIGNED_INT_VEC4]=Ct.bind(null,"uniform4uiv",Bt,4,Rt),tt[ne.FLOAT_MAT2x3]=Ct.bind(null,"uniformMatrix2x3fv",Pt,6,wt),tt[ne.FLOAT_MAT2x4]=Ct.bind(null,"uniformMatrix2x4fv",Pt,8,wt),tt[ne.FLOAT_MAT3x2]=Ct.bind(null,"uniformMatrix3x2fv",Pt,6,wt),tt[ne.FLOAT_MAT3x4]=Ct.bind(null,"uniformMatrix3x4fv",Pt,12,wt),tt[ne.FLOAT_MAT4x2]=Ct.bind(null,"uniformMatrix4x2fv",Pt,8,wt),tt[ne.FLOAT_MAT4x3]=Ct.bind(null,"uniformMatrix4x3fv",Pt,12,wt),tt[ne.SAMPLER_2D]=St,tt[ne.SAMPLER_CUBE]=St,tt[ne.SAMPLER_3D]=St,tt[ne.SAMPLER_2D_SHADOW]=St,tt[ne.SAMPLER_2D_ARRAY]=St,tt[ne.SAMPLER_2D_ARRAY_SHADOW]=St,tt[ne.SAMPLER_CUBE_SHADOW]=St,tt[ne.INT_SAMPLER_2D]=St,tt[ne.INT_SAMPLER_3D]=St,tt[ne.INT_SAMPLER_CUBE]=St,tt[ne.INT_SAMPLER_2D_ARRAY]=St,tt[ne.UNSIGNED_INT_SAMPLER_2D]=St,tt[ne.UNSIGNED_INT_SAMPLER_3D]=St,tt[ne.UNSIGNED_INT_SAMPLER_CUBE]=St,tt[ne.UNSIGNED_INT_SAMPLER_2D_ARRAY]=St,tt);function Ut(e,t,n){var r=Dt[n.type];if(!r)throw new Error("Unknown GLSL uniform type ".concat(n.type));return r().bind(null,e,t)}var Ft={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function zt(e,t){return"#define ".concat(e," ").concat(t)}function Gt(e){if(void 0===e)return null;var t=/binding\s*=\s*(\d+)/.exec(e);if(null!==t){var n=parseInt(t[1],10);if(!Number.isNaN(n))return n}return null}function Vt(e){return[e,""]}function jt(e,t,n,r,i){var o;void 0===r&&(r=null),void 0===i&&(i=!0);var a="#version 100"===e.glslVersion,s="frag"===t&&(null===(o=n.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))||void 0===o?void 0:o.length)>1,u=n.replace("\r\n","\n").split("\n").map((function(e){return e.replace(/[/][/].*$/,"")})).filter((function(e){return!(!e||/^\s+$/.test(e))})),l="";null!==r&&(l=Object.keys(r).map((function(e){return zt(e,r[e])})).join("\n"));var c=u.find((function(e){return e.startsWith("precision")}))||"precision mediump float;",f=i?u.filter((function(e){return!e.startsWith("precision")})).join("\n"):u.join("\n"),h="";if(e.viewportOrigin===Ee.UPPER_LEFT&&(h+="".concat(zt("VIEWPORT_ORIGIN_TL","1"),"\n")),e.clipSpaceNearZ===Te.ZERO&&(h+="".concat(zt("CLIPSPACE_NEAR_ZERO","1"),"\n")),e.explicitBindingLocations){var p=0,d=0,v=0;f=f.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,(function(e,t,n,r){var i=n?"".concat(n,", "):"";return"layout(".concat(i,"set = ").concat(p,", binding = ").concat(d++,") uniform ").concat(r)})),p++,d=0,De(e.separateSamplerTextures),f=f.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,(function(e,n,r,i,o){var a=Gt(r);null===a&&(a=d++);var s=ee(Vt(i),2),u=s[0],l=s[1];return"frag"===t?"\nlayout(set = ".concat(p,", binding = ").concat(2*a+0,") uniform texture").concat(u," T_").concat(o,";\nlayout(set = ").concat(p,", binding = ").concat(2*a+1,") uniform sampler").concat(l," S_").concat(o,";").trim():""})),f=f.replace("frag"===t?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,(function(e,t){return"layout(location = ".concat(v++,") ").concat(t)})),h+="".concat(zt("gl_VertexID","gl_VertexIndex"),"\n"),h+="".concat(zt("gl_InstanceID","gl_InstanceIndex"),"\n"),c=c.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var g=0;f=f.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,(function(e,t,n,r,i){var o=Gt(n);return null===o&&(o=g++),"uniform sampler".concat(r," ").concat(i,"; // BINDING=").concat(o)}))}if(f=(f=(f=f.replace(/\bPU_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"SAMPLER_".concat(t,"(P_").concat(n,")")}))).replace(/\bPF_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"PP_SAMPLER_".concat(t,"(P_").concat(n,")")}))).replace(/\bPU_TEXTURE\((.*?)\)/g,(function(e,t){return"TEXTURE(P_".concat(t,")")})),e.separateSamplerTextures)f=f.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){var r=ee(Vt(t),2),i=r[0],o=r[1];return"texture".concat(i," T_P_").concat(n,", sampler").concat(o," S_P_").concat(n)})),f=(f=(f=f.replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"T_".concat(n,", S_").concat(n)}))).replace(/\bSAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"sampler".concat(t,"(T_").concat(n,", S_").concat(n,")")}))).replace(/\bTEXTURE\((.*?)\)/g,(function(e,t){return"T_".concat(t)}));else{var m=[];f=(f=(f=f.replace(/\bPD_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return"sampler".concat(t," P_").concat(n)}))).replace(/\bPP_SAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return n}))).replace(/\bSAMPLER_(\w+)\((.*?)\)/g,(function(e,t,n){return m.push([n,t]),n})),a&&m.forEach((function(e){var t=ee(e,2),n=t[0],r=t[1];f=f.replace(new RegExp("texture\\(".concat(n),"g"),(function(){return"texture".concat(r,"(").concat(n)}))})),f=f.replace(/\bTEXTURE\((.*?)\)/g,(function(e,t){return t}))}var y="".concat(a?"":e.glslVersion,"\n").concat(a&&s?"#extension GL_EXT_draw_buffers : require\n":"","\n").concat(a&&"frag"===t?"#extension GL_OES_standard_derivatives : enable\n":"").concat(i?c:"","\n").concat(h||"").concat(l?l+"\n":"","\n").concat(f,"\n").trim();if(e.explicitBindingLocations&&"frag"===t&&(y=y.replace(/^\b(out)\b/g,(function(e,t){return"layout(location = 0) ".concat(t)}))),a){if("frag"===t&&(y=y.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return"varying ".concat(t," ").concat(n,";\n")}))),"vert"===t&&(y=(y=y.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return"varying ".concat(t," ").concat(n,";\n")}))).replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return"attribute ".concat(t," ").concat(n,";\n")}))),y=y.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,(function(e,t){return t.trim().replace(/^.*$/gm,(function(e){var t=e.trim();return t.startsWith("#")?t:e?"uniform ".concat(t):""}))})),"frag"===t)if(s){var _=[],b=(y=y.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,(function(e,t){return _.push(t),"vec4 ".concat(t,";\n")}))).lastIndexOf("}");y=y.substring(0,b)+"\n    ".concat(_.map((function(e,t){return"gl_FragData[".concat(t,"] = ").concat(e,";\n    ")})).join("\n"))+y.substring(b)}else{var x;if(y=y.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,(function(e,t,n){return x=n,"".concat(t," ").concat(n,";\n")})),x){b=y.lastIndexOf("}");y=y.substring(0,b)+"\n  gl_FragColor = vec4(".concat(x,");\n")+y.substring(b)}}y=y.replace(/^\s*layout\((.*)\)/gm,"")}return y}var Ht,Wt=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this)||this;return i.id=n,i.device=r,null!==i.device.resourceCreationTracker&&i.device.resourceCreationTracker.trackResourceCreated(i),i}return Y(t,e),t.prototype.destroy=function(){null!==this.device.resourceCreationTracker&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},t}(Me),Xt=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=re.Bindings;var a=i.uniformBufferBindings,s=i.samplerBindings;return o.uniformBufferBindings=a||[],o.samplerBindings=s||[],o.bindingLayouts=o.createBindingLayouts(),o}return Y(t,e),t.prototype.createBindingLayouts=function(){var e=0,t=0,n=[],r=this.uniformBufferBindings.length,i=this.samplerBindings.length;return n.push({firstUniformBuffer:e,numUniformBuffers:r,firstSampler:t,numSamplers:i}),{numUniformBuffers:e+=r,numSamplers:t+=i,bindingLayoutTables:n}},t}(Wt);function Zt(e){return void 0!==Ht?Ht:"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext?(Ht=!0,!0):Ht=Boolean(e&&2===e._version)}function Yt(e){switch(Oe(e)){case Se.BC1:case Se.BC2:case Se.BC3:case Se.BC4_UNORM:case Se.BC4_SNORM:case Se.BC5_UNORM:case Se.BC5_SNORM:return!0;default:return!1}}function qt(e){if(Ie(e)&Re.Normalized)return!1;var t=Oe(e);return t===Se.S8||t===Se.S16||t===Se.S32||(t===Se.U8||t===Se.U16||t===Se.U32)}function Kt(e){return e&pe.INDEX?ne.ELEMENT_ARRAY_BUFFER:e&pe.VERTEX?ne.ARRAY_BUFFER:e&pe.UNIFORM?ne.UNIFORM_BUFFER:void 0}function Qt(e){var t=Oe(e),n=Le(e),r=Ie(e),i=function(e){switch(e){case Se.U8:return ne.UNSIGNED_BYTE;case Se.U16:return ne.UNSIGNED_SHORT;case Se.U32:return ne.UNSIGNED_INT;case Se.S8:return ne.BYTE;case Se.S16:return ne.SHORT;case Se.S32:return ne.INT;case Se.F16:return ne.HALF_FLOAT;case Se.F32:return ne.FLOAT;default:throw new Error("whoops")}}(t),o=function(e){switch(e){case Ce.R:return 1;case Ce.RG:return 2;case Ce.RGB:return 3;case Ce.RGBA:return 4;default:return 1}}(n);return{size:o,type:i,normalized:!!(r&Re.Normalized)}}function $t(e){switch(e){case le.CLAMP_TO_EDGE:return ne.CLAMP_TO_EDGE;case le.REPEAT:return ne.REPEAT;case le.MIRRORED_REPEAT:return ne.MIRRORED_REPEAT;default:throw new Error("whoops")}}function Jt(e,t){if(t===fe.LINEAR&&e===ce.BILINEAR)return ne.LINEAR_MIPMAP_LINEAR;if(t===fe.LINEAR&&e===ce.POINT)return ne.NEAREST_MIPMAP_LINEAR;if(t===fe.NEAREST&&e===ce.BILINEAR)return ne.LINEAR_MIPMAP_NEAREST;if(t===fe.NEAREST&&e===ce.POINT)return ne.NEAREST_MIPMAP_NEAREST;if(t===fe.NO_MIP&&e===ce.BILINEAR)return ne.LINEAR;if(t===fe.NO_MIP&&e===ce.POINT)return ne.NEAREST;throw new Error("Unknown texture filter mode")}function en(e,t){void 0===t&&(t=0);var n=e;return n.gl_buffer_pages[t/n.pageByteSize|0]}function tn(e){return e.gl_texture}function nn(e){return e.gl_sampler}function rn(e,t){e.name=t,e.__SPECTOR_Metadata={name:t}}function on(e,t){for(var n=[];;){var r=t.exec(e);if(!r)break;n.push(r)}return n}function an(e){return e.blendMode==ue.ADD&&e.blendSrcFactor==se.ONE&&e.blendDstFactor===se.ZERO}function sn(e){if(e===me.TEXTURE_2D)return ne.TEXTURE_2D;if(e===me.TEXTURE_2D_ARRAY)return ne.TEXTURE_2D_ARRAY;if(e===me.TEXTURE_CUBE_MAP)return ne.TEXTURE_CUBE_MAP;if(e===me.TEXTURE_3D)return ne.TEXTURE_3D;throw new Error("whoops")}function un(e,t,n,r){return e%n==0&&t%r==0}var ln,cn=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=re.Buffer;var a=i.viewOrSize,s=i.usage,u=i.hint,l=void 0===u?de.STATIC:u,c=r.uniformBufferMaxPageByteSize,f=r.gl,h=s&pe.UNIFORM;h||(Zt(f)?f.bindVertexArray(null):r.OES_vertex_array_object.bindVertexArrayOES(null));var p,d=W(a)?Ze(a,4):Ze(a.byteLength,4);if(o.gl_buffer_pages=[],h){for(var v=d;v>0;)o.gl_buffer_pages.push(o.createBufferPage(Math.min(v,c),s,l)),v-=c;p=c}else o.gl_buffer_pages.push(o.createBufferPage(d,s,l)),p=d;return o.pageByteSize=p,o.byteSize=d,o.usage=s,o.gl_target=Kt(s),W(a)||o.setSubData(0,new Uint8Array(a.buffer)),h||(Zt(f)?f.bindVertexArray(o.device.currentBoundVAO):r.OES_vertex_array_object.bindVertexArrayOES(o.device.currentBoundVAO)),o}return Y(t,e),t.prototype.setSubData=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=t.byteLength-n);for(var i=this.device.gl,o=this.pageByteSize,a=e+r,s=e,u=e%o;s<a;){var l=Zt(i)?i.COPY_WRITE_BUFFER:this.gl_target,c=en(this,s);if(c.ubo)return;i.bindBuffer(l,c),Zt(i)?i.bufferSubData(l,u,t,n,Math.min(a-s,o)):i.bufferSubData(l,u,t),s+=o,u=0,n+=o,this.device.debugGroupStatisticsBufferUpload()}},t.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.gl_buffer_pages.length;t++)this.gl_buffer_pages[t].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[t]);this.gl_buffer_pages=[]},t.prototype.createBufferPage=function(e,t,n){var r=this.device.gl,i=t&pe.UNIFORM;if(!Zt(r)&&i)return{ubo:!0};var o=this.device.ensureResourceExists(r.createBuffer()),a=Kt(t),s=function(e){switch(e){case de.STATIC:return ne.STATIC_DRAW;case de.DYNAMIC:return ne.DYNAMIC_DRAW}}(n);return r.bindBuffer(a,o),r.bufferData(a,e,s),o},t}(Wt),fn=function(e){function t(t){var n,r,i,o,a,s=t.id,u=t.device,l=t.descriptor,c=e.call(this,{id:s,device:u})||this;c.type=re.InputLayout;var f=l.vertexBufferDescriptors,h=l.indexBufferFormat,p=l.program;De(h===we.U16_R||h===we.U32_R||null===h);var d=null!==h?function(e){switch(e){case we.U8_R:return ne.UNSIGNED_BYTE;case we.U16_R:return ne.UNSIGNED_SHORT;case we.U32_R:return ne.UNSIGNED_INT;default:throw new Error("whoops")}}(h):null,v=null!==h?Ne(h):null,g=c.device.gl,m=c.device.ensureResourceExists(Zt(g)?g.createVertexArray():u.OES_vertex_array_object.createVertexArrayOES());Zt(g)?g.bindVertexArray(m):u.OES_vertex_array_object.bindVertexArrayOES(m),g.bindBuffer(g.ARRAY_BUFFER,en(c.device.fallbackVertexBuffer));try{for(var y=J(l.vertexBufferDescriptors),_=y.next();!_.done;_=y.next()){var b=_.value,x=b.stepMode,E=b.attributes;try{for(var T=(i=void 0,J(E)),A=T.next();!A.done;A=T.next()){var S=A.value,C=S.shaderLocation,R=S.format,w=S.divisor,M=void 0===w?1:w,k=Zt(g)?C:null===(a=p.attributes[C])||void 0===a?void 0:a.location,L=Qt(R);if(S.vertexFormat=L,!H(k)){qt(R);var O=L.size,I=L.type,P=L.normalized;g.vertexAttribPointer(k,O,I,P,0,0),x===ve.INSTANCE&&(Zt(g)?g.vertexAttribDivisor(k,M):u.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(k,M)),g.enableVertexAttribArray(k)}}}catch(e){i={error:e}}finally{try{A&&!A.done&&(o=T.return)&&o.call(T)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{_&&!_.done&&(r=y.return)&&r.call(y)}finally{if(n)throw n.error}}return Zt(g)?g.bindVertexArray(null):u.OES_vertex_array_object.bindVertexArrayOES(null),c.vertexBufferDescriptors=f,c.vao=m,c.indexBufferFormat=h,c.indexBufferType=d,c.indexBufferCompByteSize=v,c.program=p,c}return Y(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(Zt(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},t}(Wt),hn=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=t.fake,a=e.call(this,{id:n,device:r})||this;a.type=re.Texture,i=q({dimension:me.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},i);var s,u,l=a.device.gl,c=a.clampmipLevelCount(i);if(a.immutable=i.usage===ye.RENDER_TARGET,a.pixelStore=i.pixelStore,a.format=i.format,a.dimension=i.dimension,a.formatKind=Be(i.format),a.width=i.width,a.height=i.height,a.depthOrArrayLayers=i.depthOrArrayLayers,a.mipmaps=c>=1,!o){u=a.device.ensureResourceExists(l.createTexture());var f=a.device.translateTextureType(i.format),h=a.device.translateTextureInternalFormat(i.format);if(a.device.setActiveTexture(l.TEXTURE0),a.device.currentTextures[0]=null,a.preprocessImage(),i.dimension===me.TEXTURE_2D){if(s=ne.TEXTURE_2D,l.bindTexture(s,u),a.immutable)if(Zt(l))l.texStorage2D(s,c,h,i.width,i.height);else{var p=(h===ne.DEPTH_COMPONENT||a.isNPOT(),0);(a.format!==we.D32F&&a.format!==we.D24_S8||Zt(l)||r.WEBGL_depth_texture)&&(l.texImage2D(s,p,h,i.width,i.height,0,h,f,null),a.mipmaps&&(a.mipmaps=!1,l.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MIN_FILTER,ne.LINEAR),l.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),l.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE)))}De(1===i.depthOrArrayLayers)}else if(i.dimension===me.TEXTURE_2D_ARRAY)s=ne.TEXTURE_2D_ARRAY,l.bindTexture(s,u),a.immutable&&Zt(l)&&l.texStorage3D(s,c,h,i.width,i.height,i.depthOrArrayLayers);else if(i.dimension===me.TEXTURE_3D)s=ne.TEXTURE_3D,l.bindTexture(s,u),a.immutable&&Zt(l)&&l.texStorage3D(s,c,h,i.width,i.height,i.depthOrArrayLayers);else{if(i.dimension!==me.TEXTURE_CUBE_MAP)throw new Error("whoops");s=ne.TEXTURE_CUBE_MAP,l.bindTexture(s,u),a.immutable&&Zt(l)&&l.texStorage2D(s,c,h,i.width,i.height),De(6===i.depthOrArrayLayers)}}return a.gl_texture=u,a.gl_target=s,a.mipLevelCount=c,a}return Y(t,e),t.prototype.setImageData=function(e,t){void 0===t&&(t=0);var n=this.device.gl;Yt(this.format);var r,i=this.gl_target===ne.TEXTURE_3D||this.gl_target===ne.TEXTURE_2D_ARRAY,o=this.gl_target===ne.TEXTURE_CUBE_MAP,a=(r=e[0],Object.prototype.toString.call(r)in Ft);this.device.setActiveTexture(n.TEXTURE0),this.device.currentTextures[0]=null;var s,u,l=e[0];a?(s=this.width,u=this.height):(s=l.width,u=l.height,this.width=s,this.height=u),n.bindTexture(this.gl_target,this.gl_texture);var c=this.device.translateTextureFormat(this.format),f=Zt(n)?this.device.translateInternalTextureFormat(this.format):c,h=this.device.translateTextureType(this.format);this.preprocessImage();for(var p=0;p<this.depthOrArrayLayers;p++){var d=e[p],v=this.gl_target;o&&(v=ne.TEXTURE_CUBE_MAP_POSITIVE_X+p%6),this.immutable?n.texSubImage2D(v,t,0,0,s,u,c,h,d):Zt(n)?i?n.texImage3D(v,t,f,s,u,this.depthOrArrayLayers,0,c,h,d):n.texImage2D(v,t,f,s,u,0,c,h,d):a?n.texImage2D(v,t,c,s,u,0,c,h,d):n.texImage2D(v,t,c,c,h,d)}this.mipmaps&&this.generateMipmap(i)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(tn(this))},t.prototype.clampmipLevelCount=function(e){if(e.dimension===me.TEXTURE_2D_ARRAY&&e.depthOrArrayLayers>1&&Oe(e.format)===Se.BC1)for(var t=e.width,n=e.height,r=0;r<e.mipLevelCount;r++){if(t<=2||n<=2)return r-1;t=Math.max(t/2|0,1),n=Math.max(n/2|0,1)}return e.mipLevelCount},t.prototype.preprocessImage=function(){var e=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&e.pixelStorei(ne.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&e.pixelStorei(ne.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&e.pixelStorei(ne.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},t.prototype.generateMipmap=function(e){void 0===e&&(e=!1);var t=this.device.gl;return!Zt(t)&&this.isNPOT()||this.gl_texture&&this.gl_target&&(t.bindTexture(this.gl_target,this.gl_texture),e?(t.texParameteri(this.gl_target,ne.TEXTURE_BASE_LEVEL,0),t.texParameteri(this.gl_target,ne.TEXTURE_MAX_LEVEL,Math.log2(this.width)),t.texParameteri(this.gl_target,ne.TEXTURE_MIN_FILTER,ne.LINEAR_MIPMAP_LINEAR),t.texParameteri(this.gl_target,ne.TEXTURE_MAG_FILTER,ne.LINEAR)):t.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MIN_FILTER,ne.NEAREST_MIPMAP_LINEAR),t.generateMipmap(this.gl_target),t.bindTexture(this.gl_target,null)),this},t.prototype.isNPOT=function(){return!Zt(this.device.gl)&&(!We(this.width)||!We(this.height))},t}(Wt),pn=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=re.RenderTarget,o.gl_renderbuffer=null,o.texture=null;var a=o.device.gl,s=i.format,u=i.width,l=i.height,c=i.sampleCount,f=void 0===c?1:c,h=i.texture,p=!1;if(s!==we.D32F&&s!==we.D24_S8||!h||Zt(a)||r.WEBGL_depth_texture||(h.destroy(),o.texture=null,p=!0),!p&&h)o.texture=h;else{o.gl_renderbuffer=o.device.ensureResourceExists(a.createRenderbuffer()),a.bindRenderbuffer(a.RENDERBUFFER,o.gl_renderbuffer);var d=o.device.translateTextureInternalFormat(s,!0);Zt(a)&&f>1?a.renderbufferStorageMultisample(ne.RENDERBUFFER,f,d,u,l):a.renderbufferStorage(ne.RENDERBUFFER,d,u,l)}return o.format=s,o.width=u,o.height=l,o.sampleCount=f,o}return Y(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),null!==this.gl_renderbuffer&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},t}(Wt);!function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"}(ln||(ln={}));var dn,vn=function(e){function t(t,n){var r=t.id,i=t.device,o=t.descriptor,a=e.call(this,{id:r,device:i})||this;a.rawVertexGLSL=n,a.type=re.Program,a.uniformSetters={},a.attributes=[];var s=a.device.gl;return a.descriptor=o,a.gl_program=a.device.ensureResourceExists(s.createProgram()),a.gl_shader_vert=null,a.gl_shader_frag=null,a.compileState=ln.NeedsCompile,a.tryCompileProgram(),a}return Y(t,e),t.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},t.prototype.tryCompileProgram=function(){De(this.compileState===ln.NeedsCompile);var e=this.descriptor,t=e.vertex,n=e.fragment,r=this.device.gl;(null==t?void 0:t.glsl)&&(null==n?void 0:n.glsl)&&(this.gl_shader_vert=this.compileShader(t.postprocess?t.postprocess(t.glsl):t.glsl,r.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(n.postprocess?n.postprocess(n.glsl):n.glsl,r.FRAGMENT_SHADER),r.attachShader(this.gl_program,this.gl_shader_vert),r.attachShader(this.gl_program,this.gl_shader_frag),r.linkProgram(this.gl_program),this.compileState=ln.Compiling,Zt(r)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},t.prototype.readAttributesFromLinkedProgram=function(){for(var e,t=this.device.gl,n=t.getProgramParameter(this.gl_program,t.ACTIVE_ATTRIBUTES),r=function(e){var t={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,(function(e,n,r){var i=Number(r);return t[n]=isNaN(i)?r:i,""})),t}(this.descriptor.vertex.glsl),i=function(e,t){var n=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,(function(e,r,i){var o=Number(r);return n.push({location:isNaN(o)?t[r]:o,name:i}),""})),n}(this.rawVertexGLSL,r),o=function(n){var r=t.getActiveAttrib(a.gl_program,n),o=r.name,s=r.type,u=r.size,l=t.getAttribLocation(a.gl_program,o),c=null===(e=i.find((function(e){return e.name===o})))||void 0===e?void 0:e.location;l>=0&&!H(c)&&(a.attributes[c]={name:o,location:l,type:s,size:u})},a=this,s=0;s<n;s++)o(s)},t.prototype.readUniformLocationsFromLinkedProgram=function(){for(var e=this.device.gl,t=e.getProgramParameter(this.gl_program,e.ACTIVE_UNIFORMS),n=0;n<t;n++){var r=e.getActiveUniform(this.gl_program,n),i=At(r.name).name,o=e.getUniformLocation(this.gl_program,i);if(this.uniformSetters[i]=Ut(e,o,r),r&&r.size>1)for(var a=0;a<r.size;a++)o=e.getUniformLocation(this.gl_program,"".concat(i,"[").concat(a,"]")),this.uniformSetters["".concat(i,"[").concat(a,"]")]=Ut(e,o,r)}},t.prototype.compileShader=function(e,t){var n=this.device.gl,r=this.device.ensureResourceExists(n.createShader(t));return n.shaderSource(r,e),n.compileShader(r),r},t.prototype.setUniformsLegacy=function(e){void 0===e&&(e={});var t=this.device.gl;if(!Zt(t)){var n=!1;for(var r in e){n||(t.useProgram(this.gl_program),n=!0);var i=e[r],o=this.uniformSetters[r];if(o){var a=i;a instanceof hn&&(a=a.textureIndex),o(a)}}}return this},t}(Wt),gn=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=re.QueryPool;var a=o.device.gl;if(Zt(a)){var s=i.elemCount,u=i.type;o.gl_query=function(e,t){for(var n=new Array(e),r=0;r<e;r++)n[r]=t();return n}(s,(function(){return o.device.ensureResourceExists(a.createQuery())})),o.gl_query_type=function(e){if(e===Ae.OcclusionConservative)return ne.ANY_SAMPLES_PASSED_CONSERVATIVE;throw new Error("whoops")}(u)}return o}return Y(t,e),t.prototype.queryResultOcclusion=function(e){var t=this.device.gl;if(Zt(t)){var n=this.gl_query[e];return t.getQueryParameter(n,t.QUERY_RESULT_AVAILABLE)?!!t.getQueryParameter(n,t.QUERY_RESULT):null}return null},t.prototype.destroy=function(){e.prototype.destroy.call(this);var t=this.device.gl;if(Zt(t))for(var n=0;n<this.gl_query.length;n++)t.deleteQuery(this.gl_query[n])},t}(Wt),mn=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this,{id:n,device:r})||this;return i.type=re.Readback,i.gl_pbo=null,i.gl_sync=null,i}return Y(t,e),t.prototype.clientWaitAsync=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=10);var r=this.device.gl;return new Promise((function(i,o){!function a(){var s=r.clientWaitSync(e,t,0);s!=r.WAIT_FAILED?s!=r.TIMEOUT_EXPIRED?i():setTimeout(a,X(n,0,r.MAX_CLIENT_WAIT_TIMEOUT_WEBGL)):o()}()}))},t.prototype.getBufferSubDataAsync=function(e,t,n,r,i,o){return Q(this,void 0,void 0,(function(){var a;return $(this,(function(s){switch(s.label){case 0:return Zt(a=this.device.gl)?(this.gl_sync=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0),a.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return s.sent(),a.bindBuffer(e,t),a.getBufferSubData(e,n,r,i,o),a.bindBuffer(e,null),[2,r];case 2:return[2]}}))}))},t.prototype.readTexture=function(e,t,n,r,i,o,a,s){return void 0===a&&(a=0),void 0===s&&(s=o.byteLength||0),Q(this,void 0,void 0,(function(){var u,l,c,f,h;return $(this,(function(p){var d;return u=this.device.gl,l=e,c=this.device.translateTextureFormat(l.format),f=this.device.translateTextureType(l.format),d=l.format,h=Pe(Oe(d))*Le(d),Zt(u)?(this.gl_pbo=this.device.ensureResourceExists(u.createBuffer()),u.bindBuffer(u.PIXEL_PACK_BUFFER,this.gl_pbo),u.bufferData(u.PIXEL_PACK_BUFFER,s,u.STREAM_READ),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),u.bindFramebuffer(ne.READ_FRAMEBUFFER,this.device.readbackFramebuffer),u.framebufferTexture2D(ne.READ_FRAMEBUFFER,ne.COLOR_ATTACHMENT0,ne.TEXTURE_2D,l.gl_texture,0),u.bindBuffer(u.PIXEL_PACK_BUFFER,this.gl_pbo),u.readPixels(t,n,r,i,c,f,a*h),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(u.PIXEL_PACK_BUFFER,this.gl_pbo,0,o,a,0)]):[2,this.readTextureSync(e,t,n,r,i,o,a,s)]}))}))},t.prototype.readTextureSync=function(e,t,n,r,i,o,a,s){void 0===s&&(s=o.byteLength||0);var u=this.device.gl,l=e,c=this.device.translateTextureType(l.format);return u.bindFramebuffer(ne.FRAMEBUFFER,this.device.readbackFramebuffer),u.framebufferTexture2D(ne.FRAMEBUFFER,ne.COLOR_ATTACHMENT0,ne.TEXTURE_2D,l.gl_texture,0),u.pixelStorei(u.PACK_ALIGNMENT,4),u.readPixels(t,n,r,i,u.RGBA,c,o),o},t.prototype.readBuffer=function(e,t,n,r,i){return Q(this,void 0,void 0,(function(){var o;return $(this,(function(a){return Zt(o=this.device.gl)?[2,this.getBufferSubDataAsync(o.ARRAY_BUFFER,en(e,t),t,n,r,i)]:[2,Promise.reject()]}))}))},t.prototype.destroy=function(){e.prototype.destroy.call(this),Zt(this.device.gl)&&(null!==this.gl_sync&&this.device.gl.deleteSync(this.gl_sync),null!==this.gl_pbo&&this.device.gl.deleteBuffer(this.gl_pbo))},t}(Wt),yn=function(e){function t(t){var n,r,i=t.id,o=t.device,a=t.descriptor,s=e.call(this,{id:i,device:o})||this;return s.type=re.RenderPipeline,s.drawMode=function(e){switch(e){case he.TRIANGLES:return ne.TRIANGLES;case he.POINTS:return ne.POINTS;case he.TRIANGLE_STRIP:return ne.TRIANGLE_STRIP;case he.LINES:return ne.LINES;case he.LINE_STRIP:return ne.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}(null!==(n=a.topology)&&void 0!==n?n:he.TRIANGLES),s.program=a.program,s.inputLayout=a.inputLayout,s.megaState=q(q({},$e(et)),a.megaStateDescriptor),s.colorAttachmentFormats=a.colorAttachmentFormats.slice(),s.depthStencilAttachmentFormat=a.depthStencilAttachmentFormat,s.sampleCount=null!==(r=a.sampleCount)&&void 0!==r?r:1,s}return Y(t,e),t}(Wt),_n=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;return o.type=re.ComputePipeline,o.descriptor=i,o}return Y(t,e),t}(Wt),bn=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(e){this.creationStacks.set(e,(new Error).stack),this.liveObjects.add(e)},e.prototype.trackResourceDestroyed=function(e){this.deletionStacks.has(e)&&console.warn("Object double freed:",e,"\n\nCreation stack: ",this.creationStacks.get(e),"\n\nDeletion stack: ",this.deletionStacks.get(e),"\n\nThis stack: ",(new Error).stack),this.deletionStacks.set(e,(new Error).stack),this.liveObjects.delete(e)},e.prototype.checkForLeaks=function(){var e,t;try{for(var n=J(this.liveObjects.values()),r=n.next();!r.done;r=n.next()){var i=r.value;console.warn("Object leaked:",i,"Creation stack:",this.creationStacks.get(i))}}catch(t){e={error:t}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},e.prototype.setResourceLeakCheck=function(e,t){t?this.liveObjects.add(e):this.liveObjects.delete(e)},e}(),xn=function(e){function t(t){var n,r,i=t.id,o=t.device,a=t.descriptor,s=e.call(this,{id:i,device:o})||this;s.type=re.Sampler;var u=s.device.gl;if(Zt(u)){var l=s.device.ensureResourceExists(u.createSampler());u.samplerParameteri(l,ne.TEXTURE_WRAP_S,$t(a.addressModeU)),u.samplerParameteri(l,ne.TEXTURE_WRAP_T,$t(a.addressModeV)),u.samplerParameteri(l,ne.TEXTURE_WRAP_R,$t(null!==(n=a.addressModeW)&&void 0!==n?n:a.addressModeU)),u.samplerParameteri(l,ne.TEXTURE_MIN_FILTER,Jt(a.minFilter,a.mipmapFilter)),u.samplerParameteri(l,ne.TEXTURE_MAG_FILTER,Jt(a.magFilter,fe.NO_MIP)),void 0!==a.lodMinClamp&&u.samplerParameterf(l,ne.TEXTURE_MIN_LOD,a.lodMinClamp),void 0!==a.lodMaxClamp&&u.samplerParameterf(l,ne.TEXTURE_MAX_LOD,a.lodMaxClamp),void 0!==a.compareFunction&&(u.samplerParameteri(l,u.TEXTURE_COMPARE_MODE,u.COMPARE_REF_TO_TEXTURE),u.samplerParameteri(l,u.TEXTURE_COMPARE_FUNC,a.compareFunction));var c=null!==(r=a.maxAnisotropy)&&void 0!==r?r:1;c>1&&null!==s.device.EXT_texture_filter_anisotropic&&(De(a.minFilter===ce.BILINEAR&&a.magFilter===ce.BILINEAR&&a.mipmapFilter===fe.LINEAR),u.samplerParameterf(l,s.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c)),s.gl_sampler=l}else s.descriptor=a;return s}return Y(t,e),t.prototype.setTextureParameters=function(e,t,n){var r,i=this.device.gl,o=this.descriptor;this.isNPOT(t,n)?i.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MIN_FILTER,ne.LINEAR):i.texParameteri(e,ne.TEXTURE_MIN_FILTER,Jt(o.minFilter,o.mipmapFilter)),i.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_WRAP_S,$t(o.addressModeU)),i.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_WRAP_T,$t(o.addressModeV)),i.texParameteri(e,ne.TEXTURE_MAG_FILTER,Jt(o.magFilter,fe.NO_MIP));var a=null!==(r=o.maxAnisotropy)&&void 0!==r?r:1;a>1&&null!==this.device.EXT_texture_filter_anisotropic&&(De(o.minFilter===ce.BILINEAR&&o.magFilter===ce.BILINEAR&&o.mipmapFilter===fe.LINEAR),i.texParameteri(e,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a))},t.prototype.destroy=function(){e.prototype.destroy.call(this),Zt(this.device.gl)&&this.device.gl.deleteSampler(nn(this))},t.prototype.isNPOT=function(e,t){return!We(e)||!We(t)},t}(Wt),En=function(){function e(){}return e.prototype.dispatchWorkgroups=function(e,t,n){},e.prototype.dispatchWorkgroupsIndirect=function(e,t){},e.prototype.setPipeline=function(e){},e.prototype.setBindings=function(e){},e.prototype.pushDebugGroup=function(e){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(e){},e}(),Tn=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.type=re.RenderBundle,t.commands=[],t}return Y(t,e),t.prototype.push=function(e){this.commands.push(e)},t.prototype.replay=function(){this.commands.forEach((function(e){return e()}))},t}(Wt),An=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,Sn=function(){function e(e,t){void 0===t&&(t={}),this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=$e(et),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=Ee.LOWER_LEFT,this.clipSpaceNearZ=Te.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=e,this.contextAttributes=Ue(e.getContextAttributes()),Zt(e)?(this.EXT_texture_norm16=e.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=e.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=e.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=e.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=e.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=e.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=e.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=e.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=e.getExtension("EXT_color_buffer_half_float"),e.getExtension("EXT_frag_depth"),e.getExtension("OES_element_index_uint"),e.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=e.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=e.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=e.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=e.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=e.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=e.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=e.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=e.getExtension("KHR_parallel_shader_compile"),Zt(e)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new hn({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:me.TEXTURE_2D,mipLevelCount:1,usage:ye.RENDER_TARGET,format:!1===this.contextAttributes.alpha?we.U8_RGB_RT:we.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=xe.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(e.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(me.TEXTURE_2D,xe.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(me.TEXTURE_2D,xe.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:pe.VERTEX,hint:de.STATIC}),Zt(e)&&(this.fallbackTexture2DArray=this.createFallbackTexture(me.TEXTURE_2D_ARRAY,xe.Float),this.fallbackTexture3D=this.createFallbackTexture(me.TEXTURE_3D,xe.Float),this.fallbackTextureCube=this.createFallbackTexture(me.TEXTURE_CUBE_MAP,xe.Float)),this.currentMegaState.depthCompare=ie.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=_e.ALL,e.enable(e.DEPTH_TEST),e.enable(e.STENCIL_TEST),this.checkLimits(),t.shaderDebug&&(this.shaderDebug=!0),t.trackResources&&(this.resourceCreationTracker=new bn)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(e,t){var n=e===me.TEXTURE_CUBE_MAP?6:1,r=t===xe.Depth?we.D32F:we.U8_RGBA_NORM,i=this.createTexture({dimension:e,format:r,usage:ye.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1});return t===xe.Float&&i.setImageData([new Uint8Array(4*n)]),tn(i)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var e=this.gl;if(this.maxVertexAttribs=e.getParameter(ne.MAX_VERTEX_ATTRIBS),Zt(e)){this.uniformBufferMaxPageByteSize=Math.min(e.getParameter(ne.MAX_UNIFORM_BLOCK_SIZE),65536),this.uniformBufferWordAlignment=e.getParameter(e.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var t=e.getInternalformatParameter(e.RENDERBUFFER,e.DEPTH32F_STENCIL8,e.SAMPLES);this.supportedSampleCounts=t?te([],ee(t),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=65536;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort((function(e,t){return e-t}))},e.prototype.configureSwapChain=function(e,t,n){var r,i=this.scTexture;i.width=e,i.height=t,this.scPlatformFramebuffer=void 0===(r=n)?null:r},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(e,t){switch(void 0===t&&(t=!1),e){case we.ALPHA:return ne.ALPHA;case we.U8_LUMINANCE:case we.F16_LUMINANCE:case we.F32_LUMINANCE:return ne.LUMINANCE;case we.F16_R:return ne.R16F;case we.F16_RG:return ne.RG16F;case we.F16_RGB:return ne.RGB16F;case we.F16_RGBA:return ne.RGBA16F;case we.F32_R:return ne.R32F;case we.F32_RG:return ne.RG32F;case we.F32_RGB:return ne.RGB32F;case we.F32_RGBA:return Zt(this.gl)?ne.RGBA32F:t?this.WEBGL_color_buffer_float.RGBA32F_EXT:ne.RGBA;case we.U8_R_NORM:return ne.R8;case we.U8_RG_NORM:return ne.RG8;case we.U8_RGB_NORM:case we.U8_RGB_RT:return ne.RGB8;case we.U8_RGB_SRGB:return ne.SRGB8;case we.U8_RGBA_NORM:case we.U8_RGBA_RT:return Zt(this.gl)?ne.RGBA8:t?ne.RGBA4:ne.RGBA;case we.U8_RGBA:return ne.RGBA;case we.U8_RGBA_SRGB:case we.U8_RGBA_RT_SRGB:return ne.SRGB8_ALPHA8;case we.U16_R:return ne.R16UI;case we.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case we.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case we.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case we.U16_RGBA_5551:return ne.RGB5_A1;case we.U16_RGB_565:return ne.RGB565;case we.U32_R:return ne.R32UI;case we.S8_RGBA_NORM:return ne.RGBA8_SNORM;case we.S8_RG_NORM:return ne.RG8_SNORM;case we.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case we.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case we.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case we.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case we.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case we.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case we.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case we.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case we.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case we.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case we.D32F_S8:return Zt(this.gl)?ne.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?ne.DEPTH_STENCIL:ne.DEPTH_COMPONENT16;case we.D24_S8:return Zt(this.gl)?ne.DEPTH24_STENCIL8:this.WEBGL_depth_texture?ne.DEPTH_STENCIL:ne.DEPTH_COMPONENT16;case we.D32F:return Zt(this.gl)?ne.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?ne.DEPTH_COMPONENT:ne.DEPTH_COMPONENT16;case we.D24:return Zt(this.gl)?ne.DEPTH_COMPONENT24:this.WEBGL_depth_texture?ne.DEPTH_COMPONENT:ne.DEPTH_COMPONENT16;default:throw new Error("whoops")}},e.prototype.translateTextureType=function(e){switch(Oe(e)){case Se.U8:return ne.UNSIGNED_BYTE;case Se.U16:return ne.UNSIGNED_SHORT;case Se.U32:return ne.UNSIGNED_INT;case Se.S8:return ne.BYTE;case Se.F16:return ne.HALF_FLOAT;case Se.F32:return ne.FLOAT;case Se.U16_PACKED_5551:return ne.UNSIGNED_SHORT_5_5_5_1;case Se.D32F:return Zt(this.gl)?ne.FLOAT:this.WEBGL_depth_texture?ne.UNSIGNED_INT:ne.UNSIGNED_BYTE;case Se.D24:return Zt(this.gl)?ne.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?ne.UNSIGNED_SHORT:ne.UNSIGNED_BYTE;case Se.D24S8:return Zt(this.gl)?ne.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?ne.UNSIGNED_INT_24_8_WEBGL:ne.UNSIGNED_BYTE;case Se.D32FS8:return ne.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},e.prototype.translateInternalTextureFormat=function(e){switch(e){case we.F32_R:return ne.R32F;case we.F32_RG:return ne.RG32F;case we.F32_RGB:return ne.RGB32F;case we.F32_RGBA:return ne.RGBA32F;case we.F16_R:return ne.R16F;case we.F16_RG:return ne.RG16F;case we.F16_RGB:return ne.RGB16F;case we.F16_RGBA:return ne.RGBA16F}return this.translateTextureFormat(e)},e.prototype.translateTextureFormat=function(e){if(Yt(e)||e===we.F32_LUMINANCE||e===we.U8_LUMINANCE)return this.translateTextureInternalFormat(e);var t=Zt(this.gl)||!Zt(this.gl)&&!!this.WEBGL_depth_texture;switch(e){case we.D24_S8:case we.D32F_S8:return t?ne.DEPTH_STENCIL:ne.RGBA;case we.D24:case we.D32F:return t?ne.DEPTH_COMPONENT:ne.RGBA}var n=qt(e);switch(Le(e)){case Ce.A:return ne.ALPHA;case Ce.R:return n?ne.RED_INTEGER:ne.RED;case Ce.RG:return n?ne.RG_INTEGER:ne.RG;case Ce.RGB:return n?ne.RGB_INTEGER:ne.RGB;case Ce.RGBA:return ne.RGBA}},e.prototype.setActiveTexture=function(e){this.currentActiveTexture!==e&&(this.gl.activeTexture(e),this.currentActiveTexture=e)},e.prototype.bindVAO=function(e){this.currentBoundVAO!==e&&(Zt(this.gl)?this.gl.bindVertexArray(e):this.OES_vertex_array_object.bindVertexArrayOES(e),this.currentBoundVAO=e)},e.prototype.programCompiled=function(e){De(e.compileState!==ln.NeedsCompile),e.compileState===ln.Compiling&&(e.compileState=ln.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(e))},e.prototype.useProgram=function(e){this.currentProgram!==e&&(this.programCompiled(e),this.gl.useProgram(e.gl_program),this.currentProgram=e)},e.prototype.ensureResourceExists=function(e){if(null===e){var t=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(t))}return e},e.prototype.createBuffer=function(e){return new cn({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTexture=function(e){return new hn({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createSampler=function(e){return new xn({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTarget=function(e){return new pn({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTargetFromTexture=function(e){var t=e,n=t.format,r=t.width,i=t.height;return De(1===t.mipLevelCount),this.createRenderTarget({format:n,width:r,height:i,sampleCount:1,texture:e})},e.prototype.createProgram=function(e){var t,n,r,i=null===(t=e.vertex)||void 0===t?void 0:t.glsl;return(null===(n=e.vertex)||void 0===n?void 0:n.glsl)&&(e.vertex.glsl=jt(this.queryVendorInfo(),"vert",e.vertex.glsl)),(null===(r=e.fragment)||void 0===r?void 0:r.glsl)&&(e.fragment.glsl=jt(this.queryVendorInfo(),"frag",e.fragment.glsl)),this.createProgramSimple(e,i)},e.prototype.createProgramSimple=function(e,t){return new vn({id:this.getNextUniqueId(),device:this,descriptor:e},t)},e.prototype.createBindings=function(e){return new Xt({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createInputLayout=function(e){return new fn({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderPipeline=function(e){return new yn({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createComputePass=function(){return new En},e.prototype.createComputePipeline=function(e){return new _n({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createReadback=function(){return new mn({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(e,t){return new gn({id:this.getNextUniqueId(),device:this,descriptor:{type:e,elemCount:t}})},e.prototype.formatRenderPassDescriptor=function(e){var t,n,r,i,o,a,s=e.colorAttachment;e.depthClearValue=null!==(t=e.depthClearValue)&&void 0!==t?t:"load",e.stencilClearValue=null!==(n=e.stencilClearValue)&&void 0!==n?n:"load";for(var u=0;u<s.length;u++)e.colorAttachmentLevel||(e.colorAttachmentLevel=[]),e.colorAttachmentLevel[u]=null!==(r=e.colorAttachmentLevel[u])&&void 0!==r?r:0,e.colorResolveToLevel||(e.colorResolveToLevel=[]),e.colorResolveToLevel[u]=null!==(i=e.colorResolveToLevel[u])&&void 0!==i?i:0,e.colorClearColor||(e.colorClearColor=[]),e.colorClearColor[u]=null!==(o=e.colorClearColor[u])&&void 0!==o?o:"load",e.colorStore||(e.colorStore=[]),e.colorStore[u]=null!==(a=e.colorStore[u])&&void 0!==a&&a},e.prototype.createRenderBundle=function(){return new Tn({id:this.getNextUniqueId(),device:this})},e.prototype.beginBundle=function(e){this.renderBundle=e},e.prototype.endBundle=function(){this.renderBundle=void 0},e.prototype.executeBundles=function(e){e.forEach((function(e){e.replay()}))},e.prototype.createRenderPass=function(e){null!==this.currentRenderPassDescriptor&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=e,this.formatRenderPassDescriptor(e);var t=e.colorAttachment,n=e.colorAttachmentLevel,r=e.colorClearColor,i=e.colorResolveTo,o=e.colorResolveToLevel,a=e.depthStencilAttachment,s=e.depthClearValue,u=e.stencilClearValue,l=e.depthStencilResolveTo,c=i&&1===i.length&&i[0]===this.scTexture;this.setRenderPassParametersBegin(t.length,c);for(var f=0;f<t.length;f++)this.setRenderPassParametersColor(f,t[f],n[f],i[f],o[f],c);this.setRenderPassParametersDepthStencil(a,l,c),this.validateCurrentAttachments();for(f=0;f<t.length;f++){var h=r[f];"load"!==h&&this.setRenderPassParametersClearColor(f,h.r,h.g,h.b,h.a)}return this.setRenderPassParametersClearDepthStencil(s,u),this},e.prototype.submitPass=function(e){De(null!==this.currentRenderPassDescriptor),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(e,t,n,r,i,o){var a=this.gl,s=e,u=r;if(De(1===u.mipLevelCount),De(1===s.mipLevelCount),Zt(a))s===this.scTexture?a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(a.bindFramebuffer(a.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,s,0)),a.bindFramebuffer(a.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,u,0),a.blitFramebuffer(i,o,i+u.width,o+u.height,t,n,t+u.width,n+u.height,a.COLOR_BUFFER_BIT,a.LINEAR),a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,null);else if(s===this.scTexture){var l=this.createRenderTargetFromTexture(r);this.submitBlitRenderPass(l,s)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(e,t,n){switch(e){case we.BC1_SRGB:case we.BC2_SRGB:case we.BC3_SRGB:return null!==this.WEBGL_compressed_texture_s3tc_srgb&&un(t,n,4,4);case we.BC1:case we.BC2:case we.BC3:return null!==this.WEBGL_compressed_texture_s3tc&&un(t,n,4,4);case we.BC4_UNORM:case we.BC4_SNORM:case we.BC5_UNORM:case we.BC5_SNORM:return null!==this.EXT_texture_compression_rgtc&&un(t,n,4,4);case we.U16_R_NORM:case we.U16_RG_NORM:case we.U16_RGBA_NORM:return null!==this.EXT_texture_norm16;case we.F32_R:case we.F32_RG:case we.F32_RGB:case we.F32_RGBA:return null!==this.OES_texture_float_linear;case we.F16_R:case we.F16_RG:case we.F16_RGB:case we.F16_RGBA:return null!==this.OES_texture_half_float_linear;default:return!0}},e.prototype.queryProgramReady=function(e){var t=this.gl;if(e.compileState===ln.NeedsCompile)throw new Error("whoops");if(e.compileState===ln.Compiling){var n=void 0;return(n=null===this.KHR_parallel_shader_compile||t.getProgramParameter(e.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR))&&this.programCompiled(e),n}return e.compileState===ln.NeedsBind||e.compileState===ln.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(e){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(e){return e},e.prototype.setResourceName=function(e,t){if(e.name=t,e.type===re.Buffer)for(var n=e.gl_buffer_pages,r=0;r<n.length;r++)rn(n[r],"".concat(t," Page ").concat(r));else if(e.type===re.Texture)rn(tn(e),t);else if(e.type===re.Sampler)rn(nn(e),t);else if(e.type===re.RenderTarget){var i=e.gl_renderbuffer;null!==i&&rn(i,t)}else e.type===re.InputLayout&&rn(e.vao,t)},e.prototype.setResourceLeakCheck=function(e,t){null!==this.resourceCreationTracker&&this.resourceCreationTracker.setResourceLeakCheck(e,t)},e.prototype.checkForLeaks=function(){null!==this.resourceCreationTracker&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(e){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(e){},e.prototype.programPatched=function(e,t){De(this.shaderDebug)},e.prototype.getBufferData=function(e,t,n){void 0===n&&(n=0);var r=this.gl;Zt(r)&&(r.bindBuffer(r.COPY_READ_BUFFER,en(e,4*n)),r.getBufferSubData(r.COPY_READ_BUFFER,4*n,t))},e.prototype.debugGroupStatisticsDrawCall=function(e){void 0===e&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].drawCallCount+=e},e.prototype.debugGroupStatisticsBufferUpload=function(e){void 0===e&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].bufferUploadCount+=e},e.prototype.debugGroupStatisticsTextureBind=function(e){void 0===e&&(e=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].textureBindCount+=e},e.prototype.debugGroupStatisticsTriangles=function(e){for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].triangleCount+=e},e.prototype.reportShaderError=function(e,t){var n=this.gl,r=n.getShaderParameter(e,n.COMPILE_STATUS);if(!r){console.error(function(e,t){return void 0===t&&(t=1),e.split("\n").map((function(e,n){return"".concat(function(e,t,n){for(void 0===n&&(n="0");e.length<t;)e="".concat(n).concat(e);return e}(""+(t+n),4," "),"  ").concat(e)})).join("\n")}(t));var i=n.getExtension("WEBGL_debug_shaders");i&&console.error(i.getTranslatedShaderSource(e)),console.error(n.getShaderInfoLog(e))}return r},e.prototype.checkProgramCompilationForErrors=function(e){var t=this.gl,n=e.gl_program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var r=e.descriptor;if(!this.reportShaderError(e.gl_shader_vert,r.vertex.glsl))return;if(!this.reportShaderError(e.gl_shader_frag,r.fragment.glsl))return;console.error(t.getProgramInfoLog(e.gl_program))}},e.prototype.bindFramebufferAttachment=function(e,t,n,r){var i=this.gl;if(H(n))i.framebufferRenderbuffer(e,t,i.RENDERBUFFER,null);else if(n.type===re.RenderTarget)null!==n.gl_renderbuffer?i.framebufferRenderbuffer(e,t,i.RENDERBUFFER,n.gl_renderbuffer):null!==n.texture&&i.framebufferTexture2D(e,t,ne.TEXTURE_2D,tn(n.texture),r);else if(n.type===re.Texture){var o=tn(n);n.dimension===me.TEXTURE_2D?i.framebufferTexture2D(e,t,ne.TEXTURE_2D,o,r):Zt(i)&&(n.dimension,me.TEXTURE_2D_ARRAY)}},e.prototype.bindFramebufferDepthStencilAttachment=function(e,t){var n=this.gl,r=H(t)?Re.Depth|Re.Stencil:Ie(t.format),i=!!(r&Re.Depth),o=!!(r&Re.Stencil);i&&o?Zt(this.gl)||!Zt(this.gl)&&!!this.WEBGL_depth_texture?this.bindFramebufferAttachment(e,n.DEPTH_STENCIL_ATTACHMENT,t,0):this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,t,0):i?(this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,t,0),this.bindFramebufferAttachment(e,n.STENCIL_ATTACHMENT,null,0)):o&&(this.bindFramebufferAttachment(e,n.STENCIL_ATTACHMENT,t,0),this.bindFramebufferAttachment(e,n.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var e=-1,t=-1,n=-1,r=0;r<this.currentColorAttachments.length;r++){var i=this.currentColorAttachments[r];null!==i&&(-1===e?(e=i.sampleCount,t=i.width,n=i.height):(De(e===i.sampleCount),De(t===i.width),De(n===i.height)))}this.currentDepthStencilAttachment&&(-1===e?e=this.currentDepthStencilAttachment.sampleCount:(De(e===this.currentDepthStencilAttachment.sampleCount),De(t===this.currentDepthStencilAttachment.width),De(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=e},e.prototype.setRenderPassParametersBegin=function(e,t){void 0===t&&(t=!1);var n=this.gl;if(t)n.bindFramebuffer(ne.FRAMEBUFFER,null);else if(Zt(n)?n.bindFramebuffer(ne.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||n.bindFramebuffer(ne.FRAMEBUFFER,this.renderPassDrawFramebuffer),Zt(n)?n.drawBuffers([ne.COLOR_ATTACHMENT0,ne.COLOR_ATTACHMENT1,ne.COLOR_ATTACHMENT2,ne.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([ne.COLOR_ATTACHMENT0_WEBGL,ne.COLOR_ATTACHMENT1_WEBGL,ne.COLOR_ATTACHMENT2_WEBGL,ne.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var r=e;r<this.currentColorAttachments.length;r++){var i=Zt(n)?ne.DRAW_FRAMEBUFFER:ne.FRAMEBUFFER,o=Zt(n)?ne.COLOR_ATTACHMENT0:ne.COLOR_ATTACHMENT0_WEBGL;n.framebufferRenderbuffer(i,o+r,ne.RENDERBUFFER,null),n.framebufferTexture2D(i,o+r,ne.TEXTURE_2D,null,0)}this.currentColorAttachments.length=e},e.prototype.setRenderPassParametersColor=function(e,t,n,r,i,o){void 0===o&&(o=!1);var a=Zt(this.gl);this.currentColorAttachments[e]===t&&this.currentColorAttachmentLevels[e]===n||(this.currentColorAttachments[e]=t,this.currentColorAttachmentLevels[e]=n,!o&&(a||!a&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(a?ne.DRAW_FRAMEBUFFER:ne.FRAMEBUFFER,(a?ne.COLOR_ATTACHMENT0:ne.COLOR_ATTACHMENT0_WEBGL)+e,t,n),this.resolveColorAttachmentsChanged=!0),this.currentColorResolveTos[e]===r&&this.currentColorResolveToLevels[e]===i||(this.currentColorResolveTos[e]=r,this.currentColorResolveToLevels[e]=i,null!==r&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(e,t,n){void 0===n&&(n=!1);var r=this.gl;this.currentDepthStencilAttachment!==e&&(this.currentDepthStencilAttachment=e,n||this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(Zt(r)?ne.DRAW_FRAMEBUFFER:ne.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==t&&(this.currentDepthStencilResolveTo=t,t&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(e,t,n,r,i){var o,a=this.gl;null!==this.OES_draw_buffers_indexed?(o=this.currentMegaState.attachmentsState[e])&&o.channelWriteMask!==_e.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(e,!0,!0,!0,!0),o.channelWriteMask=_e.ALL):(o=this.currentMegaState.attachmentsState[0])&&o.channelWriteMask!==_e.ALL&&(a.colorMask(!0,!0,!0,!0),o.channelWriteMask=_e.ALL);this.setScissorRectEnabled(!1),Zt(a)?a.clearBufferfv(a.COLOR,e,[t,n,r,i]):(a.clearColor(t,n,r,i),a.clear(a.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(e,t){void 0===e&&(e="load"),void 0===t&&(t="load");var n=this.gl;"load"!==e&&(De(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),Zt(n)?n.clearBufferfv(n.DEPTH,0,[e]):(n.clearDepth(e),n.clear(n.DEPTH_BUFFER_BIT))),"load"!==t&&(De(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),Zt(n)?n.clearBufferiv(n.STENCIL,0,[t]):(n.clearStencil(t),n.clear(n.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(e){var t,n=this;if(this.renderBundle)this.renderBundle.push((function(){return n.setBindings(e)}));else{var r=this.gl,i=e,o=i.uniformBufferBindings,a=i.samplerBindings,s=i.bindingLayouts;De(0<s.bindingLayoutTables.length);var u=s.bindingLayoutTables[0];De(o.length>=u.numUniformBuffers),De(a.length>=u.numSamplers);for(var l=0;l<o.length;l++){if(0!==(g=o[l]).size){var c=u.firstUniformBuffer+l,f=g.buffer,h=g.offset||0,p=g.size||f.byteSize;if(f!==this.currentUniformBuffers[c]||h!==this.currentUniformBufferByteOffsets[c]||p!==this.currentUniformBufferByteSizes[c]){var d=h%f.pageByteSize,v=f.gl_buffer_pages[h/f.pageByteSize|0];De(d+p<=f.pageByteSize),Zt(r)&&r.bindBufferRange(r.UNIFORM_BUFFER,c,v,d,p),this.currentUniformBuffers[c]=f,this.currentUniformBufferByteOffsets[c]=h,this.currentUniformBufferByteSizes[c]=p}}}for(l=0;l<u.numSamplers;l++){var g=a[l],m=u.firstSampler+l,y=null!==g&&null!==g.sampler?nn(g.sampler):null,_=null!==g&&null!==g.texture?tn(g.texture):null;if(this.currentSamplers[m]!==y&&(Zt(r)&&r.bindSampler(m,y),this.currentSamplers[m]=y),this.currentTextures[m]!==_){if(this.setActiveTexture(r.TEXTURE0+m),null!==_){var b=Ue(g).texture,x=b.gl_target,E=b.width,T=b.height;g.texture.textureIndex=m,r.bindTexture(x,_),Zt(r)||null===(t=g.sampler)||void 0===t||t.setTextureParameters(x,E,T),this.debugGroupStatisticsTextureBind()}else{var A=q(q({},g),nt),S=A.dimension,C=A.formatKind;x=sn(S);r.bindTexture(x,this.getFallbackTexture(q({gl_target:x,formatKind:C},A)))}this.currentTextures[m]=_}}}},e.prototype.setViewport=function(e,t,n,r){this.gl.viewport(e,t,n,r)},e.prototype.setScissorRect=function(e,t,n,r){var i=this.gl;this.setScissorRectEnabled(!0),i.scissor(e,t,n,r)},e.prototype.applyAttachmentStateIndexed=function(e,t,n){var r=this.gl,i=this.OES_draw_buffers_indexed;t.channelWriteMask!==n.channelWriteMask&&(i.colorMaskiOES(e,!!(n.channelWriteMask&_e.RED),!!(n.channelWriteMask&_e.GREEN),!!(n.channelWriteMask&_e.BLUE),!!(n.channelWriteMask&_e.ALPHA)),t.channelWriteMask=n.channelWriteMask);var o=t.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,a=t.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(a||o)&&(an(t.rgbBlendState)&&an(t.alphaBlendState)?i.enableiOES(e,r.BLEND):an(n.rgbBlendState)&&an(n.alphaBlendState)&&i.disableiOES(e,r.BLEND)),o&&(i.blendEquationSeparateiOES(e,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),t.rgbBlendState.blendMode=n.rgbBlendState.blendMode,t.alphaBlendState.blendMode=n.alphaBlendState.blendMode),a&&(i.blendFuncSeparateiOES(e,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(e,t){var n=this.gl;e.channelWriteMask!==t.channelWriteMask&&(n.colorMask(!!(t.channelWriteMask&_e.RED),!!(t.channelWriteMask&_e.GREEN),!!(t.channelWriteMask&_e.BLUE),!!(t.channelWriteMask&_e.ALPHA)),e.channelWriteMask=t.channelWriteMask);var r=e.rgbBlendState.blendMode!==t.rgbBlendState.blendMode||e.alphaBlendState.blendMode!==t.alphaBlendState.blendMode,i=e.rgbBlendState.blendSrcFactor!==t.rgbBlendState.blendSrcFactor||e.alphaBlendState.blendSrcFactor!==t.alphaBlendState.blendSrcFactor||e.rgbBlendState.blendDstFactor!==t.rgbBlendState.blendDstFactor||e.alphaBlendState.blendDstFactor!==t.alphaBlendState.blendDstFactor;(i||r)&&(an(e.rgbBlendState)&&an(e.alphaBlendState)?n.enable(n.BLEND):an(t.rgbBlendState)&&an(t.alphaBlendState)&&n.disable(n.BLEND)),r&&(n.blendEquationSeparate(t.rgbBlendState.blendMode,t.alphaBlendState.blendMode),e.rgbBlendState.blendMode=t.rgbBlendState.blendMode,e.alphaBlendState.blendMode=t.alphaBlendState.blendMode),i&&(n.blendFuncSeparate(t.rgbBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor,t.alphaBlendState.blendSrcFactor,t.alphaBlendState.blendDstFactor),e.rgbBlendState.blendSrcFactor=t.rgbBlendState.blendSrcFactor,e.alphaBlendState.blendSrcFactor=t.alphaBlendState.blendSrcFactor,e.rgbBlendState.blendDstFactor=t.rgbBlendState.blendDstFactor,e.alphaBlendState.blendDstFactor=t.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(e){var t=this.gl,n=this.currentMegaState;if(null!==this.OES_draw_buffers_indexed)for(var r=0;r<e.attachmentsState.length;r++)this.applyAttachmentStateIndexed(r,n.attachmentsState[0],e.attachmentsState[0]);else De(1===e.attachmentsState.length),this.applyAttachmentState(n.attachmentsState[0],e.attachmentsState[0]);Fe(n.blendConstant,e.blendConstant)||(t.blendColor(e.blendConstant.r,e.blendConstant.g,e.blendConstant.b,e.blendConstant.a),ze(n.blendConstant,e.blendConstant)),n.depthCompare!==e.depthCompare&&(t.depthFunc(e.depthCompare),n.depthCompare=e.depthCompare),!!n.depthWrite!=!!e.depthWrite&&(t.depthMask(e.depthWrite),n.depthWrite=e.depthWrite),!!n.stencilWrite!=!!e.stencilWrite&&(t.stencilMask(e.stencilWrite?255:0),n.stencilWrite=e.stencilWrite);var i=!1;if(!ft(n.stencilFront,e.stencilFront)){i=!0;var o=e.stencilFront,a=o.passOp,s=o.failOp,u=o.depthFailOp,l=o.compare;n.stencilFront.passOp===a&&n.stencilFront.failOp===s&&n.stencilFront.depthFailOp===u||(t.stencilOpSeparate(t.FRONT,s,u,a),n.stencilFront.passOp=a,n.stencilFront.failOp=s,n.stencilFront.depthFailOp=u),n.stencilFront.compare!==l&&(this.setStencilReference(0),n.stencilFront.compare=l)}if(!ft(n.stencilBack,e.stencilBack)){i=!0;var c=e.stencilBack;a=c.passOp,s=c.failOp,u=c.depthFailOp,l=c.compare;n.stencilBack.passOp===a&&n.stencilBack.failOp===s&&n.stencilBack.depthFailOp===u||(t.stencilOpSeparate(t.BACK,s,u,a),n.stencilBack.passOp=a,n.stencilBack.failOp=s,n.stencilBack.depthFailOp=u),n.stencilBack.compare!==l&&(this.setStencilReference(0),n.stencilBack.compare=l)}n.stencilFront.mask===e.stencilFront.mask&&n.stencilBack.mask===e.stencilBack.mask||(i=!0,n.stencilFront.mask=e.stencilFront.mask,n.stencilBack.mask=e.stencilBack.mask),i&&this.applyStencil(),n.cullMode!==e.cullMode&&(n.cullMode===ae.NONE?t.enable(t.CULL_FACE):e.cullMode===ae.NONE&&t.disable(t.CULL_FACE),e.cullMode===ae.BACK?t.cullFace(t.BACK):e.cullMode===ae.FRONT?t.cullFace(t.FRONT):e.cullMode===ae.FRONT_AND_BACK&&t.cullFace(t.FRONT_AND_BACK),n.cullMode=e.cullMode),n.frontFace!==e.frontFace&&(t.frontFace(e.frontFace),n.frontFace=e.frontFace),n.polygonOffset!==e.polygonOffset&&(e.polygonOffset?t.enable(t.POLYGON_OFFSET_FILL):t.disable(t.POLYGON_OFFSET_FILL),n.polygonOffset=e.polygonOffset),n.polygonOffsetFactor===e.polygonOffsetFactor&&n.polygonOffsetUnits===e.polygonOffsetUnits||(t.polygonOffset(e.polygonOffsetFactor,e.polygonOffsetUnits),n.polygonOffsetFactor=e.polygonOffsetFactor,n.polygonOffsetUnits=e.polygonOffsetUnits)},e.prototype.validatePipelineFormats=function(e){for(var t=0;t<this.currentColorAttachments.length;t++)this.currentColorAttachments[t];this.currentDepthStencilAttachment&&De(this.currentDepthStencilAttachment.format===e.depthStencilAttachmentFormat),-1!==this.currentSampleCount&&De(this.currentSampleCount===e.sampleCount)},e.prototype.setPipeline=function(e){var t=this;if(this.renderBundle)this.renderBundle.push((function(){return t.setPipeline(e)}));else{this.currentPipeline=e,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var n=this.currentPipeline.program;if(this.useProgram(n),n.compileState===ln.NeedsBind){var r=this.gl,i=n.gl_program,o=n.descriptor,a=on(o.vertex.glsl,An);if(Zt(r))for(var s=0;s<a.length;s++){var u=ee(a[s],2)[1],l=r.getUniformBlockIndex(i,u);-1!==l&&4294967295!==l&&r.uniformBlockBinding(i,l,s)}var c=on(o.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm);for(s=0;s<c.length;s++){var f=ee(c[s],3),h=f[1],p=f[2],d=r.getUniformLocation(i,h);r.uniform1i(d,parseInt(p))}n.compileState=ln.ReadyToUse}}},e.prototype.setVertexInput=function(e,t,n){var r,i,o,a=this;if(this.renderBundle)this.renderBundle.push((function(){return a.setVertexInput(e,t,n)}));else if(null!==e){De(this.currentPipeline.inputLayout===e);var s=e;this.bindVAO(s.vao);for(var u=this.gl,l=0;l<s.vertexBufferDescriptors.length;l++){var c=s.vertexBufferDescriptors[l],f=c.arrayStride,h=c.attributes;try{for(var p=(r=void 0,J(h)),d=p.next();!d.done;d=p.next()){var v=d.value,g=v.shaderLocation,m=v.offset,y=Zt(u)?g:null===(o=s.program.attributes[g])||void 0===o?void 0:o.location;if(!H(y)){var _=t[l];if(null===_)continue;var b=v.vertexFormat;u.bindBuffer(u.ARRAY_BUFFER,en(_.buffer));var x=(_.offset||0)+m;u.vertexAttribPointer(y,b.size,b.type,b.normalized,f,x)}}}catch(e){r={error:e}}finally{try{d&&!d.done&&(i=p.return)&&i.call(p)}finally{if(r)throw r.error}}}if(De(null!==n==(null!==s.indexBufferFormat)),null!==n){var E=n.buffer;De(E.usage===pe.INDEX),u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,en(E)),this.currentIndexBufferByteOffset=n.offset||0}else this.currentIndexBufferByteOffset=null}else De(null===this.currentPipeline.inputLayout),De(null===n),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(e){this.currentStencilRef!==e&&(this.currentStencilRef=e,this.applyStencil())},e.prototype.draw=function(e,t,n,r){var i,o=this;if(this.renderBundle)this.renderBundle.push((function(){return o.draw(e,t,n,r)}));else{var a=this.gl,s=this.currentPipeline;if(t){var u=[s.drawMode,n||0,e,t];Zt(a)?a.drawArraysInstanced.apply(a,te([],ee(u),!1)):(i=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(i,te([],ee(u),!1))}else a.drawArrays(s.drawMode,n,e);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(e/3*Math.max(t,1))}},e.prototype.drawIndexed=function(e,t,n,r,i){var o,a=this;if(this.renderBundle)this.renderBundle.push((function(){return a.drawIndexed(e,t,n,r,i)}));else{var s=this.gl,u=this.currentPipeline,l=Ue(u.inputLayout),c=Ue(this.currentIndexBufferByteOffset)+n*l.indexBufferCompByteSize;if(t){var f=[u.drawMode,e,l.indexBufferType,c,t];Zt(s)?s.drawElementsInstanced.apply(s,te([],ee(f),!1)):(o=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(o,te([],ee(f),!1))}else s.drawElements(u.drawMode,e,l.indexBufferType,c);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(e/3*Math.max(t,1))}},e.prototype.drawIndirect=function(e,t){},e.prototype.drawIndexedIndirect=function(e,t){},e.prototype.beginOcclusionQuery=function(e){var t=this.gl;if(Zt(t)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;t.beginQuery(n.gl_query_type,n.gl_query[e])}},e.prototype.endOcclusionQuery=function(){var e=this.gl;if(Zt(e)){var t=this.currentRenderPassDescriptor.occlusionQueryPool;e.endQuery(t.gl_query_type)}},e.prototype.pipelineQueryReady=function(e){var t=e;return this.queryProgramReady(t.program)},e.prototype.pipelineForceReady=function(e){},e.prototype.endPass=function(){for(var e=this.gl,t=Zt(e),n=1===this.currentColorResolveTos.length&&this.currentColorResolveTos[0]===this.scTexture,r=!1,i=0;i<this.currentColorAttachments.length;i++){var o=this.currentColorAttachments[i];if(null!==o){var a=this.currentColorResolveTos[i],s=!1;null!==a&&(De(o.width===a.width&&o.height===a.height),this.setScissorRectEnabled(!1),n||(t&&e.bindFramebuffer(e.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&t&&this.bindFramebufferAttachment(e.READ_FRAMEBUFFER,e.COLOR_ATTACHMENT0,o,this.currentColorAttachmentLevels[i])),s=!0,n||(a===this.scTexture?e.bindFramebuffer(t?ne.DRAW_FRAMEBUFFER:ne.FRAMEBUFFER,this.scPlatformFramebuffer):(e.bindFramebuffer(t?ne.DRAW_FRAMEBUFFER:ne.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&e.framebufferTexture2D(t?ne.DRAW_FRAMEBUFFER:ne.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,a.gl_texture,this.currentColorResolveToLevels[i]))),n||(t?(e.blitFramebuffer(0,0,o.width,o.height,0,0,a.width,a.height,e.COLOR_BUFFER_BIT,e.LINEAR),e.bindFramebuffer(e.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(o,a)),r=!0),this.currentRenderPassDescriptor.colorStore[i]||n||s||(e.bindFramebuffer(t?ne.READ_FRAMEBUFFER:ne.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(t?ne.READ_FRAMEBUFFER:ne.FRAMEBUFFER,e.COLOR_ATTACHMENT0,o,this.currentColorAttachmentLevels[i])),n||e.bindFramebuffer(t?ne.READ_FRAMEBUFFER:ne.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var u=this.currentDepthStencilAttachment;if(u){var l=this.currentDepthStencilResolveTo;s=!1;l&&(De(u.width===l.width&&u.height===l.height),this.setScissorRectEnabled(!1),n||(e.bindFramebuffer(t?ne.READ_FRAMEBUFFER:ne.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),e.bindFramebuffer(t?ne.DRAW_FRAMEBUFFER:ne.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(t?ne.READ_FRAMEBUFFER:ne.FRAMEBUFFER,u),this.bindFramebufferDepthStencilAttachment(t?ne.DRAW_FRAMEBUFFER:ne.FRAMEBUFFER,l))),s=!0,n||(t&&e.blitFramebuffer(0,0,u.width,u.height,0,0,l.width,l.height,e.DEPTH_BUFFER_BIT,e.NEAREST),e.bindFramebuffer(t?ne.DRAW_FRAMEBUFFER:ne.FRAMEBUFFER,null)),r=!0),n||this.currentRenderPassDescriptor.depthStencilStore||(s||(e.bindFramebuffer(t?ne.READ_FRAMEBUFFER:ne.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(t?ne.READ_FRAMEBUFFER:ne.FRAMEBUFFER,u),s=!0),t&&e.invalidateFramebuffer(e.READ_FRAMEBUFFER,[e.DEPTH_STENCIL_ATTACHMENT])),!n&&s&&e.bindFramebuffer(t?ne.READ_FRAMEBUFFER:ne.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}n||r||e.bindFramebuffer(t?ne.DRAW_FRAMEBUFFER:ne.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(e){if(this.currentScissorEnabled!==e){var t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),this.currentScissorEnabled=e}},e.prototype.applyStencil=function(){H(this.currentStencilRef)||(this.gl.stencilFuncSeparate(ne.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,this.currentMegaState.stencilFront.mask||255),this.gl.stencilFuncSeparate(ne.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,this.currentMegaState.stencilBack.mask||255))},e.prototype.getFallbackTexture=function(e){var t=e.gl_target,n=e.formatKind;if(t===ne.TEXTURE_2D)return n===xe.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===ne.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===ne.TEXTURE_3D)return this.fallbackTexture3D;if(t===ne.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.submitBlitRenderPass=function(e,t){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:"layout(location = 0) in vec2 a_Position;\nout vec2 v_TexCoord;\nvoid main() {\n  v_TexCoord = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n\n  #ifdef VIEWPORT_ORIGIN_TL\n    v_TexCoord.y = 1.0 - v_TexCoord.y;\n  #endif\n}"},fragment:{glsl:"uniform sampler2D u_Texture;\nin vec2 v_TexCoord;\nout vec4 outputColor;\nvoid main() {\n  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);\n}"}}),this.blitVertexBuffer=this.createBuffer({usage:pe.VERTEX|pe.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:8,stepMode:ve.VERTEX,attributes:[{format:we.F32_RG,offset:0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:he.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[we.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:$e(et)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:e.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:e}));var n=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var r=this.createRenderPass({colorAttachment:[e],colorResolveTo:[t],colorClearColor:[He]}),i=this.getCanvas(),o=i.width,a=i.height;r.setPipeline(this.blitRenderPipeline),r.setBindings(this.blitBindings),r.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),r.setViewport(0,0,o,a),this.gl.disable(this.gl.BLEND),r.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=n,this.inBlitRenderPass=!1},e}(),Cn=function(){function e(e){this.pluginOptions=e}return e.prototype.createSwapChain=function(e){return Q(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,u,l,c,f,h,p;return $(this,(function(d){return t=this.pluginOptions,n=t.targets,r=t.xrCompatible,i=t.antialias,o=void 0!==i&&i,a=t.preserveDrawingBuffer,s=void 0!==a&&a,u=t.premultipliedAlpha,l=void 0===u||u,c=t.shaderDebug,f=t.trackResources,h={antialias:o,preserveDrawingBuffer:s,stencil:!0,premultipliedAlpha:l,xrCompatible:r},this.handleContextEvents(e),n.includes("webgl2")&&(p=e.getContext("webgl2",h)||e.getContext("experimental-webgl2",h)),!p&&n.includes("webgl1")&&(p=e.getContext("webgl",h)||e.getContext("experimental-webgl",h)),[2,new Sn(p,{shaderDebug:c,trackResources:f})]}))}))},e.prototype.handleContextEvents=function(e){var t=this.pluginOptions,n=t.onContextLost,r=t.onContextRestored,i=t.onContextCreationError;i&&e.addEventListener("webglcontextcreationerror",i,!1),n&&e.addEventListener("webglcontextlost",n,!1),r&&e.addEventListener("webglcontextrestored",r,!1)},e}(),Rn="undefined"!=typeof TextDecoder?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:function(){throw Error("TextDecoder not available")}};"undefined"!=typeof TextDecoder&&Rn.decode();var wn=null;function Mn(){return null!==wn&&0!==wn.byteLength||(wn=new Uint8Array(dn.memory.buffer)),wn}function kn(e,t){return e>>>=0,Rn.decode(Mn().subarray(e,e+t))}var Ln=new Array(128).fill(void 0);Ln.push(void 0,null,!0,!1);var On=Ln.length;function In(e){return Ln[e]}function Pn(e){var t=In(e);return function(e){e<132||(Ln[e]=On,On=e)}(e),t}var Nn=0,Bn="undefined"!=typeof TextEncoder?new TextEncoder("utf-8"):{encode:function(){throw Error("TextEncoder not available")}},Dn="function"==typeof Bn.encodeInto?function(e,t){return Bn.encodeInto(e,t)}:function(e,t){var n=Bn.encode(e);return t.set(n),{read:e.length,written:n.length}};function Un(e,t,n){if(void 0===n){var r=Bn.encode(e),i=t(r.length,1)>>>0;return Mn().subarray(i,i+r.length).set(r),Nn=r.length,i}for(var o=e.length,a=t(o,1)>>>0,s=Mn(),u=0;u<o;u++){var l=e.charCodeAt(u);if(l>127)break;s[a+u]=l}if(u!==o){0!==u&&(e=e.slice(u)),a=n(a,o,o=u+3*e.length,1)>>>0;var c=Mn().subarray(a+u,a+o);u+=Dn(e,c).written}return Nn=u,a}var Fn=null;function zn(){return null!==Fn&&0!==Fn.byteLength||(Fn=new Int32Array(dn.memory.buffer)),Fn}function Gn(e,t,n){var r,i;try{var o=dn.__wbindgen_add_to_stack_pointer(-16),a=Un(e,dn.__wbindgen_malloc,dn.__wbindgen_realloc),s=Nn,u=Un(t,dn.__wbindgen_malloc,dn.__wbindgen_realloc),l=Nn;dn.glsl_compile(o,a,s,u,l,n);var c=zn()[o/4+0],f=zn()[o/4+1];return r=c,i=f,kn(c,f)}finally{dn.__wbindgen_add_to_stack_pointer(16),dn.__wbindgen_free(r,i,1)}}var Vn,jn,Hn=function(){function e(){p()(this,e);var t=dn.wgslcomposer_new();return e.__wrap(t)}return v()(e,[{key:"__destroy_into_raw",value:function(){var e=this.__wbg_ptr;return this.__wbg_ptr=0,e}},{key:"free",value:function(){var e=this.__destroy_into_raw();dn.__wbg_wgslcomposer_free(e)}},{key:"load_composable",value:function(e){var t=Un(e,dn.__wbindgen_malloc,dn.__wbindgen_realloc),n=Nn;dn.wgslcomposer_load_composable(this.__wbg_ptr,t,n)}},{key:"wgsl_compile",value:function(e){var t,n;try{var r=dn.__wbindgen_add_to_stack_pointer(-16),i=Un(e,dn.__wbindgen_malloc,dn.__wbindgen_realloc),o=Nn;dn.wgslcomposer_wgsl_compile(r,this.__wbg_ptr,i,o);var a=zn()[r/4+0],s=zn()[r/4+1];return t=a,n=s,kn(a,s)}finally{dn.__wbindgen_add_to_stack_pointer(16),dn.__wbindgen_free(t,n,1)}}}],[{key:"__wrap",value:function(t){t>>>=0;var n=Object.create(e.prototype);return n.__wbg_ptr=t,n}}]),e}();function Wn(e,t){return Xn.apply(this,arguments)}function Xn(){return(Xn=f()(l()().mark((function e(t,n){var r,i;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!("function"==typeof Response&&t instanceof Response)){e.next=23;break}if("function"!=typeof WebAssembly.instantiateStreaming){e.next=15;break}return e.prev=2,e.next=5,WebAssembly.instantiateStreaming(t,n);case 5:case 20:return e.abrupt("return",e.sent);case 8:if(e.prev=8,e.t0=e.catch(2),"application/wasm"==t.headers.get("Content-Type")){e.next=14;break}console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",e.t0),e.next=15;break;case 14:throw e.t0;case 15:return e.next=17,t.arrayBuffer();case 17:return r=e.sent,e.next=20,WebAssembly.instantiate(r,n);case 23:return e.next=25,WebAssembly.instantiate(t,n);case 25:if(!((i=e.sent)instanceof WebAssembly.Instance)){e.next=30;break}return e.abrupt("return",{instance:i,module:t});case 30:return e.abrupt("return",i);case 31:case"end":return e.stop()}}),e,null,[[2,8]])})))).apply(this,arguments)}function Zn(){var e={wbg:{}};return e.wbg.__wbindgen_string_new=function(e,t){return function(e){On===Ln.length&&Ln.push(Ln.length+1);var t=On;return On=Ln[t],Ln[t]=e,t}(kn(e,t))},e.wbg.__wbindgen_object_drop_ref=function(e){Pn(e)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(e){console.log(In(e))},e.wbg.__wbg_log_576ca876af0d4a77=function(e,t){console.log(In(e),In(t))},e.wbg.__wbindgen_throw=function(e,t){throw new Error(kn(e,t))},e}function Yn(e,t){return dn=e.exports,qn.__wbindgen_wasm_module=t,Fn=null,wn=null,dn}function qn(e){return Kn.apply(this,arguments)}function Kn(){return(Kn=f()(l()().mark((function e(t){var n,r,i,o;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===dn){e.next=2;break}return e.abrupt("return",dn);case 2:return n=Zn(),("string"==typeof t||"function"==typeof Request&&t instanceof Request||"function"==typeof URL&&t instanceof URL)&&(t=fetch(t)),e.t0=Wn,e.next=7,t;case 7:return e.t1=e.sent,e.t2=n,e.next=11,(0,e.t0)(e.t1,e.t2);case 11:return r=e.sent,i=r.instance,o=r.module,e.abrupt("return",Yn(i,o));case 15:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qn(e){if(e===we.U8_R_NORM)return"r8unorm";if(e===we.S8_R_NORM)return"r8snorm";if(e===we.U8_RG_NORM)return"rg8unorm";if(e===we.S8_RG_NORM)return"rg8snorm";if(e===we.U32_R)return"r32uint";if(e===we.S32_R)return"r32sint";if(e===we.F32_R)return"r32float";if(e===we.U16_RG)return"rg16uint";if(e===we.S16_RG)return"rg16sint";if(e===we.F16_RG)return"rg16float";if(e===we.U8_RGBA_RT)return"bgra8unorm";if(e===we.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(e===we.U8_RGBA_NORM)return"rgba8unorm";if(e===we.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(e===we.S8_RGBA_NORM)return"rgba8snorm";if(e===we.U32_RG)return"rg32uint";if(e===we.S32_RG)return"rg32sint";if(e===we.F32_RG)return"rg32float";if(e===we.U16_RGBA)return"rgba16uint";if(e===we.S16_RGBA)return"rgba16sint";if(e===we.F16_RGBA)return"rgba16float";if(e===we.F32_RGBA)return"rgba32float";if(e===we.U32_RGBA)return"rgba32uint";if(e===we.S32_RGBA)return"rgba32sint";if(e===we.D24)return"depth24plus";if(e===we.D24_S8)return"depth24plus-stencil8";if(e===we.D32F)return"depth32float";if(e===we.D32F_S8)return"depth32float-stencil8";if(e===we.BC1)return"bc1-rgba-unorm";if(e===we.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===we.BC2)return"bc2-rgba-unorm";if(e===we.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===we.BC3)return"bc3-rgba-unorm";if(e===we.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===we.BC4_SNORM)return"bc4-r-snorm";if(e===we.BC4_UNORM)return"bc4-r-unorm";if(e===we.BC5_SNORM)return"bc5-rg-snorm";if(e===we.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function $n(e){if(e===me.TEXTURE_2D)return"2d";if(e===me.TEXTURE_CUBE_MAP)return"cube";if(e===me.TEXTURE_2D_ARRAY)return"2d-array";if(e===me.TEXTURE_3D)return"3d";throw new Error("whoops")}function Jn(e){if(e===le.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===le.REPEAT)return"repeat";if(e===le.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function er(e){if(e===ce.BILINEAR)return"linear";if(e===ce.POINT)return"nearest";throw new Error("whoops")}function tr(e){if(e===fe.LINEAR)return"linear";if(e===fe.NEAREST)return"nearest";if(e===fe.NO_MIP)return"nearest";throw new Error("whoops")}function nr(e){return e.gpuBuffer}function rr(e){if(e===Ae.OcclusionConservative)return"occlusion";throw new Error("whoops")}function ir(e){switch(e){case he.TRIANGLES:return"triangle-list";case he.POINTS:return"point-list";case he.TRIANGLE_STRIP:return"triangle-strip";case he.LINES:return"line-list";case he.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function or(e){if(e===ae.NONE)return"none";if(e===ae.FRONT)return"front";if(e===ae.BACK)return"back";throw new Error("whoops")}function ar(e){if(e===oe.CCW)return"ccw";if(e===oe.CW)return"cw";throw new Error("whoops")}function sr(e){if(e===se.ZERO)return"zero";if(e===se.ONE)return"one";if(e===se.SRC)return"src";if(e===se.ONE_MINUS_SRC)return"one-minus-src";if(e===se.DST)return"dst";if(e===se.ONE_MINUS_DST)return"one-minus-dst";if(e===se.SRC_ALPHA)return"src-alpha";if(e===se.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(e===se.DST_ALPHA)return"dst-alpha";if(e===se.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(e===se.CONST)return"constant";if(e===se.ONE_MINUS_CONSTANT)return"one-minus-constant";if(e===se.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function ur(e){if(e===ue.ADD)return"add";if(e===ue.SUBSTRACT)return"subtract";if(e===ue.REVERSE_SUBSTRACT)return"reverse-subtract";if(e===ue.MIN)return"min";if(e===ue.MAX)return"max";throw new Error("whoops")}function lr(e){return{operation:ur(e.blendMode),srcFactor:sr(e.blendSrcFactor),dstFactor:sr(e.blendDstFactor)}}function cr(e){return e.blendMode===ue.ADD&&e.blendSrcFactor===se.ONE&&e.blendDstFactor===se.ZERO}function fr(e){return cr(e.rgbBlendState)&&cr(e.alphaBlendState)?void 0:{color:lr(e.rgbBlendState),alpha:lr(e.alphaBlendState)}}function hr(e,t){return t.attachmentsState.map((function(t,n){return function(e,t){return{format:Qn(t),blend:fr(e),writeMask:e.channelWriteMask}}(t,e[n])}))}function pr(e){if(e===ie.NEVER)return"never";if(e===ie.LESS)return"less";if(e===ie.EQUAL)return"equal";if(e===ie.LEQUAL)return"less-equal";if(e===ie.GREATER)return"greater";if(e===ie.NOTEQUAL)return"not-equal";if(e===ie.GEQUAL)return"greater-equal";if(e===ie.ALWAYS)return"always";throw new Error("whoops")}function dr(e){if(e===be.KEEP)return"keep";if(e===be.REPLACE)return"replace";if(e===be.ZERO)return"zero";if(e===be.DECREMENT_CLAMP)return"decrement-clamp";if(e===be.DECREMENT_WRAP)return"decrement-wrap";if(e===be.INCREMENT_CLAMP)return"increment-clamp";if(e===be.INCREMENT_WRAP)return"increment-wrap";if(e===be.INVERT)return"invert";throw new Error("whoops")}function vr(e){if(e===ve.VERTEX)return"vertex";if(e===ve.INSTANCE)return"instance";throw new Error("whoops")}function gr(e){if(e===we.U8_R)return"uint8x2";if(e===we.U8_RG)return"uint8x2";if(e===we.U8_RGB)return"uint8x4";if(e===we.U8_RGBA)return"uint8x4";if(e===we.U8_RG_NORM)return"unorm8x2";if(e===we.U8_RGBA_NORM)return"unorm8x4";if(e===we.S8_RGB_NORM)return"snorm8x4";if(e===we.S8_RGBA_NORM)return"snorm8x4";if(e===we.U16_RG_NORM)return"unorm16x2";if(e===we.U16_RGBA_NORM)return"unorm16x4";if(e===we.S16_RG_NORM)return"snorm16x2";if(e===we.S16_RGBA_NORM)return"snorm16x4";if(e===we.S16_RG)return"uint16x2";if(e===we.F16_RG)return"float16x2";if(e===we.F16_RGBA)return"float16x4";if(e===we.F32_R)return"float32";if(e===we.F32_RG)return"float32x2";if(e===we.F32_RGB)return"float32x3";if(e===we.F32_RGBA)return"float32x4";throw"whoops"}function mr(e,t,n,r){switch(void 0===n&&(n=!1),e){case we.S8_R:case we.S8_R_NORM:case we.S8_RG_NORM:case we.S8_RGB_NORM:case we.S8_RGBA_NORM:var i=(ArrayBuffer,new Int8Array(t));return r&&i.set(new Int8Array(r)),i;case we.U8_R:case we.U8_R_NORM:case we.U8_RG:case we.U8_RG_NORM:case we.U8_RGB:case we.U8_RGB_NORM:case we.U8_RGB_SRGB:case we.U8_RGBA:case we.U8_RGBA_NORM:case we.U8_RGBA_SRGB:var o=(ArrayBuffer,new Uint8Array(t));return r&&o.set(new Uint8Array(r)),o;case we.S16_R:case we.S16_RG:case we.S16_RG_NORM:case we.S16_RGB_NORM:case we.S16_RGBA:case we.S16_RGBA_NORM:var a=t instanceof ArrayBuffer?new Int16Array(t):new Int16Array(n?t/2:t);return r&&a.set(new Int16Array(r)),a;case we.U16_R:case we.U16_RGB:case we.U16_RGBA_5551:case we.U16_RGBA_NORM:case we.U16_RG_NORM:case we.U16_R_NORM:var s=t instanceof ArrayBuffer?new Uint16Array(t):new Uint16Array(n?t/2:t);return r&&s.set(new Uint16Array(r)),s;case we.S32_R:var u=t instanceof ArrayBuffer?new Int32Array(t):new Int32Array(n?t/4:t);return r&&u.set(new Int32Array(r)),u;case we.U32_R:case we.U32_RG:var l=t instanceof ArrayBuffer?new Uint32Array(t):new Uint32Array(n?t/4:t);return r&&l.set(new Uint32Array(r)),l;case we.F32_R:case we.F32_RG:case we.F32_RGB:case we.F32_RGBA:var c=t instanceof ArrayBuffer?new Float32Array(t):new Float32Array(n?t/4:t);return r&&c.set(new Float32Array(r)),c}var f=(ArrayBuffer,new Uint8Array(t));return r&&f.set(new Uint8Array(r)),f}function yr(e){switch(e){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":case"depth16unorm":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":case"depth32float":default:return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8}}}!function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"}(Vn||(Vn={})),function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"}(jn||(jn={}));var _r,br=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this)||this;return i.id=n,i.device=r,i}return Y(t,e),t.prototype.destroy=function(){},t}(Me),xr=function(e){function t(t){var n,r,i=t.id,o=t.device,a=t.descriptor,s=e.call(this,{id:i,device:o})||this;s.type=re.Bindings;var u=a.pipeline;De(!!u);var l=a.uniformBufferBindings,c=a.storageBufferBindings,f=a.samplerBindings,h=a.storageTextureBindings;s.numUniformBuffers=(null==l?void 0:l.length)||0;var p=[[],[],[],[]],d=0;if(l&&l.length)for(var v=0;v<l.length;v++){var g=a.uniformBufferBindings[v],m=g.binding,y=g.size,_=g.offset,b={buffer:nr(g.buffer),offset:null!=_?_:0,size:y};p[0].push({binding:null!=m?m:d++,resource:b})}if(f&&f.length){d=0;for(v=0;v<f.length;v++){var x=q(q({},f[v]),nt),E=null!==(m=a.samplerBindings[v]).texture?m.texture:s.device.getFallbackTexture(x);x.dimension=E.dimension,x.formatKind=Be(E.format);var T=E.gpuTextureView;if(p[1].push({binding:null!==(n=m.textureBinding)&&void 0!==n?n:d++,resource:T}),-1!==m.samplerBinding){var A=null!==m.sampler?m.sampler:s.device.getFallbackSampler(x),S=A.gpuSampler;p[1].push({binding:null!==(r=m.samplerBinding)&&void 0!==r?r:d++,resource:S})}}}if(c&&c.length){d=0;for(v=0;v<c.length;v++){var C=a.storageBufferBindings[v];m=C.binding,y=C.size,_=C.offset,b={buffer:nr(C.buffer),offset:null!=_?_:0,size:y};p[2].push({binding:null!=m?m:d++,resource:b})}}if(h&&h.length){d=0;for(v=0;v<h.length;v++){var R=a.storageTextureBindings[v];m=R.binding,T=(E=R.texture).gpuTextureView;p[3].push({binding:null!=m?m:d++,resource:T})}}var w=p.findLastIndex((function(e){return!!e.length}));return s.gpuBindGroup=p.map((function(e,t){return t<=w&&s.device.device.createBindGroup({layout:u.getBindGroupLayout(t),entries:e})})),s}return Y(t,e),t}(br),Er=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=re.Buffer;var a=i.usage,s=i.viewOrSize,u=!!(a&pe.MAP_READ);o.usage=function(e){var t=0;return e&pe.INDEX&&(t|=GPUBufferUsage.INDEX),e&pe.VERTEX&&(t|=GPUBufferUsage.VERTEX),e&pe.UNIFORM&&(t|=GPUBufferUsage.UNIFORM),e&pe.STORAGE&&(t|=GPUBufferUsage.STORAGE),e&pe.COPY_SRC&&(t|=GPUBufferUsage.COPY_SRC),e&pe.INDIRECT&&(t|=GPUBufferUsage.INDIRECT),t|GPUBufferUsage.COPY_DST}(a),u&&(o.usage=pe.MAP_READ|pe.COPY_DST);var l=!W(s);(o.view=W(s)?null:s,o.size=W(s)?Ze(s,4):Ze(s.byteLength,4),W(s))?o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:!!u&&l}):(o.gpuBuffer=o.device.device.createBuffer({usage:o.usage,size:o.size,mappedAtCreation:!0}),new(s&&s.constructor||Float32Array)(o.gpuBuffer.getMappedRange()).set(s),o.gpuBuffer.unmap());return o}return Y(t,e),t.prototype.setSubData=function(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var i=this.gpuBuffer;r=r||t.byteLength,r=Math.min(r,this.size-e);var o=t.byteOffset+n,a=o+r,s=r+3&-4;if(s!==r){var u=new Uint8Array(t.buffer.slice(o,a));(t=new Uint8Array(s)).set(u),n=0,o=0,a=s,r=s}for(var l=15728640,c=0;a-(o+c)>l;)this.device.device.queue.writeBuffer(i,e+c,t.buffer,o+c,l),c+=l;this.device.device.queue.writeBuffer(i,e+c,t.buffer,o+c,r-c)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},t}(br),Tr=function(){function e(){this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(e,t,n){this.gpuComputePassEncoder.dispatchWorkgroups(e,t,n)},e.prototype.dispatchWorkgroupsIndirect=function(e,t){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(e.gpuBuffer,t)},e.prototype.finish=function(){this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.frameCommandEncoder=null},e.prototype.beginComputePass=function(e){De(null===this.gpuComputePassEncoder),this.frameCommandEncoder=e,this.gpuComputePassEncoder=this.frameCommandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(e){var t=Ue(e.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(t)},e.prototype.setBindings=function(e){var t=this,n=e;n.gpuBindGroup.forEach((function(e,r){e&&t.gpuComputePassEncoder.setBindGroup(r,n.gpuBindGroup[r])}))},e.prototype.pushDebugGroup=function(e){this.gpuComputePassEncoder.pushDebugGroup(e)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(e){this.gpuComputePassEncoder.insertDebugMarker(e)},e}(),Ar=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=re.ComputePipeline,o.gpuComputePipeline=null,o.descriptor=i;var a=i.program.computeStage;if(null===a)return o;var s={layout:"auto",compute:q({},a)};return o.gpuComputePipeline=o.device.device.createComputePipeline(s),void 0!==o.name&&(o.gpuComputePipeline.label=o.name),o}return Y(t,e),t.prototype.getBindGroupLayout=function(e){return this.gpuComputePipeline.getBindGroupLayout(e)},t}(br),Sr=function(e){function t(t){var n,r,i,o,a=t.id,s=t.device,u=t.descriptor,l=e.call(this,{id:a,device:s})||this;l.type=re.InputLayout;var c=[];try{for(var f=J(u.vertexBufferDescriptors),h=f.next();!h.done;h=f.next()){var p=h.value,d=p.arrayStride,v=p.stepMode,g=p.attributes;c.push({arrayStride:d,stepMode:vr(v),attributes:[]});try{for(var m=(i=void 0,J(g)),y=m.next();!y.done;y=m.next()){var _=y.value,b=_.shaderLocation,x=_.format,E=_.offset;c[c.length-1].attributes.push({shaderLocation:b,format:gr(x),offset:E})}}catch(e){i={error:e}}finally{try{y&&!y.done&&(o=m.return)&&o.call(m)}finally{if(i)throw i.error}}}}catch(e){n={error:e}}finally{try{h&&!h.done&&(r=f.return)&&r.call(f)}finally{if(n)throw n.error}}return l.indexFormat=function(e){if(null!==e){if(e===we.U16_R)return"uint16";if(e===we.U32_R)return"uint32";throw new Error("whoops")}}(u.indexBufferFormat),l.buffers=c,l}return Y(t,e),t}(br),Cr=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;return o.type=re.Program,o.vertexStage=null,o.fragmentStage=null,o.computeStage=null,o.descriptor=i,i.vertex&&(o.vertexStage=o.createShaderStage(i.vertex,"vertex")),i.fragment&&(o.fragmentStage=o.createShaderStage(i.fragment,"fragment")),i.compute&&(o.computeStage=o.createShaderStage(i.compute,"compute")),o}return Y(t,e),t.prototype.setUniformsLegacy=function(e){},t.prototype.createShaderStage=function(e,t){var n,r,i=e.glsl,o=e.wgsl,a=e.entryPoint,s=e.postprocess,u=o;if(!u)try{u=this.device.glsl_compile(i,t,!1)}catch(e){throw console.error(e,i),new Error("whoops")}var l=function(e){if(!u.includes(e))return"continue";u=(u=u.replace("var T_".concat(e,": texture_2d<f32>;"),"var T_".concat(e,": texture_depth_2d;"))).replace(new RegExp("textureSample\\(T_".concat(e,"(.*)\\);$"),"gm"),(function(t,n){return"vec4<f32>(textureSample(T_".concat(e).concat(n,"), 0.0, 0.0, 0.0);")}))};try{for(var c=J(["u_TextureFramebufferDepth"]),f=c.next();!f.done;f=c.next()){l(f.value)}}catch(e){n={error:e}}finally{try{f&&!f.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}return s&&(u=s(u)),{module:this.device.device.createShaderModule({code:u}),entryPoint:a||"main"}},t}(br),Rr=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;o.type=re.QueryPool;var a=i.elemCount,s=i.type;return o.querySet=o.device.device.createQuerySet({type:rr(s),count:a}),o.resolveBuffer=o.device.device.createBuffer({size:8*a,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),o.cpuBuffer=o.device.device.createBuffer({size:8*a,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),o.results=null,o}return Y(t,e),t.prototype.queryResultOcclusion=function(e){return null===this.results?null:this.results[e]!==BigInt(0)},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},t}(br),wr=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this,{id:n,device:r})||this;return i.type=re.Readback,i}return Y(t,e),t.prototype.readTexture=function(e,t,n,r,i,o,a,s){return void 0===a&&(a=0),Q(this,void 0,void 0,(function(){var s,u,l,c,f,h,p;return $(this,(function(d){return 0,u=yr((s=e).gpuTextureformat),l=Math.ceil(r/u.width)*u.length,c=256*Math.ceil(l/256),f=c*i,h=this.device.createBuffer({usage:pe.STORAGE|pe.MAP_READ|pe.COPY_DST,hint:de.STATIC,viewOrSize:f}),(p=this.device.device.createCommandEncoder()).copyTextureToBuffer({texture:s.gpuTexture,mipLevel:0,origin:{x:t,y:n,z:Math.max(0,0)}},{buffer:h.gpuBuffer,offset:0,bytesPerRow:c},{width:r,height:i,depthOrArrayLayers:1}),this.device.device.queue.submit([p.finish()]),[2,this.readBuffer(h,0,o.byteLength===f?o:null,a,f,s.format,!0,!1,l,c,i)]}))}))},t.prototype.readTextureSync=function(e,t,n,r,i,o,a,s){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},t.prototype.readBuffer=function(e,t,n,r,i,o,a,s,u,l,c){var f=this;void 0===t&&(t=0),void 0===n&&(n=null),void 0===i&&(i=0),void 0===o&&(o=we.U8_RGB),void 0===a&&(a=!1),void 0===u&&(u=0),void 0===l&&(l=0),void 0===c&&(c=0);var h=e,p=i||h.size,d=n||h.view,v=d&&d.constructor&&d.constructor.BYTES_PER_ELEMENT||Ne(o),g=h;if(!(h.usage&pe.MAP_READ&&h.usage&pe.COPY_DST)){var m=this.device.device.createCommandEncoder();g=this.device.createBuffer({usage:pe.STORAGE|pe.MAP_READ|pe.COPY_DST,hint:de.STATIC,viewOrSize:p}),m.copyBufferToBuffer(h.gpuBuffer,t,g.gpuBuffer,0,p),this.device.device.queue.submit([m.finish()])}return new Promise((function(e,n){g.gpuBuffer.mapAsync(jn.READ,t,p).then((function(){var n=g.gpuBuffer.getMappedRange(t,p),r=d;if(a)r=null===r?mr(o,p,!0,n):mr(o,r.buffer,void 0,n);else if(null===r)switch(v){case 1:(r=new Uint8Array(p)).set(new Uint8Array(n));break;case 2:r=f.getHalfFloatAsFloatRGBAArrayBuffer(p/2,n);break;case 4:(r=new Float32Array(p/4)).set(new Float32Array(n))}else switch(v){case 1:(r=new Uint8Array(r.buffer)).set(new Uint8Array(n));break;case 2:r=f.getHalfFloatAsFloatRGBAArrayBuffer(p/2,n,d);break;case 4:var i=d&&d.constructor||Float32Array;(r=new i(r.buffer)).set(new i(n))}if(u!==l){1!==v||a||(u*=2,l*=2);for(var s=new Uint8Array(r.buffer),h=u,m=0,y=1;y<c;++y){m=y*l;for(var _=0;_<u;++_)s[h++]=s[m++]}r=0===v||a?new Uint8Array(s.buffer,0,h):new Float32Array(s.buffer,0,h/4)}g.gpuBuffer.unmap(),e(r)}),(function(e){return n(e)}))}))},t.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(e,t,n){n||(n=new Float32Array(e));for(var r,i,o,a,s=new Uint16Array(t);e--;)n[e]=(r=s[e],i=void 0,o=void 0,a=void 0,i=(32768&r)>>15,a=1023&r,0===(o=(31744&r)>>10)?(i?-1:1)*Math.pow(2,-14)*(a/Math.pow(2,10)):31==o?a?NaN:1/0*(i?-1:1):(i?-1:1)*Math.pow(2,o-15)*(1+a/Math.pow(2,10)));return n},t}(br),Mr=function(){function e(e){this.device=e,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getEncoder=function(){var e;return(null===(e=this.renderBundle)||void 0===e?void 0:e.renderBundleEncoder)||this.gpuRenderPassEncoder},e.prototype.getTextureView=function(e,t){return De(t<e.mipLevelCount),1===e.mipLevelCount?e.gpuTextureView:e.gpuTexture.createView({baseMipLevel:t,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(e){var t,n,r,i,o,a;this.descriptor=e,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var s=e.colorAttachment.length;this.gfxColorAttachment.length=s,this.gfxColorResolveTo.length=s;for(var u=0;u<e.colorAttachment.length;u++){var l=e.colorAttachment[u],c=e.colorResolveTo[u];if(null===l&&null!==c&&(l=c,c=null),this.gfxColorAttachment[u]=l,this.gfxColorResolveTo[u]=c,this.gfxColorAttachmentLevel[u]=(null===(t=e.colorAttachmentLevel)||void 0===t?void 0:t[u])||0,this.gfxColorResolveToLevel[u]=(null===(n=e.colorResolveToLevel)||void 0===n?void 0:n[u])||0,null===l){this.gpuColorAttachments.length=u,this.gfxColorAttachment.length=u,this.gfxColorResolveTo.length=u;break}void 0===this.gpuColorAttachments[u]&&(this.gpuColorAttachments[u]={}),(h=this.gpuColorAttachments[u]).view=this.getTextureView(l,(null===(r=this.gfxColorAttachmentLevel)||void 0===r?void 0:r[u])||0);var f=null!==(o=null===(i=e.colorClearColor)||void 0===i?void 0:i[u])&&void 0!==o?o:"load";"load"===f?h.loadOp="load":(h.loadOp="clear",h.clearValue=f),h.storeOp=(null===(a=e.colorStore)||void 0===a?void 0:a[u])?"store":"discard",h.resolveTarget=void 0,null!==c&&(l.sampleCount>1?h.resolveTarget=this.getTextureView(c,this.gfxColorResolveToLevel[u]):h.storeOp="store")}if(this.gfxDepthStencilAttachment=e.depthStencilAttachment,this.gfxDepthStencilResolveTo=e.depthStencilResolveTo,e.depthStencilAttachment){var h,p=e.depthStencilAttachment;(h=this.gpuDepthStencilAttachment).view=p.gpuTextureView,!!(Ie(p.format)&Re.Depth)?("load"===e.depthClearValue?h.depthLoadOp="load":(h.depthLoadOp="clear",h.depthClearValue=e.depthClearValue),e.depthStencilStore||null!==this.gfxDepthStencilResolveTo?h.depthStoreOp="store":h.depthStoreOp="discard"):(h.depthLoadOp=void 0,h.depthStoreOp=void 0),!!(Ie(p.format)&Re.Stencil)?("load"===e.stencilClearValue?h.stencilLoadOp="load":(h.stencilLoadOp="clear",h.stencilClearValue=e.stencilClearValue),e.depthStencilStore||null!==this.gfxDepthStencilResolveTo?h.stencilStoreOp="store":h.stencilStoreOp="discard"):(h.stencilLoadOp=void 0,h.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=H(e.occlusionQueryPool)?void 0:e.occlusionQueryPool.querySet},e.prototype.beginRenderPass=function(e,t){De(null===this.gpuRenderPassEncoder),this.setRenderPassDescriptor(t),this.frameCommandEncoder=e,this.gpuRenderPassEncoder=this.frameCommandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(e,t){return this.device.swapChainHeight-e-t},e.prototype.setViewport=function(e,t,n,r,i,o){void 0===i&&(i=0),void 0===o&&(o=1),this.gpuRenderPassEncoder.setViewport(e,this.flipY(t,r),n,r,i,o)},e.prototype.setScissorRect=function(e,t,n,r){this.gpuRenderPassEncoder.setScissorRect(e,this.flipY(t,r),n,r)},e.prototype.setPipeline=function(e){var t=Ue(e.gpuRenderPipeline);this.getEncoder().setPipeline(t)},e.prototype.setVertexInput=function(e,t,n){if(null!==e){var r=this.getEncoder(),i=e;null!==n&&r.setIndexBuffer(nr(n.buffer),Ue(i.indexFormat),n.offset);for(var o=0;o<t.length;o++){var a=t[o];null!==a&&r.setVertexBuffer(o,nr(a.buffer),a.offset)}}},e.prototype.setBindings=function(e){var t=e,n=this.getEncoder();t.gpuBindGroup.forEach((function(e,r){e&&n.setBindGroup(r,t.gpuBindGroup[r])}))},e.prototype.setStencilReference=function(e){this.gpuRenderPassEncoder.setStencilReference(e)},e.prototype.draw=function(e,t,n,r){this.getEncoder().draw(e,t,n,r)},e.prototype.drawIndexed=function(e,t,n,r,i){this.getEncoder().drawIndexed(e,t,n,r,i)},e.prototype.drawIndirect=function(e,t){this.getEncoder().drawIndirect(nr(e),t)},e.prototype.drawIndexedIndirect=function(e,t){this.getEncoder().drawIndexedIndirect(nr(e),t)},e.prototype.beginOcclusionQuery=function(e){this.gpuRenderPassEncoder.beginOcclusionQuery(e)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(e){this.gpuRenderPassEncoder.pushDebugGroup(e)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(e){this.gpuRenderPassEncoder.insertDebugMarker(e)},e.prototype.beginBundle=function(e){this.renderBundle=e},e.prototype.endBundle=function(){this.renderBundle.finish()},e.prototype.executeBundles=function(e){this.gpuRenderPassEncoder.executeBundles(e.map((function(e){return e.renderBundle})))},e.prototype.finish=function(){var e;null===(e=this.gpuRenderPassEncoder)||void 0===e||e.end(),this.gpuRenderPassEncoder=null;for(var t=0;t<this.gfxColorAttachment.length;t++){var n=this.gfxColorAttachment[t],r=this.gfxColorResolveTo[t];null!==n&&null!==r&&1===n.sampleCount&&this.copyAttachment(r,this.gfxColorAttachmentLevel[t],n,this.gfxColorResolveToLevel[t])}this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.frameCommandEncoder=null},e.prototype.copyAttachment=function(e,t,n,r){De(1===n.sampleCount);var i={texture:n.gpuTexture,mipLevel:r},o={texture:e.gpuTexture,mipLevel:t};De(n.width>>>r==e.width>>>t),De(n.height>>>r==e.height>>>t),De(!!(n.usage&Vn.COPY_SRC)),De(!!(e.usage&Vn.COPY_DST)),this.frameCommandEncoder.copyTextureToTexture(i,o,[e.width,e.height,1])},e}(),kr=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=e.call(this,{id:n,device:r})||this;return o.type=re.RenderPipeline,o.isCreatingAsync=!1,o.gpuRenderPipeline=null,o.descriptor=i,o.device.createRenderPipelineInternal(o,!1),o}return Y(t,e),t.prototype.getBindGroupLayout=function(e){return this.gpuRenderPipeline.getBindGroupLayout(e)},t}(br),Lr=function(e){function t(t){var n,r,i=t.id,o=t.device,a=t.descriptor,s=e.call(this,{id:i,device:o})||this;s.type=re.Sampler;var u=a.lodMinClamp,l=a.mipmapFilter===fe.NO_MIP?a.lodMinClamp:a.lodMaxClamp,c=null!==(n=a.maxAnisotropy)&&void 0!==n?n:1;return c>1&&De(a.minFilter===ce.BILINEAR&&a.magFilter===ce.BILINEAR&&a.mipmapFilter===fe.LINEAR),s.gpuSampler=s.device.device.createSampler({addressModeU:Jn(a.addressModeU),addressModeV:Jn(a.addressModeV),addressModeW:Jn(null!==(r=a.addressModeW)&&void 0!==r?r:a.addressModeU),lodMinClamp:u,lodMaxClamp:l,minFilter:er(a.minFilter),magFilter:er(a.magFilter),mipmapFilter:tr(a.mipmapFilter),compare:void 0!==a.compareFunction?pr(a.compareFunction):void 0,maxAnisotropy:c}),s}return Y(t,e),t}(br),Or=function(e){function t(t){var n=t.id,r=t.device,i=t.descriptor,o=t.skipCreate,a=t.sampleCount,s=e.call(this,{id:n,device:r})||this;s.type=re.Texture,s.flipY=!1;var u=i.format,l=i.dimension,c=i.width,f=i.height,h=i.depthOrArrayLayers,p=i.mipLevelCount,d=i.usage,v=i.pixelStore;return s.flipY=!!(null==v?void 0:v.unpackFlipY),s.device.createTextureShared({format:u,dimension:null!=l?l:me.TEXTURE_2D,width:c,height:f,depthOrArrayLayers:null!=h?h:1,mipLevelCount:null!=p?p:1,usage:d,sampleCount:null!=a?a:1},s,o),s}return Y(t,e),t.prototype.textureFromImageBitmapOrCanvas=function(e,t,n){for(var r=t[0].width,i=t[0].height,o={size:{width:r,height:i,depthOrArrayLayers:n},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},a=e.createTexture(o),s=0;s<t.length;s++)e.queue.copyExternalImageToTexture({source:t[s],flipY:this.flipY},{texture:a,origin:[0,0,s]},[r,i]);return[a,r,i]},t.prototype.isImageBitmapOrCanvases=function(e){var t=e[0];return t instanceof ImageBitmap||t instanceof HTMLCanvasElement||t instanceof OffscreenCanvas},t.prototype.isVideo=function(e){return e[0]instanceof HTMLVideoElement},t.prototype.setImageData=function(e,t){var n,r,i,o,a=this,s=this.device.device;if(this.isImageBitmapOrCanvases(e))r=(n=ee(this.textureFromImageBitmapOrCanvas(s,e,this.depthOrArrayLayers),3))[0],i=n[1],o=n[2];else if(this.isVideo(e))r=s.importExternalTexture({source:e[0]});else{var u=yr(this.gpuTextureformat),l=Math.ceil(this.width/u.width)*u.length;e.forEach((function(e){s.queue.writeTexture({texture:a.gpuTexture},e,{bytesPerRow:l},{width:a.width,height:a.height})}))}this.width=i,this.height=o,r&&(this.gpuTexture=r),this.gpuTextureView=this.gpuTexture.createView({dimension:$n(this.dimension)})},t.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},t}(br),Ir=function(e){function t(t){var n=t.id,r=t.device,i=e.call(this,{id:n,device:r})||this;return i.type=re.RenderBundle,i.renderBundleEncoder=i.device.device.createRenderBundleEncoder({colorFormats:[i.device.swapChainFormat]}),i}return Y(t,e),t.prototype.finish=function(){this.renderBundle=this.renderBundleEncoder.finish()},t}(br),Pr=function(){function e(e,t,n,r,i,o){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=Vn.RENDER_ATTACHMENT|Vn.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.frameCommandEncoderPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=Ee.UPPER_LEFT,this.clipSpaceNearZ=Te.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=t,this.canvas=n,this.canvasContext=r,this.glsl_compile=i,this.WGSLComposer=o,this.fallbackTexture2D=this.createFallbackTexture(me.TEXTURE_2D,xe.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(me.TEXTURE_2D,xe.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(me.TEXTURE_2D_ARRAY,xe.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(me.TEXTURE_3D,xe.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(me.TEXTURE_CUBE_MAP,xe.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:le.REPEAT,addressModeV:le.REPEAT,minFilter:ce.POINT,magFilter:ce.POINT,mipmapFilter:fe.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:le.REPEAT,addressModeV:le.REPEAT,minFilter:ce.POINT,magFilter:ce.POINT,mipmapFilter:fe.NEAREST,compareFunction:ie.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(e){console.error(e.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(e,t){this.swapChainWidth===e&&this.swapChainHeight===t||(this.swapChainWidth=e,this.swapChainHeight=t)},e.prototype.getOnscreenTexture=function(){var e=this.canvasContext.getCurrentTexture(),t=e.createView(),n=new Or({id:0,device:this,descriptor:{format:we.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:me.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=e,n.gpuTextureView=t,n.name="Onscreen",this.setResourceName(n,"Onscreen Texture"),n},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){De(0===this.frameCommandEncoderPool.length)},e.prototype.endFrame=function(){De(this.frameCommandEncoderPool.every((function(e){return null!==e}))),this.device.queue.submit(this.frameCommandEncoderPool.map((function(e){return e.finish()}))),this.frameCommandEncoderPool=[]},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(e){return new Er({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTexture=function(e){return new Or({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createSampler=function(e){return new Lr({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderTarget=function(e){var t=new Or({id:this.getNextUniqueId(),device:this,descriptor:q(q({},e),{dimension:me.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:ye.RENDER_TARGET}),sampleCount:e.sampleCount});return t.depthOrArrayLayers=1,t.type=re.RenderTarget,t},e.prototype.createRenderTargetFromTexture=function(e){var t=e,n=t.format,r=t.width,i=t.height,o=t.depthOrArrayLayers,a=t.sampleCount,s=t.mipLevelCount,u=t.gpuTexture,l=t.gpuTextureView,c=t.usage;De(!!(c&Vn.RENDER_ATTACHMENT));var f=new Or({id:this.getNextUniqueId(),device:this,descriptor:{format:n,width:r,height:i,depthOrArrayLayers:o,dimension:me.TEXTURE_2D,mipLevelCount:s,usage:c},skipCreate:!0});return f.depthOrArrayLayers=o,f.sampleCount=a,f.gpuTexture=u,f.gpuTextureView=l,f},e.prototype.createProgram=function(e){var t,n;return(null===(t=e.vertex)||void 0===t?void 0:t.glsl)&&(e.vertex.glsl=jt(this.queryVendorInfo(),"vert",e.vertex.glsl)),(null===(n=e.fragment)||void 0===n?void 0:n.glsl)&&(e.fragment.glsl=jt(this.queryVendorInfo(),"frag",e.fragment.glsl)),new Cr({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createProgramSimple=function(e){return new Cr({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createTextureShared=function(e,t,n){var r={width:e.width,height:e.height,depthOrArrayLayers:e.depthOrArrayLayers},i=e.mipLevelCount,o=Qn(e.format),a=function(e){if(e===me.TEXTURE_2D)return"2d";if(e===me.TEXTURE_CUBE_MAP)return"2d";if(e===me.TEXTURE_2D_ARRAY)return"2d";if(e===me.TEXTURE_3D)return"3d";throw new Error("whoops")}(e.dimension),s=function(e){var t=0;return e&ye.SAMPLED&&(t|=Vn.TEXTURE_BINDING|Vn.COPY_DST|Vn.COPY_SRC),e&ye.STORAGE&&(t|=Vn.TEXTURE_BINDING|Vn.STORAGE_BINDING|Vn.COPY_SRC|Vn.COPY_DST),e&ye.RENDER_TARGET&&(t|=Vn.RENDER_ATTACHMENT|Vn.TEXTURE_BINDING|Vn.COPY_SRC|Vn.COPY_DST),t}(e.usage);if(t.gpuTextureformat=o,t.dimension=e.dimension,t.format=e.format,t.width=e.width,t.height=e.height,t.depthOrArrayLayers=e.depthOrArrayLayers,t.mipLevelCount=i,t.usage=s,t.sampleCount=e.sampleCount,!n){var u=this.device.createTexture({size:r,mipLevelCount:i,format:o,dimension:a,sampleCount:e.sampleCount,usage:s}),l=u.createView();t.gpuTexture=u,t.gpuTextureView=l}},e.prototype.getFallbackSampler=function(e){return e.formatKind===xe.Depth&&e.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(e){var t=e.dimension,n=e.formatKind;if(t===me.TEXTURE_2D)return n===xe.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===me.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===me.TEXTURE_3D)return this.fallbackTexture3D;if(t===me.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.createFallbackTexture=function(e,t){var n=e===me.TEXTURE_CUBE_MAP?6:1,r=t===xe.Float?we.U8_RGBA_NORM:we.D24;return this.createTexture({dimension:e,format:r,usage:ye.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1})},e.prototype.createBindings=function(e){return new xr({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createInputLayout=function(e){return new Sr({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createComputePipeline=function(e){return new Ar({id:this.getNextUniqueId(),device:this,descriptor:e})},e.prototype.createRenderPipeline=function(e){return new kr({id:this.getNextUniqueId(),device:this,descriptor:q({},e)})},e.prototype.createQueryPool=function(e,t){return new Rr({id:this.getNextUniqueId(),device:this,descriptor:{type:e,elemCount:t}})},e.prototype.createRenderPipelineInternal=function(e,t){var n;if(null===e.gpuRenderPipeline){var r=e.descriptor,i=r.program,o=i.vertexStage,a=i.fragmentStage;if(null!==o&&null!==a){var s=r.megaStateDescriptor||{},u=s.stencilBack,l=s.stencilFront,c=K(s,["stencilBack","stencilFront"]),f=$e(et);r.megaStateDescriptor=q(q(q({},f),{stencilBack:q(q({},f.stencilBack),u),stencilFront:q(q({},f.stencilFront),l)}),c);var h=r.megaStateDescriptor.attachmentsState[0];r.colorAttachmentFormats.forEach((function(e,t){r.megaStateDescriptor.attachmentsState[t]||(r.megaStateDescriptor.attachmentsState[t]=Ke(void 0,h))}));var p,d,v=(p=null!==(n=r.topology)&&void 0!==n?n:he.TRIANGLES,d=r.megaStateDescriptor,{topology:ir(p),cullMode:or(d.cullMode),frontFace:ar(d.frontFace)}),g=hr(r.colorAttachmentFormats,r.megaStateDescriptor),m=function(e,t){if(!H(e))return{format:Qn(e),depthWriteEnabled:!!t.depthWrite,depthCompare:pr(t.depthCompare),depthBias:t.polygonOffset?t.polygonOffsetUnits:0,depthBiasSlopeScale:t.polygonOffset?t.polygonOffsetFactor:0,stencilFront:{compare:pr(t.stencilFront.compare),passOp:dr(t.stencilFront.passOp),failOp:dr(t.stencilFront.failOp),depthFailOp:dr(t.stencilFront.depthFailOp)},stencilBack:{compare:pr(t.stencilBack.compare),passOp:dr(t.stencilBack.passOp),failOp:dr(t.stencilBack.failOp),depthFailOp:dr(t.stencilBack.depthFailOp)},stencilReadMask:4294967295,stencilWriteMask:4294967295}}(r.depthStencilAttachmentFormat,r.megaStateDescriptor),y=void 0;null!==r.inputLayout&&(y=r.inputLayout.buffers);var _=r.sampleCount,b={layout:"auto",vertex:q(q({},o),{buffers:y}),primitive:v,depthStencil:m,multisample:{count:_},fragment:q(q({},a),{targets:g})};e.gpuRenderPipeline=this.device.createRenderPipeline(b)}}},e.prototype.createReadback=function(){return new wr({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderBundle=function(){return new Ir({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(e){var t=this.renderPassPool.pop();void 0===t&&(t=new Mr(this));var n=this.frameCommandEncoderPool.pop();return void 0===n&&(n=this.device.createCommandEncoder()),t.beginRenderPass(n,e),t},e.prototype.createComputePass=function(){var e=this.computePassPool.pop();void 0===e&&(e=new Tr);var t=this.frameCommandEncoderPool.pop();return void 0===t&&(t=this.device.createCommandEncoder()),e.beginComputePass(t),e},e.prototype.submitPass=function(e){var t=e;t instanceof Mr?(this.frameCommandEncoderPool.push(t.frameCommandEncoder),t.finish(),this.renderPassPool.push(t)):t instanceof Tr&&(this.frameCommandEncoderPool.push(t.frameCommandEncoder),t.finish(),this.computePassPool.push(t))},e.prototype.copySubTexture2D=function(e,t,n,r,i,o,a){var s=this.device.createCommandEncoder(),u=e,l=r,c={texture:l.gpuTexture,origin:[i,o,0],mipLevel:0,aspect:"all"},f={texture:u.gpuTexture,origin:[t,n,0],mipLevel:0,aspect:"all"};De(!!(l.usage&Vn.COPY_SRC)),De(!!(u.usage&Vn.COPY_DST)),s.copyTextureToTexture(c,f,[l.width,l.height,a||1]),this.device.queue.submit([s.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(e,t,n){if(function(e){switch(Oe(e)){case Se.BC1:case Se.BC2:case Se.BC3:case Se.BC4_SNORM:case Se.BC4_UNORM:case Se.BC5_SNORM:case Se.BC5_UNORM:return!0;default:return!1}}(e)){if(!this.featureTextureCompressionBC)return!1;var r=function(e){switch(Oe(e)){case Se.BC1:case Se.BC2:case Se.BC3:case Se.BC4_SNORM:case Se.BC4_UNORM:case Se.BC5_SNORM:case Se.BC5_UNORM:return 4;default:return 1}}(e);return t%r==0&&n%r==0&&this.featureTextureCompressionBC}switch(e){case we.U16_RGBA_NORM:case we.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(e){return e.descriptor},e.prototype.queryRenderTarget=function(e){return e},e.prototype.setResourceName=function(e,t){if(e.name=t,e.type===re.Buffer)(n=e).gpuBuffer.label=t;else if(e.type===re.Texture){(n=e).gpuTexture.label=t,n.gpuTextureView.label=t}else if(e.type===re.RenderTarget){(n=e).gpuTexture.label=t,n.gpuTextureView.label=t}else if(e.type===re.Sampler){(n=e).gpuSampler.label=t}else if(e.type===re.RenderPipeline){var n;null!==(n=e).gpuRenderPipeline&&(n.gpuRenderPipeline.label=t)}},e.prototype.setResourceLeakCheck=function(e,t){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(e){},e.prototype.pipelineQueryReady=function(e){return null!==e.gpuRenderPipeline},e.prototype.pipelineForceReady=function(e){var t=e;this.createRenderPipelineInternal(t,!1)},e}(),Nr=function(){function e(e){this.pluginOptions=e}return e.prototype.createSwapChain=function(e){return Q(this,void 0,void 0,(function(){var t,n,r,i,o,a,s;return $(this,(function(u){switch(u.label){case 0:if(void 0===globalThis.navigator.gpu)return[2,null];t=null,u.label=1;case 1:return u.trys.push([1,3,,4]),n=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:n})];case 2:return t=u.sent(),[3,4];case 3:return r=u.sent(),console.log(r),[3,4];case 4:return null===t?[2,null]:(i=["depth32float-stencil8","texture-compression-bc","float32-filterable"].filter((function(e){return t.features.has(e)})),[4,t.requestDevice({requiredFeatures:i})]);case 5:if((o=u.sent())&&(a=this.pluginOptions.onContextLost,o.lost.then((function(){a&&a()}))),null===o)return[2,null];if(!(s=e.getContext("webgpu")))return[2,null];u.label=6;case 6:return u.trys.push([6,8,,9]),[4,qn(this.pluginOptions.shaderCompilerPath)];case 7:case 8:return u.sent(),[3,9];case 9:return[2,new Pr(t,o,e,s,Gn,Hn&&new Hn)]}}))}))},e}(),Br=n(7193),Dr=Br.rU.isPlainObject,Ur=Br.rU.isTypedArray,Fr=function(){function e(t,n){p()(this,e),m()(this,"reGl",void 0),m()(this,"destroyed",!1),m()(this,"drawCommand",void 0),m()(this,"drawParams",void 0),m()(this,"options",void 0),m()(this,"uniforms",{}),this.reGl=t;var r=n.vs,i=n.fs,o=n.attributes,a=n.uniforms,s=n.primitive,u=n.count,l=n.elements,c=n.depth,f=n.cull,h=n.instances,d={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:Ee.LOWER_LEFT,clipSpaceNearZ:Te.NEGATIVE_ONE,supportMRT:!1},v={};this.options=n,a&&(this.uniforms=this.extractUniforms(a),Object.keys(a).forEach((function(e){v[e]=t.prop(e)})));var g={};Object.keys(o).forEach((function(e){g[e]=o[e].get()}));var y=(0,_.removeDuplicateUniforms)(jt(d,"frag",i,null,!1)),b=(0,_.removeDuplicateUniforms)(jt(d,"vert",r,null,!1)),x={attributes:g,frag:y,uniforms:v,vert:b,colorMask:t.prop("colorMask"),lineWidth:1,blend:{enable:t.prop("blend.enable"),func:t.prop("blend.func"),equation:t.prop("blend.equation"),color:t.prop("blend.color")},stencil:{enable:t.prop("stencil.enable"),mask:t.prop("stencil.mask"),func:t.prop("stencil.func"),opFront:t.prop("stencil.opFront"),opBack:t.prop("stencil.opBack")},primitive:S[void 0===s?_.gl.TRIANGLES:s]};h&&(x.instances=h),u?x.count=u:l&&(x.elements=l.get()),this.initDepthDrawParams({depth:c},x),this.initCullDrawParams({cull:f},x),this.drawCommand=t(x),this.drawParams=x}return v()(e,[{key:"updateAttributesAndElements",value:function(e,t){var n={};Object.keys(e).forEach((function(t){n[t]=e[t].get()})),this.drawParams.attributes=n,this.drawParams.elements=t.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(e){var t={};Object.keys(e).forEach((function(n){t[n]=e[n].get()})),this.drawParams.attributes=t,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(e){this.uniforms=o()(o()({},this.uniforms),this.extractUniforms(e))}},{key:"draw",value:function(e,t){if(!this.drawParams.attributes||0!==Object.keys(this.drawParams.attributes).length){var n=o()(o()({},this.uniforms),this.extractUniforms(e.uniforms||{})),r={};Object.keys(n).forEach((function(e){var t=j()(n[e]);"boolean"===t||"number"===t||Array.isArray(n[e])||n[e].BYTES_PER_ELEMENT?r[e]=n[e]:r[e]=n[e].get()})),r.blend=t?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(e),r.stencil=this.getStencilDrawParams(e),r.colorMask=this.getColorMaskDrawParams(e,t),this.drawCommand(r)}}},{key:"destroy",value:function(){var e;null===(e=this.drawParams)||void 0===e||null===(e=e.elements)||void 0===e||e.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach((function(e){null==e||e.destroy()})),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(e,t){var n=e.depth;n&&(t.depth={enable:void 0===n.enable||!!n.enable,mask:void 0===n.mask||!!n.mask,func:I[n.func||_.gl.LESS],range:n.range||[0,1]})}},{key:"getBlendDrawParams",value:function(e){var t=e.blend||{},n=t.enable,r=t.func,i=t.equation,o=t.color,a=void 0===o?[0,0,0,0]:o;return{enable:!!n,func:{srcRGB:N[r&&r.srcRGB||_.gl.SRC_ALPHA],srcAlpha:N[r&&r.srcAlpha||_.gl.SRC_ALPHA],dstRGB:N[r&&r.dstRGB||_.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:N[r&&r.dstAlpha||_.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:P[i&&i.rgb||_.gl.FUNC_ADD],alpha:P[i&&i.alpha||_.gl.FUNC_ADD]},color:a}}},{key:"getStencilDrawParams",value:function(e){var t=e.stencil||{},n=t.enable,r=t.mask,i=void 0===r?-1:r,a=t.func,s=void 0===a?{cmp:_.gl.ALWAYS,ref:0,mask:-1}:a,u=t.opFront,l=void 0===u?{fail:_.gl.KEEP,zfail:_.gl.KEEP,zpass:_.gl.KEEP}:u,c=t.opBack,f=void 0===c?{fail:_.gl.KEEP,zfail:_.gl.KEEP,zpass:_.gl.KEEP}:c;return{enable:!!n,mask:i,func:o()(o()({},s),{},{cmp:B[s.cmp]}),opFront:{fail:D[l.fail],zfail:D[l.zfail],zpass:D[l.zpass]},opBack:{fail:D[f.fail],zfail:D[f.zfail],zpass:D[f.zpass]}}}},{key:"getColorMaskDrawParams",value:function(e,t){var n=e.stencil;return null!=n&&n.enable&&n.opFront&&!t?[!1,!1,!1,!1]:[!0,!0,!0,!0]}},{key:"initCullDrawParams",value:function(e,t){var n=e.cull;if(n){var r=n.enable,i=n.face,o=void 0===i?_.gl.BACK:i;t.cull={enable:!!r,face:U[o]}}}},{key:"extractUniforms",value:function(e){var t=this,n={};return Object.keys(e).forEach((function(r){t.extractUniformsRecursively(r,e[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(e,t,n,r){var i=this;null===t||"number"==typeof t||"boolean"==typeof t||Array.isArray(t)&&"number"==typeof t[0]||Ur(t)||""===t||"resize"in t?n["".concat(r&&r+".").concat(e)]=t:(Dr(t)&&Object.keys(t).forEach((function(o){i.extractUniformsRecursively(o,t[o],n,"".concat(r&&r+".").concat(e))})),Array.isArray(t)&&t.forEach((function(t,o){Object.keys(t).forEach((function(a){i.extractUniformsRecursively(a,t[a],n,"".concat(r&&r+".").concat(e,"[").concat(o,"]"))}))})))}}]),e}(),zr=function(){function e(t,n){p()(this,e),m()(this,"texture",void 0),m()(this,"width",void 0),m()(this,"height",void 0),m()(this,"isDestroy",!1);var r=n.data,i=n.type,o=void 0===i?_.gl.UNSIGNED_BYTE:i,a=n.width,s=n.height,u=n.flipY,l=void 0!==u&&u,c=n.format,f=void 0===c?_.gl.RGBA:c,h=n.mipmap,d=void 0!==h&&h,v=n.wrapS,g=void 0===v?_.gl.CLAMP_TO_EDGE:v,y=n.wrapT,b=void 0===y?_.gl.CLAMP_TO_EDGE:y,x=n.aniso,E=void 0===x?0:x,T=n.alignment,A=void 0===T?1:T,S=n.premultiplyAlpha,C=void 0!==S&&S,I=n.mag,P=void 0===I?_.gl.NEAREST:I,N=n.min,B=void 0===N?_.gl.NEAREST:N,D=n.colorSpace,U=void 0===D?_.gl.BROWSER_DEFAULT_WEBGL:D,F=n.x,z=void 0===F?0:F,G=n.y,V=void 0===G?0:G,j=n.copy,H=void 0!==j&&j;this.width=a,this.height=s;var W={width:a,height:s,type:R[o],format:w[f],wrapS:L[g],wrapT:L[b],mag:k[P],min:k[B],alignment:A,flipY:l,colorSpace:O[U],premultiplyAlpha:C,aniso:E,x:z,y:V,copy:H};r&&(W.data=r),"number"==typeof d?W.mipmap=M[d]:"boolean"==typeof d&&(W.mipmap=d),this.texture=t.texture(W)}return v()(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.texture(e)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.texture.resize(t,n),this.width=t,this.height=n}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){var e;this.isDestroy||(null===(e=this.texture)||void 0===e||e.destroy());this.isDestroy=!0}}]),e}(),Gr=function(){function e(){var t=this;p()(this,e),m()(this,"uniformBuffers",[]),m()(this,"extensionObject",void 0),m()(this,"gl",void 0),m()(this,"$container",void 0),m()(this,"canvas",void 0),m()(this,"width",void 0),m()(this,"height",void 0),m()(this,"isDirty",void 0),m()(this,"queryVerdorInfo",(function(){return"WebGL1"})),m()(this,"createModel",(function(e){return new Fr(t.gl,e)})),m()(this,"createAttribute",(function(e){return new A(t.gl,e)})),m()(this,"createBuffer",(function(e){return new F(t.gl,e)})),m()(this,"createElements",(function(e){return new z(t.gl,e)})),m()(this,"createTexture2D",(function(e){return new zr(t.gl,e)})),m()(this,"createFramebuffer",(function(e){return new G(t.gl,e)})),m()(this,"useFramebuffer",(function(e,n){t.gl({framebuffer:e?e.get():null})(n)})),m()(this,"useFramebufferAsync",function(){var e=f()(l()().mark((function e(n,r){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.gl({framebuffer:n?n.get():null})(r);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),m()(this,"clear",(function(e){var n,r=e.color,i=e.depth,o=e.stencil,a=e.framebuffer,s=void 0===a?null:a,u={color:r,depth:i,stencil:o};u.framebuffer=null===s?s:s.get(),null===(n=t.gl)||void 0===n||n.clear(u)})),m()(this,"viewport",(function(e){var n=e.x,r=e.y,i=e.width,o=e.height;t.gl._gl.viewport(n,r,i,o),t.width=i,t.height=o,t.gl._refresh()})),m()(this,"readPixels",(function(e){var n=e.framebuffer,r={x:e.x,y:e.y,width:e.width,height:e.height};return n&&(r.framebuffer=n.get()),t.gl.read(r)})),m()(this,"readPixelsAsync",function(){var e=f()(l()().mark((function e(n){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.readPixels(n));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m()(this,"getViewportSize",(function(){return{width:t.gl._gl.drawingBufferWidth,height:t.gl._gl.drawingBufferHeight}})),m()(this,"getContainer",(function(){var e;return null===(e=t.canvas)||void 0===e?void 0:e.parentElement})),m()(this,"getCanvas",(function(){return t.canvas})),m()(this,"getGLContext",(function(){return t.gl._gl})),m()(this,"destroy",(function(){var e;t.canvas=null,null===(e=t.gl)||void 0===e||null===(e=e._gl)||void 0===e||null===(e=e.getExtension("WEBGL_lose_context"))||void 0===e||e.loseContext(),t.gl.destroy(),t.gl=null}))}var t;return v()(e,[{key:"init",value:(t=f()(l()().mark((function e(t,n,r){var i=this;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.canvas=t,!r){e.next=5;break}this.gl=r,e.next=8;break;case 5:return e.next=7,new Promise((function(e,t){T()({canvas:i.canvas,attributes:{alpha:!0,antialias:n.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,stencil:n.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(n,r){!n&&r||t(n),e(r)}})}));case 7:this.gl=e.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return e.stop()}}),e,this)}))),function(e,n,r){return t.apply(this,arguments)})},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(e){return!!this.getGLContext().getExtension(e)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var e=this.getGLContext();e.disable(e.CULL_FACE)}},{key:"setDirty",value:function(e){this.isDirty=e}},{key:"getDirty",value:function(){return this.isDirty}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),e}(),Vr=function(){function e(t,n){p()(this,e),m()(this,"attribute",void 0),m()(this,"buffer",void 0);var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor,l=n.shaderLocation;this.buffer=r,this.attribute={shaderLocation:l,buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return v()(e,[{key:"get",value:function(){return this.buffer}},{key:"updateBuffer",value:function(e){this.buffer.subData(e)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),jr=m()(m()(m()(m()(m()(m()({},_.gl.FLOAT,Float32Array),_.gl.UNSIGNED_BYTE,Uint8Array),_.gl.SHORT,Int16Array),_.gl.UNSIGNED_SHORT,Uint16Array),_.gl.INT,Int32Array),_.gl.UNSIGNED_INT,Uint32Array),Hr=m()(m()(m()(m()(m()(m()(m()({},_.gl.POINTS,he.POINTS),_.gl.LINES,he.LINES),_.gl.LINE_LOOP,he.LINES),_.gl.LINE_STRIP,he.LINE_STRIP),_.gl.TRIANGLES,he.TRIANGLES),_.gl.TRIANGLE_FAN,he.TRIANGLES),_.gl.TRIANGLE_STRIP,he.TRIANGLE_STRIP),Wr=m()(m()(m()(m()({},1,we.F32_R),2,we.F32_RG),3,we.F32_RGB),4,we.F32_RGBA),Xr=m()(m()(m()({},_.gl.STATIC_DRAW,de.STATIC),_.gl.DYNAMIC_DRAW,de.DYNAMIC),_.gl.STREAM_DRAW,de.DYNAMIC),Zr=m()(m()(m()({},_.gl.REPEAT,le.REPEAT),_.gl.CLAMP_TO_EDGE,le.CLAMP_TO_EDGE),_.gl.MIRRORED_REPEAT,le.MIRRORED_REPEAT),Yr=m()(m()(m()(m()(m()(m()(m()(m()({},_.gl.NEVER,ie.NEVER),_.gl.ALWAYS,ie.ALWAYS),_.gl.LESS,ie.LESS),_.gl.LEQUAL,ie.LEQUAL),_.gl.GREATER,ie.GREATER),_.gl.GEQUAL,ie.GEQUAL),_.gl.EQUAL,ie.EQUAL),_.gl.NOTEQUAL,ie.NOTEQUAL),qr=m()(m()({},_.gl.FRONT,ae.FRONT),_.gl.BACK,ae.BACK),Kr=m()(m()(m()(m()(m()({},_.gl.FUNC_ADD,ue.ADD),_.gl.MIN_EXT,ue.MIN),_.gl.MAX_EXT,ue.MAX),_.gl.FUNC_SUBTRACT,ue.SUBSTRACT),_.gl.FUNC_REVERSE_SUBTRACT,ue.REVERSE_SUBSTRACT),Qr=(_r={},m()(m()(m()(m()(m()(m()(m()(m()(m()(m()(_r,_.gl.ZERO,se.ZERO),_.gl.ONE,se.ONE),_.gl.SRC_COLOR,se.SRC),_.gl.ONE_MINUS_SRC_COLOR,se.ONE_MINUS_SRC),_.gl.SRC_ALPHA,se.SRC_ALPHA),_.gl.ONE_MINUS_SRC_ALPHA,se.ONE_MINUS_SRC_ALPHA),_.gl.DST_COLOR,se.DST),_.gl.ONE_MINUS_DST_COLOR,se.ONE_MINUS_DST),_.gl.DST_ALPHA,se.DST_ALPHA),_.gl.ONE_MINUS_DST_ALPHA,se.ONE_MINUS_DST_ALPHA),m()(m()(m()(m()(m()(_r,_.gl.CONSTANT_COLOR,se.CONST),_.gl.ONE_MINUS_CONSTANT_COLOR,se.ONE_MINUS_CONSTANT),_.gl.CONSTANT_ALPHA,se.CONST),_.gl.ONE_MINUS_CONSTANT_ALPHA,se.ONE_MINUS_CONSTANT),_.gl.SRC_ALPHA_SATURATE,se.SRC_ALPHA_SATURATE)),$r=m()(m()(m()(m()(m()(m()(m()(m()({},_.gl.REPLACE,be.REPLACE),_.gl.KEEP,be.KEEP),_.gl.ZERO,be.ZERO),_.gl.INVERT,be.INVERT),_.gl.INCR,be.INCREMENT_CLAMP),_.gl.DECR,be.DECREMENT_CLAMP),_.gl.INCR_WRAP,be.INCREMENT_WRAP),_.gl.DECR_WRAP,be.DECREMENT_WRAP),Jr=m()(m()(m()(m()(m()(m()(m()(m()({},_.gl.ALWAYS,ie.ALWAYS),_.gl.EQUAL,ie.EQUAL),_.gl.GEQUAL,ie.GEQUAL),_.gl.GREATER,ie.GREATER),_.gl.LEQUAL,ie.LEQUAL),_.gl.LESS,ie.LESS),_.gl.NEVER,ie.NEVER),_.gl.NOTEQUAL,ie.NOTEQUAL),ei={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function ti(e){return Object.prototype.toString.call(e)in ei}var ni=function(){function e(t,n){p()(this,e),m()(this,"buffer",void 0),m()(this,"isDestroyed",!1),m()(this,"type",void 0),m()(this,"size",void 0);var r,i=n.data,o=n.usage,a=n.type,s=n.isUBO,u=n.label;r=ti(i)?i:new jr[this.type||_.gl.FLOAT](i),this.type=a,this.size=r.byteLength,this.buffer=t.createBuffer({viewOrSize:r,usage:s?pe.UNIFORM:pe.VERTEX,hint:Xr[o||_.gl.STATIC_DRAW]}),u&&t.setResourceName(this.buffer,u)}return v()(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(e){var t,n=e.data,r=e.offset;t=ti(n)?n:new jr[this.type||_.gl.FLOAT](n),this.buffer.setSubData(r,new Uint8Array(t.buffer))}}]),e}(),ri=n(2729),ii=n.n(ri);function oi(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e+=t,e+=e<<10,(e+=e>>>6)>>>0}function ai(e){return e+=e<<3,e^=e>>>11,(e+=e<<15)>>>0}function si(){return 0}var ui=v()((function e(){p()(this,e),m()(this,"keys",[]),m()(this,"values",[])})),li=function(){function e(t,n){p()(this,e),m()(this,"buckets",new Map),this.keyEqualFunc=t,this.keyHashFunc=n}return v()(e,[{key:"findBucketIndex",value:function(e,t){for(var n=0;n<e.keys.length;n++)if(this.keyEqualFunc(t,e.keys[n]))return n;return-1}},{key:"findBucket",value:function(e){var t=this.keyHashFunc(e);return this.buckets.get(t)}},{key:"get",value:function(e){var t=this.findBucket(e);if(void 0===t)return null;var n=this.findBucketIndex(t,e);return n<0?null:t.values[n]}},{key:"add",value:function(e,t){var n=this.keyHashFunc(e);void 0===this.buckets.get(n)&&this.buckets.set(n,new ui);var r=this.buckets.get(n);r.keys.push(e),r.values.push(t)}},{key:"delete",value:function(e){var t=this.findBucket(e);if(void 0!==t){var n=this.findBucketIndex(t,e);-1!==n&&(t.keys.splice(n,1),t.values.splice(n,1))}}},{key:"clear",value:function(){this.buckets.clear()}},{key:"size",value:function(){var e,t=0,n=ii()(this.buckets.values());try{for(n.s();!(e=n.n()).done;){t+=e.value.values.length}}catch(e){n.e(e)}finally{n.f()}return t}},{key:"values",value:l()().mark((function e(){var t,n,r,i;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=ii()(this.buckets.values()),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=14;break}r=n.value,i=r.values.length-1;case 6:if(!(i>=0)){e.next=12;break}return e.next=9,r.values[i];case 9:i--,e.next=6;break;case 12:e.next=3;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),t.e(e.t0);case 19:return e.prev=19,t.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,this,[[1,16,19,22]])}))}]),e}();function ci(e,t){return e=oi(e,t.blendMode),e=oi(e,t.blendSrcFactor),e=oi(e,t.blendDstFactor)}function fi(e,t){return e=ci(e,t.rgbBlendState),e=oi(e=ci(e,t.alphaBlendState),t.channelWriteMask)}function hi(e,t){for(var n,r,i,o,a,s,u,l,c=0;c<t.attachmentsState.length;c++)e=fi(e,t.attachmentsState[c]);return e=function(e,t){return oi(e,t.r<<24|t.g<<16|t.b<<8|t.a)}(e,t.blendConstant||je),e=oi(e,t.depthCompare),e=oi(e,t.depthWrite?1:0),e=oi(e,null===(n=t.stencilFront)||void 0===n?void 0:n.compare),e=oi(e,null===(r=t.stencilFront)||void 0===r?void 0:r.passOp),e=oi(e,null===(i=t.stencilFront)||void 0===i?void 0:i.failOp),e=oi(e,null===(o=t.stencilFront)||void 0===o?void 0:o.depthFailOp),e=oi(e,null===(a=t.stencilBack)||void 0===a?void 0:a.compare),e=oi(e,null===(s=t.stencilBack)||void 0===s?void 0:s.passOp),e=oi(e,null===(u=t.stencilBack)||void 0===u?void 0:u.failOp),e=oi(e,null===(l=t.stencilBack)||void 0===l?void 0:l.depthFailOp),e=oi(e,t.stencilWrite?1:0),e=oi(e,t.cullMode),e=oi(e,t.frontFace?1:0),e=oi(e,t.polygonOffset?1:0)}function pi(e){var t=0;t=oi(t,e.program.id),null!==e.inputLayout&&(t=oi(t,e.inputLayout.id)),t=hi(t,e.megaStateDescriptor);for(var n=0;n<e.colorAttachmentFormats.length;n++)t=oi(t,e.colorAttachmentFormats[n]||0);return ai(t=oi(t,e.depthStencilAttachmentFormat||0))}function di(e){var t=0;if(e.samplerBindings)for(var n=0;n<e.samplerBindings.length;n++){var r=e.samplerBindings[n];null!==r&&null!==r.texture&&(t=oi(t,r.texture.id))}if(e.uniformBufferBindings)for(var i=0;i<e.uniformBufferBindings.length;i++){var o=e.uniformBufferBindings[i];null!==o&&null!==o.buffer&&(t=oi(t,o.buffer.id),t=oi(t,o.binding),t=oi(t,o.offset),t=oi(t,o.size))}if(e.storageBufferBindings)for(var a=0;a<e.storageBufferBindings.length;a++){var s=e.storageBufferBindings[a];null!==s&&null!==s.buffer&&(t=oi(t,s.buffer.id),t=oi(t,s.binding),t=oi(t,s.offset),t=oi(t,s.size))}if(e.storageTextureBindings)for(var u=0;u<e.storageTextureBindings.length;u++){var l=e.storageTextureBindings[u];null!==l&&null!==l.texture&&(t=oi(t,l.texture.id),t=oi(t,l.binding))}return ai(t)}function vi(e,t){var n,r,i,o;return(null===(n=e.vertex)||void 0===n?void 0:n.glsl)===(null===(r=t.vertex)||void 0===r?void 0:r.glsl)&&(null===(i=e.fragment)||void 0===i?void 0:i.glsl)===(null===(o=t.fragment)||void 0===o?void 0:o.glsl)}var gi=function(){function e(t){p()(this,e),m()(this,"bindingsCache",new li(ut,di)),m()(this,"renderPipelinesCache",new li(dt,pi)),m()(this,"inputLayoutsCache",new li(mt,si)),m()(this,"programCache",new li(vi,si)),this.device=t}return v()(e,[{key:"createBindings",value:function(e){var t,n=this.bindingsCache.get(e);if(null===n){var r,i={samplerBindings:(t=e).samplerBindings&&it(t.samplerBindings,yt),uniformBufferBindings:t.uniformBufferBindings&&it(t.uniformBufferBindings,_t),storageBufferBindings:t.storageBufferBindings&&it(t.storageBufferBindings,_t),storageTextureBindings:t.storageTextureBindings&&it(t.storageTextureBindings,bt),pipeline:t.pipeline};i.uniformBufferBindings=null===(r=i.uniformBufferBindings)||void 0===r?void 0:r.filter((function(e){var t=e.size;return t&&t>0})),n=this.device.createBindings(i),this.bindingsCache.add(i,n)}return n}},{key:"createRenderPipeline",value:function(e){var t,n,r,i,o=this.renderPipelinesCache.get(e);if(null===o){var a=(n=(t=e).inputLayout,r=t.program,i=t.topology,{inputLayout:n,megaStateDescriptor:t.megaStateDescriptor&&$e(t.megaStateDescriptor),program:r,topology:i,colorAttachmentFormats:t.colorAttachmentFormats.slice(),depthStencilAttachmentFormat:t.depthStencilAttachmentFormat,sampleCount:t.sampleCount});a.colorAttachmentFormats=a.colorAttachmentFormats.filter((function(e){return e})),o=this.device.createRenderPipeline(a),this.renderPipelinesCache.add(a,o)}return o}},{key:"createInputLayout",value:function(e){e.vertexBufferDescriptors=e.vertexBufferDescriptors.filter((function(e){return!!e}));var t,n=this.inputLayoutsCache.get(e);if(null===n){var r={vertexBufferDescriptors:it((t=e).vertexBufferDescriptors,Et),indexBufferFormat:t.indexBufferFormat,program:t.program};n=this.device.createInputLayout(r),this.inputLayoutsCache.add(r,n)}return n}},{key:"createProgram",value:function(e){var t,n,r,i=this.programCache.get(e);if(null===i){var o={vertex:{glsl:null===(n=(t=e).vertex)||void 0===n?void 0:n.glsl},fragment:{glsl:null===(r=t.fragment)||void 0===r?void 0:r.glsl}};i=this.device.createProgram(e),this.programCache.add(o,i)}return i}},{key:"destroy",value:function(){var e,t=ii()(this.bindingsCache.values());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(e){t.e(e)}finally{t.f()}var n,r=ii()(this.renderPipelinesCache.values());try{for(r.s();!(n=r.n()).done;){n.value.destroy()}}catch(e){r.e(e)}finally{r.f()}var i,o=ii()(this.inputLayoutsCache.values());try{for(o.s();!(i=o.n()).done;){i.value.destroy()}}catch(e){o.e(e)}finally{o.f()}var a,s=ii()(this.programCache.values());try{for(s.s();!(a=s.n()).done;){a.value.destroy()}}catch(e){s.e(e)}finally{s.f()}this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear()}}]),e}(),mi=function(){function e(t,n){p()(this,e),m()(this,"indexBuffer",void 0),m()(this,"type",void 0),m()(this,"count",void 0);var r,i=n.data,o=n.type,a=n.count,s=void 0===a?0:a;r=ti(i)?i:new jr[this.type||_.gl.UNSIGNED_INT](i),this.type=o,this.count=s,this.indexBuffer=t.createBuffer({viewOrSize:r,usage:pe.INDEX})}return v()(e,[{key:"get",value:function(){return this.indexBuffer}},{key:"subData",value:function(e){var t,n=e.data;t=ti(n)?n:new jr[this.type||_.gl.UNSIGNED_INT](n),this.indexBuffer.setSubData(0,new Uint8Array(t.buffer))}},{key:"destroy",value:function(){this.indexBuffer.destroy()}}]),e}();function yi(e){return!(!e||!e.texture)}var _i=function(){function e(t,n){p()(this,e),m()(this,"texture",void 0),m()(this,"sampler",void 0),m()(this,"width",void 0),m()(this,"height",void 0),m()(this,"isDestroy",!1),this.device=t,this.options=n;var r=n.wrapS,i=void 0===r?_.gl.CLAMP_TO_EDGE:r,o=n.wrapT,a=void 0===o?_.gl.CLAMP_TO_EDGE:o,s=n.aniso,u=n.mag,l=void 0===u?_.gl.NEAREST:u,c=n.min,f=void 0===c?_.gl.NEAREST:c;this.createTexture(n),this.sampler=t.createSampler({addressModeU:Zr[i],addressModeV:Zr[a],minFilter:f===_.gl.NEAREST?ce.POINT:ce.BILINEAR,magFilter:l===_.gl.NEAREST?ce.POINT:ce.BILINEAR,mipmapFilter:fe.NO_MIP,maxAnisotropy:s})}return v()(e,[{key:"createTexture",value:function(e){var t=e.type,n=void 0===t?_.gl.UNSIGNED_BYTE:t,r=e.width,i=e.height,o=e.flipY,a=void 0!==o&&o,s=e.format,u=void 0===s?_.gl.RGBA:s,l=e.alignment,c=void 0===l?1:l,f=e.usage,h=void 0===f?_.TextureUsage.SAMPLED:f,p=e.unorm,d=void 0!==p&&p,v=e.label,g=e.data;this.width=r,this.height=i;var m=we.U8_RGBA_RT;if(n===_.gl.UNSIGNED_BYTE&&u===_.gl.RGBA)m=d?we.U8_RGBA_NORM:we.U8_RGBA_RT;else if(n===_.gl.UNSIGNED_BYTE&&u===_.gl.LUMINANCE)m=we.U8_LUMINANCE;else if(n===_.gl.FLOAT&&u===_.gl.LUMINANCE)m=we.F32_LUMINANCE;else if(n===_.gl.FLOAT&&u===_.gl.RGB)"WebGPU"===this.device.queryVendorInfo().platformString?(g&&(g=function(e,t){for(var n=e.length,r=n+Math.ceil(n/3),i=new Float32Array(r),o=0;o<r;o+=4)i[o]=e[o/4*3],i[o+1]=e[o/4*3+1],i[o+2]=e[o/4*3+2],i[o+3]=t;return i}(g,0)),m=we.F32_RGBA):m=we.F32_RGB;else if(n===_.gl.FLOAT&&u===_.gl.RGBA)m=we.F32_RGBA;else{if(n!==_.gl.FLOAT||u!==_.gl.RED)throw new Error("create texture error, type: ".concat(n,", format: ").concat(u));m=we.F32_R}this.texture=this.device.createTexture({format:m,width:r,height:i,usage:h===_.TextureUsage.SAMPLED?ye.SAMPLED:ye.RENDER_TARGET,pixelStore:{unpackFlipY:a,packAlignment:c},mipLevelCount:1}),v&&this.device.setResourceName(this.texture,v),g&&this.texture.setImageData([g])}},{key:"get",value:function(){return this.texture}},{key:"update",value:function(e){var t=e.data;this.texture.setImageData([t])}},{key:"bind",value:function(){}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.width===t&&this.height===n||this.destroy(),this.options.width=t,this.options.height=n,this.createTexture(this.options),this.isDestroy=!1}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){var e;this.isDestroy||this.texture.destroyed||(null===(e=this.texture)||void 0===e||e.destroy());this.isDestroy=!0}}]),e}(),bi=function(){function e(t,n){p()(this,e),m()(this,"colorRenderTarget",void 0),m()(this,"colorTexture",void 0),m()(this,"depthRenderTarget",void 0),m()(this,"depthTexture",void 0),m()(this,"width",void 0),m()(this,"height",void 0),this.device=t,this.options=n,this.createColorRenderTarget(),this.createDepthRenderTarget()}return v()(e,[{key:"createColorRenderTarget",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.options,n=t.width,r=t.height,i=t.color;i&&(yi(i)?(e&&i.resize({width:n,height:r}),this.colorTexture=i.get(),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=i.width,this.height=i.height):n&&r&&(this.colorTexture=this.device.createTexture({format:we.U8_RGBA_RT,usage:ye.RENDER_TARGET,width:n,height:r}),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=n,this.height=r))}},{key:"createDepthRenderTarget",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.options,n=t.width,r=t.height,i=t.depth;i&&(yi(i)?(e&&i.resize({width:n,height:r}),this.depthTexture=i.get(),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=i.width,this.height=i.height):n&&r&&(this.depthTexture=this.device.createTexture({format:we.D24_S8,usage:ye.RENDER_TARGET,width:n,height:r}),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=n,this.height=r))}},{key:"get",value:function(){return this.colorRenderTarget}},{key:"destroy",value:function(){var e,t;null===(e=this.colorRenderTarget)||void 0===e||e.destroy(),null===(t=this.depthRenderTarget)||void 0===t||t.destroy()}},{key:"resize",value:function(e){var t=e.width,n=e.height;this.width===t&&this.height===n||(this.destroy(),this.colorTexture.destroyed=!0,this.depthTexture.destroyed=!0,this.options.width=t,this.options.height=n,this.createColorRenderTarget(!0),this.createDepthRenderTarget(!0))}}]),e}(),xi=Br.rU.isPlainObject,Ei=Br.rU.isTypedArray,Ti=Br.rU.isNil,Ai=function(){function e(t,n,r){var i=this;p()(this,e),m()(this,"destroyed",!1),m()(this,"uniforms",{}),m()(this,"program",void 0),m()(this,"inputLayout",void 0),m()(this,"pipeline",void 0),m()(this,"indexBuffer",void 0),m()(this,"vertexBuffers",[]),m()(this,"bindings",void 0),this.device=t,this.options=n,this.service=r;var o=n.vs,a=n.fs,s=n.attributes,u=n.uniforms,l=n.count,c=n.elements,f=n.diagnosticDerivativeUniformityEnabled;this.options=n;var h=f?"":this.service.viewportOrigin===Ee.UPPER_LEFT?"diagnostic(off,derivative_uniformity);":"";this.program=r.renderCache.createProgram({vertex:{glsl:o},fragment:{glsl:a,postprocess:function(e){return h+e}}}),u&&(this.uniforms=this.extractUniforms(u));var d=[],v=0;Object.keys(s).forEach((function(e){var t=s[e],n=t.get();i.vertexBuffers.push(n.get());var r=t.attribute,o=r.offset,a=void 0===o?0:o,u=r.stride,l=void 0===u?0:u,c=r.size,f=void 0===c?1:c,h=r.divisor,p=void 0===h?0:h,g=r.shaderLocation,m=void 0===g?0:g;d.push({arrayStride:l||4*f,stepMode:ve.VERTEX,attributes:[{format:Wr[f],shaderLocation:m,offset:a,divisor:p}]}),v=n.size/f})),l||(this.options.count=v),c&&(this.indexBuffer=c.get());var g=r.renderCache.createInputLayout({vertexBufferDescriptors:d,indexBufferFormat:c?we.U32_R:null,program:this.program});this.inputLayout=g,this.pipeline=this.createPipeline(n)}return v()(e,[{key:"createPipeline",value:function(e,t){var n,r=e.primitive,i=void 0===r?_.gl.TRIANGLES:r,o=e.depth,a=e.cull,s=e.blend,u=e.stencil,l=this.initDepthDrawParams({depth:o}),c=!(!l||!l.enable),f=this.initCullDrawParams({cull:a}),h=!(!f||!f.enable),p=this.getBlendDrawParams({blend:s}),d=!(!p||!p.enable),v=this.getStencilDrawParams({stencil:u}),g=!(!v||!v.enable),m=this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:Hr[i],colorAttachmentFormats:[we.U8_RGBA_RT],depthStencilAttachmentFormat:we.D24_S8,megaStateDescriptor:{attachmentsState:[t?{channelWriteMask:_e.ALL,rgbBlendState:{blendMode:ue.ADD,blendSrcFactor:se.ONE,blendDstFactor:se.ZERO},alphaBlendState:{blendMode:ue.ADD,blendSrcFactor:se.ONE,blendDstFactor:se.ZERO}}:{channelWriteMask:g&&v.opFront.zpass===be.REPLACE?_e.NONE:_e.ALL,rgbBlendState:{blendMode:d&&p.equation.rgb||ue.ADD,blendSrcFactor:d&&p.func.srcRGB||se.SRC_ALPHA,blendDstFactor:d&&p.func.dstRGB||se.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:d&&p.equation.alpha||ue.ADD,blendSrcFactor:d&&p.func.srcAlpha||se.ONE,blendDstFactor:d&&p.func.dstAlpha||se.ONE}}],blendConstant:d?je:void 0,depthWrite:c,depthCompare:c&&l.func||ie.LESS,cullMode:h&&f.face||ae.NONE,stencilWrite:g,stencilFront:{compare:g?v.func.cmp:ie.ALWAYS,passOp:v.opFront.zpass,failOp:v.opFront.fail,depthFailOp:v.opFront.zfail,mask:v.opFront.mask},stencilBack:{compare:g?v.func.cmp:ie.ALWAYS,passOp:v.opBack.zpass,failOp:v.opBack.fail,depthFailOp:v.opBack.zfail,mask:v.opBack.mask}}});return g&&!Ti(null==u||null===(n=u.func)||void 0===n?void 0:n.ref)&&(m.stencilFuncReference=u.func.ref),m}},{key:"updateAttributesAndElements",value:function(){}},{key:"updateAttributes",value:function(){}},{key:"addUniforms",value:function(e){this.uniforms=o()(o()({},this.uniforms),this.extractUniforms(e))}},{key:"draw",value:function(e,t){var n=this,r=o()(o()({},this.options),e),i=r.count,a=void 0===i?0:i,s=r.instances,u=r.elements,l=r.uniforms,c=void 0===l?{}:l,f=r.uniformBuffers,h=r.textures;this.uniforms=o()(o()({},this.uniforms),this.extractUniforms(c));var p=this.service,d=p.renderPass,v=p.currentFramebuffer,g=p.width,m=p.height;this.pipeline=this.createPipeline(r,t);var y=this.service.device,_=y.swapChainHeight;if(y.swapChainHeight=(null==v?void 0:v.height)||m,d.setViewport(0,0,(null==v?void 0:v.width)||g,(null==v?void 0:v.height)||m),y.swapChainHeight=_,d.setPipeline(this.pipeline),Ti(this.pipeline.stencilFuncReference)||d.setStencilReference(this.pipeline.stencilFuncReference),d.setVertexInput(this.inputLayout,this.vertexBuffers.map((function(e){return{buffer:e}})),u?{buffer:this.indexBuffer,offset:0}:null),f&&(this.bindings=y.createBindings({pipeline:this.pipeline,uniformBufferBindings:f.map((function(e,t){var n=e;return{binding:t,buffer:n.get(),size:n.size}})),samplerBindings:null==h?void 0:h.map((function(e){return{texture:e.texture,sampler:e.sampler}}))})),this.bindings&&(d.setBindings(this.bindings),Object.keys(this.uniforms).forEach((function(e){var t=n.uniforms[e];t instanceof _i?n.uniforms[e]=t.get():t instanceof bi&&(n.uniforms[e]=t.get().texture)})),this.program.setUniformsLegacy(this.uniforms)),u){var b=u.count;0===b?d.draw(a,s):d.drawIndexed(b,s)}else d.draw(a,s)}},{key:"destroy",value:function(){var e,t,n;null===(e=this.vertexBuffers)||void 0===e||e.forEach((function(e){return e.destroy()})),null===(t=this.indexBuffer)||void 0===t||t.destroy(),null===(n=this.bindings)||void 0===n||n.destroy(),this.pipeline.destroy(),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(e){var t=e.depth;if(t)return{enable:void 0===t.enable||!!t.enable,mask:void 0===t.mask||!!t.mask,func:Yr[t.func||_.gl.LESS],range:t.range||[0,1]}}},{key:"getBlendDrawParams",value:function(e){var t=e.blend||{},n=t.enable,r=t.func,i=t.equation,o=t.color,a=void 0===o?[0,0,0,0]:o;return{enable:!!n,func:{srcRGB:Qr[r&&r.srcRGB||_.gl.SRC_ALPHA],srcAlpha:Qr[r&&r.srcAlpha||_.gl.SRC_ALPHA],dstRGB:Qr[r&&r.dstRGB||_.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:Qr[r&&r.dstAlpha||_.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Kr[i&&i.rgb||_.gl.FUNC_ADD],alpha:Kr[i&&i.alpha||_.gl.FUNC_ADD]},color:a}}},{key:"getStencilDrawParams",value:function(e){var t=e.stencil||{},n=t.enable,r=t.mask,i=void 0===r?4294967295:r,a=t.func,s=void 0===a?{cmp:_.gl.ALWAYS,ref:0,mask:4294967295}:a,u=t.opFront,l=void 0===u?{fail:_.gl.KEEP,zfail:_.gl.KEEP,zpass:_.gl.KEEP}:u,c=t.opBack,f=void 0===c?{fail:_.gl.KEEP,zfail:_.gl.KEEP,zpass:_.gl.KEEP}:c;return{enable:!!n,mask:i,func:o()(o()({},s),{},{cmp:Jr[s.cmp]}),opFront:{fail:$r[l.fail],zfail:$r[l.zfail],zpass:$r[l.zpass],mask:s.mask},opBack:{fail:$r[f.fail],zfail:$r[f.zfail],zpass:$r[f.zpass],mask:s.mask}}}},{key:"initCullDrawParams",value:function(e){var t=e.cull;if(t){var n=t.enable,r=t.face,i=void 0===r?_.gl.BACK:r;return{enable:!!n,face:qr[i]}}}},{key:"extractUniforms",value:function(e){var t=this,n={};return Object.keys(e).forEach((function(r){t.extractUniformsRecursively(r,e[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(e,t,n,r){var i=this;null===t||"number"==typeof t||"boolean"==typeof t||Array.isArray(t)&&"number"==typeof t[0]||Ei(t)||""===t||"resize"in t?n["".concat(r&&r+".").concat(e)]=t:(xi(t)&&Object.keys(t).forEach((function(o){i.extractUniformsRecursively(o,t[o],n,"".concat(r&&r+".").concat(e))})),Array.isArray(t)&&t.forEach((function(t,o){Object.keys(t).forEach((function(a){i.extractUniformsRecursively(a,t[a],n,"".concat(r&&r+".").concat(e,"[").concat(o,"]"))}))})))}}]),e}();function Si(e){return"undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||Boolean(e&&2===e._version)}var Ci=Br.rU.isUndefined,Ri=function(){function e(){var t=this;p()(this,e),m()(this,"uniformBuffers",[]),m()(this,"extensionObject",void 0),m()(this,"device",void 0),m()(this,"swapChain",void 0),m()(this,"$container",void 0),m()(this,"canvas",void 0),m()(this,"width",void 0),m()(this,"height",void 0),m()(this,"isDirty",void 0),m()(this,"renderPass",void 0),m()(this,"preRenderPass",void 0),m()(this,"mainColorRT",void 0),m()(this,"mainDepthRT",void 0),m()(this,"renderCache",void 0),m()(this,"currentFramebuffer",void 0),m()(this,"queryVerdorInfo",(function(){return t.device.queryVendorInfo().platformString})),m()(this,"viewportOrigin",void 0),m()(this,"createModel",(function(e){return new Ai(t.device,e,t)})),m()(this,"createAttribute",(function(e){return new Vr(t.device,e)})),m()(this,"createBuffer",(function(e){return new ni(t.device,e)})),m()(this,"createElements",(function(e){return new mi(t.device,e)})),m()(this,"createTexture2D",(function(e){return new _i(t.device,e)})),m()(this,"createFramebuffer",(function(e){return new bi(t.device,e)})),m()(this,"useFramebuffer",(function(e,n){t.currentFramebuffer=e,t.beginFrame(),n(),t.endFrame(),t.currentFramebuffer=null})),m()(this,"useFramebufferAsync",function(){var e=f()(l()().mark((function e(n,r){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.currentFramebuffer=n,t.preRenderPass=t.renderPass,t.beginFrame(),e.next=5,r();case 5:t.endFrame(),t.currentFramebuffer=null,t.renderPass=t.preRenderPass;case 8:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()),m()(this,"clear",(function(e){var n=e.color,r=e.depth,i=e.stencil,o=e.framebuffer,a=void 0===o?null:o;if(a)a.clearOptions={color:n,depth:r,stencil:i};else{var s=t.queryVerdorInfo();if("WebGL1"===s){var u=t.getGLContext();Ci(i)?Ci(r)||(u.clearDepth(r),u.clear(u.DEPTH_BUFFER_BIT)):(u.clearStencil(i),u.clear(u.STENCIL_BUFFER_BIT))}else if("WebGL2"===s){var l=t.getGLContext();Ci(i)?Ci(r)||l.clearBufferfv(l.DEPTH,0,[r]):l.clearBufferiv(l.STENCIL,0,[i])}}})),m()(this,"viewport",(function(e){var n=e.width,r=e.height;t.swapChain.configureSwapChain(n,r),t.createMainColorDepthRT(n,r),t.width=n,t.height=r})),m()(this,"readPixels",(function(e){var n=e.framebuffer,r=e.x,i=e.y,o=e.width,a=e.height,s=t.device.createReadback(),u=n.colorTexture,l=s.readTextureSync(u,r,t.viewportOrigin===Ee.LOWER_LEFT?i:t.height-i,o,a,new Uint8Array(o*a*4));if(t.viewportOrigin!==Ee.LOWER_LEFT)for(var c=0;c<l.length;c+=4){var f=l[c];l[c]=l[c+2],l[c+2]=f}return s.destroy(),l})),m()(this,"readPixelsAsync",function(){var e=f()(l()().mark((function e(n){var r,i,o,a,s,u,c,f,h,p;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.framebuffer,i=n.x,o=n.y,a=n.width,s=n.height,u=t.device.createReadback(),c=r.colorTexture,e.next=5,u.readTexture(c,i,t.viewportOrigin===Ee.LOWER_LEFT?o:t.height-o,a,s,new Uint8Array(a*s*4));case 5:if(f=e.sent,t.viewportOrigin!==Ee.LOWER_LEFT)for(h=0;h<f.length;h+=4)p=f[h],f[h]=f[h+2],f[h+2]=p;return u.destroy(),e.abrupt("return",f);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),m()(this,"getViewportSize",(function(){return{width:t.width,height:t.height}})),m()(this,"getContainer",(function(){var e;return null===(e=t.canvas)||void 0===e?void 0:e.parentElement})),m()(this,"getCanvas",(function(){return t.canvas})),m()(this,"getGLContext",(function(){return t.device.gl})),m()(this,"destroy",(function(){var e;t.canvas=null,null===(e=t.uniformBuffers)||void 0===e||e.forEach((function(e){e.destroy()})),t.device.destroy(),t.renderCache.destroy()}))}var t;return v()(e,[{key:"init",value:(t=f()(l()().mark((function e(t,n){var r,i,o,a,s,u;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.enableWebGPU,i=n.shaderCompilerPath,o=n.antialias,this.canvas=t,a=r?new Nr({shaderCompilerPath:i}):new Cn({targets:["webgl2","webgl1"],antialias:o,onContextLost:function(e){console.warn("context lost",e)},onContextCreationError:function(e){console.warn("context creation error",e)},onContextRestored:function(e){console.warn("context restored",e)}}),e.next=5,a.createSwapChain(t);case 5:(s=e.sent).configureSwapChain(t.width,t.height),this.device=s.getDevice(),this.swapChain=s,this.renderCache=new gi(this.device),this.currentFramebuffer=null,this.viewportOrigin=this.device.queryVendorInfo().viewportOrigin,u=this.device.gl,this.extensionObject={OES_texture_float:!Si(u)&&this.device.OES_texture_float},this.createMainColorDepthRT(t.width,t.height);case 15:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"createMainColorDepthRT",value:function(e,t){this.mainColorRT&&this.mainColorRT.destroy(),this.mainDepthRT&&this.mainDepthRT.destroy(),this.mainColorRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:we.U8_RGBA_RT,width:e,height:t,usage:ye.RENDER_TARGET})),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:we.D24_S8,width:e,height:t,usage:ye.RENDER_TARGET}))}},{key:"beginFrame",value:function(){this.device.beginFrame();var e=this.currentFramebuffer,t=this.swapChain,n=this.mainColorRT,r=this.mainDepthRT,i=e?e.colorRenderTarget:n,o=e?null:t.getOnscreenTexture(),a=e?e.depthRenderTarget:r,s=(null==e?void 0:e.clearOptions)||{},u=s.color,l=void 0===u?[0,0,0,0]:u,c=s.depth,f=void 0===c?1:c,h=s.stencil,p=void 0===h?0:h,d=i?Ve(255*l[0],255*l[1],255*l[2],l[3]):je,v=a?f:void 0,g=a?p:void 0,m=this.device.createRenderPass({colorAttachment:[i],colorResolveTo:[o],colorClearColor:[d],colorStore:[!0],depthStencilAttachment:a,depthClearValue:v,stencilClearValue:g});this.renderPass=m}},{key:"endFrame",value:function(){this.device.submitPass(this.renderPass),this.device.endFrame()}},{key:"getPointSizeRange",value:function(){var e=this.device.gl;return e.getParameter(e.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(e){return!!this.getGLContext().getExtension(e)}},{key:"setState",value:function(){}},{key:"setBaseState",value:function(){}},{key:"setCustomLayerDefaults",value:function(){}},{key:"setDirty",value:function(e){this.isDirty=e}},{key:"getDirty",value:function(){return this.isDirty}}]),e}(),wi=n(1119),Mi=n.n(wi),ki=n(3491),Li=n.n(ki),Oi=n(2060),Ii=n.n(Oi),Pi=n(3262),Ni=["selectstart","selecting","selectend"],Bi=function(e){Li()(n,e);var t=Ii()(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return p()(this,n),r=t.call(this),m()(Mi()(r),"scene",void 0),m()(Mi()(r),"options",void 0),m()(Mi()(r),"isEnable",!1),m()(Mi()(r),"box",void 0),m()(Mi()(r),"startEvent",void 0),m()(Mi()(r),"endEvent",void 0),m()(Mi()(r),"onDragStart",(function(e){r.box.style.display="block",r.startEvent=r.endEvent=e,r.syncBoxBound(),r.emit("selectstart",r.getLngLatBox(),r.startEvent,r.endEvent)})),m()(Mi()(r),"onDragging",(function(e){r.endEvent=e,r.syncBoxBound(),r.emit("selecting",r.getLngLatBox(),r.startEvent,r.endEvent)})),m()(Mi()(r),"onDragEnd",(function(e){r.endEvent=e,r.box.style.display="none",r.emit("selectend",r.getLngLatBox(),r.startEvent,r.endEvent)})),r.scene=e,r.options=i,r}return v()(n,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var e=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var t=Br.SO.create("div",void 0,this.container);t.classList.add("l7-select-box"),e&&t.classList.add(e),t.style.display="none",this.box=t}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var e=this.startEvent,t=e.x,n=e.y,r=this.endEvent,i=r.x,o=r.y,a=Math.min(t,i),s=Math.min(n,o),u=Math.abs(t-i),l=Math.abs(n-o);this.box.style.top="".concat(s,"px"),this.box.style.left="".concat(a,"px"),this.box.style.width="".concat(u,"px"),this.box.style.height="".concat(l,"px")}},{key:"getLngLatBox",value:function(){var e=this.startEvent.lngLat,t=e.lng,n=e.lat,r=this.endEvent.lngLat,i=r.lng,o=r.lat;return(0,Br.Ol)([[t,n],[i,o]])}}]),n}(Pi.EventEmitter),Di=function(){function e(t){p()(this,e),m()(this,"sceneService",void 0),m()(this,"mapService",void 0),m()(this,"controlService",void 0),m()(this,"layerService",void 0),m()(this,"debugService",void 0),m()(this,"iconService",void 0),m()(this,"markerService",void 0),m()(this,"popupService",void 0),m()(this,"fontService",void 0),m()(this,"interactionService",void 0),m()(this,"boxSelect",void 0),m()(this,"container",void 0);var n=t.id,r=t.map,i=t.renderer,o=void 0===i?"device":i,a=(0,_.createSceneContainer)();this.container=a,r.setContainer(a,n),a.rendererService="regl"===o?new Gr:new Ri,this.sceneService=a.sceneService,this.mapService=a.mapService,this.iconService=a.iconService,this.fontService=a.fontService,this.controlService=a.controlService,this.layerService=a.layerService,this.debugService=a.debugService,this.debugService.setEnable(t.debug),this.markerService=a.markerService,this.interactionService=a.interactionService,this.popupService=a.popupService,this.boxSelect=new Bi(this,{}),this.initComponent(n),this.sceneService.init(t),this.initControl()}var t,n,r,i,a;return v()(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:(a=f()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"exportMap",value:(i=f()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.sceneService.exportPng(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return i.apply(this,arguments)})},{key:"registerRenderService",value:function(e){var t=this;this.sceneService.loaded?new e(this).init():this.on("loaded",(function(){new e(t).init()}))}},{key:"setBgColor",value:function(e){this.mapService.setBgColor(e)}},{key:"addLayer",value:function(e){var t=this;this.loaded?this.preAddLayer(e):this.once("loaded",(function(){t.preAddLayer(e)}))}},{key:"preAddLayer",value:function(e){var t=this,n=(0,_.createLayerContainer)(this.container);if(e.setContainer(n),this.sceneService.addLayer(e),e.inited){this.initTileLayer(e);var r=this.initMask(e);this.addMask(r,e.id)}else e.on("inited",(function(){t.initTileLayer(e);var n=t.initMask(e);t.addMask(n,e.id)}))}},{key:"initMask",value:function(e){var t=e.getLayerConfig(),n=t.mask,r=t.maskfence,i=t.maskColor,o=void 0===i?"#000":i,a=t.maskOpacity,s=void 0===a?0:a;if(n&&r)return(new b.Z).source(r).shape("fill").style({color:o,opacity:s})}},{key:"addMask",value:function(e,t){if(e){var n=this.getLayer(t);if(n){var r=(0,_.createLayerContainer)(this.container);e.setContainer(r),n.addMaskLayer(e),this.sceneService.addMask(e)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(e){return this.layerService.getLayer(e)}},{key:"getLayerByName",value:function(e){return this.layerService.getLayerByName(e)}},{key:"removeLayer",value:(r=f()(l()().mark((function e(t,n){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layerService.remove(t,n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"removeAllLayer",value:(n=f()(l()().mark((function e(){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.layerService.removeAllLayers();case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(e){this.layerService.setEnableRender(e)}},{key:"addIconFont",value:function(e,t){this.fontService.addIconFont(e,t)}},{key:"addIconFonts",value:function(e){var t=this;e.forEach((function(e){var n=s()(e,2),r=n[0],i=n[1];t.fontService.addIconFont(r,i)}))}},{key:"addFontFace",value:function(e,t){var n=this;this.fontService.once("fontloaded",(function(e){n.emit("fontloaded",e)})),this.fontService.addFontFace(e,t)}},{key:"addImage",value:(t=f()(l()().mark((function e(t,n){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iconService.addImage(t,n);case 2:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"hasImage",value:function(e){return this.iconService.hasImage(e)}},{key:"removeImage",value:function(e){this.iconService.removeImage(e)}},{key:"addIconFontGlyphs",value:function(e,t){this.fontService.addIconGlyphs(t)}},{key:"addControl",value:function(e){this.controlService.addControl(e,this.container)}},{key:"removeControl",value:function(e){this.controlService.removeControl(e)}},{key:"getControlByName",value:function(e){return this.controlService.getControlByName(e)}},{key:"addMarker",value:function(e){this.markerService.addMarker(e)}},{key:"addMarkerLayer",value:function(e){this.markerService.addMarkerLayer(e)}},{key:"removeMarkerLayer",value:function(e){this.markerService.removeMarkerLayer(e)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers 已废弃，请使用 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(e){this.popupService.addPopup(e)}},{key:"removePopup",value:function(e){this.popupService.removePopup(e)}},{key:"on",value:function(e,t){var n;Ni.includes(e)?null===(n=this.boxSelect)||void 0===n||n.on(e,t):_.SceneEventList.includes(e)?this.sceneService.on(e,t):this.mapService.on(e,t)}},{key:"once",value:function(e,t){var n;Ni.includes(e)?null===(n=this.boxSelect)||void 0===n||n.once(e,t):_.SceneEventList.includes(e)?this.sceneService.once(e,t):this.mapService.once(e,t)}},{key:"emit",value:function(e,t){-1===_.SceneEventList.indexOf(e)?this.mapService.on(e,t):this.sceneService.emit(e,t)}},{key:"off",value:function(e,t){var n;Ni.includes(e)?null===(n=this.boxSelect)||void 0===n||n.off(e,t):_.SceneEventList.includes(e)?this.sceneService.off(e,t):this.mapService.off(e,t)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(e){return this.mapService.getCenter(e)}},{key:"setCenter",value:function(e,t){return this.mapService.setCenter(e,t)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(e){return this.mapService.setPitch(e)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(e){this.mapService.setRotation(e)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(e){this.mapService.panTo(e)}},{key:"panBy",value:function(e,t){this.mapService.panBy(e,t)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(e){this.mapService.setZoom(e)}},{key:"fitBounds",value:function(e,t){var n=this.sceneService.getSceneConfig(),r=n.fitBoundsOptions,i=n.animate;this.mapService.fitBounds(e,t||o()(o()({},r),{},{animate:i}))}},{key:"setZoomAndCenter",value:function(e,t){this.mapService.setZoomAndCenter(e,t)}},{key:"setMapStyle",value:function(e){this.mapService.setMapStyle(e)}},{key:"setMapStatus",value:function(e){this.mapService.setMapStatus(e)}},{key:"pixelToLngLat",value:function(e){return this.mapService.pixelToLngLat(e)}},{key:"lngLatToPixel",value:function(e){return this.mapService.lngLatToPixel(e)}},{key:"containerToLngLat",value:function(e){return this.mapService.containerToLngLat(e)}},{key:"lngLatToContainer",value:function(e){return this.mapService.lngLatToContainer(e)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(e){this.container.postProcessingPass.name=new e}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.boxSelect.enable(),t&&this.boxSelect.once("selectend",(function(){e.disableBoxSelect()}))}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getProtocol",value:function(e){return Br.SA.REGISTERED_PROTOCOLS[e]}},{key:"startAnimate",value:function(){this.layerService.startAnimate()}},{key:"stopAnimate",value:function(){this.layerService.stopAnimate()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(e){this.controlService.init({container:Br.SO.getContainer(e)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var e=this.sceneService.getSceneConfig(),t=e.logoVisible,n=e.logoPosition;t&&this.addControl(new y.Logo({position:n}))}},{key:"initTileLayer",value:function(e){e.getSource().isTile&&(e.tileLayer=new x.Z(e))}}],[{key:"addProtocol",value:function(e,t){Br.SA.REGISTERED_PROTOCOLS[e]=t}},{key:"removeProtocol",value:function(e){delete Br.SA.REGISTERED_PROTOCOLS[e]}}]),e}()},946:function(e,t,n){"use strict";n.d(t,{default:function(){return Ot}});var r={},i={},o=function(e){return i[e]},a=function(e,t){i[e]=t},s=function(e,t){r[e]=t},u={},l={};function c(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function f(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function h(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function p(e){var t,n=e.getUTCHours(),r=e.getUTCMinutes(),i=e.getUTCSeconds(),o=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":((t=e.getUTCFullYear())<0?"-"+h(-t,6):t>9999?"+"+h(t,6):h(t,4))+"-"+h(e.getUTCMonth()+1,2)+"-"+h(e.getUTCDate(),2)+(o?"T"+h(n,2)+":"+h(r,2)+":"+h(i,2)+"."+h(o,3)+"Z":i?"T"+h(n,2)+":"+h(r,2)+":"+h(i,2)+"Z":r||n?"T"+h(n,2)+":"+h(r,2)+"Z":"")}var d=function(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],o=e.length,a=0,s=0,c=o<=0,f=!1;function h(){if(c)return l;if(f)return f=!1,u;var t,r,i=a;if(34===e.charCodeAt(i)){for(;a++<o&&34!==e.charCodeAt(a)||34===e.charCodeAt(++a););return(t=a)>=o?c=!0:10===(r=e.charCodeAt(a++))?f=!0:13===r&&(f=!0,10===e.charCodeAt(a)&&++a),e.slice(i+1,t-1).replace(/""/g,'"')}for(;a<o;){if(10===(r=e.charCodeAt(t=a++)))f=!0;else if(13===r)f=!0,10===e.charCodeAt(a)&&++a;else if(r!==n)continue;return e.slice(i,t)}return c=!0,e.slice(i,o)}for(10===e.charCodeAt(o-1)&&--o,13===e.charCodeAt(o-1)&&--o;(r=h())!==l;){for(var p=[];r!==u&&r!==l;)p.push(r),r=h();t&&null==(p=t(p,s++))||i.push(p)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return a(t[e])})).join(e)}))}function o(t){return t.map(a).join(e)}function a(e){return null==e?"":e instanceof Date?p(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,o=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=c(e);return function(r,i){return t(n(r),i,e)}}(e,t):c(e)}));return o.columns=i||[],o},parseRows:r,format:function(t,n){return null==n&&(n=f(t)),[n.map(a).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=f(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(o).join("\n")},formatRow:o,formatValue:a}}(","),v=d.parse,g=(d.parseRows,d.format,d.formatBody,d.formatRows,d.formatRow,d.formatValue,n(4450)),m=n.n(g),y=n(7436),_=n(4612),b=n(7193),x=n(1231),E=n.n(x);function T(e){return!!Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function A(e){var t=Object.isFrozen(e)?b.rU.cloneDeep(e):e;return E()(t,!0),t}function S(e,t){return e||[[t[0],t[3]],[t[2],t[3]],[t[2],t[1]],[t[0],t[1]]]}function C(e,t){var n=t.x,r=t.y,i=t.x1,o=t.y1,a=t.coordinates,s=t.geometry,u=[];if(!Array.isArray(e))return{dataArray:[]};if(s)return e.filter((function(e){return e[s]&&e[s].type&&e[s].coordinates&&e[s].coordinates.length>0})).forEach((function(e,t){var n=A(e[s]);(0,_.nG)(n,(function(n){var r=(0,y.r7)(n),i=m()(m()({},e),{},{_id:t,coordinates:r});u.push(i)}))})),{dataArray:u};for(var l=0;l<e.length;l++){var c=e[l],f=[];if(a){var h="Polygon";Array.isArray(a[0])||(h="Point"),Array.isArray(a[0])&&!Array.isArray(a[0][0])&&(h="LineString"),f=A({type:h,coordinates:c[a]}).coordinates}else if(n&&r&&i&&o){f=[[parseFloat(c[n]),parseFloat(c[r])],[parseFloat(c[i]),parseFloat(c[o])]]}else n&&r&&(f=[parseFloat(c[n]),parseFloat(c[r])]);var p=m()(m()({},c),{},{_id:l,coordinates:f});u.push(p)}return{dataArray:u}}var R=n(6502),w=n.n(R),M=n(4351),k=n.n(M);function L(e,t,n,r){for(var i,o=r,a=n-t>>1,s=n-t,u=e[t],l=e[t+1],c=e[n],f=e[n+1],h=t+3;h<n;h+=3){var p=O(e[h],e[h+1],u,l,c,f);if(p>o)i=h,o=p;else if(p===o){var d=Math.abs(h-a);d<s&&(i=h,s=d)}}o>r&&(i-t>3&&L(e,t,i,r),e[i+2]=o,n-i>3&&L(e,i,n,r))}function O(e,t,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((e-n)*a+(t-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=e-n)*a+(s=t-r)*s}function I(e,t,n,r){var i={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)P(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)P(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)P(e,t[r][i])}(i),i}function P(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function N(e,t,n,r){if(t.geometry){var i=t.geometry.coordinates,o=t.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=t.id;if(n.promoteId?u=t.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)B(i,s);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)B(i[l],s);else if("LineString"===o)D(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<i.length;l++)s=[],D(i[l],s,a,!1),e.push(I(u,"LineString",s,t.properties));return}U(i,s,a,!1)}else if("Polygon"===o)U(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<t.geometry.geometries.length;l++)N(e,{id:u,geometry:t.geometry.geometries[l],properties:t.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var c=[];U(i[l],c,a,!0),s.push(c)}}e.push(I(u,o,s,t.properties))}}function B(e,t){t.push(F(e[0])),t.push(z(e[1])),t.push(0)}function D(e,t,n,r){for(var i,o,a=0,s=0;s<e.length;s++){var u=F(e[s][0]),l=z(e[s][1]);t.push(u),t.push(l),t.push(0),s>0&&(a+=r?(i*l-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(l-o,2))),i=u,o=l}var c=t.length-3;t[2]=1,L(t,0,c,n),t[c+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function U(e,t,n,r){for(var i=0;i<e.length;i++){var o=[];D(e[i],o,n,r),t.push(o)}}function F(e){return e/360+.5}function z(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function G(e,t,n,r,i,o,a,s){if(r/=t,o>=(n/=t)&&a<r)return e;if(a<n||o>=r)return null;for(var u=[],l=0;l<e.length;l++){var c=e[l],f=c.geometry,h=c.type,p=0===i?c.minX:c.minY,d=0===i?c.maxX:c.maxY;if(p>=n&&d<r)u.push(c);else if(!(d<n||p>=r)){var v=[];if("Point"===h||"MultiPoint"===h)V(f,v,n,r,i);else if("LineString"===h)j(f,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===h)W(f,v,n,r,i,!1);else if("Polygon"===h)W(f,v,n,r,i,!0);else if("MultiPolygon"===h)for(var g=0;g<f.length;g++){var m=[];W(f[g],m,n,r,i,!0),m.length&&v.push(m)}if(v.length){if(s.lineMetrics&&"LineString"===h){for(g=0;g<v.length;g++)u.push(I(c.id,h,v[g],c.tags));continue}"LineString"!==h&&"MultiLineString"!==h||(1===v.length?(h="LineString",v=v[0]):h="MultiLineString"),"Point"!==h&&"MultiPoint"!==h||(h=3===v.length?"Point":"MultiPoint"),u.push(I(c.id,h,v,c.tags))}}}return u.length?u:null}function V(e,t,n,r,i){for(var o=0;o<e.length;o+=3){var a=e[o+i];a>=n&&a<=r&&(t.push(e[o]),t.push(e[o+1]),t.push(e[o+2]))}}function j(e,t,n,r,i,o,a){for(var s,u,l=H(e),c=0===i?Z:Y,f=e.start,h=0;h<e.length-3;h+=3){var p=e[h],d=e[h+1],v=e[h+2],g=e[h+3],m=e[h+4],y=0===i?p:d,_=0===i?g:m,b=!1;a&&(s=Math.sqrt(Math.pow(p-g,2)+Math.pow(d-m,2))),y<n?_>n&&(u=c(l,p,d,g,m,n),a&&(l.start=f+s*u)):y>r?_<r&&(u=c(l,p,d,g,m,r),a&&(l.start=f+s*u)):X(l,p,d,v),_<n&&y>=n&&(u=c(l,p,d,g,m,n),b=!0),_>r&&y<=r&&(u=c(l,p,d,g,m,r),b=!0),!o&&b&&(a&&(l.end=f+s*u),t.push(l),l=H(e)),a&&(f+=s)}var x=e.length-3;p=e[x],d=e[x+1],v=e[x+2],(y=0===i?p:d)>=n&&y<=r&&X(l,p,d,v),x=l.length-3,o&&x>=3&&(l[x]!==l[0]||l[x+1]!==l[1])&&X(l,l[0],l[1],l[2]),l.length&&t.push(l)}function H(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function W(e,t,n,r,i,o){for(var a=0;a<e.length;a++)j(e[a],t,n,r,i,o,!1)}function X(e,t,n,r){e.push(t),e.push(n),e.push(r)}function Z(e,t,n,r,i,o){var a=(o-t)/(r-t);return e.push(o),e.push(n+(i-n)*a),e.push(1),a}function Y(e,t,n,r,i,o){var a=(o-n)/(i-n);return e.push(t+(r-t)*a),e.push(o),e.push(1),a}function q(e,t){for(var n=[],r=0;r<e.length;r++){var i,o=e[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=K(o.geometry,t);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(K(o.geometry[s],t))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],l=0;l<o.geometry[s].length;l++)u.push(K(o.geometry[s][l],t));i.push(u)}n.push(I(o.id,a,i,o.tags))}return n}function K(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function Q(e,t){if(e.transformed)return e;var n,r,i,o=1<<e.z,a=e.x,s=e.y;for(n=0;n<e.features.length;n++){var u=e.features[n],l=u.geometry,c=u.type;if(u.geometry=[],1===c)for(r=0;r<l.length;r+=2)u.geometry.push($(l[r],l[r+1],t,o,a,s));else for(r=0;r<l.length;r++){var f=[];for(i=0;i<l[r].length;i+=2)f.push($(l[r][i],l[r][i+1],t,o,a,s));u.geometry.push(f)}}return e.transformed=!0,e}function $(e,t,n,r,i,o){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-o))]}function J(e,t,n,r,i){for(var o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){a.numFeatures++,ee(a,e[s],o,i);var u=e[s].minX,l=e[s].minY,c=e[s].maxX,f=e[s].maxY;u<a.minX&&(a.minX=u),l<a.minY&&(a.minY=l),c>a.maxX&&(a.maxX=c),f>a.maxY&&(a.maxY=f)}return a}function ee(e,t,n,r){var i=t.geometry,o=t.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)te(a,i,e,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)te(a,i[s],e,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var l=i[u];for(s=0;s<l.length;s++)te(a,l[s],e,n,!0,0===s)}if(a.length){var c=t.tags||null;if("LineString"===o&&r.lineMetrics){for(var f in c={},t.tags)c[f]=t.tags[f];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var h={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:c};null!==t.id&&(h.id=t.id),e.features.push(h)}}function te(e,t,n,r,i,o){var a=r*r;if(r>0&&t.size<(i?a:r))n.numPoints+=t.length/3;else{for(var s=[],u=0;u<t.length;u+=3)(0===r||t[u+2]>a)&&(n.numSimplified++,s.push(t[u]),s.push(t[u+1])),n.numPoints++;i&&function(e,t){for(var n=0,r=0,i=e.length,o=i-2;r<i;o=r,r+=2)n+=(e[r]-e[o])*(e[r+1]+e[o+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var a=e[r],s=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=a,e[i-1-r]=s}}(s,o),e.push(s)}}function ne(e,t){t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t);var n=t.debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)N(n,e.features[r],t,r);else"Feature"===e.type?N(n,e,t):N(n,{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(e,t){var n=t.buffer/t.extent,r=e,i=G(e,1,-1-n,n,0,-1,2,t),o=G(e,1,1-n,2+n,0,-1,2,t);return(i||o)&&(r=G(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=q(i,1).concat(r)),o&&(r=r.concat(q(o,-1)))),r}(r,t),r.length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function re(e,t,n){return 32*((1<<e)*n+t)+e}ne.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ne.prototype.splitTile=function(e,t,n,r,i,o,a){for(var s=[e,t,n,r],u=this.options,l=u.debug;s.length;){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var c=1<<t,f=re(t,n,r),h=this.tiles[f];if(!h&&(l>1&&console.time("creation"),h=this.tiles[f]=J(e,t,n,r,u),this.tileCoords.push({z:t,x:n,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,h.numFeatures,h.numPoints,h.numSimplified),console.timeEnd("creation"));var p="z"+t;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(h.source=e,i){if(t===u.maxZoom||t===i)continue;var d=1<<i-t;if(n!==Math.floor(o/d)||r!==Math.floor(a/d))continue}else if(t===u.indexMaxZoom||h.numPoints<=u.indexMaxPoints)continue;if(h.source=null,0!==e.length){l>1&&console.time("clipping");var v,g,m,y,_,b,x=.5*u.buffer/u.extent,E=.5-x,T=.5+x,A=1+x;v=g=m=y=null,_=G(e,c,n-x,n+T,0,h.minX,h.maxX,u),b=G(e,c,n+E,n+A,0,h.minX,h.maxX,u),e=null,_&&(v=G(_,c,r-x,r+T,1,h.minY,h.maxY,u),g=G(_,c,r+E,r+A,1,h.minY,h.maxY,u),_=null),b&&(m=G(b,c,r-x,r+T,1,h.minY,h.maxY,u),y=G(b,c,r+E,r+A,1,h.minY,h.maxY,u),b=null),l>1&&console.timeEnd("clipping"),s.push(v||[],t+1,2*n,2*r),s.push(g||[],t+1,2*n,2*r+1),s.push(m||[],t+1,2*n+1,2*r),s.push(y||[],t+1,2*n+1,2*r+1)}}},ne.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,o=r.debug;if(e<0||e>24)return null;var a=1<<e,s=re(e,t=(t%a+a)%a,n);if(this.tiles[s])return Q(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var u,l=e,c=t,f=n;!u&&l>0;)l--,c=Math.floor(c/2),f=Math.floor(f/2),u=this.tiles[re(l,c,f)];return u&&u.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,c,f),o>1&&console.time("drilling down"),this.splitTile(u.source,l,c,f,e,t,n),o>1&&console.timeEnd("drilling down"),this.tiles[s]?Q(this.tiles[s],i):null):null};var ie=n(8025),oe=n.n(ie),ae=n(1133),se=n.n(ae),ue=n(3769),le=n.n(ue),ce=function(){function e(t,n,r,i){oe()(this,e),le()(this,"vectorTile",void 0),le()(this,"vectorLayerCache",{}),le()(this,"x",void 0),le()(this,"y",void 0),le()(this,"z",void 0),this.x=n,this.y=r,this.z=i,this.vectorTile=t}return se()(e,[{key:"getTileData",value:function(e){return e&&this.vectorTile.layers[e]?this.vectorLayerCache[e]?this.vectorLayerCache[e]:this.vectorTile.layers[e].features:[]}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),fe={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function he(e){for(var t,n,r=0,i=0,o=e.length,a=o-1;i<o;a=i++)t=e[i],r+=((n=e[a]).x-t.x)*(t.y+n.y);return r}var pe=["Unknown","Point","LineString","Polygon"];function de(e,t,n,r,i){var o,a,s=i.geometry,u=i.type,l=i.tags,c=i.id,f=e*Math.pow(2,r),h=e*t,p=e*n,d=pe[u];function v(e){for(var t=0;t<e.length;t++){var n=e[t];if(n[3])break;var r=180-360*(n[1]+p)/f,i=360*(n[0]+h)/f-180,o=360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90;e[t]=[i,o,0,1]}}switch(u){case 1:var g=[];for(o=0;o<s.length;o++)g[o]=s[o][0];v(s=g);break;case 2:for(o=0;o<s.length;o++)v(s[o]);break;case 3:for(s=function(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],o=0;o<t;o++){var a=he(e[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[e[o]]):n.push(e[o]))}return n&&i.push(n),i}(s),o=0;o<s.length;o++)for(a=0;a<s[o].length;a++)v(s[o][a])}return 1===s.length?s=s[0]:d="Multi"+d,{type:"Feature",geometry:{type:d,coordinates:s},properties:l,id:c,tileOrigin:[0,0],coord:""}}var ve=function(){var e=k()(w()().mark((function e(t,n,r,i){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var o=n.getTile(t.z,t.x,t.y),a=o?o.features.map((function(e){return de(i,r.x,r.y,r.z,e)})):[];e(new ce({layers:{defaultLayer:{features:a}}},t.x,t.y,t.z))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}();function ge(e,t){var n=t.extent,r=void 0===n?[121.168,30.2828,121.384,30.4219]:n,i=t.coordinates,o=t.requestParameters,a=void 0===o?{}:o,s=new Promise((function(t){e instanceof HTMLImageElement||(0,b.fg)(e)?t([e]):function(e,t,n){var r=[];if("string"==typeof e)(0,b.gJ)(m()(m()({},t),{},{url:e}),(function(e,t){t&&(r.push(t),n(r))}));else{var i=e.length,o=0;e.forEach((function(e){(0,b.gJ)(m()(m()({},t),{},{url:e}),(function(e,t){o++,t&&r.push(t),o===i&&n(r)}))}))}}(e,a,(function(e){t(e)}))})),u=S(i,r);return{originData:e,images:s,_id:1,dataArray:[{_id:0,coordinates:u}]}}var me=function(){var e=k()(w()().mark((function e(t,n,r,i){var o,a;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={x:n.x,y:n.y,z:n.z},a=(0,b.z0)(t,o),e.abrupt("return",new Promise((function(e){i?i(o,(function(t,r){if(t||!r){var i=new ce({layers:{defaultLayer:{features:[]}}},n.x,n.y,n.z);e(i)}else{var o={layers:{defaultLayer:{features:r.features}}},a=new ce(o,n.x,n.y,n.z);e(a)}})):(0,b.Yu)(m()(m()({},r),{},{url:a}),(function(t,r){if(t||!r){var i=new ce({layers:{defaultLayer:{features:[]}}},n.x,n.y,n.z);e(i)}else{var o=JSON.parse(r),a=new ce({layers:{defaultLayer:{features:o}}},n.x,n.y,n.z);e(a)}}))})));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}();var ye=n(1436),_e=n(8777),be=n.n(_e),xe=function(){function e(t,n,r,i){oe()(this,e),le()(this,"vectorTile",void 0),le()(this,"vectorLayerCache",{}),le()(this,"x",void 0),le()(this,"y",void 0),le()(this,"z",void 0),this.x=n,this.y=r,this.z=i,this.vectorTile=new ye.VectorTile(new(be())(t))}return se()(e,[{key:"getTileData",value:function(e){if(!e||!this.vectorTile.layers[e])return[];if(this.vectorLayerCache[e])return this.vectorLayerCache[e];var t=this.vectorTile.layers[e];if(Array.isArray(t.features))return this.vectorLayerCache[e]=t.features,t.features;for(var n=[],r=0;r<t.length;r++){var i=t.feature(r).toGeoJSON(this.x,this.y,this.z);n.push(m()(m()({},i),{},{properties:m()({id:i.id},i.properties)}))}return this.vectorLayerCache[e]=n,n}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Ee={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},Te=function(){var e=k()(w()().mark((function e(t,n,r,i,o){var a;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=(0,b.z0)(t,n),e.abrupt("return",new Promise((function(e){if(o)o({x:r.x,y:r.y,z:r.z},(function(t,n){if(t||!n)e(void 0);else{var i=new xe(n,r.x,r.y,r.z);e(i)}}));else{var t=(0,b.ks)(m()(m()({},i),{},{url:a}),(function(t,n){if(t||!n)e(void 0);else{var i=new xe(n,r.x,r.y,r.z);e(i)}}));r.xhrCancel=function(){return t.cancel()}}})));case 2:case"end":return e.stop()}}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}();var Ae=n(5116),Se=n.n(Ae),Ce=n(2786),Re=n.n(Ce),we=n(3420),Me=n.n(we);function ke(e,t){for(var n=t[0],r=n.width,i=n.height,o=t.map((function(e){return e.rasterData})),a=r*i,s=[],u=JSON.stringify(e),l=0;l<a;l++){var c=JSON.parse(u),f=Le(c,o,l);if("number"==typeof f)s.push(f);else{var h=Oe(c);s.push(h)}}return s}function Le(e,t,n){if(2===e.length&&"band"===e[0]&&"number"==typeof e[1])try{return t[e[1]][n]}catch(e){return console.warn("Raster Data err!"),0}e.map((function(r,i){if(Array.isArray(r)&&r.length>0)if("band"===r[0])try{e[i]=t[r[1]][n]}catch(t){console.warn("Raster Data err!"),e[i]=0}else Le(r,t,n)}))}function Oe(e){var t=function(e){var t=Me()(e,3),n=t[0],r=t[1],i=void 0===r?-1:r,o=t[2],a=void 0===o?-1:o;return void 0===n?(console.warn("Express err!"),["+",0,0]):[n.replace(/\s+/g,""),i,a]}(e),n=t[0],r=t[1],i=t[2];return Array.isArray(r)&&(r=Oe(e[1])),Array.isArray(i)&&(i=Oe(e[2])),function(e,t,n){switch(e){case"+":return t+n;case"-":return t-n;case"*":return t*n;case"/":return t/n;case"%":return t%n;case"^":return Math.pow(t,n);case"abs":return Math.abs(t);case"floor":return Math.floor(t);case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"sin":return Math.sin(t);case"cos":return Math.cos(t);case"atan":return-1===n?Math.atan(t):Math.atan2(t,n);case"min":return Math.min(t,n);case"max":return Math.max(t,n);case"log10":return Math.log(t);case"log2":return Math.log2(t);default:return console.warn("Calculate symbol err! Return default 0"),0}}(n,r,i)}var Ie={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:function(e,t){for(var n=e[0].rasterData,r=e[1].rasterData,i=e[2].rasterData,o=[],a=(null==t?void 0:t.countCut)||[2,98],s=Me()(a,2),u=s[0],l=s[1],c=(null==t?void 0:t.RMinMax)||Pe(n,u,l),f=(null==t?void 0:t.GMinMax)||Pe(r,u,l),h=(null==t?void 0:t.BMinMax)||Pe(i,u,l),p=0;p<n.length;p++)o.push(Math.max(0,n[p]-c[0])),o.push(Math.max(0,r[p]-f[0])),o.push(Math.max(0,i[p]-h[0]));return{rasterData:o,rMinMax:c,gMinMax:f,bMinMax:h}}}};function Pe(e,t,n){var r=e.slice().sort((function(e,t){return e-t})),i=r.length;return[r[Math.ceil(i*t/100)],r[Math.ceil(i*n/100)]]}function Ne(e,t,n){return Be.apply(this,arguments)}function Be(){return Be=k()(w()().mark((function e(t,n,r){var i,o,a,s,u,l;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==t.length){e.next=2;break}return e.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return e.next=4,Promise.all(t.map((function(e){var t=e.data,r=e.bands;return n(t,void 0===r?[0]:r)})));case 4:i=e.sent,o=[],i.forEach((function(e){Array.isArray(e)?o.push.apply(o,Re()(e)):o.push(e)})),a=o[0],s=a.width,u=a.height,e.t0=Se()(r),e.next="function"===e.t0?11:"object"===e.t0?13:15;break;case 11:return l=r(o),e.abrupt("break",16);case 13:return l=Array.isArray(r)?{rasterData:ke(r,o)}:De(r,o),e.abrupt("break",16);case 15:l={rasterData:o[0].rasterData};case 16:return e.abrupt("return",m()(m()({},l),{},{width:s,height:u}));case 17:case"end":return e.stop()}}),e)}))),Be.apply(this,arguments)}function De(e,t){var n=Ie[e.type];return"function"===n.type?n.method(t,null==e?void 0:e.options):"operation"===n.type?"rgb"===e.type?function(e,t){void 0===e.r&&console.warn("Channel R lost in Operation! Use band[0] to fill!");void 0===e.g&&console.warn("Channel G lost in Operation! Use band[0] to fill!");void 0===e.b&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var n=ke(e.r||["band",0],t),r=ke(e.g||["band",0],t),i=ke(e.b||["band",0],t);return[n,r,i]}(n.expression,t):{rasterData:ke(n.expression,t)}:void 0}function Ue(e,t,n,r){return Fe.apply(this,arguments)}function Fe(){return(Fe=k()(w()().mark((function e(t,n,r,i){var o;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ne(t,n,r);case 2:o=e.sent,i(null,{data:o});case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ze=n(7033),Ge=function(){var e=k()(w()().mark((function e(t,n,r,i){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,o){n({x:t.x,y:t.y,z:t.z},(function(t,n){t||0===n.length?o(t):n&&Ue([{data:n,bands:[0]}],r,i,(function(t,n){t?o(t):n&&e(n)}))}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),Ve=function(){var e=k()(w()().mark((function e(t,n){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){n({x:t.x,y:t.y,z:t.z},(function(t,n){!t&&n?n instanceof ArrayBuffer?(0,b.Co)(n,(function(t,n){t&&r(t),e(n)})):n instanceof HTMLImageElement?e(n):r(t):r(t)}))})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();function je(e,t){return Array.isArray(e)?"string"==typeof e[0]?e.map((function(e){return(0,b.z0)(e,t)})):e.map((function(e){return{url:(0,b.z0)(e.url,t),bands:e.bands||[0]}})):(0,b.z0)(e,t)}function He(e,t){e.xhrCancel=function(){t.map((function(e){e.abort()}))}}var We=function(){var e=k()(w()().mark((function e(t,n,r,i,o){var a,s,u,l,c,f;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(h=n.url,!((a="string"==typeof h?[{url:h,bands:[0]}]:"string"==typeof h[0]?h.map((function(e){return{url:e,bands:[0]}})):h).length>1)){e.next=15;break}return e.next=4,Xe(a,n);case 4:if(s=e.sent,u=s.rasterFiles,l=s.xhrList,c=s.errList,He(t,l),!(c.length>0)){e.next=12;break}return r(c,null),e.abrupt("return");case 12:Ue(u,i,o,r),e.next=17;break;case 15:f=(0,b.ks)(n,(function(e,t){if(e)r(e);else if(t){Ue([{data:t,bands:a[0].bands}],i,o,r)}})),He(t,[f]);case 17:case"end":return e.stop()}var h}),e)})));return function(t,n,r,i,o){return e.apply(this,arguments)}}();function Xe(e,t){return Ze.apply(this,arguments)}function Ze(){return(Ze=k()(w()().mark((function e(t,n){var r,i,o,a,s,u,l,c,f,h,p;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],i=[],o=[],a=0;case 4:if(!(a<t.length)){e.next=20;break}return s=t[a],u=m()(m()({},n),{},{url:s.url}),l=s.bands,e.next=10,(0,b.LF)(m()(m()({},u),{},{type:"arrayBuffer"}));case 10:c=e.sent,f=c.err,h=c.data,p=c.xhr,f&&o.push(f),i.push(p),r.push({data:h,bands:l});case 17:a++,e.next=4;break;case 20:return e.abrupt("return",{rasterFiles:r,xhrList:i,errList:o});case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ye=function(){var e=k()(w()().mark((function e(t,n,r,i){var o,a,s,u,l,c;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=i.format,a=void 0===o?Ke:o,s=i.operation,u=i.requestParameters,l=void 0===u?{}:u,c=m()(m()({},l),{},{url:je(t,n)}),e.abrupt("return",new Promise((function(e,t){We(r,c,(function(n,r){n?t(n):r&&e(r)}),a,s)})));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),qe=function(){var e=k()(w()().mark((function e(t,n,r,i){var o,a,s,u;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Array.isArray(t)?t[0]:t,i.wmtsOptions?(s=(null==i?void 0:i.getURLFromTemplate)||b.jG,o=s(a,m()(m()({},n),i.wmtsOptions))):(u=(null==i?void 0:i.getURLFromTemplate)||b.z0,o=u(a,n)),e.abrupt("return",new Promise((function(e,t){var n,a=(0,b.gJ)(m()(m()({},null==i?void 0:i.requestParameters),{},{url:o,type:(null==i||null===(n=i.requestParameters)||void 0===n?void 0:n.type)||"arrayBuffer"}),(function(n,r){n?t(n):r&&e(r)}),i.transformResponse);r.xhrCancel=function(){return a.cancel()}})));case 3:case"end":return e.stop()}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}(),Ke=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},Qe={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0};ze.RasterTileType.ARRAYBUFFER,ze.RasterTileType.RGB;function $e(e){return!(!Array.isArray(e)||0!==e.length)||!Array.isArray(e)&&"string"!=typeof e}var Je=n(1409),et=n.n(Je),tt=["extent","coordinates","width","height"];var nt=["extent","coordinates","width","height"];var rt=["extent","coordinates","min","max","width","height","format","operation"];var it={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},ot=function(){var e=k()(w()().mark((function e(t){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=Me()(t.bounds,4),r=n[0],i=n[1],o=n[2],a=n[3];e({layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,x:(r+o)/2,y:(i+a)/2},geometry:{type:"LineString",coordinates:[[o,a],[o,i],[r,i],[r,i]]}}]}}})})));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var at=n(1119),st=n.n(at),ut=n(3491),lt=n.n(ut),ct=n(2060),ft=n.n(ct),ht=n(4474),pt=n(3262),dt=n(5947),vt=n.n(dt);function gt(e,t){var n=t.radius,r=void 0===n?40:n,i=t.maxZoom,o=void 0===i?18:i,a=t.minZoom,s=void 0===a?0:a,u=t.zoom,l=void 0===u?2:u;if(e.pointIndex){var c=e.pointIndex.getClusters(e.extent,Math.floor(l));return e.dataArray=c.map((function(e,t){return m()({coordinates:e.geometry.coordinates,_id:t+1},e.properties)})),e}var f=new(vt())({radius:r,minZoom:s,maxZoom:o}),h={type:"FeatureCollection",features:[]};return h.features=e.dataArray.map((function(e){return{type:"Feature",geometry:{type:"Point",coordinates:e.coordinates},properties:m()({},e)}})),f.load(h.features),f}function mt(e){if(0===e.length)return 0;for(var t,n=e[0],r=0,i=1;i<e.length;i++)t=n+1*e[i],Math.abs(n)>=Math.abs(e[i])?r+=n-t+e[i]:r+=e[i]-t+n,n=t;return n+1*r}var yt={min:function(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return t},max:function(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return t},mean:function(e){if(0===e.length)throw new Error("mean requires at least one data point");return mt(e)/e.length},sum:mt},_t=b.rU.cloneDeep,bt=b.rU.isFunction,xt=b.rU.isString,Et=b.rU.mergeWith;function Tt(e,t){if(Array.isArray(t))return t}var At=function(e){lt()(a,e);var t,n,i=ft()(a);function a(e,t){var n;return oe()(this,a),n=i.call(this),le()(st()(n),"type","source"),le()(st()(n),"isTile",!1),le()(st()(n),"inited",!1),le()(st()(n),"data",void 0),le()(st()(n),"center",void 0),le()(st()(n),"extent",void 0),le()(st()(n),"hooks",{init:new ht.ni}),le()(st()(n),"parser",{type:"geojson"}),le()(st()(n),"transforms",[]),le()(st()(n),"cluster",!1),le()(st()(n),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),le()(st()(n),"tileset",void 0),le()(st()(n),"invalidExtent",!1),le()(st()(n),"dataArrayChanged",!1),le()(st()(n),"originData",void 0),le()(st()(n),"rawData",void 0),le()(st()(n),"cfg",{autoRender:!0}),le()(st()(n),"clusterIndex",void 0),n.originData=e,n.initCfg(t),n.init().then((function(){n.inited=!0,n.emit("update",{type:"inited"})})),n}return se()(a,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(e){return this.clusterIndex.getClusters(this.caculClusterExtent(2),e)}},{key:"getClustersLeaves",value:function(e){return this.clusterIndex.getLeaves(e,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(e){var t=this,n=this.clusterOptions,r=n.method,i=void 0===r?"sum":r,a=n.field,s=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(e));this.clusterOptions.zoom=e,s.forEach((function(e){e.id||(e.properties.point_count=1)})),(a||bt(i))&&(s=s.map((function(e){var n=e.id;if(n){var r,o=t.clusterIndex.getLeaves(n,1/0).map((function(e){return e.properties}));if(xt(i)&&a){var s=function(e,t){return e.map((function(e){return 1*e[t]}))}(o,a);r=yt[i](s)}bt(i)&&(r=i(o)),e.properties.stat=r}else e.properties.point_count=1;return e}))),this.data=o("geojson")({type:"FeatureCollection",features:s}),this.executeTrans()}},{key:"getFeatureById",value:function(e){var t=this.parser,n=t.type,r=void 0===n?"geojson":n,i=t.geometry;if("geojson"!==r||this.cluster)return"json"===r&&i?this.data.dataArray.find((function(t){return t._id===e})):e<this.data.dataArray.length?this.data.dataArray[e]:"null";var o=e<this.originData.features.length?this.originData.features[e]:"null",a=_t(o);if(null!=a&&a.properties&&(0!==this.transforms.length||this.dataArrayChanged)){var s=this.data.dataArray.find((function(t){return t._id===e}));a.properties=s}return a}},{key:"updateFeaturePropertiesById",value:function(e,t){this.data.dataArray=this.data.dataArray.map((function(n){return n._id===e?m()(m()({},n),t):n})),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(e,t){var n=this.data.dataArray.find((function(n){return n[e]===t}));return null==n?void 0:n._id}},{key:"setData",value:function(e,t){var n=this;this.originData=e,this.dataArrayChanged=!1,this.initCfg(t),this.init().then((function(){n.emit("update",{type:"update"})}))}},{key:"reloadAllTile",value:function(){var e;null===(e=this.tileset)||void 0===e||e.reloadAll()}},{key:"reloadTilebyId",value:function(e,t,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileById(e,t,n)}},{key:"reloadTileByLnglat",value:function(e,t,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileByLnglat(e,t,n)}},{key:"getTileExtent",value:function(e,t){var n;return null===(n=this.tileset)||void 0===n?void 0:n.getTileExtent(e,t)}},{key:"getTileByZXY",value:function(e,t,n){var r;return null===(r=this.tileset)||void 0===r?void 0:r.getTileByZXY(e,t,n)}},{key:"reloadTileByExtent",value:function(e,t){var n;null===(n=this.tileset)||void 0===n||n.reloadTileByExtent(e,t)}},{key:"destroy",value:function(){var e;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,null===(e=this.tileset)||void 0===e||e.destroy()}},{key:"processData",value:(n=k()(w()().mark((function e(){var t=this;return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){try{t.excuteParser(),t.initCluster(),t.executeTrans(),e({})}catch(e){n(e)}})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"initCfg",value:function(e){this.cfg=Et(this.cfg,e,Tt);var t=this.cfg;t&&(t.parser&&(this.parser=t.parser),t.transforms&&(this.transforms=t.transforms),this.cluster=t.cluster||!1,t.clusterOptions&&(this.cluster=!0,this.clusterOptions=m()(m()({},this.clusterOptions),t.clusterOptions)))}},{key:"init",value:(t=k()(w()().mark((function e(){return w()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.inited=!1,e.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"excuteParser",value:function(){var e=this.parser,t=e.type||"geojson",n=o(t);this.data=n(this.originData,e),this.tileset=this.initTileset(),e.cancelExtent||(this.extent=(0,b.We)(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(e){this.center=[(e[0]+e[2])/2,(e[1]+e[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var e=this.data.tilesetOptions;if(e)return this.isTile=!0,this.tileset?(this.tileset.updateOptions(e),this.tileset):new b.nx(m()({},e))}},{key:"executeTrans",value:function(){var e=this;this.transforms.forEach((function(t){var n=function(e){return r[e]}(t.type)(e.data,t);Object.assign(e.data,n)}))}},{key:"initCluster",value:function(){if(this.cluster){var e=this.clusterOptions||{};this.clusterIndex=gt(this.data,e)}}},{key:"caculClusterExtent",value:function(e){var t=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(t=(0,b.yA)((0,b.ds)(this.extent),e)),t[0].concat(t[1])}}]),a}(pt.EventEmitter);var St=n(2729),Ct=n.n(St),Rt=6378e3;var wt=Math.PI/3,Mt=[0,wt,2*wt,3*wt,4*wt,5*wt];function kt(e){return e[0]}function Lt(e){return e[1]}n(3561);a("rasterTile",(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if($e(e))throw new Error("tile server url is error");var n=t.extent,r=void 0===n?[1/0,1/0,-1/0,-1/0]:n,i=t.coordinates,o=(null==t?void 0:t.dataType)||ze.RasterTileType.IMAGE;o===ze.RasterTileType.RGB&&(o=ze.RasterTileType.ARRAYBUFFER);var a=function(n,r){switch(o){case ze.RasterTileType.IMAGE:return qe(e,n,r,t);case ze.RasterTileType.CUSTOMIMAGE:case ze.RasterTileType.CUSTOMTERRAINRGB:return Ve(r,null==t?void 0:t.getCustomData);case ze.RasterTileType.ARRAYBUFFER:return Ye(e,n,r,t);case ze.RasterTileType.CUSTOMARRAYBUFFER:case ze.RasterTileType.CUSTOMRGB:return Ge(r,null==t?void 0:t.getCustomData,(null==t?void 0:t.format)||Ke,null==t?void 0:t.operation);default:return qe(e,n,r,t)}},s=m()(m()(m()({},Qe),t),{},{getTileData:a}),u=S(i,r);return{data:e,dataArray:[{_id:1,coordinates:u}],tilesetOptions:s,isTile:!0}})),a("mvt",(function(e,t){var n=Array.isArray(e)?e[0]:e,r=m()(m()(m()({},Ee),t),{},{getTileData:function(e,r){return Te(n,e,r,null==t?void 0:t.requestParameters,null==t?void 0:t.getCustomData)}});return{data:n,dataArray:[],tilesetOptions:r,isTile:!0}})),a("geojsonvt",(function(e,t){var n=function(e){var t={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return void 0===e||void 0===e.geojsonvtOptions?t:m()(m()({},t),e.geojsonvtOptions)}(t),r=n.extent||4096,i=function(e,t){return new ne(e,t)}(e,n);return{data:e,dataArray:[],tilesetOptions:m()(m()(m()({},fe),t),{},{getTileData:function(e,t){return ve(t,i,e,r)}}),isTile:!0}})),a("testTile",(function(e,t){return{data:e,dataArray:[],tilesetOptions:m()(m()(m()({},it),t),{},{getTileData:function(e){return ot(e)}}),isTile:!0}})),a("geojson",(function(e,t){var n=[],r={};return e.features?(e.features=e.features.filter((function(e){var t=e.geometry;return null!=e&&t&&t.type&&t.coordinates&&t.coordinates.length>0})),0===(e=A(e)).features.length?{dataArray:[],featureKeys:r}:((0,_.nG)(e,(function(e,r){var i,o,a=(i=e,void 0===(o=null==t?void 0:t.featureId)?null:"number"==typeof(1*i.properties[o])?1*i.properties[o]:i.properties&&i.properties[o]?function(e){for(var t=e.toString(),n=5381,r=t.length;r;)n=33*n^t.charCodeAt(--r);return n>>>0}(i.properties[o]+"")%1000019:null);null===a&&(a=r);var s=a,u=(0,y.r7)(e),l=m()(m()({},e.properties),{},{coordinates:u,_id:s});n.push(l)})),{dataArray:n,featureKeys:r})):(e.features=[],{dataArray:[]})})),a("jsonTile",(function(e,t){return{dataArray:[],tilesetOptions:m()(m()({},t),{},{getTileData:function(n,r){return me(e,r,null==t?void 0:t.requestParameters,t.getCustomData)}}),isTile:!0}})),a("image",ge),a("csv",(function(e,t){return C(v(e),t)})),a("json",C),a("raster",(function(e,t){var n,r,i,o=t.extent,a=void 0===o?[121.168,30.2828,121.384,30.4219]:o,s=t.coordinates,u=t.width,l=t.height,c=t.min,f=t.max,h=t.format,p=t.operation;return void 0===h||T(e)?(n=Array.from(e),r=u,i=l):n=Ne(Array.isArray(e)?e:[e],h,p),{_id:1,dataArray:[{_id:1,data:n,width:r,height:i,min:c,max:f,coordinates:S(s,a)}]}})),a("rasterRgb",(function(e,t){var n,r=t.extent,i=t.coordinates,o=t.min,a=t.max,s=t.width,u=t.height,l=t.format,c=t.operation,f=et()(t,rt);n=void 0===l||T(e)?Array.from(e):Ne(Array.isArray(e)?e:[e],l,c);var h=S(i,r);return{_id:1,dataArray:[m()(m()({_id:1,data:n,width:s,height:u},f),{},{min:o,max:a,coordinates:h})]}})),a("rgb",(function(e,t){var n=t.extent,r=t.coordinates,i=t.width,o=t.height,a=et()(t,nt);e.length<3&&console.warn("RGB解析需要三个波段的数据");for(var s=a.bands||[0,1,2],u=Me()(s,3),l=u[0],c=u[1],f=u[2],h=[e[l],e[c],e[f]],p=[],d=(null==a?void 0:a.countCut)||[2,98],v=Me()(d,2),g=v[0],y=v[1],_=(null==a?void 0:a.RMinMax)||Pe(h[0],g,y),b=(null==a?void 0:a.GMinMax)||Pe(h[1],g,y),x=(null==a?void 0:a.BMinMax)||Pe(h[2],g,y),E=0;E<h[0].length;E++)p.push(Math.max(0,h[0][E]-_[0])),p.push(Math.max(0,h[1][E]-b[0])),p.push(Math.max(0,h[2][E]-x[0]));var T=S(r,n);return{_id:1,dataArray:[m()(m()({_id:1,data:p,width:i,height:o,rMinMax:_,gMinMax:b,bMinMax:x},a),{},{coordinates:T})]}})),a("ndi",(function(e,t){var n=t.extent,r=void 0===n?[121.168,30.2828,121.384,30.4219]:n,i=t.coordinates,o=t.width,a=t.height,s=et()(t,tt);e.length<2&&console.warn("RGB解析需要2个波段的数据");for(var u=s.bands||[0,1],l=Me()(u,2),c=l[0],f=l[1],h=[e[c],e[f]],p=[],d=0;d<h[0].length;d++)p.push((h[1][d]-h[0][d])/(h[1][d]+h[0][d]));var v=S(i,r);return{_id:1,dataArray:[m()(m()({_id:1,data:p,width:o,height:a},s),{},{coordinates:v})]}})),s("cluster",gt),s("filter",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.filter(n)),e})),s("join",(function(e,t){var n=t.sourceField,r=t.targetField,i=t.data,o={};return i.forEach((function(e){o[e[n]]=e})),e.dataArray=e.dataArray.map((function(e){var t=e[r];return m()(m()({},e),o[t])})),e})),s("map",(function(e,t){var n=t.callback;return n&&(e.dataArray=e.dataArray.map(n)),e})),s("grid",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,o=i/(2*Math.PI*Rt)*(256<<20)/2,a=function(e,t){var n,r,i=1/0,o=-1/0,a=Ct()(e);try{for(a.s();!(r=a.n()).done;){n=r.value.coordinates[1],Number.isFinite(n)&&(i=n<i?n:i,o=n>o?n:o)}}catch(e){a.e(e)}finally{a.f()}var s=(u=t,l=(i+o)/2,h=u,c=h/Rt*(180/Math.PI),f=function(e,t){return t/Rt*(180/Math.PI)/Math.cos(e*Math.PI/180)}(l,u),{yOffset:c,xOffset:f});var u,l,c,f,h;if(s.xOffset<=0||s.yOffset<=0)return{gridHash:{},gridOffset:s};var p,d={},v=Ct()(e);try{for(v.s();!(p=v.n()).done;){var g=p.value,m=g.coordinates[1],y=g.coordinates[0];if(Number.isFinite(m)&&Number.isFinite(y)){var _=Math.floor((m+90)/s.yOffset),b=Math.floor((y+180)/s.xOffset),x="".concat(_,"-").concat(b);d[x]=d[x]||{count:0,points:[]},d[x].count+=1,d[x].points.push(g)}}}catch(e){v.e(e)}finally{v.f()}return{gridHash:d,gridOffset:s}}(n,i),s=function(e,t,n){return Object.keys(e).reduce((function(r,i,o){var a=i.split("-"),s=parseInt(a[0],10),u=parseInt(a[1],10),l={};if(n.field&&n.method){var c=b.a5.getColumn(e[i].points,n.field);l[n.method]=b.a5.statMap[n.method](c)}return Object.assign(l,{_id:o,coordinates:(0,b.Z)([t.xOffset*(u+.5)-180,t.yOffset*(s+.5)-90]),rawData:e[i].points,count:e[i].count}),r.push(l),r}),[])}(a.gridHash,a.gridOffset,t);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:s}})),s("hexagon",(function(e,t){var n=e.dataArray,r=t.size,i=void 0===r?10:r,o=t.method,a=void 0===o?"sum":o,s=i/(2*Math.PI*6378e3)*(256<<20)/2,u=n.map((function(e){var t=(0,b.Z)(e.coordinates),n=Me()(t,2),r=n[0],i=n[1];return m()(m()({},e),{},{coordinates:[r,i]})})),l=function(){var e,t,n,r=0,i=0,o=1,a=1,s=kt,u=Lt;function l(e){var r,i={},o=[],a=e.length;for(r=0;r<a;++r)if(!isNaN(c=+s.call(null,l=e[r],r,e))&&!isNaN(f=+u.call(null,l,r,e))){var l,c,f,h=Math.round(f/=n),p=Math.round(c=c/t-(1&h)/2),d=f-h;if(3*Math.abs(d)>1){var v=c-p,g=p+(c<p?-1:1)/2,m=h+(f<h?-1:1),y=c-g,_=f-m;v*v+d*d>y*y+_*_&&(p=g+(1&h?1:-1)/2,h=m)}var b=p+"-"+h,x=i[b];x?x.push(l):(o.push(x=i[b]=[l]),x.x=(p+(1&h)/2)*t,x.y=h*n)}return o}function c(e){var t=0,n=0;return Mt.map((function(r){var i=Math.sin(r)*e,o=-Math.cos(r)*e,a=i-t,s=o-n;return t=i,n=o,[a,s]}))}return l.hexagon=function(t){return"m"+c(null==t?e:+t).join("l")+"z"},l.centers=function(){for(var s=[],u=Math.round(i/n),l=Math.round(r/t),c=u*n;c<a+e;c+=n,++u)for(var f=l*t+(1&u)*t/2;f<o+t/2;f+=t)s.push([f,c]);return s},l.mesh=function(){var t=c(e).slice(0,4).join("l");return l.centers().map((function(e){return"M"+e+"m"+t})).join("")},l.x=function(e){return arguments.length?(s=e,l):s},l.y=function(e){return arguments.length?(u=e,l):u},l.radius=function(r){return arguments.length?(t=2*(e=+r)*Math.sin(wt),n=1.5*e,l):e},l.size=function(e){return arguments.length?(r=i=0,o=+e[0],a=+e[1],l):[o-r,a-i]},l.extent=function(e){return arguments.length?(r=+e[0][0],i=+e[0][1],o=+e[1][0],a=+e[1][1],l):[[r,i],[o,a]]},l.radius(1)}().radius(s).x((function(e){return e.coordinates[0]})).y((function(e){return e.coordinates[1]}));return{dataArray:l(u).map((function(e,n){if(t.field&&a){var r=b.a5.getColumn(e,t.field);e[a]=b.a5.statMap[a](r)}return le()(le()(le()(le()(le()({},t.method,e[a]),"count",e.length),"rawData",e),"coordinates",[e.x,e.y]),"_id",n)})),radius:s,xOffset:s,yOffset:s,type:"hexagon"}}));var Ot=At},3561:function(){},7193:function(e,t,n){"use strict";n.d(t,{Uj:function(){return T},e2:function(){return dn},SO:function(){return r},iH:function(){return Lt},z6:function(){return Rn},Qj:function(){return jn},a5:function(){return i},SA:function(){return x},LZ:function(){return er},nx:function(){return or},dD:function(){return Vn},Z:function(){return qt},TG:function(){return Qt},S8:function(){return $t},rQ:function(){return U},bV:function(){return D},zi:function(){return F},ds:function(){return rn},Ev:function(){return kt},oO:function(){return nn},mt:function(){return un},Lw:function(){return an},SI:function(){return fn},Rx:function(){return hn},W0:function(){return j},LS:function(){return cr},h8:function(){return vn},Z6:function(){return H},Gk:function(){return sr},We:function(){return zt},ls:function(){return cn},Co:function(){return B},Ks:function(){return Dt},hj:function(){return Z},Cl:function(){return W},Oc:function(){return q},M4:function(){return X},NJ:function(){return Y},_O:function(){return ln},ks:function(){return w},Ol:function(){return pn},Yu:function(){return k},ZB:function(){return Q},gJ:function(){return N},xA:function(){return R},Y3:function(){return E},an:function(){return St},rJ:function(){return $n},qD:function(){return Jn},z0:function(){return ur},jG:function(){return lr},M8:function(){return gn},Dt:function(){return wt},D5:function(){return G},fg:function(){return Tt},Id:function(){return Bt},Ro:function(){return Mt},Xj:function(){return ar},hJ:function(){return At},Tt:function(){return Rt},pq:function(){return Zt},LT:function(){return Sn},wj:function(){return Cn},if:function(){return Ft},vP:function(){return Ht},yM:function(){return Jt},rU:function(){return Xe},MS:function(){return Xt},LF:function(){return S},Uv:function(){return Wt},Fv:function(){return on},RV:function(){return qn},cN:function(){return Kn},yA:function(){return tn},qC:function(){return M},iV:function(){return en},CI:function(){return V},_0:function(){return L},Dv:function(){return Qn},Jo:function(){return Vt},ih:function(){return Kt},Fb:function(){return Yt}});var r={};n.r(r),n.d(r,{DPR:function(){return ht},addClass:function(){return Je},addStyle:function(){return pt},appendElementType:function(){return xt},clearChildren:function(){return _t},create:function(){return Qe},css2Style:function(){return gt},empty:function(){return ot},findParentElement:function(){return Et},getClass:function(){return it},getContainer:function(){return Ye},getDiffRect:function(){return mt},getStyleList:function(){return dt},getViewPortScale:function(){return ct},hasClass:function(){return tt},printCanvas:function(){return lt},remove:function(){return $e},removeClass:function(){return et},removeStyle:function(){return vt},setChecked:function(){return yt},setClass:function(){return nt},setTransform:function(){return st},setUnDraggable:function(){return bt},splitWords:function(){return Ke},toggleClass:function(){return rt},triggerResize:function(){return ut},trim:function(){return qe}});var i={};n.r(i),n.d(i,{getColumn:function(){return Pn},getSatByColumn:function(){return Nn},max:function(){return wn},mean:function(){return Ln},min:function(){return Mn},mode:function(){return On},statMap:function(){return In},sum:function(){return kn}});var o=n(4450),a=n.n(o),s=n(1133),u=n.n(s),l=n(8025),c=n.n(l),f=n(1119),h=n.n(f),p=n(3491),d=n.n(p),v=n(2060),g=n.n(v),m=n(4692),y=n.n(m),_=n(3769),b=n.n(_),x={REGISTERED_PROTOCOLS:{}},E=function(e){return x.REGISTERED_PROTOCOLS[e.substring(0,e.indexOf("://"))]},T=function(e){d()(n,e);var t=g()(n);function n(e,r,i,o){var a;return c()(this,n),a=t.call(this,"AJAXError: ".concat(r," (").concat(e,"): ").concat(i)),b()(h()(a),"status",void 0),b()(h()(a),"statusText",void 0),b()(h()(a),"url",void 0),b()(h()(a),"body",void 0),a.status=e,a.statusText=r,a.url=i,a.body=o,a}return u()(n)}(y()(Error));function A(e,t){var n=new XMLHttpRequest,r=Array.isArray(e.url)?e.url[0]:e.url;for(var i in n.open(e.method||"GET",r,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer"),e.headers)e.headers.hasOwnProperty(i)&&n.setRequestHeader(i,e.headers[i]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var i=n.response;if("json"===e.type)try{i=JSON.parse(n.response)}catch(e){return t(e)}t(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"),n)}else{var o=new Blob([n.response],{type:n.getResponseHeader("Content-Type")});t(new T(n.status,n.statusText,r.toString(),o))}},n.cancel=n.abort,n.send(e.body),n}function S(e){return new Promise((function(t,n){A(e,(function(e,r,i,o,a){e?n({err:e,data:null,xhr:a}):t({err:null,data:r,cacheControl:i,expires:o,xhr:a})}))}))}function C(e,t){return A(e,t)}var R=function(e,t){return(E(e.url)||C)(a()(a()({},e),{},{type:"json"}),t)},w=function(e,t){return(E(e.url)||C)(a()(a()({},e),{},{type:"arrayBuffer"}),t)},M=function(e,t){return C(a()(a()({},e),{},{method:"POST"}),t)},k=function(e,t){return C(a()(a()({},e),{},{method:"GET"}),t)};function L(e){var t=window.document.createElement("a");return t.href=e,t.protocol===window.document.location.protocol&&t.host===window.document.location.host}var O="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function I(e,t){var n=new window.Image,r=window.URL||window.webkitURL;n.crossOrigin="anonymous",n.onload=function(){t(null,n),r.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame((function(){n.src=O}))},n.onerror=function(){return t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(e)],{type:"image/png"});n.src=e.byteLength?r.createObjectURL(i):O}function P(e,t){var n=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(n).then((function(e){t(null,e)})).catch((function(e){t(new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))}))}var N=function(e,t,n){var r=function(e,r){if(e)t(e);else if(r){var i="function"==typeof createImageBitmap,o=n?n(r):r;i?P(o,t):I(o,t)}};return"json"===e.type?R(e,r):w(e,r)},B=function(e,t){"function"==typeof createImageBitmap?P(e,t):I(e,t)},D=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),U={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function F(e,t,n){var r=e.classList;for(var i in U)U.hasOwnProperty(i)&&r.remove("l7-".concat(n,"-anchor-").concat(i));r.add("l7-".concat(n,"-anchor-").concat(t))}var z=n(7361);function G(e){return"string"==typeof e&&!!z.ZP(e)}function V(e){var t=z.ZP(e),n=[0,0,0,0];return null!=t&&(n[0]=t.r/255,n[1]=t.g/255,n[2]=t.b/255,n[3]=t.opacity),n}function j(e){return(e&&e[0])+256*(e&&e[1])+65536*(e&&e[2])-1}function H(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function W(e){var t=window.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var r,i=n.createLinearGradient(0,0,256,1),o=e.positions[0],a=e.positions[e.positions.length-1],s=0;s<e.colors.length;++s){var u=(e.positions[s]-o)/(a-o);i.addColorStop(u,e.colors[s])}return n.fillStyle=i,n.fillRect(0,0,256,1),r=new Uint8ClampedArray(n.getImageData(0,0,256,1).data),t=null,n=null,{data:r,width:256,height:1}}function X(e,t){var n=window.document.createElement("canvas"),r=n.getContext("2d");n.width=256,n.height=1;for(var i=r.createLinearGradient(0,0,256,1),o=t[1]-t[0],a=0;a<e.colors.length;++a){var s=Math.max((e.positions[a]-t[0])/o,0);i.addColorStop(s,e.colors[a])}r.fillStyle=i,r.fillRect(0,0,256,1);var u=r.getImageData(0,0,256,1).data,l=K(r,u);return n=null,r=null,l}function Z(e){var t=window.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;var r=n.createImageData(256,1);return r.data.fill(0),e.positions.forEach((function(t,n){var i=V(e.colors[n]);r.data[4*t+0]=255*i[0],r.data[4*t+1]=255*i[1],r.data[4*t+2]=255*i[2],r.data[4*t+3]=255*i[3]})),t=null,n=null,r}function Y(e){var t=window.document.createElement("canvas"),n=t.getContext("2d");n.globalAlpha=1,t.width=256,t.height=1;for(var r=256/e.colors.length,i=0;i<e.colors.length;i++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[i],n.moveTo(i*r,0),n.lineTo((i+1)*r,0),n.stroke();var o=n.getImageData(0,0,256,1).data,a=K(n,o);return t=null,n=null,a}function q(e,t){var n=window.document.createElement("canvas"),r=n.getContext("2d");r.globalAlpha=1,n.width=256,n.height=1;var i=t[1]-t[0];e.positions.length-e.colors.length!=1&&console.warn("positions 的数字个数应当比 colors 的样式多一个,poisitions 的首尾值一般为数据的最大最新值");for(var o=0;o<e.colors.length;o++)r.beginPath(),r.lineWidth=2,r.strokeStyle=e.colors[o],r.moveTo((e.positions[o]-t[0])/i*255,0),r.lineTo((e.positions[o+1]-t[0])/i*255,0),r.stroke();var a=r.getImageData(0,0,256,1).data,s=K(r,a);return n=null,r=null,s}function K(e,t){for(var n=e.createImageData(256,1),r=0;r<n.data.length;r+=4)n.data[r+0]=t[r+0],n.data[r+1]=t[r+1],n.data[r+2]=t[r+2],n.data[r+3]=t[r+3];return n}function Q(e){return"cat"===(null==e?void 0:e.type)?[0,255]:[0,1]}var $=n(2786),J=n.n($),ee=n(3420),te=n.n(ee),ne=n(263),re=n.n(ne),ie=n(2281),oe=n.n(ie),ae=n(8199),se=n.n(ae),ue=n(6890),le=n.n(ue),ce=n(4345),fe=n.n(ce),he=n(28),pe=n.n(he),de=n(3426),ve=n.n(de),ge=n(3759),me=n.n(ge),ye=n(1091),_e=n.n(ye),be=n(2293),xe=n.n(be),Ee=n(3749),Te=n.n(Ee),Ae=n(3447),Se=n.n(Ae),Ce=n(6281),Re=n.n(Ce),we=n(2630),Me=n.n(we),ke=n(5966),Le=n.n(ke),Oe=n(651),Ie=n.n(Oe),Pe=n(920),Ne=n.n(Pe),Be=n(2530),De=n.n(Be),Ue=n(8137),Fe=n.n(Ue),ze=n(8605),Ge=n.n(ze),Ve=n(9726),je=n.n(Ve),He=n(7145),We=n.n(He),Xe={isNil:ve(),merge:Se(),throttle:Le(),isString:xe(),debounce:se(),pull:Me(),isTypedArray:Te(),isPlainObject:_e(),isNumber:me(),isBoolean:fe(),isEqual:pe(),cloneDeep:oe(),uniq:Ie(),clamp:re(),upperFirst:Ne(),get:le(),mergeWith:Re(),isFunction:De(),isObject:Fe(),isUndefined:Ge(),camelCase:je(),uniqueId:We()},Ze=Xe.pull;function Ye(e){var t=e;return"string"==typeof e&&(t=window.document.getElementById(e)),t}function qe(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Ke(e){return qe(e).split(/\s+/)}function Qe(e,t,n){var r=window.document.createElement(e);return t&&(r.className=t||""),n&&n.appendChild(r),r}function $e(e){var t=e.parentNode;t&&t.removeChild(e)}function Je(e,t){if(void 0!==e.classList)for(var n=Ke(t),r=0,i=n.length;r<i;r++)e.classList.add(n[r]);else if(!tt(e,t)){var o=it(e);nt(e,(o?o+" ":"")+t)}}function et(e,t){void 0!==e.classList?Ke(t).forEach((function(t){e.classList.remove(t)})):nt(e,qe((" "+it(e)+" ").replace(" "+t+" "," ")))}function tt(e,t){if(void 0!==e.classList)return e.classList.contains(t);var n=it(e);return n.length>0&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(n)}function nt(e,t){e instanceof HTMLElement?e.className=t:e.className.baseVal=t}function rt(e,t,n){void 0===n?tt(e,t)?et(e,t):Je(e,t):n?Je(e,t):et(e,t)}function it(e){return e instanceof SVGElement&&(e=e.correspondingElement),void 0===e.className.baseVal?e.className:e.className.baseVal}function ot(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var at=function(e){var t,n=null===(t=document)||void 0===t||null===(t=t.documentElement)||void 0===t?void 0:t.style;if(!n)return e[0];for(var r in e)if(e[r]&&e[r]in n)return e[r];return e[0]}(["transform","WebkitTransform"]);function st(e,t){e.style[at]=t}function ut(){if("function"==typeof Event)window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function lt(e){var t=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log("%c\n",t.join(""))}function ct(){var e,t=window.document.querySelector('meta[name="viewport"]');if(!t)return 1;var n=(null===(e=t.content)||void 0===e?void 0:e.split(",")).find((function(e){var t=e.split("=");return"initial-scale"===te()(t,1)[0]}));return n?1*n.split("=")[1]:1}var ft,ht=ct()<1?1:window.devicePixelRatio;function pt(e,t){e.setAttribute("style","".concat(e.style.cssText).concat(t))}function dt(e){return e.split(";").map((function(e){return e.trim()})).filter((function(e){return e}))}function vt(e,t){var n,r=dt(null!==(n=e.getAttribute("style"))&&void 0!==n?n:""),i=dt(t),o=Ze.apply(void 0,[r].concat(J()(i)));e.setAttribute("style",o.join(";"))}function gt(e){return Object.entries(e).map((function(e){var t=te()(e,2),n=t[0],r=t[1];return"".concat(n,": ").concat(r)})).join(";")}function mt(e,t){return{left:e.left-t.left,top:e.top-t.top,right:t.left+t.width-e.left-e.width,bottom:t.top+t.height-e.top-e.height}}function yt(e,t){e.checked=t,t?e.setAttribute("checked","true"):e.removeAttribute("checked")}function _t(e){e.innerHTML=""}function bt(e){e.setAttribute("draggable","false")}function xt(e,t){if("string"==typeof t){var n=document.createElement("div");for(n.innerHTML=t;n.firstChild;)e.append(n.firstChild)}else Array.isArray(t)?e.append.apply(e,J()(t)):e.append(t)}function Et(e,t){for(var n=Array.isArray(t)?t:[t],r=e;r instanceof Element&&r!==window.document.body;){var i,o;if(n.find((function(e){var t;return null===(t=r)||void 0===t?void 0:t.matches(e)})))return r;r=null!==(i=null===(o=r)||void 0===o?void 0:o.parentElement)&&void 0!==i?i:null}}function Tt(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap}function At(){return"function"==typeof importScripts}var St=At()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===window.location.protocol?window.parent:window).location.href},Ct=null===(ft=navigator)||void 0===ft?void 0:ft.userAgent,Rt=!!Ct.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),wt=Ct.indexOf("Android")>-1||Ct.indexOf("Adr")>-1;function Mt(){for(var e=Ct,t=!0,n=0,r=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"];n<r.length;n++){var i=r[n];if(e.indexOf(i)>0){t=!1;break}}return t}function kt(e,t){e.forEach((function(e){t[e]&&(t[e]=t[e].bind(t))}))}var Lt=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;c()(this,e),b()(this,"duration",16),b()(this,"timestamp",(new Date).getTime()),this.duration=t}return u()(e,[{key:"run",value:function(e){var t=(new Date).getTime(),n=t-this.timestamp;this.timestamp=t,n>=this.duration&&e()}}]),e}(),Ot=n(4612);function It(e){var t=[1/0,1/0,-1/0,-1/0];return(0,Ot.pZ)(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}It.default=It;var Pt=It,Nt=n(23);function Bt(e){return"number"==typeof e}function Dt(e){return e-Math.fround(e)}var Ut=2*Math.PI*6378137/2;function Ft(e,t){var n=te()(t,4),r=n[0],i=n[1],o=n[2],a=n[3];return e.lng>r&&e.lng<=o&&e.lat>i&&e.lat<=a}function zt(e){var t=[1/0,1/0,-1/0,-1/0];return e.forEach((function(e){var n=e.coordinates;Gt(t,n)})),t}function Gt(e,t){return Array.isArray(t[0])?t.forEach((function(t){Gt(e,t)})):(e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])),e}function Vt(e,t){return jt(e,t)}function jt(e,t){return Array.isArray(e[0])?e.map((function(e){return jt(e,t)})):t(e)}function Ht(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{enable:!0,decimal:1},r=(e=Yt(e,t))[0],i=e[1],o=r*Ut/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*Ut/180,n.enable&&(o=Number(o.toFixed(n.decimal)),a=Number(a.toFixed(n.decimal))),3===e.length?[o,a,e[2]]:[o,a]}function Wt(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=e[0],r=e[1],i=n/Ut*180,o=r/Ut*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),null!=t&&(i=Number(i.toFixed(t)),o=Number(o.toFixed(t))),3===e.length?[i,o,e[2]]:[i,o]}function Xt(e){if(null==e)throw new Error("lng is required");return(e>180||e<-180)&&((e%=360)>180&&(e=-360+e),e<-180&&(e=360+e),0===e&&(e=0)),e}function Zt(e){if(null==e)throw new Error("lat is required");return(e>90||e<-90)&&((e%=180)>90&&(e=-180+e),e<-90&&(e=180+e),0===e&&(e=0)),e}function Yt(e,t){if(!1===t)return e;var n=Xt(e[0]),r=Zt(e[1]);return r>85&&(r=85),r<-85&&(r=-85),3===e.length?[n,r,e[2]]:[n,r]}function qt(e){var t=85.0511287798,n=Math.max(Math.min(t,e[1]),-t),r=256<<20,i=Math.PI/180,o=e[0]*i,a=n*i;a=Math.log(Math.tan(Math.PI/4+a/2));return o=r*(.5/Math.PI*o+.5),a=r*(-.5/Math.PI*a+(i=.5)),[Math.floor(o),Math.floor(a)]}function Kt(e){var t=.5/Math.PI,n=-.5/Math.PI,r=.5,i=256<<20,o=te()(e,2),a=o[0],s=o[1];return a=(a/i-.5)/t,s=(s/i-r)/n,s=2*(Math.atan(Math.pow(Math.E,s))-Math.PI/4),[a/(r=Math.PI/180),s/r]}function Qt(e,t){var n=85.0511287798,r=Math.PI/180,i=6378137;return t=Math.max(Math.min(n,t),-n),t*=r,[(e*=r)*i,(t=Math.log(Math.tan(Math.PI/4+t/2)))*i]}function $t(e,t){var n=Math.PI/180,r=6378137;return[e/r/n,2*(Math.atan(Math.exp(t/r))-Math.PI/4)/n]}function Jt(e,t,n){var r=(0,Nt.Ht)(t[1]-e[1]),i=(0,Nt.Ht)(t[0]-e[0]),o=(0,Nt.Ht)(e[1]),a=(0,Nt.Ht)(t[1]),s=Math.pow(Math.sin(r/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(o)*Math.cos(a);return(0,Nt.DL)(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters")}function en(e){var t=Math.PI/180,n=85.0511287798,r=6378137,i=Math.max(Math.min(n,e[1]),-n),o=Math.sin(i*t);return[r*e[0]*t,r*Math.log((1+o)/(1-o))/2]}function tn(e,t){var n=Math.abs(e[1][1]-e[0][1])*t,r=Math.abs(e[1][0]-e[0][0])*t;return[[e[0][0]-r,e[0][1]-n],[e[1][0]+r,e[1][1]+n]]}function nn(e,t){return e[0][0]<=t[0][0]&&e[0][1]<=t[0][1]&&e[1][0]>=t[1][0]&&e[1][1]>=t[1][1]}function rn(e){return[[e[0],e[1]],[e[2],e[3]]]}function on(e){var t=an(e,[0,0]);return[e[0]/t,e[1]/t]}function an(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function sn(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function un(e,t){return 180*Math.acos(function(e,t){return e[0]*t[0]+e[1]*t[1]}(e,t)/(sn(e)*sn(t)))/Math.PI}function ln(e,t){return t[0]>0?t[1]>0?90-180*Math.atan(t[1]/t[0])/Math.PI:90+180*Math.atan(-t[1]/t[0])/Math.PI:t[1]<0?90-180*Math.atan(t[1]/t[0])/Math.PI+180:270+180*Math.atan(t[1]/-t[0])/Math.PI}function cn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;if(e&&!(e.length<2)){for(var n=0,r=[],i=0;i<e.length-1;i++){var o=e[i],a=e[i+1],s=an(o,a);n+=s;var u=[o[0]-a[0],o[1]-a[1]],l=ln(0,u);if(i>0){var c=r[i-1].rotation;c-l>360-c+l&&(l+=360)}r.push({start:o,end:a,dis:s,rotation:l,duration:0})}return r.map((function(e){e.duration=t*(e.dis/n)})),r}}function fn(e){if(Bt(e[0]))return e;if(Bt(e[0][0]))throw new Error("当前数据不支持标注");if(Bt(e[0][0][0])){var t=0,n=0,r=0;return e.forEach((function(e){e.forEach((function(e){t+=e[0],n+=e[1],r++}))})),[t/r,n/r,0]}throw new Error("当前数据不支持标注")}function hn(e){for(var t=e[0],n=e[1],r=e[0],i=e[1],o=0,a=0,s=0,u=0;u<e.length;u+=2){var l=e[u],c=e[u+1];l&&c&&(t=Math.max(l,t),n=Math.max(c,n),r=Math.min(l,r),i=Math.min(c,i),o+=l,a+=c,s++)}return{center:[o/s,a/s],radius:Math.sqrt(Math.pow(t-r,2)+Math.pow(n-i,2))/2}}function pn(e){return Pt((0,Nt.uf)([(0,Nt.Tu)(e)]))}function dn(e){var t=0;e+="x";for(var n=Math.floor(65745979961613.07),r=0;r<e.length;r++)t>n&&(t=Math.floor(t/137)),t=131*t+e.charCodeAt(r);return t}function vn(e){for(var t=5381,n=(e=e.toString()).length;n;)t=33*t^e.charCodeAt(--n);return t>>>0}function gn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))}function mn(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,o=arguments.length>5?arguments[5]:void 0,a=n;return o&&(a=Math.round(n*(i-1))/(i-1)),bn(e,t,a,r||.314)}function yn(e,t){var n=1-t;return(e[0]*n+e[1]*t)*n+(e[1]*n+e[2]*t)*t}function _n(e,t,n){var r,i,o=[t[0]-e[0],t[1]-e[1]],a=(r=o,i=[0,0],Math.sqrt(Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2))),s=Math.atan2(o[1],o[0]),u=a/2/Math.cos(n),l=s+n;return[u*Math.cos(l)+e[0],u*Math.sin(l)+e[1]]}function bn(e,t,n,r){var i=_n(e,t,r),o=[e[0],i[0],t[0]],a=[e[1],i[1],t[1]];return[yn(o,n),yn(a,n),0]}function xn(e,t,n,r){var i=arguments.length>5?arguments[5]:void 0,o=n;return i&&(o=Math.round(29*n)/29),En(e,t,o)}function En(e,t,n){var r=[(0,Nt.Ht)(e[0]),(0,Nt.Ht)(e[1])],i=[(0,Nt.Ht)(t[0]),(0,Nt.Ht)(t[1])],o=function(e,t){var n=[e[0]-t[0],e[1]-t[1]],r=[Math.sin(n[0]/2),Math.sin(n[1]/2)],i=r[1]*r[1]+Math.cos(e[1])*Math.cos(t[1])*r[0]*r[0];return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}(r,i);if(Math.abs(o-Math.PI)<.001)return[(1-n)*r[0]+n*i[0],(1-n)*r[1]+n*i[1]];var a=Math.sin((1-n)*o)/Math.sin(o),s=Math.sin(n*o)/Math.sin(o),u=[Math.sin(r[0]),Math.sin(r[1])],l=[Math.cos(r[0]),Math.cos(r[1])],c=[Math.sin(i[0]),Math.sin(i[1])],f=[Math.cos(i[0]),Math.cos(i[1])],h=a*l[1]*l[0]+s*f[1]*f[0],p=a*l[1]*u[0]+s*f[1]*c[0],d=a*u[1]+s*c[1];return[(0,Nt.vi)(Math.atan2(p,h)),(0,Nt.vi)(Math.atan2(d,Math.sqrt(h*h+p*p)))]}function Tn(e,t,n){return[e[0]*n+t[0]*(1-n),e[1]*n+t[1]*(1-n)]}function An(e,t){return Math.sqrt(Math.pow(e[0]-t[0],2)+Math.pow(e[1]-t[1],2))}function Sn(e,t){var n=t.featureId,r=e.data.dataArray;return"number"==typeof n&&(r=r.filter((function(e){return e.id===n}))),r.map((function(e){var n=function(e,t){var n=t.offset,r=t.shape,i=t.thetaOffset,o=t.segmentNumber,a=void 0===o?30:o,s=t.autoFit,u=void 0===s||s,l=e.coordinates;if("line"===r)return function(e,t){for(var n=0,r=[],i=0;i<e.length-1;i++){var o=e[i],a=e[i+1],s=An(o,a),u=n;n+=s,r.push({p1:o,p2:a,totalDistance:n,distance:s,lastTotalDistance:u})}for(var l,c,f=n*t,h=0,p=r;h<p.length;h++){var d=p[h];if(d.totalDistance>f){var v=d.p1,g=Tn(d.p2,v,(f-d.lastTotalDistance)/d.distance);l=g[0],c=g[1];break}}return{lng:l,lat:c,height:0}}(l,n);var c,f=l[0],h=l[1],p="string"==typeof i?e[i]||0:i;switch(r){case"arc":default:c=mn;break;case"greatcircle":c=xn}var d=c(f,h,n,p,a,u),v=te()(d,3),g=v[0],m=v[1],y=v[2];return{lng:g,lat:m,height:y}}(e,t);return a()(a()({},e),n)}))}function Cn(e,t){return new Promise((function(n){e.inited?n(Sn(e,t)):e.once("update",(function(){n(Sn(e,t))}))}))}var Rn=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;c()(this,e),b()(this,"limit",void 0),b()(this,"cache",void 0),b()(this,"destroy",void 0),b()(this,"order",void 0),this.limit=t,this.destroy=n||this.defaultDestroy,this.order=[],this.clear()}return u()(e,[{key:"clear",value:function(){var e=this;this.order.forEach((function(t){e.delete(t)})),this.cache={},this.order=[]}},{key:"get",value:function(e){var t=this.cache[e];return t&&(this.deleteOrder(e),this.appendOrder(e)),t}},{key:"set",value:function(e,t){this.cache[e]?(this.delete(e),this.cache[e]=t,this.appendOrder(e)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[e]=t,this.appendOrder(e))}},{key:"delete",value:function(e){var t=this.cache[e];t&&(this.deleteCache(e),this.deleteOrder(e),this.destroy(t,e))}},{key:"deleteCache",value:function(e){delete this.cache[e]}},{key:"deleteOrder",value:function(e){var t=this.order.findIndex((function(t){return t===e}));t>=0&&this.order.splice(t,1)}},{key:"appendOrder",value:function(e){this.order.push(e)}},{key:"defaultDestroy",value:function(e,t){return null}}]),e}();function wn(e){if(0===e.length)throw new Error("max requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]>t&&(t=e[n]);return 1*t}function Mn(e){if(0===e.length)throw new Error("min requires at least one data point");for(var t=e[0],n=1;n<e.length;n++)e[n]<t&&(t=e[n]);return 1*t}function kn(e){if(0===e.length)return 0;for(var t=1*e[0],n=1;n<e.length;n++)t+=1*e[n];return t}function Ln(e){if(0===e.length)throw new Error("mean requires at least one data point");return kn(e)/e.length}function On(e){if(0===e.length)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var t=e[0],n=NaN,r=0,i=1,o=1;o<e.length+1;o++)e[o]!==t?(i>r&&(r=i,n=t),i=1,t=e[o]):i++;return 1*n}var In={min:Mn,max:wn,mean:Ln,sum:kn,mode:On};function Pn(e,t){return e.map((function(e){return e[t]}))}function Nn(e,t){return In[e](t)}var Bn=n(6502),Dn=n.n(Bn),Un=n(4351),Fn=n.n(Un);var zn=n(3262),Gn=n.n(zn),Vn=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),jn=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({});function Hn(e){for(;e;){if(e.isLoaded)return e.properties.state|=2,!0;e=e.parent}return!1}function Wn(e){e.children.forEach((function(e){e.isLoaded?e.properties.state|=2:Wn(e)}))}var Xn=[-1/0,-1/0,1/0,1/0],Zn=b()(b()(b()({},Vn.Realtime,(function(e){e.forEach((function(e){e.isCurrent&&(e.isVisible=e.isLoaded)}))})),Vn.Overlap,(function(e){e.forEach((function(e){e.properties.state=0})),e.forEach((function(e){e.isCurrent&&!Hn(e)&&Wn(e)})),e.forEach((function(e){e.isVisible=Boolean(2&e.properties.state)}))})),Vn.Replace,(function(e){e.forEach((function(e){e.properties.state=0})),e.forEach((function(e){e.isCurrent&&Hn(e)})),e.slice().sort((function(e,t){return e.z-t.z})).forEach((function(e){e.isVisible=Boolean(2&e.properties.state),e.children.length&&(e.isVisible||1&e.properties.state)?e.children.forEach((function(e){e.properties.state=1})):e.isCurrent&&Wn(e)}))})),Yn=function(){};function qn(e,t,n){return[Math.floor((e+180)/360*Math.pow(2,n)),Math.floor((1-Math.log(Math.tan(t*Math.PI/180)+1/Math.cos(t*Math.PI/180))/Math.PI)/2*Math.pow(2,n))]}function Kn(e,t,n){var r=e/Math.pow(2,n)*360-180,i=Math.PI-2*Math.PI*t/Math.pow(2,n);return[r,180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)))]}var Qn=function(e,t,n){var r=Kn(e,t,n),i=te()(r,2),o=i[0],a=i[1],s=Kn(e+1,t+1,n),u=te()(s,2),l=u[0];return[o,u[1],l,a]};function $n(e){var t=e.zoom,n=e.latLonBounds,r=e.maxZoom,i=void 0===r?1/0:r,o=e.minZoom,a=void 0===o?0:o,s=e.zoomOffset,u=void 0===s?0:s,l=e.extent,c=void 0===l?Xn:l,f=Math.ceil(t)+u;if(Number.isFinite(a)&&f<a)return[];Number.isFinite(i)&&f>i&&(f=i);for(var h=te()(n,4),p=h[0],d=h[1],v=h[2],g=h[3],m=[Math.max(p,c[0]),Math.max(d,c[1]),Math.min(v,c[2]),Math.min(g,c[3])],y=[],_=qn(m[0],m[1],f),b=te()(_,2),x=b[0],E=b[1],T=qn(m[2],m[3],f),A=te()(T,2),S=A[0],C=A[1],R=x;R<=S;R++)for(var w=C;w<=E;w++)y.push({x:R,y:w,z:f});var M=(S+x)/2,k=(E+C)/2,L=function(e,t){return Math.abs(e-M)+Math.abs(t-k)};return y.sort((function(e,t){return L(e.x,e.y)-L(t.x,t.y)})),y}var Jn=function(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=Math.pow(2,n),o=i-1,a=e;return r&&(a<0?a+=i:a>o&&(a%=i)),{warpX:a,warpY:t}},er=function(e){d()(r,e);var t,n=g()(r);function r(e){var t;c()(this,r),t=n.call(this),b()(h()(t),"x",void 0),b()(h()(t),"y",void 0),b()(h()(t),"z",void 0),b()(h()(t),"warp",void 0),b()(h()(t),"tileSize",256),b()(h()(t),"isVisible",!1),b()(h()(t),"isCurrent",!1),b()(h()(t),"isVisibleChange",!1),b()(h()(t),"loadedLayers",0),b()(h()(t),"isLayerLoaded",!1),b()(h()(t),"isLoad",!1),b()(h()(t),"isChildLoad",!1),b()(h()(t),"parent",null),b()(h()(t),"children",[]),b()(h()(t),"data",null),b()(h()(t),"properties",{}),b()(h()(t),"xhrCancel",void 0),b()(h()(t),"loadStatus",void 0),b()(h()(t),"abortController",void 0),b()(h()(t),"loadDataId",0);var i=e.x,o=e.y,a=e.z,s=e.tileSize,u=e.warp,l=void 0===u||u;return t.x=i,t.y=o,t.z=a,t.warp=l||!0,t.tileSize=s,t}return u()(r,[{key:"isLoading",get:function(){return this.loadStatus===jn.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===jn.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===jn.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===jn.Cancelled}},{key:"isDone",get:function(){return[jn.Loaded,jn.Cancelled,jn.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Qn(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var e=te()(this.bounds,4),t=e[0],n=e[1],r=[(e[2]-t)/2,(e[3]-n)/2],i=function(e,t){void 0===t&&(t={});var n=Number(e[0]),r=Number(e[1]),i=Number(e[2]),o=Number(e[3]);if(6===e.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[n,r],s=[n,o],u=[i,o],l=[i,r];return(0,Nt.yu)([[a,l,u,s,a]],t.properties,{bbox:e,id:t.id})}(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:r,meta:"\n      ".concat(this.key,"\n      ")}});return i}},{key:"key",get:function(){return"".concat(this.x,"_").concat(this.y,"_").concat(this.z)}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:(t=Fn()(Dn()().mark((function e(t){var n,r,i,o,a,s,u,l,c,f,h,p,d,v,g,m,y;return Dn()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.getData,r=t.onLoad,i=t.onError,this.loadDataId++,o=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=jn.Loading,a=null,e.prev=7,u=this.x,l=this.y,c=this.z,f=this.bounds,h=this.tileSize,p=this.warp,d=Jn(u,l,c,p),v=d.warpX,g=d.warpY,m=this.abortController.signal,y={x:v,y:g,z:c,bounds:f,tileSize:h,signal:m,warp:p},e.next=14,n(y,this);case 14:a=e.sent,e.next=20;break;case 17:e.prev=17,e.t0=e.catch(7),s=e.t0;case 20:if(o===this.loadDataId){e.next=22;break}return e.abrupt("return");case 22:if(!this.isCancelled||a){e.next=24;break}return e.abrupt("return");case 24:if(!s&&a){e.next=28;break}return this.loadStatus=jn.Failure,i(s,this),e.abrupt("return");case 28:this.loadStatus=jn.Loaded,this.data=a,r(this);case 31:case"end":return e.stop()}}),e,this,[[7,17]])}))),function(e){return t.apply(this,arguments)})},{key:"reloadData",value:function(e){this.isLoading&&this.abortLoad(),this.loadData(e)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=jn.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),r}(zn.EventEmitter),tr=n(2729),nr=n.n(tr),rr=Xe.throttle,ir=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),or=function(e){d()(n,e);var t=g()(n);function n(e){var r;return c()(this,n),r=t.call(this),b()(h()(r),"currentZoom",void 0),b()(h()(r),"currentTiles",[]),b()(h()(r),"options",void 0),b()(h()(r),"cacheTiles",new Map),b()(h()(r),"lastViewStates",void 0),b()(h()(r),"throttleUpdate",rr((function(e,t){r.update(e,t)}),16)),b()(h()(r),"onTileLoad",(function(e){r.emit(ir.TileLoaded,e),r.updateTileVisible(),r.loadFinished()})),b()(h()(r),"onTileError",(function(e,t){r.emit(ir.TileError,{error:e,tile:t}),r.updateTileVisible(),r.loadFinished()})),b()(h()(r),"onTileUnload",(function(e){r.emit(ir.TileUnload,e),r.loadFinished()})),r.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:Xn,getTileData:Yn,warp:!0,updateStrategy:Vn.Replace},r.updateOptions(e),r}return u()(n,[{key:"isLoaded",get:function(){return this.currentTiles.every((function(e){return e.isDone}))}},{key:"tiles",get:function(){return Array.from(this.cacheTiles.values()).sort((function(e,t){return e.z-t.z}))}},{key:"updateOptions",value:function(e){var t=void 0===e.minZoom?this.options.minZoom:Math.ceil(e.minZoom),n=void 0===e.maxZoom?this.options.maxZoom:Math.floor(e.maxZoom);this.options=a()(a()(a()({},this.options),e),{},{minZoom:t,maxZoom:n})}},{key:"update",value:function(e,t){var n=this,r=Math.max(0,Math.ceil(e));if(!this.lastViewStates||this.lastViewStates.zoom!==r||!function(e,t){return nn(rn(e),rn(t))}(this.lastViewStates.latLonBoundsBuffer,t)){var i=function(e,t){var n=tn(rn(e),t),r=85.0511287798065;return[Math.max(n[0][0],-900),Math.max(n[0][1],-r),Math.min(n[1][0],900),Math.min(n[1][1],r)]}(t,.2);this.lastViewStates={zoom:r,latLonBounds:t,latLonBoundsBuffer:i},this.currentZoom=r;var o=!1,a=this.getTileIndices(r,i).filter((function(e){return n.options.warp||e.x>=0&&e.x<Math.pow(2,r)}));this.emit(ir.TilesLoadStart),this.currentTiles=a.map((function(e){var t,r,i=e.x,a=e.y,s=e.z,u=n.getTile(i,a,s);return u?(((null===(t=u)||void 0===t?void 0:t.isFailure)||(null===(r=u)||void 0===r?void 0:r.isCancelled))&&u.loadData({getData:n.options.getTileData,onLoad:n.onTileLoad,onError:n.onTileError}),u):(u=n.createTile(i,a,s),o=!0,u)})),o&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var e,t=nr()(this.cacheTiles);try{for(t.s();!(e=t.n()).done;){var n=te()(e.value,2),r=n[0],i=n[1];if(!this.currentTiles.includes(i))return this.cacheTiles.delete(r),void this.onTileUnload(i);this.onTileUnload(i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(e){t.e(e)}finally{t.f()}}},{key:"reloadTileById",value:function(e,t,n){var r=this.cacheTiles.get("".concat(t,",").concat(n,",").concat(e));r&&(this.onTileUnload(r),r.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(e,t,n){var r=this.getTileByLngLat(e,t,n);r&&this.reloadTileById(r.z,r.x,r.y)}},{key:"reloadTileByExtent",value:function(e,t){var n=this;this.getTileIndices(t,e).forEach((function(e){n.reloadTileById(e.z,e.x,e.y)}))}},{key:"pruneRequests",value:function(){var e,t=[],n=nr()(this.cacheTiles.values());try{for(n.s();!(e=n.n()).done;){var r=e.value;r.isLoading&&(r.isCurrent||r.isVisible||t.push(r))}}catch(e){n.e(e)}finally{n.f()}for(;t.length>0;){t.shift().abortLoad()}}},{key:"getTileByLngLat",value:function(e,t,n){var r=this.options.zoomOffset,i=Math.ceil(n)+r,o=qn(e,t,i);return this.tiles.filter((function(e){return e.key==="".concat(o[0],"_").concat(o[1],"_").concat(i)}))[0]}},{key:"getTileExtent",value:function(e,t){return this.getTileIndices(t,e)}},{key:"getTileByZXY",value:function(e,t,n){return this.tiles.filter((function(r){return r.key==="".concat(t,"_").concat(n,"_").concat(e)}))[0]}},{key:"clear",value:function(){var e,t=nr()(this.cacheTiles.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.isLoading?n.abortLoad():this.onTileUnload(n)}}catch(e){t.e(e)}finally{t.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var e,t=this.options.updateStrategy,n=new Map,r=nr()(this.cacheTiles.values());try{for(r.s();!(e=r.n()).done;){var i=e.value;n.set(i.key,i.isVisible),i.isCurrent=!1,i.isVisible=!1}}catch(e){r.e(e)}finally{r.f()}var o,a=nr()(this.currentTiles);try{for(a.s();!(o=a.n()).done;){var s=o.value;s.isCurrent=!0,s.isVisible=!0}}catch(e){a.e(e)}finally{a.f()}var u=Array.from(this.cacheTiles.values());"function"==typeof t?t(u):Zn[t](u);var l=!1;Array.from(this.cacheTiles.values()).forEach((function(e){e.isVisible!==n.get(e.key)?(e.isVisibleChange=!0,l=!0):e.isVisibleChange=!1})),l&&this.emit(ir.TileUpdate)}},{key:"getTileIndices",value:function(e,t){var n=this.options,r=n.tileSize,i=n.extent,o=n.zoomOffset;return $n({maxZoom:Math.floor(this.options.maxZoom),minZoom:Math.ceil(this.options.minZoom),zoomOffset:o,tileSize:r,zoom:e,latLonBounds:t,extent:i})}},{key:"getTileId",value:function(e,t,n){return"".concat(e,",").concat(t,",").concat(n)}},{key:"loadFinished",value:function(){var e=!this.currentTiles.some((function(e){return!e.isDone}));return e&&this.emit(ir.TilesLoadFinished),e}},{key:"getTile",value:function(e,t,n){var r=this.getTileId(e,t,n);return this.cacheTiles.get(r)}},{key:"createTile",value:function(e,t,n){var r=this.getTileId(e,t,n),i=new er({x:e,y:t,z:n,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(r,i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),i}},{key:"resizeCacheTiles",value:function(){var e=5*this.currentTiles.length;if(this.cacheTiles.size>e){var t,n=nr()(this.cacheTiles);try{for(n.s();!(t=n.n()).done;){var r=te()(t.value,2),i=r[0],o=r[1];if(o.isVisible||this.currentTiles.includes(o)||(this.cacheTiles.delete(i),this.onTileUnload(o)),this.cacheTiles.size<=e)break}}catch(e){n.e(e)}finally{n.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var e,t=nr()(this.cacheTiles.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.parent=null,n.children.length=0}}catch(e){t.e(e)}finally{t.f()}var r,i=nr()(this.cacheTiles.values());try{for(i.s();!(r=i.n()).done;){var o=r.value,a=this.getNearestAncestor(o.x,o.y,o.z);o.parent=a,null!=a&&a.children&&a.children.push(o)}}catch(e){i.e(e)}finally{i.f()}}},{key:"getNearestAncestor",value:function(e,t,n){for(;n>this.options.minZoom;){e=Math.floor(e/2),t=Math.floor(t/2),n-=1;var r=this.getTile(e,t,n);if(r)return r}return null}}]),n}(Gn());function ar(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function sr(e){var t=[],n=/\{([a-z])-([a-z])\}/.exec(e);if(n){var r,i=n[1].charCodeAt(0),o=n[2].charCodeAt(0);for(r=i;r<=o;++r)t.push(e.replace(n[0],String.fromCharCode(r)));return t}if(n=/\{(\d+)-(\d+)\}/.exec(e)){for(var a=parseInt(n[2],10),s=parseInt(n[1],10);s<=a;s++)t.push(e.replace(n[0],s.toString()));return t}return t.push(e),t}function ur(e,t){if(!e||!e.length)throw new Error("url is not allowed to be empty");var n=t.x,r=t.y,i=t.z,o=sr(e),a=Math.abs(n+r)%o.length;return(E(o[a])?"".concat(o[a],"/{z}/{x}/{y}"):o[a]).replace(/\{x\}/g,n.toString()).replace(/\{y\}/g,r.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,Qn(n,r,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-r-1).toString())}function lr(e,t){var n=t.x,r=t.y,i=t.z,o=t.layer,a=t.version,s=void 0===a?"1.0.0":a,u=t.style,l=void 0===u?"default":u,c=t.format,f=t.service,h=void 0===f?"WMTS":f,p=t.tileMatrixset,d=sr(e),v=Math.abs(n+r)%d.length;return"".concat(d[v],"&SERVICE=").concat(h,"&REQUEST=GetTile&VERSION=").concat(s,"&LAYER=").concat(o,"&STYLE=").concat(l,"&TILEMATRIXSET=").concat(p,"&FORMAT=").concat(c,"&TILECOL=").concat(n,"&TILEROW=").concat(r,"&TILEMATRIX=").concat(i)}function cr(e,t){return null==e?t:e}},879:function(e,t,n){"use strict";var r,i,o,a=n(5116).default;o=function(){function e(e){var r=[];return e.AMapUI&&r.push(t(e.AMapUI)),e.Loca&&r.push(n(e.Loca)),Promise.all(r)}function t(e){return new Promise((function(t,n){var i=[];if(e.plugins)for(var u=0;u<e.plugins.length;u+=1)-1==o.AMapUI.plugins.indexOf(e.plugins[u])&&i.push(e.plugins[u]);if(a.AMapUI===r.failed)n("前次请求 AMapUI 失败");else if(a.AMapUI===r.notload){a.AMapUI=r.loading,o.AMapUI.version=e.version||o.AMapUI.version,u=o.AMapUI.version;var l=document.body||document.head,c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/ui/"+u+"/main.js",c.onerror=function(e){a.AMapUI=r.failed,n("请求 AMapUI 失败")},c.onload=function(){if(a.AMapUI=r.loaded,i.length)window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}for(t();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()}));else for(t();s.AMapUI.length;)s.AMapUI.splice(0,1)[0]()},l.appendChild(c)}else a.AMapUI===r.loaded?e.version&&e.version!==o.AMapUI.version?n("不允许多个版本 AMapUI 混用"):i.length?window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()})):t():e.version&&e.version!==o.AMapUI.version?n("不允许多个版本 AMapUI 混用"):s.AMapUI.push((function(e){e?n(e):i.length?window.AMapUI.loadUI(i,(function(){for(var e=0,n=i.length;e<n;e++){var r=i[e].split("/").slice(-1)[0];window.AMapUI[r]=arguments[e]}t()})):t()}))}))}function n(e){return new Promise((function(t,n){if(a.Loca===r.failed)n("前次请求 Loca 失败");else if(a.Loca===r.notload){a.Loca=r.loading,o.Loca.version=e.version||o.Loca.version;var i=o.Loca.version,u=o.AMap.version.startsWith("2"),l=i.startsWith("2");if(u&&!l||!u&&l)n("JSAPI 与 Loca 版本不对应！！");else{u=o.key,l=document.body||document.head;var c=document.createElement("script");c.type="text/javascript",c.src="https://webapi.amap.com/loca?v="+i+"&key="+u,c.onerror=function(e){a.Loca=r.failed,n("请求 AMapUI 失败")},c.onload=function(){for(a.Loca=r.loaded,t();s.Loca.length;)s.Loca.splice(0,1)[0]()},l.appendChild(c)}}else a.Loca===r.loaded?e.version&&e.version!==o.Loca.version?n("不允许多个版本 Loca 混用"):t():e.version&&e.version!==o.Loca.version?n("不允许多个版本 Loca 混用"):s.Loca.push((function(e){e?n(e):n()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var r,i;(i=r||(r={})).notload="notload",i.loading="loading",i.loaded="loaded",i.failed="failed";var o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]},u=[];return{load:function(t){return new Promise((function(n,i){if(a.AMap==r.failed)i("");else if(a.AMap==r.notload){var s=t.key,l=t.version,c=t.plugins;s?(window.AMap&&"lbs.amap.com"!==location.host&&i("禁止多种API加载方式混用"),o.key=s,o.AMap.version=l||o.AMap.version,o.AMap.plugins=c||o.AMap.plugins,a.AMap=r.loading,l=document.body||document.head,window.___onAPILoaded=function(o){if(delete window.___onAPILoaded,o)a.AMap=r.failed,i(o);else for(a.AMap=r.loaded,e(t).then((function(){n(window.AMap)})).catch(i);u.length;)u.splice(0,1)[0]()},(c=document.createElement("script")).type="text/javascript",c.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+o.AMap.version+"&key="+s+"&plugin="+o.AMap.plugins.join(","),c.onerror=function(e){a.AMap=r.failed,i(e)},l.appendChild(c)):i("请填写key")}else if(a.AMap==r.loaded)if(t.key&&t.key!==o.key)i("多个不一致的 key");else if(t.version&&t.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{if(s=[],t.plugins)for(l=0;l<t.plugins.length;l+=1)-1==o.AMap.plugins.indexOf(t.plugins[l])&&s.push(t.plugins[l]);s.length?window.AMap.plugin(s,(function(){e(t).then((function(){n(window.AMap)})).catch(i)})):e(t).then((function(){n(window.AMap)})).catch(i)}else if(t.key&&t.key!==o.key)i("多个不一致的 key");else if(t.version&&t.version!==o.AMap.version)i("不允许多个版本 JSAPI 混用");else{var f=[];if(t.plugins)for(l=0;l<t.plugins.length;l+=1)-1==o.AMap.plugins.indexOf(t.plugins[l])&&f.push(t.plugins[l]);!function(e){"function"==typeof e&&(a.AMap===r.loaded?e(window.AMap):u.push(e))}((function(){f.length?window.AMap.plugin(f,(function(){e(t).then((function(){n(window.AMap)})).catch(i)})):e(t).then((function(){n(window.AMap)})).catch(i)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,o={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},a={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},s={AMap:[],AMapUI:[],Loca:[]}}}},"object"===a(t)?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)},4474:function(e,t,n){"use strict";n.d(t,{S$:function(){return X},bf:function(){return Z},ni:function(){return U},oI:function(){return H},sX:function(){return W}});var r=n(5116),i=n.n(r),o=n(4693);function a(e,t,n,r){return new(n||(n=Promise))((function(i,o){function a(e){try{u(r.next(e))}catch(e){o(e)}}function s(e){try{u(r.throw(e))}catch(e){o(e)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=a.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function u(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)a.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return a}function l(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function c(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var f={exports:{}},h={exports:{}},p={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e&&"number"==typeof e.length&&e.length>=0&&e.length%1==0},e.exports=t.default}(p,p.exports);var d={},v={exports:{}},g={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop();return e.call(this,t,r)}},e.exports=t.default}(g,g.exports);var m={};Object.defineProperty(m,"__esModule",{value:!0}),m.fallback=E,m.wrap=T;var y,_=m.hasQueueMicrotask="function"==typeof queueMicrotask&&queueMicrotask,b=m.hasSetImmediate="function"==typeof setImmediate&&setImmediate,x=m.hasNextTick="object"===(void 0===o?"undefined":i()(o))&&"function"==typeof o.nextTick;function E(e){setTimeout(e,0)}function T(e){return function(t){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];return e((function(){return t.apply(void 0,n)}))}}y=_?queueMicrotask:b?setImmediate:x?o.nextTick:E,m.default=T(y),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,i.isAsync)(e))return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];var r=t.pop(),i=e.apply(this,t);return a(i,r)};return(0,n.default)((function(t,n){var r;try{r=e.apply(this,t)}catch(e){return n(e)}if(r&&"function"==typeof r.then)return a(r,n);n(null,r)}))};var n=o(g.exports),r=o(m),i=d;function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){return e.then((function(e){s(t,null,e)}),(function(e){s(t,e&&e.message?e:new Error(e))}))}function s(e,t,n){try{e(t,n)}catch(e){(0,r.default)((function(e){throw e}),e)}}e.exports=t.default}(v,v.exports),Object.defineProperty(d,"__esModule",{value:!0}),d.isAsyncIterable=d.isAsyncGenerator=d.isAsync=void 0;var A,S=(A=v.exports)&&A.__esModule?A:{default:A};function C(e){return"AsyncFunction"===e[Symbol.toStringTag]}d.default=function(e){if("function"!=typeof e)throw new Error("expected a function");return C(e)?(0,S.default)(e):e},d.isAsync=C,d.isAsyncGenerator=function(e){return"AsyncGenerator"===e[Symbol.toStringTag]},d.isAsyncIterable=function(e){return"function"==typeof e[Symbol.asyncIterator]};var R={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){void 0===t&&(t=e.length);if(!t)throw new Error("arity is undefined");return function(){for(var n=this,r=[],i=arguments.length;i--;)r[i]=arguments[i];return"function"==typeof r[t-1]?e.apply(this,r):new Promise((function(i,o){r[t-1]=function(e){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];if(e)return o(e);i(t.length>1?t:t[0])},e.apply(n,r)}))}},e.exports=t.default}(R,R.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(p.exports),r=o(d),i=o(R.exports);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i){var o=(0,n.default)(t)?[]:{};e(t,(function(e,t,n){(0,r.default)(e)((function(e){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];r.length<2&&(r=r[0]),o[t]=r,n(e)}))}),(function(e){return i(e,o)}))}),3),e.exports=t.default}(h,h.exports);var w={exports:{}},M={exports:{}},k={exports:{}},L={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){function t(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null!==e){var r=e;e=null,r.apply(this,t)}}return Object.assign(t,e),t},e.exports=t.default}(L,L.exports);var O={exports:{}},I={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return e[Symbol.iterator]&&e[Symbol.iterator]()},e.exports=t.default}(I,I.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){if((0,n.default)(e))return function(e){var t=-1,n=e.length;return function(){return++t<n?{value:e[t],key:t}:null}}(e);var t=(0,r.default)(e);return t?function(e){var t=-1;return function(){var n=e.next();return n.done?null:(t++,{value:n.value,key:t})}}(t):function(e){var t=e?Object.keys(e):[],n=-1,r=t.length;return function i(){var o=t[++n];return"__proto__"===o?i():n<r?{value:e[o],key:o}:null}}(e)};var n=i(p.exports),r=i(I.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(O,O.exports);var P={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];if(null===e)throw new Error("Callback was already called.");var r=e;e=null,r.apply(this,t)}},e.exports=t.default}(P,P.exports);var N={exports:{}},B={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});t.default={},e.exports=t.default}(B,B.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,r,i){var o=!1,a=!1,s=!1,u=0,l=0;function c(){u>=t||s||o||(s=!0,e.next().then((function(e){var t=e.value,n=e.done;if(!a&&!o){if(s=!1,n)return o=!0,void(u<=0&&i(null));u++,r(t,l,f),l++,c()}})).catch(h))}function f(e,t){if(u-=1,!a)return e?h(e):!1===e?(o=!0,void(a=!0)):t===n.default||o&&u<=0?(o=!0,i(null)):void c()}function h(e){a||(s=!1,o=!0,i(e))}c()};var n=function(e){return e&&e.__esModule?e:{default:e}}(B.exports);e.exports=t.default}(N,N.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=u(L.exports),r=u(O.exports),i=u(P.exports),o=d,a=u(N.exports),s=u(B.exports);function u(e){return e&&e.__esModule?e:{default:e}}t.default=function(e){return function(t,u,l){if(l=(0,n.default)(l),e<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!t)return l(null);if((0,o.isAsyncGenerator)(t))return(0,a.default)(t,e,u,l);if((0,o.isAsyncIterable)(t))return(0,a.default)(t[Symbol.asyncIterator](),e,u,l);var c=(0,r.default)(t),f=!1,h=!1,p=0,d=!1;function v(e,t){if(!h)if(p-=1,e)f=!0,l(e);else if(!1===e)f=!0,h=!0;else{if(t===s.default||f&&p<=0)return f=!0,l(null);d||g()}}function g(){for(d=!0;p<e&&!f;){var t=c();if(null===t)return f=!0,void(p<=0&&l(null));p+=1,u(t.value,t.key,(0,i.default)(v))}d=!1}g()}},e.exports=t.default}(k,k.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=o(k.exports),r=o(d),i=o(R.exports);function o(e){return e&&e.__esModule?e:{default:e}}t.default=(0,i.default)((function(e,t,i,o){return(0,n.default)(t)(e,(0,r.default)(i),o)}),4),e.exports=t.default}(M,M.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=i(M.exports),r=i(R.exports);function i(e){return e&&e.__esModule?e:{default:e}}t.default=(0,r.default)((function(e,t,r){return(0,n.default)(e,1,t,r)}),3),e.exports=t.default}(w,w.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,n.default)(r.default,e,t)};var n=i(h.exports),r=i(w.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(f,f.exports);var D=c(f.exports),U=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,D(this.tasks)},e.prototype.tap=function(e,t){var n=this;this.tasks.push((function(r){t.apply(void 0,l([],u(n.args),!1)),r(null,e)}))},e}(),F={exports:{}},z={exports:{}};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=l(p.exports),r=l(B.exports),i=l(M.exports),o=l(L.exports),a=l(P.exports),s=l(d),u=l(R.exports);function l(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n){n=(0,o.default)(n);var i=0,s=0,u=e.length,l=!1;function c(e,t){!1===e&&(l=!0),!0!==l&&(e?n(e):++s!==u&&t!==r.default||n(null))}for(0===u&&n(null);i<u;i++)t(e[i],i,(0,a.default)(c))}function f(e,t,n){return(0,i.default)(e,1/0,t,n)}t.default=(0,u.default)((function(e,t,r){return((0,n.default)(e)?c:f)(e,(0,s.default)(t),r)}),3),e.exports=t.default}(z,z.exports),function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return(0,r.default)(n.default,e,t)};var n=i(z.exports),r=i(h.exports);function i(e){return e&&e.__esModule?e:{default:e}}e.exports=t.default}(F,F.exports);var G=c(F.exports),V=(function(){function e(){this.tasks=[]}e.prototype.promise=function(){return G(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return a(n,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,t()];case 1:return n.sent(),r(null,e),[2]}}))}))}))}}(),{exports:{}});!function(e,t){Object.defineProperty(t,"__esModule",{value:!0});var n=a(L.exports),r=a(P.exports),i=a(d),o=a(R.exports);function a(e){return e&&e.__esModule?e:{default:e}}t.default=(0,o.default)((function(e,t){if(t=(0,n.default)(t),!Array.isArray(e))return t(new Error("First argument to waterfall must be an array of functions"));if(!e.length)return t();var o=0;function a(t){(0,i.default)(e[o++]).apply(void 0,t.concat([(0,r.default)(s)]))}function s(n){for(var r=[],i=arguments.length-1;i-- >0;)r[i]=arguments[i+1];if(!1!==n)return n||o===e.length?t.apply(void 0,[n].concat(r)):void a(r)}a([])})),e.exports=t.default}(V,V.exports);var j=c(V.exports),H=(function(){function e(){this.tasks=[]}e.prototype.call=function(){return j(this.tasks)},e.prototype.tap=function(e,t){0===this.tasks.length?this.tasks.push((function(e){var n=t();e(!!n&&null,n)})):this.tasks.push((function(n,r){r(!!t.apply(void 0,l([],u(n),!1))&&null,e)}))}}(),function(){function e(){this.tasks=[]}return e.prototype.call=function(){return D(this.tasks)},e.prototype.tap=function(e,t){this.tasks.push((function(n){n(t(),e)}))},e}()),W=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,D(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return a(n,void 0,void 0,(function(){return s(this,(function(n){switch(n.label){case 0:return[4,t.apply(void 0,l([],u(this.args),!1))];case 1:return n.sent(),r(null,e),[2]}}))}))}))},e}(),X=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var e=arguments,t=[],n=0;n<arguments.length;n++)t[n]=e[n];return this.args=t,D(this.tasks)},e.prototype.tapPromise=function(e,t){var n=this;this.tasks.push((function(r){return a(n,void 0,void 0,(function(){var n;return s(this,(function(i){switch(i.label){case 0:return[4,t.apply(void 0,l([],u(this.args),!1))];case 1:return n=i.sent(),r(n,e),[2]}}))}))}))},e}(),Z=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return j(this.tasks)},e.prototype.tapPromise=function(e,t){0===this.tasks.length?this.tasks.push((function(e){t().then((function(t){e(null,t)}))})):this.tasks.push((function(e,n){t(e).then((function(e){n(null,e)}))}))},e}()},1231:function(e){function t(e,t){if(0!==e.length){n(e[0],t);for(var r=1;r<e.length;r++)n(e[r],!t)}}function n(e,t){for(var n=0,r=0,i=0,o=e.length,a=o-1;i<o;a=i++){var s=(e[i][0]-e[a][0])*(e[a][1]+e[i][1]),u=n+s;r+=Math.abs(n)>=Math.abs(s)?n-u+s:s-u+n,n=u}n+r>=0!=!!t&&e.reverse()}e.exports=function e(n,r){var i,o=n&&n.type;if("FeatureCollection"===o)for(i=0;i<n.features.length;i++)e(n.features[i],r);else if("GeometryCollection"===o)for(i=0;i<n.geometries.length;i++)e(n.geometries[i],r);else if("Feature"===o)e(n.geometry,r);else if("Polygon"===o)t(n.coordinates,r);else if("MultiPolygon"===o)for(i=0;i<n.coordinates.length;i++)t(n.coordinates[i],r);return n}},521:function(e){"use strict";function t(e,t){this.x=e,this.y=t}e.exports=t,t.prototype={clone:function(){return new t(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,n=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=n,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=t*this.x-n*this.y,i=n*this.x+t*this.y;return this.x=r,this.y=i,this},_rotateAround:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.x+n*(this.x-t.x)-r*(this.y-t.y),o=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},t.convert=function(e){return e instanceof t?e:Array.isArray(e)?new t(e[0],e[1]):e}},1786:function(e){"use strict";e.exports=n,e.exports.default=n;var t=1e20;function n(e,t,n,r,i,o){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer,s=a+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function r(e,t,n,r,o,a){for(var s=0;s<t;s++)i(e,s,t,n,r,o,a);for(var u=0;u<n;u++)i(e,u*t,1,t,r,o,a)}function i(e,n,r,i,o,a,s){var u,l,c,f;for(a[0]=0,s[0]=-t,s[1]=t,u=0;u<i;u++)o[u]=e[n+u*r];for(u=1,l=0,c=0;u<i;u++){do{f=a[l],c=(o[u]-o[f]+u*u-f*f)/(u-f)/2}while(c<=s[l]&&--l>-1);a[++l]=u,s[l]=c,s[l+1]=t}for(u=0,l=0;u<i;u++){for(;s[l+1]<u;)l++;f=a[l],e[n+u*r]=o[f]+(u-f)*(u-f)}}n.prototype._draw=function(e,n){var i,o,a,s,u,l,c,f,h,p=this.ctx.measureText(e),d=p.width,v=2*this.buffer;n&&this.useMetrics?(u=Math.floor(p.actualBoundingBoxAscent),f=this.buffer+Math.ceil(p.actualBoundingBoxAscent),l=this.buffer,c=this.buffer,i=(o=Math.min(this.size,Math.ceil(p.actualBoundingBoxRight-p.actualBoundingBoxLeft)))+v,a=(s=Math.min(this.size-l,Math.ceil(p.actualBoundingBoxAscent+p.actualBoundingBoxDescent)))+v,this.ctx.textBaseline="alphabetic"):(i=o=this.size,a=s=this.size,u=19*this.fontSize/24,l=c=0,f=this.middle,this.ctx.textBaseline="middle"),o&&s&&(this.ctx.clearRect(c,l,o,s),this.ctx.fillText(e,this.buffer,f),h=this.ctx.getImageData(c,l,o,s));var g=new Uint8ClampedArray(i*a);return function(e,n,r,i,o,a,s){a.fill(t,0,n*r),s.fill(0,0,n*r);for(var u=(n-i)/2,l=0;l<o;l++)for(var c=0;c<i;c++){var f=(l+u)*n+c+u,h=e.data[4*(l*i+c)+3]/255;if(1===h)a[f]=0,s[f]=t;else if(0===h)a[f]=t,s[f]=0;else{var p=Math.max(0,.5-h),d=Math.max(0,h-.5);a[f]=p*p,s[f]=d*d}}}(h,i,a,o,s,this.gridOuter,this.gridInner),r(this.gridOuter,i,a,this.f,this.v,this.z),r(this.gridInner,i,a,this.f,this.v,this.z),function(e,t,n,r,i,o,a){for(var s=0;s<t*n;s++){var u=Math.sqrt(r[s])-Math.sqrt(i[s]);e[s]=Math.round(255-255*(u/o+a))}}(g,i,a,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:g,metrics:{width:o,height:s,sdfWidth:i,sdfHeight:a,top:u,left:0,advance:d}}},n.prototype.draw=function(e){return this._draw(e,!1).data},n.prototype.drawWithMetrics=function(e){return this._draw(e,!0)}},3990:function(e){"use strict";function t(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=n,this.p2y=r}e.exports=t,t.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var n=e,r=0;r<8;r++){var i=this.sampleCurveX(n)-e;if(Math.abs(i)<t)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n-=i/o}var a=0,s=1;for(n=e,r=0;r<20&&(i=this.sampleCurveX(n),!(Math.abs(i-e)<t));r++)e>i?a=n:s=n,n=.5*(s-a)+a;return n},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}}},1436:function(e,t,n){e.exports.VectorTile=n(317),n(1503),n(2376)},317:function(e,t,n){"use strict";var r=n(2376);function i(e,t,n){if(3===e){var i=new r(n,n.readVarint()+n.pos);i.length&&(t[i.name]=i)}}e.exports=function(e,t){this.layers=e.readFields(i,{},t)}},1503:function(e,t,n){"use strict";var r=n(521);function i(e,t,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=i,e.readFields(o,this,t)}function o(e,t,n){1==e?t.id=n.readVarint():2==e?function(e,t){var n=e.readVarint()+e.pos;for(;e.pos<n;){var r=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[r]=i}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function a(e){for(var t,n,r=0,i=0,o=e.length,a=o-1;i<o;a=i++)t=e[i],r+=((n=e[a]).x-t.x)*(t.y+n.y);return r}e.exports=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,i=1,o=0,a=0,s=0,u=[];e.pos<n;){if(o<=0){var l=e.readVarint();i=7&l,o=l>>3}if(o--,1===i||2===i)a+=e.readSVarint(),s+=e.readSVarint(),1===i&&(t&&u.push(t),t=[]),t.push(new r(a,s));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&u.push(t),u},i.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,r=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,l=-1/0;e.pos<t;){if(r<=0){var c=e.readVarint();n=7&c,r=c>>3}if(r--,1===n||2===n)(i+=e.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=e.readSVarint())<u&&(u=o),o>l&&(l=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,u,s,l]},i.prototype.toGeoJSON=function(e,t,n){var r,o,s=this.extent*Math.pow(2,n),u=this.extent*e,l=this.extent*t,c=this.loadGeometry(),f=i.types[this.type];function h(e){for(var t=0;t<e.length;t++){var n=e[t],r=180-360*(n.y+l)/s;e[t]=[360*(n.x+u)/s-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var p=[];for(r=0;r<c.length;r++)p[r]=c[r][0];h(c=p);break;case 2:for(r=0;r<c.length;r++)h(c[r]);break;case 3:for(c=function(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],o=0;o<t;o++){var s=a(e[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(n&&i.push(n),n=[e[o]]):n.push(e[o]))}n&&i.push(n);return i}(c),r=0;r<c.length;r++)for(o=0;o<c[r].length;o++)h(c[r][o])}1===c.length?c=c[0]:f="Multi"+f;var d={type:"Feature",geometry:{type:f,coordinates:c},properties:this.properties};return"id"in this&&(d.id=this.id),d}},2376:function(e,t,n){"use strict";var r=n(1503);function i(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(o,this,t),this.length=this._features.length}function o(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){var t=null,n=e.readVarint()+e.pos;for(;e.pos<n;){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(n))}e.exports=i,i.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,t,this.extent,this._keys,this._values)}},1127:function(e,t,n){"use strict";var r=n(7986);function i(){var e={},t=0,n=0,r=0;return{add:function(i,o){o||(o=i,i=0),i>n?n=i:i<r&&(r=i),e[i]||(e[i]=[]),e[i].push(o),t++},process:function(){for(var t=r;t<=n;t++)for(var i=e[t],o=0;o<i.length;o++){(0,i[o])()}},size:function(){return t}}}e.exports=function(e){var t=(e=e||{}).reporter,n=r.getOption(e,"async",!0),o=r.getOption(e,"auto",!0);o&&!n&&(t&&t.warn("Invalid options combination. auto=true and async=false is invalid. Setting async=true."),n=!0);var a,s=i(),u=!1;function l(){for(u=!0;s.size();){var e=s;s=i(),e.process()}u=!1}function c(){var e;e=l,a=setTimeout(e,0)}return{add:function(e,t){!u&&o&&n&&0===s.size()&&c(),s.add(e,t)},force:function(e){u||(void 0===e&&(e=n),a&&(clearTimeout(a),a=null),e?c():l())}}}},7986:function(e){"use strict";(e.exports={}).getOption=function(e,t,n){var r=e[t];if(null==r&&void 0!==n)return n;return r}},7361:function(e,t,n){"use strict";function r(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function i(e,t){var n=Object.create(e.prototype);for(var r in t)n[r]=t[r];return n}function o(){}n.d(t,{ZP:function(){return x},B8:function(){return S}});var a=.7,s=1/a,u="\\s*([+-]?\\d+)\\s*",l="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",c="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",f=/^#([0-9a-f]{3,8})$/,h=new RegExp("^rgb\\("+[u,u,u]+"\\)$"),p=new RegExp("^rgb\\("+[c,c,c]+"\\)$"),d=new RegExp("^rgba\\("+[u,u,u,l]+"\\)$"),v=new RegExp("^rgba\\("+[c,c,c,l]+"\\)$"),g=new RegExp("^hsl\\("+[l,c,c]+"\\)$"),m=new RegExp("^hsla\\("+[l,c,c,l]+"\\)$"),y={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function _(){return this.rgb().formatHex()}function b(){return this.rgb().formatRgb()}function x(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=f.exec(e))?(n=t[1].length,t=parseInt(t[1],16),6===n?E(t):3===n?new C(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===n?T(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===n?T(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=h.exec(e))?new C(t[1],t[2],t[3],1):(t=p.exec(e))?new C(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=d.exec(e))?T(t[1],t[2],t[3],t[4]):(t=v.exec(e))?T(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=g.exec(e))?k(t[1],t[2]/100,t[3]/100,1):(t=m.exec(e))?k(t[1],t[2]/100,t[3]/100,t[4]):y.hasOwnProperty(e)?E(y[e]):"transparent"===e?new C(NaN,NaN,NaN,0):null}function E(e){return new C(e>>16&255,e>>8&255,255&e,1)}function T(e,t,n,r){return r<=0&&(e=t=n=NaN),new C(e,t,n,r)}function A(e){return e instanceof o||(e=x(e)),e?new C((e=e.rgb()).r,e.g,e.b,e.opacity):new C}function S(e,t,n,r){return 1===arguments.length?A(e):new C(e,t,n,null==r?1:r)}function C(e,t,n,r){this.r=+e,this.g=+t,this.b=+n,this.opacity=+r}function R(){return"#"+M(this.r)+M(this.g)+M(this.b)}function w(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===e?")":", "+e+")")}function M(e){return((e=Math.max(0,Math.min(255,Math.round(e)||0)))<16?"0":"")+e.toString(16)}function k(e,t,n,r){return r<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new O(e,t,n,r)}function L(e){if(e instanceof O)return new O(e.h,e.s,e.l,e.opacity);if(e instanceof o||(e=x(e)),!e)return new O;if(e instanceof O)return e;var t=(e=e.rgb()).r/255,n=e.g/255,r=e.b/255,i=Math.min(t,n,r),a=Math.max(t,n,r),s=NaN,u=a-i,l=(a+i)/2;return u?(s=t===a?(n-r)/u+6*(n<r):n===a?(r-t)/u+2:(t-n)/u+4,u/=l<.5?a+i:2-a-i,s*=60):u=l>0&&l<1?0:s,new O(s,u,l,e.opacity)}function O(e,t,n,r){this.h=+e,this.s=+t,this.l=+n,this.opacity=+r}function I(e,t,n){return 255*(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)}r(o,x,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:_,formatHex:_,formatHsl:function(){return L(this).formatHsl()},formatRgb:b,toString:b}),r(C,S,i(o,{brighter:function(e){return e=null==e?s:Math.pow(s,e),new C(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=null==e?a:Math.pow(a,e),new C(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:R,formatHex:R,formatRgb:w,toString:w})),r(O,(function(e,t,n,r){return 1===arguments.length?L(e):new O(e,t,n,null==r?1:r)}),i(o,{brighter:function(e){return e=null==e?s:Math.pow(s,e),new O(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=null==e?a:Math.pow(a,e),new O(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*t,i=2*n-r;return new C(I(e>=240?e-240:e+120,i,r),I(e,i,r),I(e<120?e+240:e-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return(1===(e=isNaN(e)?1:Math.max(0,Math.min(1,e)))?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===e?")":", "+e+")")}}))},1102:function(e){"use strict";function t(e,t,r){r=r||2;var o,a,s,u,f,h,d,v=t&&t.length,g=v?t[0]*r:e.length,m=n(e,0,g,r,!0),y=[];if(!m||m.next===m.prev)return y;if(v&&(m=function(e,t,r,i){var o,a,s,u=[];for(o=0,a=t.length;o<a;o++)(s=n(e,t[o]*i,o<a-1?t[o+1]*i:e.length,i,!1))===s.next&&(s.steiner=!0),u.push(p(s));for(u.sort(l),o=0;o<u.length;o++)r=c(u[o],r);return r}(e,t,m,r)),e.length>80*r){o=s=e[0],a=u=e[1];for(var _=r;_<g;_+=r)(f=e[_])<o&&(o=f),(h=e[_+1])<a&&(a=h),f>s&&(s=f),h>u&&(u=h);d=0!==(d=Math.max(s-o,u-a))?32767/d:0}return i(m,y,r,o,a,d,0),y}function n(e,t,n,r,i){var o,a;if(i===C(e,t,n,r)>0)for(o=t;o<n;o+=r)a=T(o,e[o],e[o+1],a);else for(o=n-r;o>=t;o-=r)a=T(o,e[o],e[o+1],a);return a&&m(a,a.next)&&(A(a),a=a.next),a}function r(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!m(r,r.next)&&0!==g(r.prev,r,r.next))r=r.next;else{if(A(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function i(e,t,n,l,c,f,p){if(e){!p&&f&&function(e,t,n,r){var i=e;do{0===i.z&&(i.z=h(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,o,a,s,u,l=1;do{for(n=e,e=null,o=null,a=0;n;){for(a++,r=n,s=0,t=0;t<l&&(s++,r=r.nextZ);t++);for(u=l;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(a>1)}(i)}(e,l,c,f);for(var d,v,g=e;e.prev!==e.next;)if(d=e.prev,v=e.next,f?a(e,l,c,f):o(e))t.push(d.i/n|0),t.push(e.i/n|0),t.push(v.i/n|0),A(e),e=v.next,g=v.next;else if((e=v)===g){p?1===p?i(e=s(r(e),t,n),t,n,l,c,f,2):2===p&&u(e,t,n,l,c,f):i(r(e),t,n,l,c,f,1);break}}}function o(e){var t=e.prev,n=e,r=e.next;if(g(t,n,r)>=0)return!1;for(var i=t.x,o=n.x,a=r.x,s=t.y,u=n.y,l=r.y,c=i<o?i<a?i:a:o<a?o:a,f=s<u?s<l?s:l:u<l?u:l,h=i>o?i>a?i:a:o>a?o:a,p=s>u?s>l?s:l:u>l?u:l,v=r.next;v!==t;){if(v.x>=c&&v.x<=h&&v.y>=f&&v.y<=p&&d(i,s,o,u,a,l,v.x,v.y)&&g(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function a(e,t,n,r){var i=e.prev,o=e,a=e.next;if(g(i,o,a)>=0)return!1;for(var s=i.x,u=o.x,l=a.x,c=i.y,f=o.y,p=a.y,v=s<u?s<l?s:l:u<l?u:l,m=c<f?c<p?c:p:f<p?f:p,y=s>u?s>l?s:l:u>l?u:l,_=c>f?c>p?c:p:f>p?f:p,b=h(v,m,t,n,r),x=h(y,_,t,n,r),E=e.prevZ,T=e.nextZ;E&&E.z>=b&&T&&T.z<=x;){if(E.x>=v&&E.x<=y&&E.y>=m&&E.y<=_&&E!==i&&E!==a&&d(s,c,u,f,l,p,E.x,E.y)&&g(E.prev,E,E.next)>=0)return!1;if(E=E.prevZ,T.x>=v&&T.x<=y&&T.y>=m&&T.y<=_&&T!==i&&T!==a&&d(s,c,u,f,l,p,T.x,T.y)&&g(T.prev,T,T.next)>=0)return!1;T=T.nextZ}for(;E&&E.z>=b;){if(E.x>=v&&E.x<=y&&E.y>=m&&E.y<=_&&E!==i&&E!==a&&d(s,c,u,f,l,p,E.x,E.y)&&g(E.prev,E,E.next)>=0)return!1;E=E.prevZ}for(;T&&T.z<=x;){if(T.x>=v&&T.x<=y&&T.y>=m&&T.y<=_&&T!==i&&T!==a&&d(s,c,u,f,l,p,T.x,T.y)&&g(T.prev,T,T.next)>=0)return!1;T=T.nextZ}return!0}function s(e,t,n){var i=e;do{var o=i.prev,a=i.next.next;!m(o,a)&&y(o,i,i.next,a)&&x(o,a)&&x(a,o)&&(t.push(o.i/n|0),t.push(i.i/n|0),t.push(a.i/n|0),A(i),A(i.next),i=e=a),i=i.next}while(i!==e);return r(i)}function u(e,t,n,o,a,s){var u=e;do{for(var l=u.next.next;l!==u.prev;){if(u.i!==l.i&&v(u,l)){var c=E(u,l);return u=r(u,u.next),c=r(c,c.next),i(u,t,n,o,a,s,0),void i(c,t,n,o,a,s,0)}l=l.next}u=u.next}while(u!==e)}function l(e,t){return e.x-t.x}function c(e,t){var n=function(e,t){var n,r=t,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a&&(a=s,n=r.x<r.next.x?r:r.next,s===i))return n}r=r.next}while(r!==t);if(!n)return null;var u,l=n,c=n.x,h=n.y,p=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&d(o<h?i:a,o,c,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),x(r,e)&&(u<p||u===p&&(r.x>n.x||r.x===n.x&&f(n,r)))&&(n=r,p=u)),r=r.next}while(r!==l);return n}(e,t);if(!n)return t;var i=E(n,e);return r(i,i.next),r(n,n.next)}function f(e,t){return g(e.prev,e,t.prev)<0&&g(t.next,e,e.next)<0}function h(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function p(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function d(e,t,n,r,i,o,a,s){return(i-a)*(t-s)>=(e-a)*(o-s)&&(e-a)*(r-s)>=(n-a)*(t-s)&&(n-a)*(o-s)>=(i-a)*(r-s)}function v(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&y(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(x(e,t)&&x(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(g(e.prev,e,t.prev)||g(e,t.prev,t))||m(e,t)&&g(e.prev,e,e.next)>0&&g(t.prev,t,t.next)>0)}function g(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function m(e,t){return e.x===t.x&&e.y===t.y}function y(e,t,n,r){var i=b(g(e,t,n)),o=b(g(e,t,r)),a=b(g(n,r,e)),s=b(g(n,r,t));return i!==o&&a!==s||(!(0!==i||!_(e,n,t))||(!(0!==o||!_(e,r,t))||(!(0!==a||!_(n,e,r))||!(0!==s||!_(n,t,r)))))}function _(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function b(e){return e>0?1:e<0?-1:0}function x(e,t){return g(e.prev,e,e.next)<0?g(e,t,e.next)>=0&&g(e,e.prev,t)>=0:g(e,t,e.prev)<0||g(e,e.next,t)<0}function E(e,t){var n=new S(e.i,e.x,e.y),r=new S(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function T(e,t,n,r){var i=new S(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function A(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function S(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function C(e,t,n,r){for(var i=0,o=t,a=n-r;o<n;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}e.exports=t,e.exports.default=t,t.deviation=function(e,t,n,r){var i=t&&t.length,o=i?t[0]*n:e.length,a=Math.abs(C(e,0,o,n));if(i)for(var s=0,u=t.length;s<u;s++){var l=t[s]*n,c=s<u-1?t[s+1]*n:e.length;a-=Math.abs(C(e,l,c,n))}var f=0;for(s=0;s<r.length;s+=3){var h=r[s]*n,p=r[s+1]*n,d=r[s+2]*n;f+=Math.abs((e[h]-e[d])*(e[p+1]-e[h+1])-(e[h]-e[p])*(e[d+1]-e[h+1]))}return 0===a&&0===f?0:Math.abs((f-a)/a)},t.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<t;a++)n.vertices.push(e[i][o][a]);i>0&&(r+=e[i-1].length,n.holes.push(r))}return n}},9597:function(e){"use strict";var t=e.exports={};t.isIE=function(e){return(-1!==(t=navigator.userAgent.toLowerCase()).indexOf("msie")||-1!==t.indexOf("trident")||-1!==t.indexOf(" edge/"))&&(!e||e===function(){var e=3,t=document.createElement("div"),n=t.getElementsByTagName("i");do{t.innerHTML="\x3c!--[if gt IE "+ ++e+"]><i></i><![endif]--\x3e"}while(n[0]);return e>4?e:undefined}());var t},t.isLegacyOpera=function(){return!!window.opera}},8997:function(e){"use strict";(e.exports={}).forEach=function(e,t){for(var n=0;n<e.length;n++){var r=t(e[n]);if(r)return r}}},1302:function(e,t,n){"use strict";var r=n(9597);e.exports=function(e){var t=(e=e||{}).reporter,n=e.batchProcessor,i=e.stateHandler.getState;if(!t)throw new Error("Missing required dependency: reporter.");function o(t){var n=e.important?" !important; ":"; ";return(t.join(n)+n).trim()}function a(e){return i(e).object}return{makeDetectable:function(e,a,s){s||(s=a,a=e,e=null),(e=e||{}).debug,r.isIE(8)?s(a):function(a,s){var u=o(["display: block","position: absolute","top: 0","left: 0","width: 100%","height: 100%","border: none","padding: 0","margin: 0","opacity: 0","z-index: -1000","pointer-events: none"]),l=!1,c=window.getComputedStyle(a),f=a.offsetWidth,h=a.offsetHeight;function p(){function n(){if("static"===c.position){a.style.setProperty("position","relative",e.important?"important":"");var n=function(t,n,r,i){var o=r[i];"auto"!==o&&"0"!==function(e){return e.replace(/[^-\d\.]/g,"")}(o)&&(t.warn("An element that is positioned static has style."+i+"="+o+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+i+" will be set to 0. Element: ",n),n.style.setProperty(i,"0",e.important?"important":""))};n(t,a,c,"top"),n(t,a,c,"right"),n(t,a,c,"bottom"),n(t,a,c,"left")}}""!==c.position&&(n(),l=!0);var o=document.createElement("object");o.style.cssText=u,o.tabIndex=-1,o.type="text/html",o.setAttribute("aria-hidden","true"),o.onload=function(){l||n(),function e(t,n){if(!t.contentDocument){var r=i(t);return r.checkForObjectDocumentTimeoutId&&window.clearTimeout(r.checkForObjectDocumentTimeoutId),void(r.checkForObjectDocumentTimeoutId=setTimeout((function(){r.checkForObjectDocumentTimeoutId=0,e(t,n)}),100))}n(t.contentDocument)}(this,(function(e){s(a)}))},r.isIE()||(o.data="about:blank"),i(a)&&(a.appendChild(o),i(a).object=o,r.isIE()&&(o.data="about:blank"))}i(a).startSize={width:f,height:h},n?n.add(p):p()}(a,s)},addListener:function(e,t){function n(){t(e)}if(r.isIE(8))i(e).object={proxy:n},e.attachEvent("onresize",n);else{var o=a(e);if(!o)throw new Error("Element is not detectable by this strategy.");o.contentDocument.defaultView.addEventListener("resize",n)}},uninstall:function(e){if(i(e)){var t=a(e);t&&(r.isIE(8)?e.detachEvent("onresize",t.proxy):e.removeChild(t),i(e).checkForObjectDocumentTimeoutId&&window.clearTimeout(i(e).checkForObjectDocumentTimeoutId),delete i(e).object)}}}}},9889:function(e,t,n){"use strict";var r=n(8997).forEach;e.exports=function(e){var t=(e=e||{}).reporter,n=e.batchProcessor,i=e.stateHandler.getState,o=(e.stateHandler.hasState,e.idHandler);if(!n)throw new Error("Missing required dependency: batchProcessor");if(!t)throw new Error("Missing required dependency: reporter.");var a=function(){var e=500,t=500,n=document.createElement("div");n.style.cssText=l(["position: absolute","width: 1000px","height: 1000px","visibility: hidden","margin: 0","padding: 0"]);var r=document.createElement("div");r.style.cssText=l(["position: absolute","width: 500px","height: 500px","overflow: scroll","visibility: none","top: -1500px","left: -1500px","visibility: hidden","margin: 0","padding: 0"]),r.appendChild(n),document.body.insertBefore(r,document.body.firstChild);var i=e-r.clientWidth,o=t-r.clientHeight;return document.body.removeChild(r),{width:i,height:o}}(),s="erd_scroll_detection_container";function u(e){!function(e,t,n){function r(n,r){r=r||function(t){e.head.appendChild(t)};var i=e.createElement("style");return i.innerHTML=n,i.id=t,r(i),i}if(!e.getElementById(t)){var i=n+"_animation",o=n+"_animation_active",a="/* Created by the element-resize-detector library. */\n";a+="."+n+" > div::-webkit-scrollbar { "+l(["display: none"])+" }\n\n",a+="."+o+" { "+l(["-webkit-animation-duration: 0.1s","animation-duration: 0.1s","-webkit-animation-name: "+i,"animation-name: "+i])+" }\n",a+="@-webkit-keyframes "+i+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }\n",r(a+="@keyframes "+i+" { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }")}}(e,"erd_scroll_detection_scrollbar_style",s)}function l(t){var n=e.important?" !important; ":"; ";return(t.join(n)+n).trim()}function c(e,n,r){if(e.addEventListener)e.addEventListener(n,r);else{if(!e.attachEvent)return t.error("[scroll] Don't know how to add event listeners.");e.attachEvent("on"+n,r)}}function f(e,n,r){if(e.removeEventListener)e.removeEventListener(n,r);else{if(!e.detachEvent)return t.error("[scroll] Don't know how to remove event listeners.");e.detachEvent("on"+n,r)}}function h(e){return i(e).container.childNodes[0].childNodes[0].childNodes[0]}function p(e){return i(e).container.childNodes[0].childNodes[0].childNodes[1]}return u(window.document),{makeDetectable:function(e,u,f){function d(){if(e.debug){var n=Array.prototype.slice.call(arguments);if(n.unshift(o.get(u),"Scroll: "),t.log.apply)t.log.apply(null,n);else for(var r=0;r<n.length;r++)t.log(n[r])}}function v(e){var t=i(e).container.childNodes[0],n=window.getComputedStyle(t);return!n.width||-1===n.width.indexOf("px")}function g(){var e=window.getComputedStyle(u),t={};return t.position=e.position,t.width=u.offsetWidth,t.height=u.offsetHeight,t.top=e.top,t.right=e.right,t.bottom=e.bottom,t.left=e.left,t.widthCSS=e.width,t.heightCSS=e.height,t}function m(){if(d("storeStyle invoked."),i(u)){var e=g();i(u).style=e}else d("Aborting because element has been uninstalled")}function y(e,t,n){i(e).lastWidth=t,i(e).lastHeight=n}function _(){return 2*a.width+1}function b(){return 2*a.height+1}function x(e){return e+10+_()}function E(e){return e+10+b()}function T(e,t,n){var r=h(e),i=p(e),o=x(t),a=E(n),s=function(e){return 2*e+_()}(t),u=function(e){return 2*e+b()}(n);r.scrollLeft=o,r.scrollTop=a,i.scrollLeft=s,i.scrollTop=u}function A(){var e=i(u).container;if(!e){(e=document.createElement("div")).className=s,e.style.cssText=l(["visibility: hidden","display: inline","width: 0px","height: 0px","z-index: -1","overflow: hidden","margin: 0","padding: 0"]),i(u).container=e,function(e){e.className+=" "+s+"_animation_active"}(e),u.appendChild(e);var t=function(){i(u).onRendered&&i(u).onRendered()};c(e,"animationstart",t),i(u).onAnimationStart=t}return e}function S(){if(d("Injecting elements"),i(u)){!function(){var n=i(u).style;if("static"===n.position){u.style.setProperty("position","relative",e.important?"important":"");var r=function(e,t,n,r){var i=n[r];"auto"!==i&&"0"!==function(e){return e.replace(/[^-\d\.]/g,"")}(i)&&(e.warn("An element that is positioned static has style."+r+"="+i+" which is ignored due to the static positioning. The element will need to be positioned relative, so the style."+r+" will be set to 0. Element: ",t),t.style[r]=0)};r(t,u,n,"top"),r(t,u,n,"right"),r(t,u,n,"bottom"),r(t,u,n,"left")}}();var n=i(u).container;n||(n=A());var r,o,f,h,p=a.width,v=a.height,g=l(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden","width: 100%","height: 100%","left: 0px","top: 0px"]),m=l(["position: absolute","flex: none","overflow: hidden","z-index: -1","visibility: hidden"].concat(["left: "+(r=(r=-(1+p))?r+"px":"0"),"top: "+(o=(o=-(1+v))?o+"px":"0"),"right: "+(h=(h=-p)?h+"px":"0"),"bottom: "+(f=(f=-v)?f+"px":"0")])),y=l(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),_=l(["position: absolute","flex: none","overflow: scroll","z-index: -1","visibility: hidden","width: 100%","height: 100%"]),b=l(["position: absolute","left: 0","top: 0"]),x=l(["position: absolute","width: 200%","height: 200%"]),E=document.createElement("div"),T=document.createElement("div"),S=document.createElement("div"),C=document.createElement("div"),R=document.createElement("div"),w=document.createElement("div");E.dir="ltr",E.style.cssText=g,E.className=s,T.className=s,T.style.cssText=m,S.style.cssText=y,C.style.cssText=b,R.style.cssText=_,w.style.cssText=x,S.appendChild(C),R.appendChild(w),T.appendChild(S),T.appendChild(R),E.appendChild(T),n.appendChild(E),c(S,"scroll",M),c(R,"scroll",k),i(u).onExpandScroll=M,i(u).onShrinkScroll=k}else d("Aborting because element has been uninstalled");function M(){var e=i(u);e&&e.onExpand?e.onExpand():d("Aborting expand scroll handler: element has been uninstalled")}function k(){var e=i(u);e&&e.onShrink?e.onShrink():d("Aborting shrink scroll handler: element has been uninstalled")}}function C(){function a(t,n,r){var i=function(e){return h(e).childNodes[0]}(t),o=x(n),a=E(r);i.style.setProperty("width",o+"px",e.important?"important":""),i.style.setProperty("height",a+"px",e.important?"important":"")}function s(r){var s=u.offsetWidth,c=u.offsetHeight,f=s!==i(u).lastWidth||c!==i(u).lastHeight;d("Storing current size",s,c),y(u,s,c),n.add(0,(function(){if(f)if(i(u))if(l()){if(e.debug){var n=u.offsetWidth,r=u.offsetHeight;n===s&&r===c||t.warn(o.get(u),"Scroll: Size changed before updating detector elements.")}a(u,s,c)}else d("Aborting because element container has not been initialized");else d("Aborting because element has been uninstalled")})),n.add(1,(function(){i(u)?l()?T(u,s,c):d("Aborting because element container has not been initialized"):d("Aborting because element has been uninstalled")})),f&&r&&n.add(2,(function(){i(u)?l()?r():d("Aborting because element container has not been initialized"):d("Aborting because element has been uninstalled")}))}function l(){return!!i(u).container}function c(){d("notifyListenersIfNeeded invoked");var e=i(u);return void 0===i(u).lastNotifiedWidth&&e.lastWidth===e.startSize.width&&e.lastHeight===e.startSize.height?d("Not notifying: Size is the same as the start size, and there has been no notification yet."):e.lastWidth===e.lastNotifiedWidth&&e.lastHeight===e.lastNotifiedHeight?d("Not notifying: Size already notified"):(d("Current size not notified, notifying..."),e.lastNotifiedWidth=e.lastWidth,e.lastNotifiedHeight=e.lastHeight,void r(i(u).listeners,(function(e){e(u)})))}function f(){d("Scroll detected."),v(u)?d("Scroll event fired while unrendered. Ignoring..."):s(c)}if(d("registerListenersAndPositionElements invoked."),i(u)){i(u).onRendered=function(){if(d("startanimation triggered."),v(u))d("Ignoring since element is still unrendered...");else{d("Element rendered.");var e=h(u),t=p(u);0!==e.scrollLeft&&0!==e.scrollTop&&0!==t.scrollLeft&&0!==t.scrollTop||(d("Scrollbars out of sync. Updating detector elements..."),s(c))}},i(u).onExpand=f,i(u).onShrink=f;var g=i(u).style;a(u,g.width,g.height)}else d("Aborting because element has been uninstalled")}function R(){if(d("finalizeDomMutation invoked."),i(u)){var e=i(u).style;y(u,e.width,e.height),T(u,e.width,e.height)}else d("Aborting because element has been uninstalled")}function w(){f(u)}function M(){var e;d("Installing..."),i(u).listeners=[],e=g(),i(u).startSize={width:e.width,height:e.height},d("Element start size",i(u).startSize),n.add(0,m),n.add(1,S),n.add(2,C),n.add(3,R),n.add(4,w)}f||(f=u,u=e,e=null),e=e||{},d("Making detectable..."),!function(e){return!function(e){var t=e.getRootNode&&e.getRootNode().contains(e);return e===e.ownerDocument.body||e.ownerDocument.body.contains(e)||t}(e)||null===window.getComputedStyle(e)}(u)?M():(d("Element is detached"),A(),d("Waiting until element is attached..."),i(u).onRendered=function(){d("Element is now attached"),M()})},addListener:function(e,t){if(!i(e).listeners.push)throw new Error("Cannot add listener to an element that is not detectable.");i(e).listeners.push(t)},uninstall:function(e){var t=i(e);t&&(t.onExpandScroll&&f(h(e),"scroll",t.onExpandScroll),t.onShrinkScroll&&f(p(e),"scroll",t.onShrinkScroll),t.onAnimationStart&&f(t.container,"animationstart",t.onAnimationStart),t.container&&e.removeChild(t.container))},initDocument:u}}},5841:function(e,t,n){"use strict";var r=n(8997).forEach,i=n(4317),o=n(2396),a=n(8038),s=n(308),u=n(3425),l=n(9597),c=n(1127),f=n(2241),h=n(1302),p=n(9889);function d(e){return Array.isArray(e)||void 0!==e.length}function v(e){if(Array.isArray(e))return e;var t=[];return r(e,(function(e){t.push(e)})),t}function g(e){return e&&1===e.nodeType}function m(e,t,n){var r=e[t];return null==r&&void 0!==n?n:r}e.exports=function(e){var t;if((e=e||{}).idHandler)t={get:function(t){return e.idHandler.get(t,!0)},set:e.idHandler.set};else{var n=a(),y=s({idGenerator:n,stateHandler:f});t=y}var _=e.reporter;_||(_=u(!1===_));var b=m(e,"batchProcessor",c({reporter:_})),x={};x.callOnAdd=!!m(e,"callOnAdd",!0),x.debug=!!m(e,"debug",!1);var E,T=o(t),A=i({stateHandler:f}),S=m(e,"strategy","object"),C=m(e,"important",!1),R={reporter:_,batchProcessor:b,stateHandler:f,idHandler:t,important:C};if("scroll"===S&&(l.isLegacyOpera()?(_.warn("Scroll strategy is not supported on legacy Opera. Changing to object strategy."),S="object"):l.isIE(9)&&(_.warn("Scroll strategy is not supported on IE9. Changing to object strategy."),S="object")),"scroll"===S)E=p(R);else{if("object"!==S)throw new Error("Invalid strategy name: "+S);E=h(R)}var w={};return{listenTo:function(e,n,i){function o(e){var t=T.get(e);r(t,(function(t){t(e)}))}function a(e,t,n){T.add(t,n),e&&n(t)}if(i||(i=n,n=e,e={}),!n)throw new Error("At least one element required.");if(!i)throw new Error("Listener required.");if(g(n))n=[n];else{if(!d(n))return _.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");n=v(n)}var s=0,u=m(e,"callOnAdd",x.callOnAdd),l=m(e,"onReady",(function(){})),c=m(e,"debug",x.debug);r(n,(function(e){f.getState(e)||(f.initState(e),t.set(e));var h=t.get(e);if(c&&_.log("Attaching listener to element",h,e),!A.isDetectable(e))return c&&_.log(h,"Not detectable."),A.isBusy(e)?(c&&_.log(h,"System busy making it detectable"),a(u,e,i),w[h]=w[h]||[],void w[h].push((function(){++s===n.length&&l()}))):(c&&_.log(h,"Making detectable..."),A.markBusy(e,!0),E.makeDetectable({debug:c,important:C},e,(function(e){if(c&&_.log(h,"onElementDetectable"),f.getState(e)){A.markAsDetectable(e),A.markBusy(e,!1),E.addListener(e,o),a(u,e,i);var t=f.getState(e);if(t&&t.startSize){var p=e.offsetWidth,d=e.offsetHeight;t.startSize.width===p&&t.startSize.height===d||o(e)}w[h]&&r(w[h],(function(e){e()}))}else c&&_.log(h,"Element uninstalled before being detectable.");delete w[h],++s===n.length&&l()})));c&&_.log(h,"Already detecable, adding listener."),a(u,e,i),s++})),s===n.length&&l()},removeListener:T.removeListener,removeAllListeners:T.removeAllListeners,uninstall:function(e){if(!e)return _.error("At least one element is required.");if(g(e))e=[e];else{if(!d(e))return _.error("Invalid arguments. Must be a DOM element or a collection of DOM elements.");e=v(e)}r(e,(function(e){T.removeAllListeners(e),E.uninstall(e),f.cleanState(e)}))},initDocument:function(e){E.initDocument&&E.initDocument(e)}}}},4317:function(e){"use strict";e.exports=function(e){var t=e.stateHandler.getState;return{isDetectable:function(e){var n=t(e);return n&&!!n.isDetectable},markAsDetectable:function(e){t(e).isDetectable=!0},isBusy:function(e){return!!t(e).busy},markBusy:function(e,n){t(e).busy=!!n}}}},8038:function(e){"use strict";e.exports=function(){var e=1;return{generate:function(){return e++}}}},308:function(e){"use strict";e.exports=function(e){var t=e.idGenerator,n=e.stateHandler.getState;return{get:function(e){var t=n(e);return t&&void 0!==t.id?t.id:null},set:function(e){var r=n(e);if(!r)throw new Error("setId required the element to have a resize detection state.");var i=t.generate();return r.id=i,i}}}},2396:function(e){"use strict";e.exports=function(e){var t={};function n(n){var r=e.get(n);return void 0===r?[]:t[r]||[]}return{get:n,add:function(n,r){var i=e.get(n);t[i]||(t[i]=[]),t[i].push(r)},removeListener:function(e,t){for(var r=n(e),i=0,o=r.length;i<o;++i)if(r[i]===t){r.splice(i,1);break}},removeAllListeners:function(e){var t=n(e);t&&(t.length=0)}}}},3425:function(e){"use strict";e.exports=function(e){function t(){}var n={log:t,warn:t,error:t};if(!e&&window.console){var r=function(e,t){e[t]=function(){var e=console[t];if(e.apply)e.apply(console,arguments);else for(var n=0;n<arguments.length;n++)e(arguments[n])}};r(n,"log"),r(n,"warn"),r(n,"error")}return n}},2241:function(e){"use strict";var t="_erd";function n(e){return e[t]}e.exports={initState:function(e){return e[t]={},n(e)},getState:n,cleanState:function(e){delete e[t]}}},3262:function(e){"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||e,a),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var u,l,c=this._events[s],f=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,o),!0;case 6:return c.fn.call(c.context,t,r,i,o,a),!0}for(l=1,u=new Array(f-1);l<f;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var h,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),f){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,r);break;case 4:c[l].fn.call(c[l].context,t,r,i);break;default:if(!u)for(h=1,u=new Array(f-1);h<f;h++)u[h-1]=arguments[h];c[l].fn.apply(c[l].context,u)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,l=[],c=s.length;u<c;u++)(s[u].fn!==t||i&&!s[u].once||r&&s[u].context!==r)&&l.push(s[u]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s},246:function(e){"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||e,a),u=n?n+t:t;return e._events[u]?e._events[u].fn?e._events[u]=[e._events[u],s]:e._events[u].push(s):(e._events[u]=s,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=new Array(o);i<o;i++)a[i]=r[i].fn;return a},s.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},s.prototype.emit=function(e,t,r,i,o,a){var s=n?n+e:e;if(!this._events[s])return!1;var u,l,c=this._events[s],f=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),f){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,r),!0;case 4:return c.fn.call(c.context,t,r,i),!0;case 5:return c.fn.call(c.context,t,r,i,o),!0;case 6:return c.fn.call(c.context,t,r,i,o,a),!0}for(l=1,u=new Array(f-1);l<f;l++)u[l-1]=arguments[l];c.fn.apply(c.context,u)}else{var h,p=c.length;for(l=0;l<p;l++)switch(c[l].once&&this.removeListener(e,c[l].fn,void 0,!0),f){case 1:c[l].fn.call(c[l].context);break;case 2:c[l].fn.call(c[l].context,t);break;case 3:c[l].fn.call(c[l].context,t,r);break;case 4:c[l].fn.call(c[l].context,t,r,i);break;default:if(!u)for(h=1,u=new Array(f-1);h<f;h++)u[h-1]=arguments[h];c[l].fn.apply(c[l].context,u)}}return!0},s.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},s.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},s.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,l=[],c=s.length;u<c;u++)(s[u].fn!==t||i&&!s[u].once||r&&s[u].context!==r)&&l.push(s[u]);l.length?this._events[o]=1===l.length?l[0]:l:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,e.exports=s},3794:function(e,t,n){"use strict";n.d(t,{FD:function(){return o},Ib:function(){return r},WT:function(){return i}});var r=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array,o=Math.random;Math.PI;Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)})},7703:function(e,t,n){"use strict";n.r(t),n.d(t,{add:function(){return Z},adjoint:function(){return h},clone:function(){return o},copy:function(){return a},create:function(){return i},determinant:function(){return p},equals:function(){return $},exactEquals:function(){return Q},frob:function(){return X},fromQuat:function(){return P},fromQuat2:function(){return w},fromRotation:function(){return T},fromRotationTranslation:function(){return R},fromRotationTranslationScale:function(){return O},fromRotationTranslationScaleOrigin:function(){return I},fromScaling:function(){return E},fromTranslation:function(){return x},fromValues:function(){return s},fromXRotation:function(){return A},fromYRotation:function(){return S},fromZRotation:function(){return C},frustum:function(){return N},getRotation:function(){return L},getScaling:function(){return k},getTranslation:function(){return M},identity:function(){return l},invert:function(){return f},lookAt:function(){return j},mul:function(){return J},multiply:function(){return d},multiplyScalar:function(){return q},multiplyScalarAndAdd:function(){return K},ortho:function(){return G},orthoNO:function(){return z},orthoZO:function(){return V},perspective:function(){return D},perspectiveFromFieldOfView:function(){return F},perspectiveNO:function(){return B},perspectiveZO:function(){return U},rotate:function(){return m},rotateX:function(){return y},rotateY:function(){return _},rotateZ:function(){return b},scale:function(){return g},set:function(){return u},str:function(){return W},sub:function(){return ee},subtract:function(){return Y},targetTo:function(){return H},translate:function(){return v},transpose:function(){return c}});var r=n(3794);function i(){var e=new r.WT(16);return r.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function o(e){var t=new r.WT(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function a(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function s(e,t,n,i,o,a,s,u,l,c,f,h,p,d,v,g){var m=new r.WT(16);return m[0]=e,m[1]=t,m[2]=n,m[3]=i,m[4]=o,m[5]=a,m[6]=s,m[7]=u,m[8]=l,m[9]=c,m[10]=f,m[11]=h,m[12]=p,m[13]=d,m[14]=v,m[15]=g,m}function u(e,t,n,r,i,o,a,s,u,l,c,f,h,p,d,v,g){return e[0]=t,e[1]=n,e[2]=r,e[3]=i,e[4]=o,e[5]=a,e[6]=s,e[7]=u,e[8]=l,e[9]=c,e[10]=f,e[11]=h,e[12]=p,e[13]=d,e[14]=v,e[15]=g,e}function l(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function c(e,t){if(e===t){var n=t[1],r=t[2],i=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function f(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=t[9],h=t[10],p=t[11],d=t[12],v=t[13],g=t[14],m=t[15],y=n*s-r*a,_=n*u-i*a,b=n*l-o*a,x=r*u-i*s,E=r*l-o*s,T=i*l-o*u,A=c*v-f*d,S=c*g-h*d,C=c*m-p*d,R=f*g-h*v,w=f*m-p*v,M=h*m-p*g,k=y*M-_*w+b*R+x*C-E*S+T*A;return k?(k=1/k,e[0]=(s*M-u*w+l*R)*k,e[1]=(i*w-r*M-o*R)*k,e[2]=(v*T-g*E+m*x)*k,e[3]=(h*E-f*T-p*x)*k,e[4]=(u*C-a*M-l*S)*k,e[5]=(n*M-i*C+o*S)*k,e[6]=(g*b-d*T-m*_)*k,e[7]=(c*T-h*b+p*_)*k,e[8]=(a*w-s*C+l*A)*k,e[9]=(r*C-n*w-o*A)*k,e[10]=(d*E-v*b+m*y)*k,e[11]=(f*b-c*E-p*y)*k,e[12]=(s*S-a*R-u*A)*k,e[13]=(n*R-r*S+i*A)*k,e[14]=(v*_-d*x-g*y)*k,e[15]=(c*x-f*_+h*y)*k,e):null}function h(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],l=t[7],c=t[8],f=t[9],h=t[10],p=t[11],d=t[12],v=t[13],g=t[14],m=t[15];return e[0]=s*(h*m-p*g)-f*(u*m-l*g)+v*(u*p-l*h),e[1]=-(r*(h*m-p*g)-f*(i*m-o*g)+v*(i*p-o*h)),e[2]=r*(u*m-l*g)-s*(i*m-o*g)+v*(i*l-o*u),e[3]=-(r*(u*p-l*h)-s*(i*p-o*h)+f*(i*l-o*u)),e[4]=-(a*(h*m-p*g)-c*(u*m-l*g)+d*(u*p-l*h)),e[5]=n*(h*m-p*g)-c*(i*m-o*g)+d*(i*p-o*h),e[6]=-(n*(u*m-l*g)-a*(i*m-o*g)+d*(i*l-o*u)),e[7]=n*(u*p-l*h)-a*(i*p-o*h)+c*(i*l-o*u),e[8]=a*(f*m-p*v)-c*(s*m-l*v)+d*(s*p-l*f),e[9]=-(n*(f*m-p*v)-c*(r*m-o*v)+d*(r*p-o*f)),e[10]=n*(s*m-l*v)-a*(r*m-o*v)+d*(r*l-o*s),e[11]=-(n*(s*p-l*f)-a*(r*p-o*f)+c*(r*l-o*s)),e[12]=-(a*(f*g-h*v)-c*(s*g-u*v)+d*(s*h-u*f)),e[13]=n*(f*g-h*v)-c*(r*g-i*v)+d*(r*h-i*f),e[14]=-(n*(s*g-u*v)-a*(r*g-i*v)+d*(r*u-i*s)),e[15]=n*(s*h-u*f)-a*(r*h-i*f)+c*(r*u-i*s),e}function p(e){var t=e[0],n=e[1],r=e[2],i=e[3],o=e[4],a=e[5],s=e[6],u=e[7],l=e[8],c=e[9],f=e[10],h=e[11],p=e[12],d=e[13],v=e[14],g=e[15];return(t*a-n*o)*(f*g-h*v)-(t*s-r*o)*(c*g-h*d)+(t*u-i*o)*(c*v-f*d)+(n*s-r*a)*(l*g-h*p)-(n*u-i*a)*(l*v-f*p)+(r*u-i*s)*(l*d-c*p)}function d(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=t[9],p=t[10],d=t[11],v=t[12],g=t[13],m=t[14],y=t[15],_=n[0],b=n[1],x=n[2],E=n[3];return e[0]=_*r+b*s+x*f+E*v,e[1]=_*i+b*u+x*h+E*g,e[2]=_*o+b*l+x*p+E*m,e[3]=_*a+b*c+x*d+E*y,_=n[4],b=n[5],x=n[6],E=n[7],e[4]=_*r+b*s+x*f+E*v,e[5]=_*i+b*u+x*h+E*g,e[6]=_*o+b*l+x*p+E*m,e[7]=_*a+b*c+x*d+E*y,_=n[8],b=n[9],x=n[10],E=n[11],e[8]=_*r+b*s+x*f+E*v,e[9]=_*i+b*u+x*h+E*g,e[10]=_*o+b*l+x*p+E*m,e[11]=_*a+b*c+x*d+E*y,_=n[12],b=n[13],x=n[14],E=n[15],e[12]=_*r+b*s+x*f+E*v,e[13]=_*i+b*u+x*h+E*g,e[14]=_*o+b*l+x*p+E*m,e[15]=_*a+b*c+x*d+E*y,e}function v(e,t,n){var r,i,o,a,s,u,l,c,f,h,p,d,v=n[0],g=n[1],m=n[2];return t===e?(e[12]=t[0]*v+t[4]*g+t[8]*m+t[12],e[13]=t[1]*v+t[5]*g+t[9]*m+t[13],e[14]=t[2]*v+t[6]*g+t[10]*m+t[14],e[15]=t[3]*v+t[7]*g+t[11]*m+t[15]):(r=t[0],i=t[1],o=t[2],a=t[3],s=t[4],u=t[5],l=t[6],c=t[7],f=t[8],h=t[9],p=t[10],d=t[11],e[0]=r,e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=u,e[6]=l,e[7]=c,e[8]=f,e[9]=h,e[10]=p,e[11]=d,e[12]=r*v+s*g+f*m+t[12],e[13]=i*v+u*g+h*m+t[13],e[14]=o*v+l*g+p*m+t[14],e[15]=a*v+c*g+d*m+t[15]),e}function g(e,t,n){var r=n[0],i=n[1],o=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function m(e,t,n,i){var o,a,s,u,l,c,f,h,p,d,v,g,m,y,_,b,x,E,T,A,S,C,R,w,M=i[0],k=i[1],L=i[2],O=Math.hypot(M,k,L);return O<r.Ib?null:(M*=O=1/O,k*=O,L*=O,o=Math.sin(n),s=1-(a=Math.cos(n)),u=t[0],l=t[1],c=t[2],f=t[3],h=t[4],p=t[5],d=t[6],v=t[7],g=t[8],m=t[9],y=t[10],_=t[11],b=M*M*s+a,x=k*M*s+L*o,E=L*M*s-k*o,T=M*k*s-L*o,A=k*k*s+a,S=L*k*s+M*o,C=M*L*s+k*o,R=k*L*s-M*o,w=L*L*s+a,e[0]=u*b+h*x+g*E,e[1]=l*b+p*x+m*E,e[2]=c*b+d*x+y*E,e[3]=f*b+v*x+_*E,e[4]=u*T+h*A+g*S,e[5]=l*T+p*A+m*S,e[6]=c*T+d*A+y*S,e[7]=f*T+v*A+_*S,e[8]=u*C+h*R+g*w,e[9]=l*C+p*R+m*w,e[10]=c*C+d*R+y*w,e[11]=f*C+v*R+_*w,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function y(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[4],a=t[5],s=t[6],u=t[7],l=t[8],c=t[9],f=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+l*r,e[5]=a*i+c*r,e[6]=s*i+f*r,e[7]=u*i+h*r,e[8]=l*i-o*r,e[9]=c*i-a*r,e[10]=f*i-s*r,e[11]=h*i-u*r,e}function _(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],l=t[8],c=t[9],f=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-l*r,e[1]=a*i-c*r,e[2]=s*i-f*r,e[3]=u*i-h*r,e[8]=o*r+l*i,e[9]=a*r+c*i,e[10]=s*r+f*i,e[11]=u*r+h*i,e}function b(e,t,n){var r=Math.sin(n),i=Math.cos(n),o=t[0],a=t[1],s=t[2],u=t[3],l=t[4],c=t[5],f=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+l*r,e[1]=a*i+c*r,e[2]=s*i+f*r,e[3]=u*i+h*r,e[4]=l*i-o*r,e[5]=c*i-a*r,e[6]=f*i-s*r,e[7]=h*i-u*r,e}function x(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function E(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function T(e,t,n){var i,o,a,s=n[0],u=n[1],l=n[2],c=Math.hypot(s,u,l);return c<r.Ib?null:(s*=c=1/c,u*=c,l*=c,i=Math.sin(t),a=1-(o=Math.cos(t)),e[0]=s*s*a+o,e[1]=u*s*a+l*i,e[2]=l*s*a-u*i,e[3]=0,e[4]=s*u*a-l*i,e[5]=u*u*a+o,e[6]=l*u*a+s*i,e[7]=0,e[8]=s*l*a+u*i,e[9]=u*l*a-s*i,e[10]=l*l*a+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function A(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function S(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function C(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function R(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3],s=r+r,u=i+i,l=o+o,c=r*s,f=r*u,h=r*l,p=i*u,d=i*l,v=o*l,g=a*s,m=a*u,y=a*l;return e[0]=1-(p+v),e[1]=f+y,e[2]=h-m,e[3]=0,e[4]=f-y,e[5]=1-(c+v),e[6]=d+g,e[7]=0,e[8]=h+m,e[9]=d-g,e[10]=1-(c+p),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function w(e,t){var n=new r.WT(3),i=-t[0],o=-t[1],a=-t[2],s=t[3],u=t[4],l=t[5],c=t[6],f=t[7],h=i*i+o*o+a*a+s*s;return h>0?(n[0]=2*(u*s+f*i+l*a-c*o)/h,n[1]=2*(l*s+f*o+c*i-u*a)/h,n[2]=2*(c*s+f*a+u*o-l*i)/h):(n[0]=2*(u*s+f*i+l*a-c*o),n[1]=2*(l*s+f*o+c*i-u*a),n[2]=2*(c*s+f*a+u*o-l*i)),R(e,t,n),e}function M(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function k(e,t){var n=t[0],r=t[1],i=t[2],o=t[4],a=t[5],s=t[6],u=t[8],l=t[9],c=t[10];return e[0]=Math.hypot(n,r,i),e[1]=Math.hypot(o,a,s),e[2]=Math.hypot(u,l,c),e}function L(e,t){var n=new r.WT(3);k(n,t);var i=1/n[0],o=1/n[1],a=1/n[2],s=t[0]*i,u=t[1]*o,l=t[2]*a,c=t[4]*i,f=t[5]*o,h=t[6]*a,p=t[8]*i,d=t[9]*o,v=t[10]*a,g=s+f+v,m=0;return g>0?(m=2*Math.sqrt(g+1),e[3]=.25*m,e[0]=(h-d)/m,e[1]=(p-l)/m,e[2]=(u-c)/m):s>f&&s>v?(m=2*Math.sqrt(1+s-f-v),e[3]=(h-d)/m,e[0]=.25*m,e[1]=(u+c)/m,e[2]=(p+l)/m):f>v?(m=2*Math.sqrt(1+f-s-v),e[3]=(p-l)/m,e[0]=(u+c)/m,e[1]=.25*m,e[2]=(h+d)/m):(m=2*Math.sqrt(1+v-s-f),e[3]=(u-c)/m,e[0]=(p+l)/m,e[1]=(h+d)/m,e[2]=.25*m),e}function O(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=t[3],u=i+i,l=o+o,c=a+a,f=i*u,h=i*l,p=i*c,d=o*l,v=o*c,g=a*c,m=s*u,y=s*l,_=s*c,b=r[0],x=r[1],E=r[2];return e[0]=(1-(d+g))*b,e[1]=(h+_)*b,e[2]=(p-y)*b,e[3]=0,e[4]=(h-_)*x,e[5]=(1-(f+g))*x,e[6]=(v+m)*x,e[7]=0,e[8]=(p+y)*E,e[9]=(v-m)*E,e[10]=(1-(f+d))*E,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function I(e,t,n,r,i){var o=t[0],a=t[1],s=t[2],u=t[3],l=o+o,c=a+a,f=s+s,h=o*l,p=o*c,d=o*f,v=a*c,g=a*f,m=s*f,y=u*l,_=u*c,b=u*f,x=r[0],E=r[1],T=r[2],A=i[0],S=i[1],C=i[2],R=(1-(v+m))*x,w=(p+b)*x,M=(d-_)*x,k=(p-b)*E,L=(1-(h+m))*E,O=(g+y)*E,I=(d+_)*T,P=(g-y)*T,N=(1-(h+v))*T;return e[0]=R,e[1]=w,e[2]=M,e[3]=0,e[4]=k,e[5]=L,e[6]=O,e[7]=0,e[8]=I,e[9]=P,e[10]=N,e[11]=0,e[12]=n[0]+A-(R*A+k*S+I*C),e[13]=n[1]+S-(w*A+L*S+P*C),e[14]=n[2]+C-(M*A+O*S+N*C),e[15]=1,e}function P(e,t){var n=t[0],r=t[1],i=t[2],o=t[3],a=n+n,s=r+r,u=i+i,l=n*a,c=r*a,f=r*s,h=i*a,p=i*s,d=i*u,v=o*a,g=o*s,m=o*u;return e[0]=1-f-d,e[1]=c+m,e[2]=h-g,e[3]=0,e[4]=c-m,e[5]=1-l-d,e[6]=p+v,e[7]=0,e[8]=h+g,e[9]=p-v,e[10]=1-l-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function N(e,t,n,r,i,o,a){var s=1/(n-t),u=1/(i-r),l=1/(o-a);return e[0]=2*o*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*o*u,e[6]=0,e[7]=0,e[8]=(n+t)*s,e[9]=(i+r)*u,e[10]=(a+o)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=a*o*2*l,e[15]=0,e}function B(e,t,n,r,i){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=(i+r)*o,e[14]=2*i*r*o):(e[10]=-1,e[14]=-2*r),e}var D=B;function U(e,t,n,r,i){var o,a=1/Math.tan(t/2);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(o=1/(r-i),e[10]=i*o,e[14]=i*r*o):(e[10]=-1,e[14]=-r),e}function F(e,t,n,r){var i=Math.tan(t.upDegrees*Math.PI/180),o=Math.tan(t.downDegrees*Math.PI/180),a=Math.tan(t.leftDegrees*Math.PI/180),s=Math.tan(t.rightDegrees*Math.PI/180),u=2/(a+s),l=2/(i+o);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-(a-s)*u*.5,e[9]=(i-o)*l*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function z(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),l=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=(a+o)*l,e[15]=1,e}var G=z;function V(e,t,n,r,i,o,a){var s=1/(t-n),u=1/(r-i),l=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=l,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*u,e[14]=o*l,e[15]=1,e}function j(e,t,n,i){var o,a,s,u,c,f,h,p,d,v,g=t[0],m=t[1],y=t[2],_=i[0],b=i[1],x=i[2],E=n[0],T=n[1],A=n[2];return Math.abs(g-E)<r.Ib&&Math.abs(m-T)<r.Ib&&Math.abs(y-A)<r.Ib?l(e):(h=g-E,p=m-T,d=y-A,o=b*(d*=v=1/Math.hypot(h,p,d))-x*(p*=v),a=x*(h*=v)-_*d,s=_*p-b*h,(v=Math.hypot(o,a,s))?(o*=v=1/v,a*=v,s*=v):(o=0,a=0,s=0),u=p*s-d*a,c=d*o-h*s,f=h*a-p*o,(v=Math.hypot(u,c,f))?(u*=v=1/v,c*=v,f*=v):(u=0,c=0,f=0),e[0]=o,e[1]=u,e[2]=h,e[3]=0,e[4]=a,e[5]=c,e[6]=p,e[7]=0,e[8]=s,e[9]=f,e[10]=d,e[11]=0,e[12]=-(o*g+a*m+s*y),e[13]=-(u*g+c*m+f*y),e[14]=-(h*g+p*m+d*y),e[15]=1,e)}function H(e,t,n,r){var i=t[0],o=t[1],a=t[2],s=r[0],u=r[1],l=r[2],c=i-n[0],f=o-n[1],h=a-n[2],p=c*c+f*f+h*h;p>0&&(c*=p=1/Math.sqrt(p),f*=p,h*=p);var d=u*h-l*f,v=l*c-s*h,g=s*f-u*c;return(p=d*d+v*v+g*g)>0&&(d*=p=1/Math.sqrt(p),v*=p,g*=p),e[0]=d,e[1]=v,e[2]=g,e[3]=0,e[4]=f*g-h*v,e[5]=h*d-c*g,e[6]=c*v-f*d,e[7]=0,e[8]=c,e[9]=f,e[10]=h,e[11]=0,e[12]=i,e[13]=o,e[14]=a,e[15]=1,e}function W(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function X(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Z(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function Y(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function q(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function K(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function Q(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function $(e,t){var n=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],l=e[6],c=e[7],f=e[8],h=e[9],p=e[10],d=e[11],v=e[12],g=e[13],m=e[14],y=e[15],_=t[0],b=t[1],x=t[2],E=t[3],T=t[4],A=t[5],S=t[6],C=t[7],R=t[8],w=t[9],M=t[10],k=t[11],L=t[12],O=t[13],I=t[14],P=t[15];return Math.abs(n-_)<=r.Ib*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(i-b)<=r.Ib*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(o-x)<=r.Ib*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(a-E)<=r.Ib*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(s-T)<=r.Ib*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(u-A)<=r.Ib*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(l-S)<=r.Ib*Math.max(1,Math.abs(l),Math.abs(S))&&Math.abs(c-C)<=r.Ib*Math.max(1,Math.abs(c),Math.abs(C))&&Math.abs(f-R)<=r.Ib*Math.max(1,Math.abs(f),Math.abs(R))&&Math.abs(h-w)<=r.Ib*Math.max(1,Math.abs(h),Math.abs(w))&&Math.abs(p-M)<=r.Ib*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(d-k)<=r.Ib*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(v-L)<=r.Ib*Math.max(1,Math.abs(v),Math.abs(L))&&Math.abs(g-O)<=r.Ib*Math.max(1,Math.abs(g),Math.abs(O))&&Math.abs(m-I)<=r.Ib*Math.max(1,Math.abs(m),Math.abs(I))&&Math.abs(y-P)<=r.Ib*Math.max(1,Math.abs(y),Math.abs(P))}var J=d,ee=Y},2621:function(e,t,n){"use strict";n.d(t,{$X:function(){return l},AK:function(){return h},Fv:function(){return f},IH:function(){return u},JG:function(){return a},Ue:function(){return i},al:function(){return o},lu:function(){return v},t7:function(){return p},t8:function(){return s},tk:function(){return c}});var r=n(3794);function i(){var e=new r.WT(2);return r.WT!=Float32Array&&(e[0]=0,e[1]=0),e}function o(e,t){var n=new r.WT(2);return n[0]=e,n[1]=t,n}function a(e,t){return e[0]=t[0],e[1]=t[1],e}function s(e,t,n){return e[0]=t,e[1]=n,e}function u(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function l(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function c(e,t){return e[0]=-t[0],e[1]=-t[1],e}function f(e,t){var n=t[0],r=t[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function h(e,t){return e[0]*t[0]+e[1]*t[1]}function p(e,t,n,r){var i=t[0],o=t[1];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e}var d,v=l;d=i()},3188:function(e,t,n){"use strict";n.r(t),n.d(t,{add:function(){return c},angle:function(){return F},bezier:function(){return L},ceil:function(){return d},clone:function(){return o},copy:function(){return u},create:function(){return i},cross:function(){return w},dist:function(){return Y},distance:function(){return x},div:function(){return Z},divide:function(){return p},dot:function(){return R},equals:function(){return j},exactEquals:function(){return V},floor:function(){return v},forEach:function(){return $},fromValues:function(){return s},hermite:function(){return k},inverse:function(){return S},len:function(){return K},length:function(){return a},lerp:function(){return M},max:function(){return m},min:function(){return g},mul:function(){return X},multiply:function(){return h},negate:function(){return A},normalize:function(){return C},random:function(){return O},rotateX:function(){return B},rotateY:function(){return D},rotateZ:function(){return U},round:function(){return y},scale:function(){return _},scaleAndAdd:function(){return b},set:function(){return l},sqrDist:function(){return q},sqrLen:function(){return Q},squaredDistance:function(){return E},squaredLength:function(){return T},str:function(){return G},sub:function(){return W},subtract:function(){return f},transformMat3:function(){return P},transformMat4:function(){return I},transformQuat:function(){return N},zero:function(){return z}});var r=n(3794);function i(){var e=new r.WT(3);return r.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function o(e){var t=new r.WT(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function a(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function s(e,t,n){var i=new r.WT(3);return i[0]=e,i[1]=t,i[2]=n,i}function u(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function l(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function c(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function f(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function h(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function p(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function d(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function v(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function g(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function m(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function y(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function _(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function b(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function x(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return Math.hypot(n,r,i)}function E(e,t){var n=t[0]-e[0],r=t[1]-e[1],i=t[2]-e[2];return n*n+r*r+i*i}function T(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function A(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function S(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function C(e,t){var n=t[0],r=t[1],i=t[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function R(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function w(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[0],s=n[1],u=n[2];return e[0]=i*u-o*s,e[1]=o*a-r*u,e[2]=r*s-i*a,e}function M(e,t,n,r){var i=t[0],o=t[1],a=t[2];return e[0]=i+r*(n[0]-i),e[1]=o+r*(n[1]-o),e[2]=a+r*(n[2]-a),e}function k(e,t,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,l=a*(o-1),c=a*(3-2*o);return e[0]=t[0]*s+n[0]*u+r[0]*l+i[0]*c,e[1]=t[1]*s+n[1]*u+r[1]*l+i[1]*c,e[2]=t[2]*s+n[2]*u+r[2]*l+i[2]*c,e}function L(e,t,n,r,i,o){var a=1-o,s=a*a,u=o*o,l=s*a,c=3*o*s,f=3*u*a,h=u*o;return e[0]=t[0]*l+n[0]*c+r[0]*f+i[0]*h,e[1]=t[1]*l+n[1]*c+r[1]*f+i[1]*h,e[2]=t[2]*l+n[2]*c+r[2]*f+i[2]*h,e}function O(e,t){t=t||1;var n=2*r.FD()*Math.PI,i=2*r.FD()-1,o=Math.sqrt(1-i*i)*t;return e[0]=Math.cos(n)*o,e[1]=Math.sin(n)*o,e[2]=i*t,e}function I(e,t,n){var r=t[0],i=t[1],o=t[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,e[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,e[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,e[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,e}function P(e,t,n){var r=t[0],i=t[1],o=t[2];return e[0]=r*n[0]+i*n[3]+o*n[6],e[1]=r*n[1]+i*n[4]+o*n[7],e[2]=r*n[2]+i*n[5]+o*n[8],e}function N(e,t,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=t[0],u=t[1],l=t[2],c=i*l-o*u,f=o*s-r*l,h=r*u-i*s,p=i*h-o*f,d=o*c-r*h,v=r*f-i*c,g=2*a;return c*=g,f*=g,h*=g,p*=2,d*=2,v*=2,e[0]=s+c+p,e[1]=u+f+d,e[2]=l+h+v,e}function B(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function D(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function U(e,t,n,r){var i=[],o=[];return i[0]=t[0]-n[0],i[1]=t[1]-n[1],i[2]=t[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],e[0]=o[0]+n[0],e[1]=o[1]+n[1],e[2]=o[2]+n[2],e}function F(e,t){var n=e[0],r=e[1],i=e[2],o=t[0],a=t[1],s=t[2],u=Math.sqrt(n*n+r*r+i*i)*Math.sqrt(o*o+a*a+s*s),l=u&&R(e,t)/u;return Math.acos(Math.min(Math.max(l,-1),1))}function z(e){return e[0]=0,e[1]=0,e[2]=0,e}function G(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function V(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function j(e,t){var n=e[0],i=e[1],o=e[2],a=t[0],s=t[1],u=t[2];return Math.abs(n-a)<=r.Ib*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=r.Ib*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-u)<=r.Ib*Math.max(1,Math.abs(o),Math.abs(u))}var H,W=f,X=h,Z=p,Y=x,q=E,K=a,Q=T,$=(H=i(),function(e,t,n,r,i,o){var a,s;for(t||(t=3),n||(n=0),s=r?Math.min(r*t+n,e.length):e.length,a=n;a<s;a+=t)H[0]=e[a],H[1]=e[a+1],H[2]=e[a+2],i(H,H,o),e[a]=H[0],e[a+1]=H[1],e[a+2]=H[2];return e})},8942:function(e,t,n){"use strict";n.d(t,{Ue:function(){return i},al:function(){return o},bA:function(){return a},fF:function(){return s}});var r=n(3794);function i(){var e=new r.WT(4);return r.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function o(e,t,n,i){var o=new r.WT(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=i,o}function a(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function s(e,t,n){var r=t[0],i=t[1],o=t[2],a=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,e[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,e[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,e[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,e}var u;u=i()},2410:function(e,t,n){var r,i=n(5116).default;!function(o,a,s,u){"use strict";var l,c=["","webkit","Moz","MS","ms","o"],f=a.createElement("div"),h=Math.round,p=Math.abs,d=Date.now;function v(e,t,n){return setTimeout(E(e,n),t)}function g(e,t,n){return!!Array.isArray(e)&&(m(e,n[t],n),!0)}function m(e,t,n){var r;if(e)if(e.forEach)e.forEach(t,n);else if(e.length!==u)for(r=0;r<e.length;)t.call(n,e[r],r,e),r++;else for(r in e)e.hasOwnProperty(r)&&t.call(n,e[r],r,e)}function y(e,t,n){var r="DEPRECATED METHOD: "+t+"\n"+n+" AT \n";return function(){var t=new Error("get-stack-trace"),n=t&&t.stack?t.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",i=o.console&&(o.console.warn||o.console.log);return i&&i.call(o.console,r,n),e.apply(this,arguments)}}l="function"!=typeof Object.assign?function(e){if(e===u||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==u&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(t[i]=r[i])}return t}:Object.assign;var _=y((function(e,t,n){for(var r=Object.keys(t),i=0;i<r.length;)(!n||n&&e[r[i]]===u)&&(e[r[i]]=t[r[i]]),i++;return e}),"extend","Use `assign`."),b=y((function(e,t){return _(e,t,!0)}),"merge","Use `assign`.");function x(e,t,n){var r,i=t.prototype;(r=e.prototype=Object.create(i)).constructor=e,r._super=i,n&&l(r,n)}function E(e,t){return function(){return e.apply(t,arguments)}}function T(e,t){return"function"==i(e)?e.apply(t&&t[0]||u,t):e}function A(e,t){return e===u?t:e}function S(e,t,n){m(M(t),(function(t){e.addEventListener(t,n,!1)}))}function C(e,t,n){m(M(t),(function(t){e.removeEventListener(t,n,!1)}))}function R(e,t){for(;e;){if(e==t)return!0;e=e.parentNode}return!1}function w(e,t){return e.indexOf(t)>-1}function M(e){return e.trim().split(/\s+/g)}function k(e,t,n){if(e.indexOf&&!n)return e.indexOf(t);for(var r=0;r<e.length;){if(n&&e[r][n]==t||!n&&e[r]===t)return r;r++}return-1}function L(e){return Array.prototype.slice.call(e,0)}function O(e,t,n){for(var r=[],i=[],o=0;o<e.length;){var a=t?e[o][t]:e[o];k(i,a)<0&&r.push(e[o]),i[o]=a,o++}return n&&(r=t?r.sort((function(e,n){return e[t]>n[t]})):r.sort()),r}function I(e,t){for(var n,r,i=t[0].toUpperCase()+t.slice(1),o=0;o<c.length;){if((r=(n=c[o])?n+i:t)in e)return r;o++}return u}var P=1;function N(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow||o}var B="ontouchstart"in o,D=I(o,"PointerEvent")!==u,U=B&&/mobile|tablet|ip(ad|hone|od)|android/i.test(navigator.userAgent),F="touch",z="mouse",G=24,V=["x","y"],j=["clientX","clientY"];function H(e,t){var n=this;this.manager=e,this.callback=t,this.element=e.element,this.target=e.options.inputTarget,this.domHandler=function(t){T(e.options.enable,[e])&&n.handler(t)},this.init()}function W(e,t,n){var r=n.pointers.length,i=n.changedPointers.length,o=1&t&&r-i==0,a=12&t&&r-i==0;n.isFirst=!!o,n.isFinal=!!a,o&&(e.session={}),n.eventType=t,function(e,t){var n=e.session,r=t.pointers,i=r.length;n.firstInput||(n.firstInput=X(t));i>1&&!n.firstMultiple?n.firstMultiple=X(t):1===i&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,s=a?a.center:o.center,l=t.center=Z(r);t.timeStamp=d(),t.deltaTime=t.timeStamp-o.timeStamp,t.angle=Q(s,l),t.distance=K(s,l),function(e,t){var n=t.center,r=e.offsetDelta||{},i=e.prevDelta||{},o=e.prevInput||{};1!==t.eventType&&4!==o.eventType||(i=e.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=e.offsetDelta={x:n.x,y:n.y});t.deltaX=i.x+(n.x-r.x),t.deltaY=i.y+(n.y-r.y)}(n,t),t.offsetDirection=q(t.deltaX,t.deltaY);var c=Y(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=c.x,t.overallVelocityY=c.y,t.overallVelocity=p(c.x)>p(c.y)?c.x:c.y,t.scale=a?(f=a.pointers,h=r,K(h[0],h[1],j)/K(f[0],f[1],j)):1,t.rotation=a?function(e,t){return Q(t[1],t[0],j)+Q(e[1],e[0],j)}(a.pointers,r):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length,function(e,t){var n,r,i,o,a=e.lastInterval||t,s=t.timeStamp-a.timeStamp;if(8!=t.eventType&&(s>25||a.velocity===u)){var l=t.deltaX-a.deltaX,c=t.deltaY-a.deltaY,f=Y(s,l,c);r=f.x,i=f.y,n=p(f.x)>p(f.y)?f.x:f.y,o=q(l,c),e.lastInterval=t}else n=a.velocity,r=a.velocityX,i=a.velocityY,o=a.direction;t.velocity=n,t.velocityX=r,t.velocityY=i,t.direction=o}(n,t);var f,h;var v=e.element;R(t.srcEvent.target,v)&&(v=t.srcEvent.target);t.target=v}(e,n),e.emit("hammer.input",n),e.recognize(n),e.session.prevInput=n}function X(e){for(var t=[],n=0;n<e.pointers.length;)t[n]={clientX:h(e.pointers[n].clientX),clientY:h(e.pointers[n].clientY)},n++;return{timeStamp:d(),pointers:t,center:Z(t),deltaX:e.deltaX,deltaY:e.deltaY}}function Z(e){var t=e.length;if(1===t)return{x:h(e[0].clientX),y:h(e[0].clientY)};for(var n=0,r=0,i=0;i<t;)n+=e[i].clientX,r+=e[i].clientY,i++;return{x:h(n/t),y:h(r/t)}}function Y(e,t,n){return{x:t/e||0,y:n/e||0}}function q(e,t){return e===t?1:p(e)>=p(t)?e<0?2:4:t<0?8:16}function K(e,t,n){n||(n=V);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return Math.sqrt(r*r+i*i)}function Q(e,t,n){n||(n=V);var r=t[n[0]]-e[n[0]],i=t[n[1]]-e[n[1]];return 180*Math.atan2(i,r)/Math.PI}H.prototype={handler:function(){},init:function(){this.evEl&&S(this.element,this.evEl,this.domHandler),this.evTarget&&S(this.target,this.evTarget,this.domHandler),this.evWin&&S(N(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&C(this.element,this.evEl,this.domHandler),this.evTarget&&C(this.target,this.evTarget,this.domHandler),this.evWin&&C(N(this.element),this.evWin,this.domHandler)}};var $={mousedown:1,mousemove:2,mouseup:4},J="mousedown",ee="mousemove mouseup";function te(){this.evEl=J,this.evWin=ee,this.pressed=!1,H.apply(this,arguments)}x(te,H,{handler:function(e){var t=$[e.type];1&t&&0===e.button&&(this.pressed=!0),2&t&&1!==e.which&&(t=4),this.pressed&&(4&t&&(this.pressed=!1),this.callback(this.manager,t,{pointers:[e],changedPointers:[e],pointerType:z,srcEvent:e}))}});var ne={pointerdown:1,pointermove:2,pointerup:4,pointercancel:8,pointerout:8},re={2:F,3:"pen",4:z,5:"kinect"},ie="pointerdown",oe="pointermove pointerup pointercancel";function ae(){this.evEl=ie,this.evWin=oe,H.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}o.MSPointerEvent&&!o.PointerEvent&&(ie="MSPointerDown",oe="MSPointerMove MSPointerUp MSPointerCancel"),x(ae,H,{handler:function(e){var t=this.store,n=!1,r=e.type.toLowerCase().replace("ms",""),i=ne[r],o=re[e.pointerType]||e.pointerType,a=o==F,s=k(t,e.pointerId,"pointerId");1&i&&(0===e.button||a)?s<0&&(t.push(e),s=t.length-1):12&i&&(n=!0),s<0||(t[s]=e,this.callback(this.manager,i,{pointers:t,changedPointers:[e],pointerType:o,srcEvent:e}),n&&t.splice(s,1))}});var se={touchstart:1,touchmove:2,touchend:4,touchcancel:8},ue="touchstart",le="touchstart touchmove touchend touchcancel";function ce(){this.evTarget=ue,this.evWin=le,this.started=!1,H.apply(this,arguments)}function fe(e,t){var n=L(e.touches),r=L(e.changedTouches);return 12&t&&(n=O(n.concat(r),"identifier",!0)),[n,r]}x(ce,H,{handler:function(e){var t=se[e.type];if(1===t&&(this.started=!0),this.started){var n=fe.call(this,e,t);12&t&&n[0].length-n[1].length==0&&(this.started=!1),this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:F,srcEvent:e})}}});var he={touchstart:1,touchmove:2,touchend:4,touchcancel:8},pe="touchstart touchmove touchend touchcancel";function de(){this.evTarget=pe,this.targetIds={},H.apply(this,arguments)}function ve(e,t){var n=L(e.touches),r=this.targetIds;if(3&t&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,a=L(e.changedTouches),s=[],u=this.target;if(o=n.filter((function(e){return R(e.target,u)})),1===t)for(i=0;i<o.length;)r[o[i].identifier]=!0,i++;for(i=0;i<a.length;)r[a[i].identifier]&&s.push(a[i]),12&t&&delete r[a[i].identifier],i++;return s.length?[O(o.concat(s),"identifier",!0),s]:void 0}x(de,H,{handler:function(e){var t=he[e.type],n=ve.call(this,e,t);n&&this.callback(this.manager,t,{pointers:n[0],changedPointers:n[1],pointerType:F,srcEvent:e})}});function ge(){H.apply(this,arguments);var e=E(this.handler,this);this.touch=new de(this.manager,e),this.mouse=new te(this.manager,e),this.primaryTouch=null,this.lastTouches=[]}function me(e,t){1&e?(this.primaryTouch=t.changedPointers[0].identifier,ye.call(this,t)):12&e&&ye.call(this,t)}function ye(e){var t=e.changedPointers[0];if(t.identifier===this.primaryTouch){var n={x:t.clientX,y:t.clientY};this.lastTouches.push(n);var r=this.lastTouches;setTimeout((function(){var e=r.indexOf(n);e>-1&&r.splice(e,1)}),2500)}}function _e(e){for(var t=e.srcEvent.clientX,n=e.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(t-i.x),a=Math.abs(n-i.y);if(o<=25&&a<=25)return!0}return!1}x(ge,H,{handler:function(e,t,n){var r=n.pointerType==F,i=n.pointerType==z;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)me.call(this,t,n);else if(i&&_e.call(this,n))return;this.callback(e,t,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var be=I(f.style,"touchAction"),xe=be!==u,Ee="compute",Te="auto",Ae="manipulation",Se="none",Ce="pan-x",Re="pan-y",we=function(){if(!xe)return!1;var e={},t=o.CSS&&o.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){e[n]=!t||o.CSS.supports("touch-action",n)})),e}();function Me(e,t){this.manager=e,this.set(t)}Me.prototype={set:function(e){e==Ee&&(e=this.compute()),xe&&this.manager.element.style&&we[e]&&(this.manager.element.style[be]=e),this.actions=e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var e=[];return m(this.manager.recognizers,(function(t){T(t.options.enable,[t])&&(e=e.concat(t.getTouchAction()))})),function(e){if(w(e,Se))return Se;var t=w(e,Ce),n=w(e,Re);if(t&&n)return Se;if(t||n)return t?Ce:Re;if(w(e,Ae))return Ae;return Te}(e.join(" "))},preventDefaults:function(e){var t=e.srcEvent,n=e.offsetDirection;if(this.manager.session.prevented)t.preventDefault();else{var r=this.actions,i=w(r,Se)&&!we[Se],o=w(r,Re)&&!we[Re],a=w(r,Ce)&&!we[Ce];if(i){var s=1===e.pointers.length,u=e.distance<2,l=e.deltaTime<250;if(s&&u&&l)return}if(!a||!o)return i||o&&6&n||a&&n&G?this.preventSrc(t):void 0}},preventSrc:function(e){this.manager.session.prevented=!0,e.preventDefault()}};var ke=32;function Le(e){this.options=l({},this.defaults,e||{}),this.id=P++,this.manager=null,this.options.enable=A(this.options.enable,!0),this.state=1,this.simultaneous={},this.requireFail=[]}function Oe(e){return 16&e?"cancel":8&e?"end":4&e?"move":2&e?"start":""}function Ie(e){return 16==e?"down":8==e?"up":2==e?"left":4==e?"right":""}function Pe(e,t){var n=t.manager;return n?n.get(e):e}function Ne(){Le.apply(this,arguments)}function Be(){Ne.apply(this,arguments),this.pX=null,this.pY=null}function De(){Ne.apply(this,arguments)}function Ue(){Le.apply(this,arguments),this._timer=null,this._input=null}function Fe(){Ne.apply(this,arguments)}function ze(){Ne.apply(this,arguments)}function Ge(){Le.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Ve(e,t){return(t=t||{}).recognizers=A(t.recognizers,Ve.defaults.preset),new je(e,t)}Le.prototype={defaults:{},set:function(e){return l(this.options,e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(e){if(g(e,"recognizeWith",this))return this;var t=this.simultaneous;return t[(e=Pe(e,this)).id]||(t[e.id]=e,e.recognizeWith(this)),this},dropRecognizeWith:function(e){return g(e,"dropRecognizeWith",this)||(e=Pe(e,this),delete this.simultaneous[e.id]),this},requireFailure:function(e){if(g(e,"requireFailure",this))return this;var t=this.requireFail;return-1===k(t,e=Pe(e,this))&&(t.push(e),e.requireFailure(this)),this},dropRequireFailure:function(e){if(g(e,"dropRequireFailure",this))return this;e=Pe(e,this);var t=k(this.requireFail,e);return t>-1&&this.requireFail.splice(t,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(e){return!!this.simultaneous[e.id]},emit:function(e){var t=this,n=this.state;function r(n){t.manager.emit(n,e)}n<8&&r(t.options.event+Oe(n)),r(t.options.event),e.additionalEvent&&r(e.additionalEvent),n>=8&&r(t.options.event+Oe(n))},tryEmit:function(e){if(this.canEmit())return this.emit(e);this.state=ke},canEmit:function(){for(var e=0;e<this.requireFail.length;){if(!(33&this.requireFail[e].state))return!1;e++}return!0},recognize:function(e){var t=l({},e);if(!T(this.options.enable,[this,t]))return this.reset(),void(this.state=ke);56&this.state&&(this.state=1),this.state=this.process(t),30&this.state&&this.tryEmit(t)},process:function(e){},getTouchAction:function(){},reset:function(){}},x(Ne,Le,{defaults:{pointers:1},attrTest:function(e){var t=this.options.pointers;return 0===t||e.pointers.length===t},process:function(e){var t=this.state,n=e.eventType,r=6&t,i=this.attrTest(e);return r&&(8&n||!i)?16|t:r||i?4&n?8|t:2&t?4|t:2:ke}}),x(Be,Ne,{defaults:{event:"pan",threshold:10,pointers:1,direction:30},getTouchAction:function(){var e=this.options.direction,t=[];return 6&e&&t.push(Re),e&G&&t.push(Ce),t},directionTest:function(e){var t=this.options,n=!0,r=e.distance,i=e.direction,o=e.deltaX,a=e.deltaY;return i&t.direction||(6&t.direction?(i=0===o?1:o<0?2:4,n=o!=this.pX,r=Math.abs(e.deltaX)):(i=0===a?1:a<0?8:16,n=a!=this.pY,r=Math.abs(e.deltaY))),e.direction=i,n&&r>t.threshold&&i&t.direction},attrTest:function(e){return Ne.prototype.attrTest.call(this,e)&&(2&this.state||!(2&this.state)&&this.directionTest(e))},emit:function(e){this.pX=e.deltaX,this.pY=e.deltaY;var t=Ie(e.direction);t&&(e.additionalEvent=this.options.event+t),this._super.emit.call(this,e)}}),x(De,Ne,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Se]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.scale-1)>this.options.threshold||2&this.state)},emit:function(e){if(1!==e.scale){var t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}this._super.emit.call(this,e)}}),x(Ue,Le,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Te]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime>t.time;if(this._input=e,!r||!n||12&e.eventType&&!i)this.reset();else if(1&e.eventType)this.reset(),this._timer=v((function(){this.state=8,this.tryEmit()}),t.time,this);else if(4&e.eventType)return 8;return ke},reset:function(){clearTimeout(this._timer)},emit:function(e){8===this.state&&(e&&4&e.eventType?this.manager.emit(this.options.event+"up",e):(this._input.timeStamp=d(),this.manager.emit(this.options.event,this._input)))}}),x(Fe,Ne,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Se]},attrTest:function(e){return this._super.attrTest.call(this,e)&&(Math.abs(e.rotation)>this.options.threshold||2&this.state)}}),x(ze,Ne,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:30,pointers:1},getTouchAction:function(){return Be.prototype.getTouchAction.call(this)},attrTest:function(e){var t,n=this.options.direction;return 30&n?t=e.overallVelocity:6&n?t=e.overallVelocityX:n&G&&(t=e.overallVelocityY),this._super.attrTest.call(this,e)&&n&e.offsetDirection&&e.distance>this.options.threshold&&e.maxPointers==this.options.pointers&&p(t)>this.options.velocity&&4&e.eventType},emit:function(e){var t=Ie(e.offsetDirection);t&&this.manager.emit(this.options.event+t,e),this.manager.emit(this.options.event,e)}}),x(Ge,Le,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Ae]},process:function(e){var t=this.options,n=e.pointers.length===t.pointers,r=e.distance<t.threshold,i=e.deltaTime<t.time;if(this.reset(),1&e.eventType&&0===this.count)return this.failTimeout();if(r&&i&&n){if(4!=e.eventType)return this.failTimeout();var o=!this.pTime||e.timeStamp-this.pTime<t.interval,a=!this.pCenter||K(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,a&&o?this.count+=1:this.count=1,this._input=e,0===this.count%t.taps)return this.hasRequireFailures()?(this._timer=v((function(){this.state=8,this.tryEmit()}),t.interval,this),2):8}return ke},failTimeout:function(){return this._timer=v((function(){this.state=ke}),this.options.interval,this),ke},reset:function(){clearTimeout(this._timer)},emit:function(){8==this.state&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Ve.VERSION="2.0.7",Ve.defaults={domEvents:!1,touchAction:Ee,enable:!0,inputTarget:null,inputClass:null,preset:[[Fe,{enable:!1}],[De,{enable:!1},["rotate"]],[ze,{direction:6}],[Be,{direction:6},["swipe"]],[Ge],[Ge,{event:"doubletap",taps:2},["tap"]],[Ue]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};function je(e,t){var n;this.options=l({},Ve.defaults,t||{}),this.options.inputTarget=this.options.inputTarget||e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new((n=this).options.inputClass||(D?ae:U?de:B?ge:te))(n,W),this.touchAction=new Me(this,this.options.touchAction),He(this,!0),m(this.options.recognizers,(function(e){var t=this.add(new e[0](e[1]));e[2]&&t.recognizeWith(e[2]),e[3]&&t.requireFailure(e[3])}),this)}function He(e,t){var n,r=e.element;r.style&&(m(e.options.cssProps,(function(i,o){n=I(r.style,o),t?(e.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=e.oldCssProps[n]||""})),t||(e.oldCssProps={}))}je.prototype={set:function(e){return l(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this},stop:function(e){this.session.stopped=e?2:1},recognize:function(e){var t=this.session;if(!t.stopped){var n;this.touchAction.preventDefaults(e);var r=this.recognizers,i=t.curRecognizer;(!i||i&&8&i.state)&&(i=t.curRecognizer=null);for(var o=0;o<r.length;)n=r[o],2===t.stopped||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(e),!i&&14&n.state&&(i=t.curRecognizer=n),o++}},get:function(e){if(e instanceof Le)return e;for(var t=this.recognizers,n=0;n<t.length;n++)if(t[n].options.event==e)return t[n];return null},add:function(e){if(g(e,"add",this))return this;var t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e},remove:function(e){if(g(e,"remove",this))return this;if(e=this.get(e)){var t=this.recognizers,n=k(t,e);-1!==n&&(t.splice(n,1),this.touchAction.update())}return this},on:function(e,t){if(e!==u&&t!==u){var n=this.handlers;return m(M(e),(function(e){n[e]=n[e]||[],n[e].push(t)})),this}},off:function(e,t){if(e!==u){var n=this.handlers;return m(M(e),(function(e){t?n[e]&&n[e].splice(k(n[e],t),1):delete n[e]})),this}},emit:function(e,t){this.options.domEvents&&function(e,t){var n=a.createEvent("Event");n.initEvent(e,!0,!0),n.gesture=t,t.target.dispatchEvent(n)}(e,t);var n=this.handlers[e]&&this.handlers[e].slice();if(n&&n.length){t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};for(var r=0;r<n.length;)n[r](t),r++}},destroy:function(){this.element&&He(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},l(Ve,{INPUT_START:1,INPUT_MOVE:2,INPUT_END:4,INPUT_CANCEL:8,STATE_POSSIBLE:1,STATE_BEGAN:2,STATE_CHANGED:4,STATE_ENDED:8,STATE_RECOGNIZED:8,STATE_CANCELLED:16,STATE_FAILED:ke,DIRECTION_NONE:1,DIRECTION_LEFT:2,DIRECTION_RIGHT:4,DIRECTION_UP:8,DIRECTION_DOWN:16,DIRECTION_HORIZONTAL:6,DIRECTION_VERTICAL:G,DIRECTION_ALL:30,Manager:je,Input:H,TouchAction:Me,TouchInput:de,MouseInput:te,PointerEventInput:ae,TouchMouseInput:ge,SingleTouchInput:ce,Recognizer:Le,AttrRecognizer:Ne,Tap:Ge,Pan:Be,Swipe:ze,Pinch:De,Rotate:Fe,Press:Ue,on:S,off:C,each:m,merge:b,extend:_,assign:l,inherit:x,bindFn:E,prefixed:I}),(void 0!==o?o:"undefined"!=typeof self?self:{}).Hammer=Ve,(r=function(){return Ve}.call(t,n,t,e))===u||(e.exports=r)}(window,document)},6460:function(e,t){t.read=function(e,t,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,l=u>>1,c=-7,f=n?i-1:0,h=n?-1:1,p=e[t+f];for(f+=h,o=p&(1<<-c)-1,p>>=-c,c+=s;c>0;o=256*o+e[t+f],f+=h,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=r;c>0;a=256*a+e[t+f],f+=h,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=l}return(p?-1:1)*a*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,f=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-a))<1&&(a--,u*=2),(t+=a+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(a++,u/=2),a+f>=c?(s=0,a=c):a+f>=1?(s=(t*u-1)*Math.pow(2,i),a+=f):(s=t*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;e[n+p]=255&s,p+=d,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;e[n+p]=255&a,p+=d,a/=256,l-=8);e[n+p-d]|=128*v}},5655:function(e,t,n){var r=n(8978)(n(2385),"DataView");e.exports=r},8047:function(e,t,n){var r=n(6387),i=n(3850),o=n(9354),a=n(9254),s=n(2137);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},9708:function(e,t,n){var r=n(1628),i=n(3789),o=n(2129),a=n(8289),s=n(8613);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},4902:function(e,t,n){var r=n(8978)(n(2385),"Map");e.exports=r},6778:function(e,t,n){var r=n(6866),i=n(4798),o=n(7915),a=n(3834),s=n(2992);function u(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype.delete=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,e.exports=u},2313:function(e,t,n){var r=n(8978)(n(2385),"Promise");e.exports=r},7858:function(e,t,n){var r=n(8978)(n(2385),"Set");e.exports=r},8831:function(e,t,n){var r=n(6778),i=n(353),o=n(3347);function a(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new r;++t<n;)this.add(e[t])}a.prototype.add=a.prototype.push=i,a.prototype.has=o,e.exports=a},4958:function(e,t,n){var r=n(9708),i=n(2018),o=n(6211),a=n(4592),s=n(9253),u=n(6539);function l(e){var t=this.__data__=new r(e);this.size=t.size}l.prototype.clear=i,l.prototype.delete=o,l.prototype.get=a,l.prototype.has=s,l.prototype.set=u,e.exports=l},2742:function(e,t,n){var r=n(2385).Symbol;e.exports=r},8224:function(e,t,n){var r=n(2385).Uint8Array;e.exports=r},2748:function(e,t,n){var r=n(8978)(n(2385),"WeakMap");e.exports=r},6316:function(e){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},3590:function(e){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e}},3775:function(e){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}},7110:function(e,t,n){var r=n(1822);e.exports=function(e,t){return!!(null==e?0:e.length)&&r(e,t,0)>-1}},5909:function(e){e.exports=function(e,t,n){for(var r=-1,i=null==e?0:e.length;++r<i;)if(n(t,e[r]))return!0;return!1}},3118:function(e,t,n){var r=n(854),i=n(738),o=n(7276),a=n(9758),s=n(3492),u=n(3749),l=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=o(e),c=!n&&i(e),f=!n&&!c&&a(e),h=!n&&!c&&!f&&u(e),p=n||c||f||h,d=p?r(e.length,String):[],v=d.length;for(var g in e)!t&&!l.call(e,g)||p&&("length"==g||f&&("offset"==g||"parent"==g)||h&&("buffer"==g||"byteLength"==g||"byteOffset"==g)||s(g,v))||d.push(g);return d}},8885:function(e){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length,i=Array(r);++n<r;)i[n]=t(e[n],n,e);return i}},446:function(e){e.exports=function(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}},8856:function(e){e.exports=function(e,t,n,r){var i=-1,o=null==e?0:e.length;for(r&&o&&(n=e[++i]);++i<o;)n=t(n,e[i],i,e);return n}},2145:function(e){e.exports=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}},9370:function(e){e.exports=function(e){return e.split("")}},6321:function(e){var t=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;e.exports=function(e){return e.match(t)||[]}},5774:function(e,t,n){var r=n(8860),i=n(3949);e.exports=function(e,t,n){(void 0!==n&&!i(e[t],n)||void 0===n&&!(t in e))&&r(e,t,n)}},131:function(e,t,n){var r=n(8860),i=n(3949),o=Object.prototype.hasOwnProperty;e.exports=function(e,t,n){var a=e[t];o.call(e,t)&&i(a,n)&&(void 0!==n||t in e)||r(e,t,n)}},2839:function(e,t,n){var r=n(3949);e.exports=function(e,t){for(var n=e.length;n--;)if(r(e[n][0],t))return n;return-1}},2910:function(e,t,n){var r=n(2904),i=n(5330);e.exports=function(e,t){return e&&r(t,i(t),e)}},8453:function(e,t,n){var r=n(2904),i=n(7263);e.exports=function(e,t){return e&&r(t,i(t),e)}},8860:function(e,t,n){var r=n(3592);e.exports=function(e,t,n){"__proto__"==t&&r?r(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n}},3691:function(e){e.exports=function(e,t,n){return e==e&&(void 0!==n&&(e=e<=n?e:n),void 0!==t&&(e=e>=t?e:t)),e}},3496:function(e,t,n){var r=n(4958),i=n(3590),o=n(131),a=n(2910),s=n(8453),u=n(5410),l=n(8147),c=n(2728),f=n(4562),h=n(9045),p=n(481),d=n(4656),v=n(8502),g=n(3502),m=n(5662),y=n(7276),_=n(9758),b=n(870),x=n(8137),E=n(4353),T=n(5330),A=n(7263),S="[object Arguments]",C="[object Function]",R="[object Object]",w={};w[S]=w["[object Array]"]=w["[object ArrayBuffer]"]=w["[object DataView]"]=w["[object Boolean]"]=w["[object Date]"]=w["[object Float32Array]"]=w["[object Float64Array]"]=w["[object Int8Array]"]=w["[object Int16Array]"]=w["[object Int32Array]"]=w["[object Map]"]=w["[object Number]"]=w[R]=w["[object RegExp]"]=w["[object Set]"]=w["[object String]"]=w["[object Symbol]"]=w["[object Uint8Array]"]=w["[object Uint8ClampedArray]"]=w["[object Uint16Array]"]=w["[object Uint32Array]"]=!0,w["[object Error]"]=w[C]=w["[object WeakMap]"]=!1,e.exports=function e(t,n,M,k,L,O){var I,P=1&n,N=2&n,B=4&n;if(M&&(I=L?M(t,k,L,O):M(t)),void 0!==I)return I;if(!x(t))return t;var D=y(t);if(D){if(I=v(t),!P)return l(t,I)}else{var U=d(t),F=U==C||"[object GeneratorFunction]"==U;if(_(t))return u(t,P);if(U==R||U==S||F&&!L){if(I=N||F?{}:m(t),!P)return N?f(t,s(I,t)):c(t,a(I,t))}else{if(!w[U])return L?t:{};I=g(t,U,P)}}O||(O=new r);var z=O.get(t);if(z)return z;O.set(t,I),E(t)?t.forEach((function(r){I.add(e(r,n,M,r,t,O))})):b(t)&&t.forEach((function(r,i){I.set(i,e(r,n,M,i,t,O))}));var G=D?void 0:(B?N?p:h:N?A:T)(t);return i(G||t,(function(r,i){G&&(r=t[i=r]),o(I,i,e(r,n,M,i,t,O))})),I}},8306:function(e,t,n){var r=n(8137),i=Object.create,o=function(){function e(){}return function(t){if(!r(t))return{};if(i)return i(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();e.exports=o},2987:function(e){e.exports=function(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return-1}},7220:function(e,t,n){var r=n(4090)();e.exports=r},4190:function(e,t,n){var r=n(6380),i=n(776);e.exports=function(e,t){for(var n=0,o=(t=r(t,e)).length;null!=e&&n<o;)e=e[i(t[n++])];return n&&n==o?e:void 0}},571:function(e,t,n){var r=n(446),i=n(7276);e.exports=function(e,t,n){var o=t(e);return i(e)?o:r(o,n(e))}},460:function(e,t,n){var r=n(2742),i=n(3315),o=n(9402),a=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?i(e):o(e)}},1822:function(e,t,n){var r=n(2987),i=n(2053),o=n(8098);e.exports=function(e,t,n){return t==t?o(e,t,n):r(e,i,n)}},5902:function(e){e.exports=function(e,t,n,r){for(var i=n-1,o=e.length;++i<o;)if(r(e[i],t))return i;return-1}},1766:function(e,t,n){var r=n(460),i=n(4518);e.exports=function(e){return i(e)&&"[object Arguments]"==r(e)}},4745:function(e,t,n){var r=n(7750),i=n(4518);e.exports=function e(t,n,o,a,s){return t===n||(null==t||null==n||!i(t)&&!i(n)?t!=t&&n!=n:r(t,n,o,a,e,s))}},7750:function(e,t,n){var r=n(4958),i=n(440),o=n(4758),a=n(371),s=n(4656),u=n(7276),l=n(9758),c=n(3749),f="[object Arguments]",h="[object Array]",p="[object Object]",d=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,v,g,m){var y=u(e),_=u(t),b=y?h:s(e),x=_?h:s(t),E=(b=b==f?p:b)==p,T=(x=x==f?p:x)==p,A=b==x;if(A&&l(e)){if(!l(t))return!1;y=!0,E=!1}if(A&&!E)return m||(m=new r),y||c(e)?i(e,t,n,v,g,m):o(e,t,b,n,v,g,m);if(!(1&n)){var S=E&&d.call(e,"__wrapped__"),C=T&&d.call(t,"__wrapped__");if(S||C){var R=S?e.value():e,w=C?t.value():t;return m||(m=new r),g(R,w,n,v,m)}}return!!A&&(m||(m=new r),a(e,t,n,v,g,m))}},5610:function(e,t,n){var r=n(4656),i=n(4518);e.exports=function(e){return i(e)&&"[object Map]"==r(e)}},2053:function(e){e.exports=function(e){return e!=e}},8406:function(e,t,n){var r=n(2530),i=n(6599),o=n(8137),a=n(4590),s=/^\[object .+?Constructor\]$/,u=Function.prototype,l=Object.prototype,c=u.toString,f=l.hasOwnProperty,h=RegExp("^"+c.call(f).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||i(e))&&(r(e)?h:s).test(a(e))}},1994:function(e,t,n){var r=n(4656),i=n(4518);e.exports=function(e){return i(e)&&"[object Set]"==r(e)}},3720:function(e,t,n){var r=n(460),i=n(5318),o=n(4518),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&i(e.length)&&!!a[r(e)]}},1823:function(e,t,n){var r=n(3847),i=n(8591),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return i(e);var t=[];for(var n in Object(e))o.call(e,n)&&"constructor"!=n&&t.push(n);return t}},5975:function(e,t,n){var r=n(8137),i=n(3847),o=n(6898),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return o(e);var t=i(e),n=[];for(var s in e)("constructor"!=s||!t&&a.call(e,s))&&n.push(s);return n}},9820:function(e,t,n){var r=n(4958),i=n(5774),o=n(7220),a=n(7300),s=n(8137),u=n(7263),l=n(3219);e.exports=function e(t,n,c,f,h){t!==n&&o(n,(function(o,u){if(h||(h=new r),s(o))a(t,n,u,c,e,f,h);else{var p=f?f(l(t,u),o,u+"",t,n,h):void 0;void 0===p&&(p=o),i(t,u,p)}}),u)}},7300:function(e,t,n){var r=n(5774),i=n(5410),o=n(9989),a=n(8147),s=n(5662),u=n(738),l=n(7276),c=n(4658),f=n(9758),h=n(2530),p=n(8137),d=n(1091),v=n(3749),g=n(3219),m=n(6532);e.exports=function(e,t,n,y,_,b,x){var E=g(e,n),T=g(t,n),A=x.get(T);if(A)r(e,n,A);else{var S=b?b(E,T,n+"",e,t,x):void 0,C=void 0===S;if(C){var R=l(T),w=!R&&f(T),M=!R&&!w&&v(T);S=T,R||w||M?l(E)?S=E:c(E)?S=a(E):w?(C=!1,S=i(T,!0)):M?(C=!1,S=o(T,!0)):S=[]:d(T)||u(T)?(S=E,u(E)?S=m(E):p(E)&&!h(E)||(S=s(T))):C=!1}C&&(x.set(T,S),_(S,T,y,b,x),x.delete(T)),r(e,n,S)}}},1991:function(e){e.exports=function(e){return function(t){return null==e?void 0:e[t]}}},6239:function(e,t,n){var r=n(8885),i=n(1822),o=n(5902),a=n(7686),s=n(8147),u=Array.prototype.splice;e.exports=function(e,t,n,l){var c=l?o:i,f=-1,h=t.length,p=e;for(e===t&&(t=s(t)),n&&(p=r(e,a(n)));++f<h;)for(var d=0,v=t[f],g=n?n(v):v;(d=c(p,g,d,l))>-1;)p!==e&&u.call(p,d,1),u.call(e,d,1);return e}},8165:function(e,t,n){var r=n(1434),i=n(5874),o=n(5117);e.exports=function(e,t){return o(i(e,t,r),e+"")}},5849:function(e,t,n){var r=n(7004),i=n(3592),o=n(1434),a=i?function(e,t){return i(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:o;e.exports=a},3629:function(e){e.exports=function(e,t,n){var r=-1,i=e.length;t<0&&(t=-t>i?0:i+t),(n=n>i?i:n)<0&&(n+=i),i=t>n?0:n-t>>>0,t>>>=0;for(var o=Array(i);++r<i;)o[r]=e[r+t];return o}},854:function(e){e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},9863:function(e,t,n){var r=n(2742),i=n(8885),o=n(7276),a=n(4906),s=r?r.prototype:void 0,u=s?s.toString:void 0;e.exports=function e(t){if("string"==typeof t)return t;if(o(t))return i(t,e)+"";if(a(t))return u?u.call(t):"";var n=t+"";return"0"==n&&1/t==-Infinity?"-0":n}},9109:function(e,t,n){var r=n(7029),i=/^\s+/;e.exports=function(e){return e?e.slice(0,r(e)+1).replace(i,""):e}},7686:function(e){e.exports=function(e){return function(t){return e(t)}}},938:function(e,t,n){var r=n(8831),i=n(7110),o=n(5909),a=n(144),s=n(8243),u=n(2203);e.exports=function(e,t,n){var l=-1,c=i,f=e.length,h=!0,p=[],d=p;if(n)h=!1,c=o;else if(f>=200){var v=t?null:s(e);if(v)return u(v);h=!1,c=a,d=new r}else d=t?[]:p;e:for(;++l<f;){var g=e[l],m=t?t(g):g;if(g=n||0!==g?g:0,h&&m==m){for(var y=d.length;y--;)if(d[y]===m)continue e;t&&d.push(m),p.push(g)}else c(d,m,n)||(d!==p&&d.push(m),p.push(g))}return p}},144:function(e){e.exports=function(e,t){return e.has(t)}},6380:function(e,t,n){var r=n(7276),i=n(8145),o=n(686),a=n(5944);e.exports=function(e,t){return r(e)?e:i(e,t)?[e]:o(a(e))}},8334:function(e,t,n){var r=n(3629);e.exports=function(e,t,n){var i=e.length;return n=void 0===n?i:n,!t&&n>=i?e:r(e,t,n)}},8355:function(e,t,n){var r=n(8224);e.exports=function(e){var t=new e.constructor(e.byteLength);return new r(t).set(new r(e)),t}},5410:function(e,t,n){e=n.nmd(e);var r=n(5116).default,i=n(2385),o="object"==r(t)&&t&&!t.nodeType&&t,a=o&&"object"==r(e)&&e&&!e.nodeType&&e,s=a&&a.exports===o?i.Buffer:void 0,u=s?s.allocUnsafe:void 0;e.exports=function(e,t){if(t)return e.slice();var n=e.length,r=u?u(n):new e.constructor(n);return e.copy(r),r}},5579:function(e,t,n){var r=n(8355);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)}},583:function(e){var t=/\w*$/;e.exports=function(e){var n=new e.constructor(e.source,t.exec(e));return n.lastIndex=e.lastIndex,n}},5256:function(e,t,n){var r=n(2742),i=r?r.prototype:void 0,o=i?i.valueOf:void 0;e.exports=function(e){return o?Object(o.call(e)):{}}},9989:function(e,t,n){var r=n(8355);e.exports=function(e,t){var n=t?r(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)}},8147:function(e){e.exports=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t}},2904:function(e,t,n){var r=n(131),i=n(8860);e.exports=function(e,t,n,o){var a=!n;n||(n={});for(var s=-1,u=t.length;++s<u;){var l=t[s],c=o?o(n[l],e[l],l,n,e):void 0;void 0===c&&(c=e[l]),a?i(n,l,c):r(n,l,c)}return n}},2728:function(e,t,n){var r=n(2904),i=n(9893);e.exports=function(e,t){return r(e,i(e),t)}},4562:function(e,t,n){var r=n(2904),i=n(6827);e.exports=function(e,t){return r(e,i(e),t)}},7465:function(e,t,n){var r=n(2385)["__core-js_shared__"];e.exports=r},4364:function(e,t,n){var r=n(8165),i=n(1805);e.exports=function(e){return r((function(t,n){var r=-1,o=n.length,a=o>1?n[o-1]:void 0,s=o>2?n[2]:void 0;for(a=e.length>3&&"function"==typeof a?(o--,a):void 0,s&&i(n[0],n[1],s)&&(a=o<3?void 0:a,o=1),t=Object(t);++r<o;){var u=n[r];u&&e(t,u,r,a)}return t}))}},4090:function(e){e.exports=function(e){return function(t,n,r){for(var i=-1,o=Object(t),a=r(t),s=a.length;s--;){var u=a[e?s:++i];if(!1===n(o[u],u,o))break}return t}}},2665:function(e,t,n){var r=n(8334),i=n(3104),o=n(3655),a=n(5944);e.exports=function(e){return function(t){t=a(t);var n=i(t)?o(t):void 0,s=n?n[0]:t.charAt(0),u=n?r(n,1).join(""):t.slice(1);return s[e]()+u}}},1437:function(e,t,n){var r=n(8856),i=n(7608),o=n(2294),a=RegExp("['’]","g");e.exports=function(e){return function(t){return r(o(i(t).replace(a,"")),e,"")}}},8243:function(e,t,n){var r=n(7858),i=n(5093),o=n(2203),a=r&&1/o(new r([,-0]))[1]==1/0?function(e){return new r(e)}:i;e.exports=a},9218:function(e,t,n){var r=n(1991)({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"});e.exports=r},3592:function(e,t,n){var r=n(8978),i=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=i},440:function(e,t,n){var r=n(8831),i=n(2145),o=n(144);e.exports=function(e,t,n,a,s,u){var l=1&n,c=e.length,f=t.length;if(c!=f&&!(l&&f>c))return!1;var h=u.get(e),p=u.get(t);if(h&&p)return h==t&&p==e;var d=-1,v=!0,g=2&n?new r:void 0;for(u.set(e,t),u.set(t,e);++d<c;){var m=e[d],y=t[d];if(a)var _=l?a(y,m,d,t,e,u):a(m,y,d,e,t,u);if(void 0!==_){if(_)continue;v=!1;break}if(g){if(!i(t,(function(e,t){if(!o(g,t)&&(m===e||s(m,e,n,a,u)))return g.push(t)}))){v=!1;break}}else if(m!==y&&!s(m,y,n,a,u)){v=!1;break}}return u.delete(e),u.delete(t),v}},4758:function(e,t,n){var r=n(2742),i=n(8224),o=n(3949),a=n(440),s=n(8672),u=n(2203),l=r?r.prototype:void 0,c=l?l.valueOf:void 0;e.exports=function(e,t,n,r,l,f,h){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!f(new i(e),new i(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return o(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var p=s;case"[object Set]":var d=1&r;if(p||(p=u),e.size!=t.size&&!d)return!1;var v=h.get(e);if(v)return v==t;r|=2,h.set(e,t);var g=a(p(e),p(t),r,l,f,h);return h.delete(e),g;case"[object Symbol]":if(c)return c.call(e)==c.call(t)}return!1}},371:function(e,t,n){var r=n(9045),i=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,o,a,s){var u=1&n,l=r(e),c=l.length;if(c!=r(t).length&&!u)return!1;for(var f=c;f--;){var h=l[f];if(!(u?h in t:i.call(t,h)))return!1}var p=s.get(e),d=s.get(t);if(p&&d)return p==t&&d==e;var v=!0;s.set(e,t),s.set(t,e);for(var g=u;++f<c;){var m=e[h=l[f]],y=t[h];if(o)var _=u?o(y,m,h,t,e,s):o(m,y,h,e,t,s);if(!(void 0===_?m===y||a(m,y,n,o,s):_)){v=!1;break}g||(g="constructor"==h)}if(v&&!g){var b=e.constructor,x=t.constructor;b==x||!("constructor"in e)||!("constructor"in t)||"function"==typeof b&&b instanceof b&&"function"==typeof x&&x instanceof x||(v=!1)}return s.delete(e),s.delete(t),v}},1521:function(e,t,n){var r=n(5116).default,i="object"==(void 0===n.g?"undefined":r(n.g))&&n.g&&n.g.Object===Object&&n.g;e.exports=i},9045:function(e,t,n){var r=n(571),i=n(9893),o=n(5330);e.exports=function(e){return r(e,o,i)}},481:function(e,t,n){var r=n(571),i=n(6827),o=n(7263);e.exports=function(e){return r(e,o,i)}},3586:function(e,t,n){var r=n(8668);e.exports=function(e,t){var n=e.__data__;return r(t)?n["string"==typeof t?"string":"hash"]:n.map}},8978:function(e,t,n){var r=n(8406),i=n(3551);e.exports=function(e,t){var n=i(e,t);return r(n)?n:void 0}},9315:function(e,t,n){var r=n(8369)(Object.getPrototypeOf,Object);e.exports=r},3315:function(e,t,n){var r=n(2742),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=r?r.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),n=e[s];try{e[s]=void 0;var r=!0}catch(e){}var i=a.call(e);return r&&(t?e[s]=n:delete e[s]),i}},9893:function(e,t,n){var r=n(3775),i=n(3483),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(e){return null==e?[]:(e=Object(e),r(a(e),(function(t){return o.call(e,t)})))}:i;e.exports=s},6827:function(e,t,n){var r=n(446),i=n(9315),o=n(9893),a=n(3483),s=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)r(t,o(e)),e=i(e);return t}:a;e.exports=s},4656:function(e,t,n){var r=n(5655),i=n(4902),o=n(2313),a=n(7858),s=n(2748),u=n(460),l=n(4590),c="[object Map]",f="[object Promise]",h="[object Set]",p="[object WeakMap]",d="[object DataView]",v=l(r),g=l(i),m=l(o),y=l(a),_=l(s),b=u;(r&&b(new r(new ArrayBuffer(1)))!=d||i&&b(new i)!=c||o&&b(o.resolve())!=f||a&&b(new a)!=h||s&&b(new s)!=p)&&(b=function(e){var t=u(e),n="[object Object]"==t?e.constructor:void 0,r=n?l(n):"";if(r)switch(r){case v:return d;case g:return c;case m:return f;case y:return h;case _:return p}return t}),e.exports=b},3551:function(e){e.exports=function(e,t){return null==e?void 0:e[t]}},3104:function(e){var t=RegExp("[\\u200d\\ud800-\\udfff\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\ufe0e\\ufe0f]");e.exports=function(e){return t.test(e)}},1855:function(e){var t=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;e.exports=function(e){return t.test(e)}},6387:function(e,t,n){var r=n(5755);e.exports=function(){this.__data__=r?r(null):{},this.size=0}},3850:function(e){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},9354:function(e,t,n){var r=n(5755),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(r){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return i.call(t,e)?t[e]:void 0}},9254:function(e,t,n){var r=n(5755),i=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return r?void 0!==t[e]:i.call(t,e)}},2137:function(e,t,n){var r=n(5755);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=r&&void 0===t?"__lodash_hash_undefined__":t,this}},8502:function(e){var t=Object.prototype.hasOwnProperty;e.exports=function(e){var n=e.length,r=new e.constructor(n);return n&&"string"==typeof e[0]&&t.call(e,"index")&&(r.index=e.index,r.input=e.input),r}},3502:function(e,t,n){var r=n(8355),i=n(5579),o=n(583),a=n(5256),s=n(9989);e.exports=function(e,t,n){var u=e.constructor;switch(t){case"[object ArrayBuffer]":return r(e);case"[object Boolean]":case"[object Date]":return new u(+e);case"[object DataView]":return i(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return s(e,n);case"[object Map]":case"[object Set]":return new u;case"[object Number]":case"[object String]":return new u(e);case"[object RegExp]":return o(e);case"[object Symbol]":return a(e)}}},5662:function(e,t,n){var r=n(8306),i=n(9315),o=n(3847);e.exports=function(e){return"function"!=typeof e.constructor||o(e)?{}:r(i(e))}},3492:function(e,t,n){var r=n(5116).default,i=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var n=r(e);return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&i.test(e))&&e>-1&&e%1==0&&e<t}},1805:function(e,t,n){var r=n(5116).default,i=n(3949),o=n(1594),a=n(3492),s=n(8137);e.exports=function(e,t,n){if(!s(n))return!1;var u=r(t);return!!("number"==u?o(n)&&a(t,n.length):"string"==u&&t in n)&&i(n[t],e)}},8145:function(e,t,n){var r=n(5116).default,i=n(7276),o=n(4906),a=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,s=/^\w*$/;e.exports=function(e,t){if(i(e))return!1;var n=r(e);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=e&&!o(e))||(s.test(e)||!a.test(e)||null!=t&&e in Object(t))}},8668:function(e,t,n){var r=n(5116).default;e.exports=function(e){var t=r(e);return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},6599:function(e,t,n){var r,i=n(7465),o=(r=/[^.]+$/.exec(i&&i.keys&&i.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!o&&o in e}},3847:function(e){var t=Object.prototype;e.exports=function(e){var n=e&&e.constructor;return e===("function"==typeof n&&n.prototype||t)}},1628:function(e){e.exports=function(){this.__data__=[],this.size=0}},3789:function(e,t,n){var r=n(2839),i=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=r(t,e);return!(n<0)&&(n==t.length-1?t.pop():i.call(t,n,1),--this.size,!0)}},2129:function(e,t,n){var r=n(2839);e.exports=function(e){var t=this.__data__,n=r(t,e);return n<0?void 0:t[n][1]}},8289:function(e,t,n){var r=n(2839);e.exports=function(e){return r(this.__data__,e)>-1}},8613:function(e,t,n){var r=n(2839);e.exports=function(e,t){var n=this.__data__,i=r(n,e);return i<0?(++this.size,n.push([e,t])):n[i][1]=t,this}},6866:function(e,t,n){var r=n(8047),i=n(9708),o=n(4902);e.exports=function(){this.size=0,this.__data__={hash:new r,map:new(o||i),string:new r}}},4798:function(e,t,n){var r=n(3586);e.exports=function(e){var t=r(this,e).delete(e);return this.size-=t?1:0,t}},7915:function(e,t,n){var r=n(3586);e.exports=function(e){return r(this,e).get(e)}},3834:function(e,t,n){var r=n(3586);e.exports=function(e){return r(this,e).has(e)}},2992:function(e,t,n){var r=n(3586);e.exports=function(e,t){var n=r(this,e),i=n.size;return n.set(e,t),this.size+=n.size==i?0:1,this}},8672:function(e){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,r){n[++t]=[r,e]})),n}},3410:function(e,t,n){var r=n(6663);e.exports=function(e){var t=r(e,(function(e){return 500===n.size&&n.clear(),e})),n=t.cache;return t}},5755:function(e,t,n){var r=n(8978)(Object,"create");e.exports=r},8591:function(e,t,n){var r=n(8369)(Object.keys,Object);e.exports=r},6898:function(e){e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},1497:function(e,t,n){e=n.nmd(e);var r=n(5116).default,i=n(1521),o="object"==r(t)&&t&&!t.nodeType&&t,a=o&&"object"==r(e)&&e&&!e.nodeType&&e,s=a&&a.exports===o&&i.process,u=function(){try{var e=a&&a.require&&a.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=u},9402:function(e){var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},8369:function(e){e.exports=function(e,t){return function(n){return e(t(n))}}},5874:function(e,t,n){var r=n(6316),i=Math.max;e.exports=function(e,t,n){return t=i(void 0===t?e.length-1:t,0),function(){for(var o=arguments,a=-1,s=i(o.length-t,0),u=Array(s);++a<s;)u[a]=o[t+a];a=-1;for(var l=Array(t+1);++a<t;)l[a]=o[a];return l[t]=n(u),r(e,this,l)}}},2385:function(e,t,n){var r=n(5116).default,i=n(1521),o="object"==("undefined"==typeof self?"undefined":r(self))&&self&&self.Object===Object&&self,a=i||o||Function("return this")();e.exports=a},3219:function(e){e.exports=function(e,t){if(("constructor"!==t||"function"!=typeof e[t])&&"__proto__"!=t)return e[t]}},353:function(e){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},3347:function(e){e.exports=function(e){return this.__data__.has(e)}},2203:function(e){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}},5117:function(e,t,n){var r=n(5849),i=n(3616)(r);e.exports=i},3616:function(e){var t=Date.now;e.exports=function(e){var n=0,r=0;return function(){var i=t(),o=16-(i-r);if(r=i,o>0){if(++n>=800)return arguments[0]}else n=0;return e.apply(void 0,arguments)}}},2018:function(e,t,n){var r=n(9708);e.exports=function(){this.__data__=new r,this.size=0}},6211:function(e){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},4592:function(e){e.exports=function(e){return this.__data__.get(e)}},9253:function(e){e.exports=function(e){return this.__data__.has(e)}},6539:function(e,t,n){var r=n(9708),i=n(4902),o=n(6778);e.exports=function(e,t){var n=this.__data__;if(n instanceof r){var a=n.__data__;if(!i||a.length<199)return a.push([e,t]),this.size=++n.size,this;n=this.__data__=new o(a)}return n.set(e,t),this.size=n.size,this}},8098:function(e){e.exports=function(e,t,n){for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return-1}},3655:function(e,t,n){var r=n(9370),i=n(3104),o=n(1347);e.exports=function(e){return i(e)?o(e):r(e)}},686:function(e,t,n){var r=n(3410),i=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,o=/\\(\\)?/g,a=r((function(e){var t=[];return 46===e.charCodeAt(0)&&t.push(""),e.replace(i,(function(e,n,r,i){t.push(r?i.replace(o,"$1"):n||e)})),t}));e.exports=a},776:function(e,t,n){var r=n(4906);e.exports=function(e){if("string"==typeof e||r(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}},4590:function(e){var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},7029:function(e){var t=/\s/;e.exports=function(e){for(var n=e.length;n--&&t.test(e.charAt(n)););return n}},1347:function(e){var t="\\ud800-\\udfff",n="["+t+"]",r="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]",i="\\ud83c[\\udffb-\\udfff]",o="[^"+t+"]",a="(?:\\ud83c[\\udde6-\\uddff]){2}",s="[\\ud800-\\udbff][\\udc00-\\udfff]",u="(?:"+r+"|"+i+")"+"?",l="[\\ufe0e\\ufe0f]?",c=l+u+("(?:\\u200d(?:"+[o,a,s].join("|")+")"+l+u+")*"),f="(?:"+[o+r+"?",r,a,s,n].join("|")+")",h=RegExp(i+"(?="+i+")|"+f+c,"g");e.exports=function(e){return e.match(h)||[]}},1905:function(e){var t="\\ud800-\\udfff",n="\\u2700-\\u27bf",r="a-z\\xdf-\\xf6\\xf8-\\xff",i="A-Z\\xc0-\\xd6\\xd8-\\xde",o="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",a="["+o+"]",s="\\d+",u="["+n+"]",l="["+r+"]",c="[^"+t+o+s+n+r+i+"]",f="(?:\\ud83c[\\udde6-\\uddff]){2}",h="[\\ud800-\\udbff][\\udc00-\\udfff]",p="["+i+"]",d="(?:"+l+"|"+c+")",v="(?:"+p+"|"+c+")",g="(?:['’](?:d|ll|m|re|s|t|ve))?",m="(?:['’](?:D|LL|M|RE|S|T|VE))?",y="(?:[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]|\\ud83c[\\udffb-\\udfff])?",_="[\\ufe0e\\ufe0f]?",b=_+y+("(?:\\u200d(?:"+["[^"+t+"]",f,h].join("|")+")"+_+y+")*"),x="(?:"+[u,f,h].join("|")+")"+b,E=RegExp([p+"?"+l+"+"+g+"(?="+[a,p,"$"].join("|")+")",v+"+"+m+"(?="+[a,p+d,"$"].join("|")+")",p+"?"+d+"+"+g,p+"+"+m,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",s,x].join("|"),"g");e.exports=function(e){return e.match(E)||[]}},9726:function(e,t,n){var r=n(7751),i=n(1437)((function(e,t,n){return t=t.toLowerCase(),e+(n?r(t):t)}));e.exports=i},7751:function(e,t,n){var r=n(5944),i=n(920);e.exports=function(e){return i(r(e).toLowerCase())}},263:function(e,t,n){var r=n(3691),i=n(4956);e.exports=function(e,t,n){return void 0===n&&(n=t,t=void 0),void 0!==n&&(n=(n=i(n))==n?n:0),void 0!==t&&(t=(t=i(t))==t?t:0),r(i(e),t,n)}},2281:function(e,t,n){var r=n(3496);e.exports=function(e){return r(e,5)}},7004:function(e){e.exports=function(e){return function(){return e}}},8199:function(e,t,n){var r=n(8137),i=n(4970),o=n(4956),a=Math.max,s=Math.min;e.exports=function(e,t,n){var u,l,c,f,h,p,d=0,v=!1,g=!1,m=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function y(t){var n=u,r=l;return u=l=void 0,d=t,f=e.apply(r,n)}function _(e){return d=e,h=setTimeout(x,t),v?y(e):f}function b(e){var n=e-p;return void 0===p||n>=t||n<0||g&&e-d>=c}function x(){var e=i();if(b(e))return E(e);h=setTimeout(x,function(e){var n=t-(e-p);return g?s(n,c-(e-d)):n}(e))}function E(e){return h=void 0,m&&u?y(e):(u=l=void 0,f)}function T(){var e=i(),n=b(e);if(u=arguments,l=this,p=e,n){if(void 0===h)return _(p);if(g)return clearTimeout(h),h=setTimeout(x,t),y(p)}return void 0===h&&(h=setTimeout(x,t)),f}return t=o(t)||0,r(n)&&(v=!!n.leading,c=(g="maxWait"in n)?a(o(n.maxWait)||0,t):c,m="trailing"in n?!!n.trailing:m),T.cancel=function(){void 0!==h&&clearTimeout(h),d=0,u=p=l=h=void 0},T.flush=function(){return void 0===h?f:E(i())},T}},7608:function(e,t,n){var r=n(9218),i=n(5944),o=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,a=RegExp("[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff]","g");e.exports=function(e){return(e=i(e))&&e.replace(o,r).replace(a,"")}},3949:function(e){e.exports=function(e,t){return e===t||e!=e&&t!=t}},6890:function(e,t,n){var r=n(4190);e.exports=function(e,t,n){var i=null==e?void 0:r(e,t);return void 0===i?n:i}},1434:function(e){e.exports=function(e){return e}},738:function(e,t,n){var r=n(1766),i=n(4518),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,u=r(function(){return arguments}())?r:function(e){return i(e)&&a.call(e,"callee")&&!s.call(e,"callee")};e.exports=u},7276:function(e){var t=Array.isArray;e.exports=t},1594:function(e,t,n){var r=n(2530),i=n(5318);e.exports=function(e){return null!=e&&i(e.length)&&!r(e)}},4658:function(e,t,n){var r=n(1594),i=n(4518);e.exports=function(e){return i(e)&&r(e)}},4345:function(e,t,n){var r=n(460),i=n(4518);e.exports=function(e){return!0===e||!1===e||i(e)&&"[object Boolean]"==r(e)}},9758:function(e,t,n){e=n.nmd(e);var r=n(5116).default,i=n(2385),o=n(3781),a="object"==r(t)&&t&&!t.nodeType&&t,s=a&&"object"==r(e)&&e&&!e.nodeType&&e,u=s&&s.exports===a?i.Buffer:void 0,l=(u?u.isBuffer:void 0)||o;e.exports=l},28:function(e,t,n){var r=n(4745);e.exports=function(e,t){return r(e,t)}},2530:function(e,t,n){var r=n(460),i=n(8137);e.exports=function(e){if(!i(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},5318:function(e){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},870:function(e,t,n){var r=n(5610),i=n(7686),o=n(1497),a=o&&o.isMap,s=a?i(a):r;e.exports=s},3426:function(e){e.exports=function(e){return null==e}},3759:function(e,t,n){var r=n(460),i=n(4518);e.exports=function(e){return"number"==typeof e||i(e)&&"[object Number]"==r(e)}},8137:function(e,t,n){var r=n(5116).default;e.exports=function(e){var t=r(e);return null!=e&&("object"==t||"function"==t)}},4518:function(e,t,n){var r=n(5116).default;e.exports=function(e){return null!=e&&"object"==r(e)}},1091:function(e,t,n){var r=n(460),i=n(9315),o=n(4518),a=Function.prototype,s=Object.prototype,u=a.toString,l=s.hasOwnProperty,c=u.call(Object);e.exports=function(e){if(!o(e)||"[object Object]"!=r(e))return!1;var t=i(e);if(null===t)return!0;var n=l.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&u.call(n)==c}},4353:function(e,t,n){var r=n(1994),i=n(7686),o=n(1497),a=o&&o.isSet,s=a?i(a):r;e.exports=s},2293:function(e,t,n){var r=n(460),i=n(7276),o=n(4518);e.exports=function(e){return"string"==typeof e||!i(e)&&o(e)&&"[object String]"==r(e)}},4906:function(e,t,n){var r=n(5116).default,i=n(460),o=n(4518);e.exports=function(e){return"symbol"==r(e)||o(e)&&"[object Symbol]"==i(e)}},3749:function(e,t,n){var r=n(3720),i=n(7686),o=n(1497),a=o&&o.isTypedArray,s=a?i(a):r;e.exports=s},8605:function(e){e.exports=function(e){return void 0===e}},5330:function(e,t,n){var r=n(3118),i=n(1823),o=n(1594);e.exports=function(e){return o(e)?r(e):i(e)}},7263:function(e,t,n){var r=n(3118),i=n(5975),o=n(1594);e.exports=function(e){return o(e)?r(e,!0):i(e)}},6663:function(e,t,n){var r=n(6778);function i(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function n(){var r=arguments,i=t?t.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=e.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(i.Cache||r),n}i.Cache=r,e.exports=i},3447:function(e,t,n){var r=n(9820),i=n(4364)((function(e,t,n){r(e,t,n)}));e.exports=i},6281:function(e,t,n){var r=n(9820),i=n(4364)((function(e,t,n,i){r(e,t,n,i)}));e.exports=i},5093:function(e){e.exports=function(){}},4970:function(e,t,n){var r=n(2385);e.exports=function(){return r.Date.now()}},2630:function(e,t,n){var r=n(8165)(n(1475));e.exports=r},1475:function(e,t,n){var r=n(6239);e.exports=function(e,t){return e&&e.length&&t&&t.length?r(e,t):e}},3483:function(e){e.exports=function(){return[]}},3781:function(e){e.exports=function(){return!1}},5966:function(e,t,n){var r=n(8199),i=n(8137);e.exports=function(e,t,n){var o=!0,a=!0;if("function"!=typeof e)throw new TypeError("Expected a function");return i(n)&&(o="leading"in n?!!n.leading:o,a="trailing"in n?!!n.trailing:a),r(e,t,{leading:o,maxWait:t,trailing:a})}},4956:function(e,t,n){var r=n(9109),i=n(8137),o=n(4906),a=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,u=/^0o[0-7]+$/i,l=parseInt;e.exports=function(e){if("number"==typeof e)return e;if(o(e))return NaN;if(i(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=i(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=r(e);var n=s.test(e);return n||u.test(e)?l(e.slice(2),n?2:8):a.test(e)?NaN:+e}},6532:function(e,t,n){var r=n(2904),i=n(7263);e.exports=function(e){return r(e,i(e))}},5944:function(e,t,n){var r=n(9863);e.exports=function(e){return null==e?"":r(e)}},651:function(e,t,n){var r=n(938);e.exports=function(e){return e&&e.length?r(e):[]}},7145:function(e,t,n){var r=n(5944),i=0;e.exports=function(e){var t=++i;return r(e)+t}},920:function(e,t,n){var r=n(2665)("toUpperCase");e.exports=r},2294:function(e,t,n){var r=n(6321),i=n(1855),o=n(5944),a=n(1905);e.exports=function(e,t,n){return e=o(e),void 0===(t=n?void 0:t)?i(e)?a(e):r(e):e.match(t)||[]}},8777:function(e,t,n){"use strict";e.exports=i;var r=n(6460);function i(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var o=4294967296,a=1/o,s="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");function u(e){return e.type===i.Bytes?e.readVarint()+e.pos:e.pos+1}function l(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function c(e,t,n){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function f(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function h(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function p(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function d(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function v(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function g(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function m(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function y(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function _(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function b(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function x(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function E(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}i.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,e(i,t,this),this.pos===o&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=b(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=E(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=b(this.buf,this.pos)+b(this.buf,this.pos+4)*o;return this.pos+=8,e},readSFixed64:function(){var e=b(this.buf,this.pos)+E(this.buf,this.pos+4)*o;return this.pos+=8,e},readFloat:function(){var e=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,r=this.buf;return t=127&(n=r[this.pos++]),n<128?t:(t|=(127&(n=r[this.pos++]))<<7,n<128?t:(t|=(127&(n=r[this.pos++]))<<14,n<128?t:(t|=(127&(n=r[this.pos++]))<<21,n<128?t:function(e,t,n){var r,i,o=n.buf;if(i=o[n.pos++],r=(112&i)>>4,i<128)return l(e,r,t);if(i=o[n.pos++],r|=(127&i)<<3,i<128)return l(e,r,t);if(i=o[n.pos++],r|=(127&i)<<10,i<128)return l(e,r,t);if(i=o[n.pos++],r|=(127&i)<<17,i<128)return l(e,r,t);if(i=o[n.pos++],r|=(127&i)<<24,i<128)return l(e,r,t);if(i=o[n.pos++],r|=(1&i)<<31,i<128)return l(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&s?function(e,t,n){return s.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){var r="",i=t;for(;i<n;){var o,a,s,u=e[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>n)break;1===c?u<128&&(l=u):2===c?128==(192&(o=e[i+1]))&&(l=(31&u)<<6|63&o)<=127&&(l=null):3===c?(o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&((l=(15&u)<<12|(63&o)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=c}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==i.Bytes)return e.push(this.readVarint(t));var n=u(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==i.Bytes)return e.push(this.readSVarint());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==i.Bytes)return e.push(this.readBoolean());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==i.Bytes)return e.push(this.readFloat());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==i.Bytes)return e.push(this.readDouble());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==i.Bytes)return e.push(this.readFixed32());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==i.Bytes)return e.push(this.readSFixed32());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==i.Bytes)return e.push(this.readFixed64());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==i.Bytes)return e.push(this.readSFixed64());var t=u(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===i.Varint)for(;this.buf[this.pos++]>127;);else if(t===i.Bytes)this.pos=this.readVarint()+this.pos;else if(t===i.Fixed32)this.pos+=4;else{if(t!==i.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),x(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),x(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),x(this.buf,-1&e,this.pos),x(this.buf,Math.floor(e*a),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),x(this.buf,-1&e,this.pos),x(this.buf,Math.floor(e*a),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,r;e>=0?(n=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,r=r+1|0));if(e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos]=127&e}(n,0,t),function(e,t){var n=(7&e)<<4;if(t.buf[t.pos++]|=n|((e>>>=3)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;if(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),!e)return;t.buf[t.pos++]=127&e}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var r,i,o=0;o<t.length;o++){if((r=t.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):i=r;continue}if(r<56320){e[n++]=239,e[n++]=191,e[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(e[n++]=239,e[n++]=191,e[n++]=189,i=null);r<128?e[n++]=r:(r<2048?e[n++]=r>>6|192:(r<65536?e[n++]=r>>12|224:(e[n++]=r>>18|240,e[n++]=r>>12&63|128),e[n++]=r>>6&63|128),e[n++]=63&r|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&c(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),r.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),r.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var r=this.pos-n;r>=128&&c(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,n){this.writeTag(e,i.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,f,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,h,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,v,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,p,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,d,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,g,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,m,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,y,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,_,t)},writeBytesField:function(e,t){this.writeTag(e,i.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,i.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,i.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,i.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,i.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,i.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,i.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,i.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,i.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,i.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}}},7564:function(e,t,n){var r,i,o,a=n(4693),s=n(8025).default,u=n(1133).default,l=n(5116).default;o=function(){"use strict";function e(e,t){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var t=function(e,t){this.next=null,this.key=e,this.data=t,this.left=null,this.right=null};function n(e,t){return e>t?1:e<t?-1:0}function r(e,n,r){for(var i=new t(null,null),o=i,a=i;;){var s=r(e,n.key);if(s<0){if(null===n.left)break;if(r(e,n.left.key)<0){var u=n.left;if(n.left=u.right,u.right=n,null===(n=u).left)break}a.left=n,a=n,n=n.left}else{if(!(s>0))break;if(null===n.right)break;if(r(e,n.right.key)>0&&(u=n.right,n.right=u.left,u.left=n,null===(n=u).right))break;o.right=n,o=n,n=n.right}}return o.right=n.left,a.left=n.right,n.left=i.right,n.right=i.left,n}function i(e,n,i,o){var a=new t(e,n);if(null===i)return a.left=a.right=null,a;var s=o(e,(i=r(e,i,o)).key);return s<0?(a.left=i.left,a.right=i,i.left=null):s>=0&&(a.right=i.right,a.left=i,i.right=null),a}function o(e,t,n){var i=null,o=null;if(t){var a=n((t=r(e,t,n)).key,e);0===a?(i=t.left,o=t.right):a<0?(o=t.right,t.right=null,i=t):(i=t.left,t.left=null,o=t)}return{left:i,right:o}}function l(e,t,n,r,i){if(e){r(t+(n?"└── ":"├── ")+i(e)+"\n");var o=t+(n?"    ":"│   ");e.left&&l(e.left,o,!1,r,i),e.right&&l(e.right,o,!0,r,i)}}var c=function(){function a(e){void 0===e&&(e=n),this._root=null,this._size=0,this._comparator=e}return a.prototype.insert=function(e,t){return this._size++,this._root=i(e,t,this._root,this._comparator)},a.prototype.add=function(e,n){var i=new t(e,n);null===this._root&&(i.left=i.right=null,this._size++,this._root=i);var o=this._comparator,a=r(e,this._root,o),s=o(e,a.key);return 0===s?this._root=a:(s<0?(i.left=a.left,i.right=a,a.left=null):s>0&&(i.right=a.right,i.left=a,a.right=null),this._size++,this._root=i),this._root},a.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},a.prototype._remove=function(e,t,n){var i;return null===t?null:0===n(e,(t=r(e,t,n)).key)?(null===t.left?i=t.right:(i=r(e,t.left,n)).right=t.right,this._size--,i):t},a.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=r(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},a.prototype.findStatic=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(0===r)return t;t=r<0?t.left:t.right}return null},a.prototype.find=function(e){return this._root&&(this._root=r(e,this._root,this._comparator),0!==this._comparator(e,this._root.key))?null:this._root},a.prototype.contains=function(e){for(var t=this._root,n=this._comparator;t;){var r=n(e,t.key);if(0===r)return!0;t=r<0?t.left:t.right}return!1},a.prototype.forEach=function(e,t){for(var n=this._root,r=[],i=!1;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),e.call(t,n),n=n.right):i=!0;return this},a.prototype.range=function(e,t,n,r){for(var i=[],o=this._comparator,a=this._root;0!==i.length||a;)if(a)i.push(a),a=a.left;else{if(o((a=i.pop()).key,t)>0)break;if(o(a.key,e)>=0&&n.call(r,a))return this;a=a.right}return this},a.prototype.keys=function(){var e=[];return this.forEach((function(t){var n=t.key;return e.push(n)})),e},a.prototype.values=function(){var e=[];return this.forEach((function(t){var n=t.data;return e.push(n)})),e},a.prototype.min=function(){return this._root?this.minNode(this._root).key:null},a.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},a.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},a.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},a.prototype.at=function(e){for(var t=this._root,n=!1,r=0,i=[];!n;)if(t)i.push(t),t=t.left;else if(i.length>0){if(t=i.pop(),r===e)return t;r++,t=t.right}else n=!0;return null},a.prototype.next=function(e){var t=this._root,n=null;if(e.right){for(n=e.right;n.left;)n=n.left;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(0===i)break;i<0?(n=t,t=t.left):t=t.right}return n},a.prototype.prev=function(e){var t=this._root,n=null;if(null!==e.left){for(n=e.left;n.right;)n=n.right;return n}for(var r=this._comparator;t;){var i=r(e.key,t.key);if(0===i)break;i<0?t=t.left:(n=t,t=t.right)}return n},a.prototype.clear=function(){return this._root=null,this._size=0,this},a.prototype.toList=function(){return function(e){for(var n=e,r=[],i=!1,o=new t(null,null),a=o;!i;)n?(r.push(n),n=n.left):r.length>0?n=(n=a=a.next=r.pop()).right:i=!0;return a.next=null,o.next}(this._root)},a.prototype.load=function(e,n,r){void 0===n&&(n=[]),void 0===r&&(r=!1);var i=e.length,o=this._comparator;if(r&&p(e,n,0,i-1,o),null===this._root)this._root=f(e,n,0,i),this._size=i;else{var a=function(e,n,r){for(var i=new t(null,null),o=i,a=e,s=n;null!==a&&null!==s;)r(a.key,s.key)<0?(o.next=a,a=a.next):(o.next=s,s=s.next),o=o.next;return null!==a?o.next=a:null!==s&&(o.next=s),i.next}(this.toList(),function(e,n){for(var r=new t(null,null),i=r,o=0;o<e.length;o++)i=i.next=new t(e[o],n[o]);return i.next=null,r.next}(e,n),o);i=this._size+i,this._root=h({head:a},0,i)}return this},a.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(a.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),a.prototype.toString=function(e){void 0===e&&(e=function(e){return String(e.key)});var t=[];return l(this._root,"",!0,(function(e){return t.push(e)}),e),t.join("")},a.prototype.update=function(e,t,n){var a=this._comparator,s=o(e,this._root,a),u=s.left,l=s.right;a(e,t)<0?l=i(t,n,l,a):u=i(t,n,u,a),this._root=function(e,t,n){return null===t?e:(null===e||((t=r(e.key,t,n)).left=e),t)}(u,l,a)},a.prototype.split=function(e){return o(e,this._root,this._comparator)},a.prototype[Symbol.iterator]=function(){var t,n,r;return e(this,(function(e){switch(e.label){case 0:t=this._root,n=[],r=!1,e.label=1;case 1:return r?[3,6]:null===t?[3,2]:(n.push(t),t=t.left,[3,5]);case 2:return 0===n.length?[3,4]:[4,t=n.pop()];case 3:return e.sent(),t=t.right,[3,5];case 4:r=!0,e.label=5;case 5:return[3,1];case 6:return[2]}}))},a}();function f(e,n,r,i){var o=i-r;if(o>0){var a=r+Math.floor(o/2),s=e[a],u=n[a],l=new t(s,u);return l.left=f(e,n,r,a),l.right=f(e,n,a+1,i),l}return null}function h(e,t,n){var r=n-t;if(r>0){var i=t+Math.floor(r/2),o=h(e,t,i),a=e.head;return a.left=o,e.head=e.head.next,a.right=h(e,i+1,n),a}return null}function p(e,t,n,r,i){if(!(n>=r)){for(var o=e[n+r>>1],a=n-1,s=r+1;;){do{a++}while(i(e[a],o)<0);do{s--}while(i(e[s],o)>0);if(a>=s)break;var u=e[a];e[a]=e[s],e[s]=u,u=t[a],t[a]=t[s],t[s]=u}p(e,t,n,s,i),p(e,t,s+1,r,i)}}var d=function(e,t){return e.ll.x<=t.x&&t.x<=e.ur.x&&e.ll.y<=t.y&&t.y<=e.ur.y},v=function(e,t){if(t.ur.x<e.ll.x||e.ur.x<t.ll.x||t.ur.y<e.ll.y||e.ur.y<t.ll.y)return null;var n=e.ll.x<t.ll.x?t.ll.x:e.ll.x,r=e.ur.x<t.ur.x?e.ur.x:t.ur.x;return{ll:{x:n,y:e.ll.y<t.ll.y?t.ll.y:e.ll.y},ur:{x:r,y:e.ur.y<t.ur.y?e.ur.y:t.ur.y}}},g=Number.EPSILON;void 0===g&&(g=Math.pow(2,-52));var m=g*g,y=function(e,t){if(-g<e&&e<g&&-g<t&&t<g)return 0;var n=e-t;return n*n<m*e*t?0:e<t?-1:1},_=function(){function e(){s(this,e),this.reset()}return u(e,[{key:"reset",value:function(){this.xRounder=new b,this.yRounder=new b}},{key:"round",value:function(e,t){return{x:this.xRounder.round(e),y:this.yRounder.round(t)}}}]),e}(),b=function(){function e(){s(this,e),this.tree=new c,this.round(0)}return u(e,[{key:"round",value:function(e){var t=this.tree.add(e),n=this.tree.prev(t);if(null!==n&&0===y(t.key,n.key))return this.tree.remove(e),n.key;var r=this.tree.next(t);return null!==r&&0===y(t.key,r.key)?(this.tree.remove(e),r.key):e}}]),e}(),x=new _,E=134217729;function T(e,t,n,r,i){var o,a,s,u,l=t[0],c=r[0],f=0,h=0;c>l==c>-l?(o=l,l=t[++f]):(o=c,c=r[++h]);var p=0;if(f<e&&h<n)for(c>l==c>-l?(s=o-((a=l+o)-l),l=t[++f]):(s=o-((a=c+o)-c),c=r[++h]),o=a,0!==s&&(i[p++]=s);f<e&&h<n;)c>l==c>-l?(s=o-((a=o+l)-(u=a-o))+(l-u),l=t[++f]):(s=o-((a=o+c)-(u=a-o))+(c-u),c=r[++h]),o=a,0!==s&&(i[p++]=s);for(;f<e;)s=o-((a=o+l)-(u=a-o))+(l-u),l=t[++f],o=a,0!==s&&(i[p++]=s);for(;h<n;)s=o-((a=o+c)-(u=a-o))+(c-u),c=r[++h],o=a,0!==s&&(i[p++]=s);return 0===o&&0!==p||(i[p++]=o),p}function A(e){return new Float64Array(e)}var S=A(4),C=A(8),R=A(12),w=A(16),M=A(4);function k(e,t,n,r,i,o){var a=(t-o)*(n-i),s=(e-i)*(r-o),u=a-s,l=Math.abs(a+s);return Math.abs(u)>=33306690738754716e-32*l?u:-function(e,t,n,r,i,o,a){var s,u,l,c,f,h,p,d,v,g,m,y,_,b,x,A,k,L,O=e-i,I=n-i,P=t-o,N=r-o;f=(x=(d=O-(p=(h=E*O)-(h-O)))*(g=N-(v=(h=E*N)-(h-N)))-((b=O*N)-p*v-d*v-p*g))-(m=x-(k=(d=P-(p=(h=E*P)-(h-P)))*(g=I-(v=(h=E*I)-(h-I)))-((A=P*I)-p*v-d*v-p*g))),S[0]=x-(m+f)+(f-k),f=(_=b-((y=b+m)-(f=y-b))+(m-f))-(m=_-A),S[1]=_-(m+f)+(f-A),f=(L=y+m)-y,S[2]=y-(L-f)+(m-f),S[3]=L;var B=function(e,t){for(var n=t[0],r=1;r<e;r++)n+=t[r];return n}(4,S),D=22204460492503146e-32*a;if(B>=D||-B>=D)return B;if(s=e-(O+(f=e-O))+(f-i),l=n-(I+(f=n-I))+(f-i),u=t-(P+(f=t-P))+(f-o),c=r-(N+(f=r-N))+(f-o),0===s&&0===u&&0===l&&0===c)return B;if(D=11093356479670487e-47*a+33306690738754706e-32*Math.abs(B),(B+=O*c+N*s-(P*l+I*u))>=D||-B>=D)return B;f=(x=(d=s-(p=(h=E*s)-(h-s)))*(g=N-(v=(h=E*N)-(h-N)))-((b=s*N)-p*v-d*v-p*g))-(m=x-(k=(d=u-(p=(h=E*u)-(h-u)))*(g=I-(v=(h=E*I)-(h-I)))-((A=u*I)-p*v-d*v-p*g))),M[0]=x-(m+f)+(f-k),f=(_=b-((y=b+m)-(f=y-b))+(m-f))-(m=_-A),M[1]=_-(m+f)+(f-A),f=(L=y+m)-y,M[2]=y-(L-f)+(m-f),M[3]=L;var U=T(4,S,4,M,C);f=(x=(d=O-(p=(h=E*O)-(h-O)))*(g=c-(v=(h=E*c)-(h-c)))-((b=O*c)-p*v-d*v-p*g))-(m=x-(k=(d=P-(p=(h=E*P)-(h-P)))*(g=l-(v=(h=E*l)-(h-l)))-((A=P*l)-p*v-d*v-p*g))),M[0]=x-(m+f)+(f-k),f=(_=b-((y=b+m)-(f=y-b))+(m-f))-(m=_-A),M[1]=_-(m+f)+(f-A),f=(L=y+m)-y,M[2]=y-(L-f)+(m-f),M[3]=L;var F=T(U,C,4,M,R);f=(x=(d=s-(p=(h=E*s)-(h-s)))*(g=c-(v=(h=E*c)-(h-c)))-((b=s*c)-p*v-d*v-p*g))-(m=x-(k=(d=u-(p=(h=E*u)-(h-u)))*(g=l-(v=(h=E*l)-(h-l)))-((A=u*l)-p*v-d*v-p*g))),M[0]=x-(m+f)+(f-k),f=(_=b-((y=b+m)-(f=y-b))+(m-f))-(m=_-A),M[1]=_-(m+f)+(f-A),f=(L=y+m)-y,M[2]=y-(L-f)+(m-f),M[3]=L;var z=T(F,R,4,M,w);return w[z-1]}(e,t,n,r,i,o,l)}var L=function(e,t){return e.x*t.y-e.y*t.x},O=function(e,t){return e.x*t.x+e.y*t.y},I=function(e,t,n){var r=k(e.x,e.y,t.x,t.y,n.x,n.y);return r>0?-1:r<0?1:0},P=function(e){return Math.sqrt(O(e,e))},N=function(e,t,n){var r={x:t.x-e.x,y:t.y-e.y},i={x:n.x-e.x,y:n.y-e.y};return O(i,r)/P(i)/P(r)},B=function(e,t,n){return 0===t.y?null:{x:e.x+t.x/t.y*(n-e.y),y:n}},D=function(e,t,n){return 0===t.x?null:{x:n,y:e.y+t.y/t.x*(n-e.x)}},U=function(){function e(t,n){s(this,e),void 0===t.events?t.events=[this]:t.events.push(this),this.point=t,this.isLeft=n}return u(e,[{key:"link",value:function(e){if(e.point===this.point)throw new Error("Tried to link already linked events");for(var t=e.point.events,n=0,r=t.length;n<r;n++){var i=t[n];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var e=this.point.events.length,t=0;t<e;t++){var n=this.point.events[t];if(void 0===n.segment.consumedBy)for(var r=t+1;r<e;r++){var i=this.point.events[r];void 0===i.consumedBy&&n.otherSE.point.events===i.otherSE.point.events&&n.segment.consume(i.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var e=[],t=0,n=this.point.events.length;t<n;t++){var r=this.point.events[t];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&e.push(r)}return e}},{key:"getLeftmostComparator",value:function(e){var t=this,n=new Map,r=function(r){var i,o,a,s,u,l=r.otherSE;n.set(r,{sine:(i=t.point,o=e.point,a=l.point,s={x:o.x-i.x,y:o.y-i.y},u={x:a.x-i.x,y:a.y-i.y},L(u,s)/P(u)/P(s)),cosine:N(t.point,e.point,l.point)})};return function(e,t){n.has(e)||r(e),n.has(t)||r(t);var i=n.get(e),o=i.sine,a=i.cosine,s=n.get(t),u=s.sine,l=s.cosine;return o>=0&&u>=0?a<l?1:a>l?-1:0:o<0&&u<0?a<l?-1:a>l?1:0:u<o?-1:u>o?1:0}}}],[{key:"compare",value:function(t,n){var r=e.comparePoints(t.point,n.point);return 0!==r?r:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:z.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(e,t){return e.x<t.x?-1:e.x>t.x?1:e.y<t.y?-1:e.y>t.y?1:0}}]),e}(),F=0,z=function(){function e(t,n,r,i){s(this,e),this.id=++F,this.leftSE=t,t.segment=this,t.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=t,this.rings=r,this.windings=i}return u(e,[{key:"replaceRightSE",value:function(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<t?e:t},ur:{x:this.rightSE.point.x,y:e>t?e:t}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}},{key:"comparePoint",value:function(e){if(this.isAnEndpoint(e))return 0;var t=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(t.x===n.x)return e.x===t.x?0:e.x<t.x?1:-1;var i=(e.y-t.y)/r.y,o=t.x+i*r.x;if(e.x===o)return 0;var a=(e.x-t.x)/r.x,s=t.y+a*r.y;return e.y===s?0:e.y<s?-1:1}},{key:"getIntersection",value:function(e){var t=this.bbox(),n=e.bbox(),r=v(t,n);if(null===r)return null;var i=this.leftSE.point,o=this.rightSE.point,a=e.leftSE.point,s=e.rightSE.point,u=d(t,a)&&0===this.comparePoint(a),l=d(n,i)&&0===e.comparePoint(i),c=d(t,s)&&0===this.comparePoint(s),f=d(n,o)&&0===e.comparePoint(o);if(l&&u)return f&&!c?o:!f&&c?s:null;if(l)return c&&i.x===s.x&&i.y===s.y?null:i;if(u)return f&&o.x===a.x&&o.y===a.y?null:a;if(f&&c)return null;if(f)return o;if(c)return s;var h=function(e,t,n,r){if(0===t.x)return D(n,r,e.x);if(0===r.x)return D(e,t,n.x);if(0===t.y)return B(n,r,e.y);if(0===r.y)return B(e,t,n.y);var i=L(t,r);if(0==i)return null;var o={x:n.x-e.x,y:n.y-e.y},a=L(o,t)/i,s=L(o,r)/i;return{x:(e.x+s*t.x+(n.x+a*r.x))/2,y:(e.y+s*t.y+(n.y+a*r.y))/2}}(i,this.vector(),a,e.vector());return null===h?null:d(r,h)?x.round(h.x,h.y):null}},{key:"split",value:function(t){var n=[],r=void 0!==t.events,i=new U(t,!0),o=new U(t,!1),a=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);var s=new e(i,a,this.rings.slice(),this.windings.slice());return U.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),U.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var t=0,n=this.windings.length;t<n;t++)this.windings[t]*=-1}},{key:"consume",value:function(t){for(var n=this,r=t;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var i=e.compare(n,r);if(0!==i){if(i>0){var o=n;n=r,r=o}if(n.prev===r){var a=n;n=r,r=a}for(var s=0,u=r.rings.length;s<u;s++){var l=r.rings[s],c=r.windings[s],f=n.rings.indexOf(l);-1===f?(n.rings.push(l),n.windings.push(c)):n.windings[f]+=c}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};for(var t=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,i=0,o=this.rings.length;i<o;i++){var a=this.rings[i],s=this.windings[i],u=t.indexOf(a);-1===u?(t.push(a),n.push(s)):n[u]+=s}for(var l=[],c=[],f=0,h=t.length;f<h;f++)if(0!==n[f]){var p=t[f],d=p.poly;if(-1===c.indexOf(d))if(p.isExterior)l.push(d);else{-1===c.indexOf(d)&&c.push(d);var v=l.indexOf(p.poly);-1!==v&&l.splice(v,1)}}for(var g=0,m=l.length;g<m;g++){var y=l[g].multiPoly;-1===r.indexOf(y)&&r.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(K.type){case"union":var n=0===e.length,r=0===t.length;this._isInResult=n!==r;break;case"intersection":var i,o;e.length<t.length?(i=e.length,o=t.length):(i=t.length,o=e.length),this._isInResult=o===K.numMultiPolys&&i<o;break;case"xor":var a=Math.abs(e.length-t.length);this._isInResult=a%2==1;break;case"difference":var s=function(e){return 1===e.length&&e[0].isSubject};this._isInResult=s(e)!==s(t);break;default:throw new Error("Unrecognized operation type found ".concat(K.type))}return this._isInResult}}],[{key:"compare",value:function(e,t){var n=e.leftSE.point.x,r=t.leftSE.point.x,i=e.rightSE.point.x,o=t.rightSE.point.x;if(o<n)return 1;if(i<r)return-1;var a=e.leftSE.point.y,s=t.leftSE.point.y,u=e.rightSE.point.y,l=t.rightSE.point.y;if(n<r){if(s<a&&s<u)return 1;if(s>a&&s>u)return-1;var c=e.comparePoint(t.leftSE.point);if(c<0)return 1;if(c>0)return-1;var f=t.comparePoint(e.rightSE.point);return 0!==f?f:-1}if(n>r){if(a<s&&a<l)return-1;if(a>s&&a>l)return 1;var h=t.comparePoint(e.leftSE.point);if(0!==h)return h;var p=e.comparePoint(t.rightSE.point);return p<0?1:p>0?-1:1}if(a<s)return-1;if(a>s)return 1;if(i<o){var d=t.comparePoint(e.rightSE.point);if(0!==d)return d}if(i>o){var v=e.comparePoint(t.rightSE.point);if(v<0)return 1;if(v>0)return-1}if(i!==o){var g=u-a,m=i-n,y=l-s,_=o-r;if(g>m&&y<_)return 1;if(g<m&&y>_)return-1}return i>o?1:i<o||u<l?-1:u>l?1:e.id<t.id?-1:e.id>t.id?1:0}},{key:"fromRing",value:function(t,n,r){var i,o,a,s=U.comparePoints(t,n);if(s<0)i=t,o=n,a=1;else{if(!(s>0))throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));i=n,o=t,a=-1}return new e(new U(i,!0),new U(o,!1),[r],[a])}}]),e}(),G=function(){function e(t,n,r){if(s(this,e),!Array.isArray(t)||0===t.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=r,this.segments=[],"number"!=typeof t[0][0]||"number"!=typeof t[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=x.round(t[0][0],t[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,a=1,u=t.length;a<u;a++){if("number"!=typeof t[a][0]||"number"!=typeof t[a][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=x.round(t[a][0],t[a][1]);l.x===o.x&&l.y===o.y||(this.segments.push(z.fromRing(o,l,this)),l.x<this.bbox.ll.x&&(this.bbox.ll.x=l.x),l.y<this.bbox.ll.y&&(this.bbox.ll.y=l.y),l.x>this.bbox.ur.x&&(this.bbox.ur.x=l.x),l.y>this.bbox.ur.y&&(this.bbox.ur.y=l.y),o=l)}i.x===o.x&&i.y===o.y||this.segments.push(z.fromRing(o,i,this))}return u(e,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.segments.length;t<n;t++){var r=this.segments[t];e.push(r.leftSE),e.push(r.rightSE)}return e}}]),e}(),V=function(){function e(t,n){if(s(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new G(t[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,i=t.length;r<i;r++){var o=new G(t[r],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=n}return u(e,[{key:"getSweepEvents",value:function(){for(var e=this.exteriorRing.getSweepEvents(),t=0,n=this.interiorRings.length;t<n;t++)for(var r=this.interiorRings[t].getSweepEvents(),i=0,o=r.length;i<o;i++)e.push(r[i]);return e}}]),e}(),j=function(){function e(t,n){if(s(this,e),!Array.isArray(t))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof t[0][0][0]&&(t=[t])}catch(e){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,i=t.length;r<i;r++){var o=new V(t[r],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=n}return u(e,[{key:"getSweepEvents",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++)for(var r=this.polys[t].getSweepEvents(),i=0,o=r.length;i<o;i++)e.push(r[i]);return e}}]),e}(),H=function(){function e(t){s(this,e),this.events=t;for(var n=0,r=t.length;n<r;n++)t[n].segment.ringOut=this;this.poly=null}return u(e,[{key:"getGeom",value:function(){for(var e=this.events[0].point,t=[e],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,o=this.events[n+1].point;0!==I(i,e,o)&&(t.push(i),e=i)}if(1===t.length)return null;var a=t[0],s=t[1];0===I(a,e,s)&&t.shift(),t.push(t[0]);for(var u=this.isExteriorRing()?1:-1,l=this.isExteriorRing()?0:t.length-1,c=this.isExteriorRing()?t.length:-1,f=[],h=l;h!=c;h+=u)f.push([t[h].x,t[h].y]);return f}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var e=this.enclosingRing();this._isExteriorRing=!e||!e.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var e=this.events[0],t=1,n=this.events.length;t<n;t++){var r=this.events[t];U.compare(e,r)>0&&(e=r)}for(var i=e.segment.prevInResult(),o=i?i.prevInResult():null;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}],[{key:"factory",value:function(t){for(var n=[],r=0,i=t.length;r<i;r++){var o=t[r];if(o.isInResult()&&!o.ringOut){for(var a=null,s=o.leftSE,u=o.rightSE,l=[s],c=s.point,f=[];a=s,s=u,l.push(s),s.point!==c;)for(;;){var h=s.getAvailableLinkedEvents();if(0===h.length){var p=l[0].point,d=l[l.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(p.x,",")+" ".concat(p.y,"]. Last matching segment found ends at")+" [".concat(d.x,", ").concat(d.y,"]."))}if(1===h.length){u=h[0].otherSE;break}for(var v=null,g=0,m=f.length;g<m;g++)if(f[g].point===s.point){v=g;break}if(null===v){f.push({index:l.length,point:s.point});var y=s.getLeftmostComparator(a);u=h.sort(y)[0].otherSE;break}var _=f.splice(v)[0],b=l.splice(_.index);b.unshift(b[0].otherSE),n.push(new e(b.reverse()))}n.push(new e(l))}}return n}}]),e}(),W=function(){function e(t){s(this,e),this.exteriorRing=t,t.poly=this,this.interiorRings=[]}return u(e,[{key:"addInterior",value:function(e){this.interiorRings.push(e),e.poly=this}},{key:"getGeom",value:function(){var e=[this.exteriorRing.getGeom()];if(null===e[0])return null;for(var t=0,n=this.interiorRings.length;t<n;t++){var r=this.interiorRings[t].getGeom();null!==r&&e.push(r)}return e}}]),e}(),X=function(){function e(t){s(this,e),this.rings=t,this.polys=this._composePolys(t)}return u(e,[{key:"getGeom",value:function(){for(var e=[],t=0,n=this.polys.length;t<n;t++){var r=this.polys[t].getGeom();null!==r&&e.push(r)}return e}},{key:"_composePolys",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];if(!i.poly)if(i.isExteriorRing())t.push(new W(i));else{var o=i.enclosingRing();o.poly||t.push(new W(o)),o.poly.addInterior(i)}}return t}}]),e}(),Z=function(){function e(t){s(this,e);var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:z.compare;this.queue=t,this.tree=new c(n),this.segments=[]}return u(e,[{key:"process",value:function(e){var t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(t),n;var r=e.isLeft?this.tree.add(t):this.tree.find(t);if(!r)throw new Error("Unable to find segment #".concat(t.id," ")+"[".concat(t.leftSE.point.x,", ").concat(t.leftSE.point.y,"] -> ")+"[".concat(t.rightSE.point.x,", ").concat(t.rightSE.point.y,"] ")+"in SweepLine tree.");for(var i=r,o=r,a=void 0,s=void 0;void 0===a;)null===(i=this.tree.prev(i))?a=null:void 0===i.key.consumedBy&&(a=i.key);for(;void 0===s;)null===(o=this.tree.next(o))?s=null:void 0===o.key.consumedBy&&(s=o.key);if(e.isLeft){var u=null;if(a){var l=a.getIntersection(t);if(null!==l&&(t.isAnEndpoint(l)||(u=l),!a.isAnEndpoint(l)))for(var c=this._splitSafely(a,l),f=0,h=c.length;f<h;f++)n.push(c[f])}var p=null;if(s){var d=s.getIntersection(t);if(null!==d&&(t.isAnEndpoint(d)||(p=d),!s.isAnEndpoint(d)))for(var v=this._splitSafely(s,d),g=0,m=v.length;g<m;g++)n.push(v[g])}if(null!==u||null!==p){var y=null;y=null===u?p:null===p||U.comparePoints(u,p)<=0?u:p,this.queue.remove(t.rightSE),n.push(t.rightSE);for(var _=t.split(y),b=0,x=_.length;b<x;b++)n.push(_[b])}n.length>0?(this.tree.remove(t),n.push(e)):(this.segments.push(t),t.prev=a)}else{if(a&&s){var E=a.getIntersection(s);if(null!==E){if(!a.isAnEndpoint(E))for(var T=this._splitSafely(a,E),A=0,S=T.length;A<S;A++)n.push(T[A]);if(!s.isAnEndpoint(E))for(var C=this._splitSafely(s,E),R=0,w=C.length;R<w;R++)n.push(C[R])}}this.tree.remove(t)}return n}},{key:"_splitSafely",value:function(e,t){this.tree.remove(e);var n=e.rightSE;this.queue.remove(n);var r=e.split(t);return r.push(n),void 0===e.consumedBy&&this.tree.add(e),r}}]),e}(),Y=void 0!==a&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,q=void 0!==a&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,K=new(function(){function e(){s(this,e)}return u(e,[{key:"run",value:function(e,t,n){K.type=e,x.reset();for(var r=[new j(t,!0)],i=0,o=n.length;i<o;i++)r.push(new j(n[i],!1));if(K.numMultiPolys=r.length,"difference"===K.type)for(var a=r[0],s=1;s<r.length;)null!==v(r[s].bbox,a.bbox)?s++:r.splice(s,1);if("intersection"===K.type)for(var u=0,l=r.length;u<l;u++)for(var f=r[u],h=u+1,p=r.length;h<p;h++)if(null===v(f.bbox,r[h].bbox))return[];for(var d=new c(U.compare),g=0,m=r.length;g<m;g++)for(var y=r[g].getSweepEvents(),_=0,b=y.length;_<b;_++)if(d.insert(y[_]),d.size>Y)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).");for(var E=new Z(d),T=d.size,A=d.pop();A;){var S=A.key;if(d.size===T){var C=S.segment;throw new Error("Unable to pop() ".concat(S.isLeft?"left":"right"," SweepEvent ")+"[".concat(S.point.x,", ").concat(S.point.y,"] from segment #").concat(C.id," ")+"[".concat(C.leftSE.point.x,", ").concat(C.leftSE.point.y,"] -> ")+"[".concat(C.rightSE.point.x,", ").concat(C.rightSE.point.y,"] from queue."))}if(d.size>Y)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(E.segments.length>q)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");for(var R=E.process(S),w=0,M=R.length;w<M;w++){var k=R[w];void 0===k.consumedBy&&d.insert(k)}T=d.size,A=d.pop()}x.reset();var L=H.factory(E.segments);return new X(L).getGeom()}}]),e}()),Q={union:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return K.run("union",e,n)},intersection:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return K.run("intersection",e,n)},xor:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return K.run("xor",e,n)},difference:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return K.run("difference",e,n)}};return Q},"object"===l(t)?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)},4693:function(e){var t,n,r=e.exports={};function i(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(t===setTimeout)return setTimeout(e,0);if((t===i||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:i}catch(e){t=i}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var s,u=[],l=!1,c=-1;function f(){l&&s&&(l=!1,s.length?u=s.concat(u):c=-1,u.length&&h())}function h(){if(!l){var e=a(f);l=!0;for(var t=u.length;t;){for(s=u,u=[];++c<t;)s&&s[c].run();c=-1,t=u.length}s=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function d(){}r.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||l||a(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},r.title="browser",r.browser=!0,r.env={},r.argv=[],r.version="",r.versions={},r.on=d,r.addListener=d,r.once=d,r.off=d,r.removeListener=d,r.removeAllListeners=d,r.emit=d,r.prependListener=d,r.prependOnceListener=d,r.listeners=function(e){return[]},r.binding=function(e){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(e){throw new Error("process.chdir is not supported")},r.umask=function(){return 0}},6270:function(e,t,n){var r,i,o,a=n(5116).default;o=function(){"use strict";var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e},n="\n";function r(e){var t=new Error("(regl) "+e);throw console.error(t),t}function i(e,t){e||r(t)}function o(e){return e?": "+e:""}function s(e,t){switch(t){case"number":return"number"==typeof e;case"object":return"object"===a(e);case"string":return"string"==typeof e;case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"undefined":return void 0===e;case"symbol":return"symbol"===a(e)}}function u(e,t,n){t.indexOf(e)<0&&r("invalid value"+o(n)+". must be one of: "+t)}var l=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function c(e,t){for(e+="";e.length<t;)e=" "+e;return e}function f(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function h(e,t){this.number=e,this.line=t,this.errors=[]}function p(e,t,n){this.file=e,this.line=t,this.message=n}function d(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function v(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function g(e,t){var n,r=e.split("\n"),i=1,o=0,a={unknown:new f,0:new f};a.unknown.name=a[0].name=t||d(),a.unknown.lines.push(new h(0,""));for(var s=0;s<r.length;++s){var u=r[s],l=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(l)switch(l[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(l[2]);c&&(i=0|c[1],c[2]&&((o=0|c[2])in a||(a[o]=new f)));break;case"define":var p=/SHADER_NAME(_B64)?\s+(.*)$/.exec(l[2]);p&&(a[o].name=p[1]?(n=p[2],"undefined"!=typeof atob?atob(n):"base64:"+n):p[2])}a[o].lines.push(new h(i++,u))}return Object.keys(a).forEach((function(e){var t=a[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),a}function m(e){e._commandRef=d()}function y(e,t){var n=v();r(e+" in command "+(t||d())+("unknown"===n?"":" called from "+n))}function _(e,t,n,r){s(e,t)||y("invalid parameter type"+o(n)+". expected "+t+", got "+a(e),r||d())}var b=33071,x={};function E(e,t){return 32820===e||32819===e||33635===e?2:34042===e?4:x[e]*t}function T(e){return!(e&e-1||!e)}x[5120]=x[5121]=1,x[5122]=x[5123]=x[36193]=x[33635]=x[32819]=x[32820]=2,x[5124]=x[5125]=x[5126]=x[34042]=4;var A=t(i,{optional:function(e){e()},raise:r,commandRaise:y,command:function(e,t,n){e||y(t,n||d())},parameter:function(e,t,n){e in t||r("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join())},commandParameter:function(e,t,n,r){e in t||y("unknown parameter ("+e+")"+o(n)+". possible values: "+Object.keys(t).join(),r||d())},constructor:function(e){Object.keys(e).forEach((function(e){l.indexOf(e)<0&&r('invalid regl constructor argument "'+e+'". must be one of '+l)}))},type:function(e,t,n){s(e,t)||r("invalid parameter type"+o(n)+". expected "+t+", got "+a(e))},commandType:_,isTypedArray:function(t,n){e(t)||r("invalid parameter type"+o(n)+". must be a typed array")},nni:function(e,t){e>=0&&(0|e)===e||r("invalid parameter type, ("+e+")"+o(t)+". must be a nonnegative integer")},oneOf:u,shaderError:function(e,t,r,o,a){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var s=e.getShaderInfoLog(t),u=o===e.FRAGMENT_SHADER?"fragment":"vertex";_(r,"string",u+" shader source must be a string",a);var l=g(r,a),f=function(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new p(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new p("unknown",0,e))}})),t}(s);!function(e,t){t.forEach((function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))}(l,f),Object.keys(l).forEach((function(e){var t=l[e];if(t.hasErrors){var r=[""],i=[""];o("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){o(c(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(e.line+n,"color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(r){var i=r.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(a){var s=a[1];i=a[2],"assign"===s&&(s="="),t=Math.max(e.line.indexOf(s,t),0)}else t=0;o(c("| ",6)),o(c("^^^",t+3)+n,"font-weight:bold"),o(c("| ",6)),o(i+n,"font-weight:bold")})),o(c("| ",6)+n)}else o(c(e.number,4)+"|  "),o(e.line+n,"color:red")})),"undefined"==typeof document||window.chrome?console.log(r.join("")):(i[0]=r.join("%c"),console.log.apply(console,i))}function o(e,t){r.push(e),i.push(t||"")}})),i.raise("Error compiling "+u+" shader, "+l[0].name)}},linkError:function(e,t,r,o,a){if(!e.getProgramParameter(t,e.LINK_STATUS)){var s=e.getProgramInfoLog(t),u=g(r,a),l='Error linking program with vertex shader, "'+g(o,a)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+l+"\n%c"+s,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(l+n+s),i.raise(l)}},callSite:v,saveCommandRef:m,saveDrawInfo:function(e,t,n,r){function i(e){return e?r.id(e):0}function o(e,t){Object.keys(t).forEach((function(t){e[r.id(t)]=!0}))}m(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var a=e._uniformSet={};o(a,t.static),o(a,t.dynamic);var s=e._attributeSet={};o(s,n.static),o(s,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic},framebufferFormat:function(e,t,n){e.texture?u(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):u(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")},guessCommand:d,texture2D:function(e,t,n){var r,o=t.width,a=t.height,s=t.channels;i(o>0&&o<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),e.wrapS===b&&e.wrapT===b||i(T(o)&&T(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==o&&1!==a&&i(9984!==e.minFilter&&9986!==e.minFilter&&9985!==e.minFilter&&9987!==e.minFilter,"min filter requires mipmap"):(i(T(o)&&T(a),"texture must be a square power of 2 to support mipmapping"),i(t.mipmask===(o<<1)-1,"missing or incomplete mipmap data")),5126===t.type&&(n.extensions.indexOf("oes_texture_float_linear")<0&&i(9728===e.minFilter&&9728===e.magFilter,"filter not supported, must enable oes_texture_float_linear"),i(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(r=0;r<16;++r)if(u[r]){var l=o>>r,c=a>>r;i(t.mipmask&1<<r,"missing mipmap data");var f=u[r];if(i(f.width===l&&f.height===c,"invalid shape for mip images"),i(f.format===t.format&&f.internalformat===t.internalformat&&f.type===t.type,"incompatible type for mip image"),f.compressed);else if(f.data){var h=Math.ceil(E(f.type,s)*l/f.unpackAlignment)*f.unpackAlignment;i(f.data.byteLength===h*c,"invalid data for image, buffer size is inconsistent with image format")}else f.element||f.copy}else e.genMipmaps||i(0==(t.mipmask&1<<r),"extra mipmap data");t.compressed&&i(!e.genMipmaps,"mipmap generation for compressed images not supported")},textureCube:function(e,t,n,r){var o=e.width,a=e.height,s=e.channels;i(o>0&&o<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),i(o===a,"cube map must be square"),i(t.wrapS===b&&t.wrapT===b,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var l=n[u];i(l.width===o&&l.height===a,"inconsistent cube map face shape"),t.genMipmaps&&(i(!l.compressed,"can not generate mipmap for compressed textures"),i(1===l.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=l.images,f=0;f<16;++f){var h=c[f];if(h){var p=o>>f,d=a>>f;i(l.mipmask&1<<f,"missing mipmap data"),i(h.width===p&&h.height===d,"invalid shape for mip images"),i(h.format===e.format&&h.internalformat===e.internalformat&&h.type===e.type,"incompatible type for mip image"),h.compressed||(h.data?i(h.data.byteLength===p*d*Math.max(E(h.type,s),h.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):h.element||h.copy)}}}}}),S=0;function C(e,t){this.id=S++,this.type=e,this.data=t}function R(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function w(e){if(0===e.length)return[];var t=e.charAt(0),n=e.charAt(e.length-1);if(e.length>1&&t===n&&('"'===t||"'"===t))return['"'+R(e.substr(1,e.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(r)return w(e.substr(0,r.index)).concat(w(r[1])).concat(w(e.substr(r.index+r[0].length)));var i=e.split(".");if(1===i.length)return['"'+R(e)+'"'];for(var o=[],a=0;a<i.length;++a)o=o.concat(w(i[a]));return o}function M(e){return"["+w(e).join("][")+"]"}var k={DynamicVariable:C,define:function(e,t){return new C(e,M(t+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof C},unbox:function(e,t){return"function"==typeof e?new C(0,e):e},accessor:M},L={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},O="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function I(e){return"string"==typeof e?e.split():(A(Array.isArray(e),"invalid extension array"),e)}function P(e){return"string"==typeof e?(A("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function N(e){var n,r,i,o,s,u=e||{},l={},c=[],f=[],h="undefined"==typeof window?1:window.devicePixelRatio,p=!1,d=function(e){e&&A.raise(e)},v=function(){};if("string"==typeof u?(A("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),n=document.querySelector(u),A(n,"invalid query string for element")):"object"===a(u)?"string"==typeof(s=u).nodeName&&"function"==typeof s.appendChild&&"function"==typeof s.getBoundingClientRect?n=u:function(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}(u)?i=(o=u).canvas:(A.constructor(u),"gl"in u?o=u.gl:"canvas"in u?i=P(u.canvas):"container"in u&&(r=P(u.container)),"attributes"in u&&(l=u.attributes,A.type(l,"object","invalid context attributes")),"extensions"in u&&(c=I(u.extensions)),"optionalExtensions"in u&&(f=I(u.optionalExtensions)),"onDone"in u&&(A.type(u.onDone,"function","invalid or missing onDone callback"),d=u.onDone),"profile"in u&&(p=!!u.profile),"pixelRatio"in u&&(h=+u.pixelRatio,A(h>0,"invalid pixel ratio"))):A.raise("invalid arguments to regl"),n&&("canvas"===n.nodeName.toLowerCase()?i=n:r=n),!o){if(!i){A("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var g=function(e,n,r){var i,o=document.createElement("canvas");function a(){var n=window.innerWidth,i=window.innerHeight;if(e!==document.body){var a=e.getBoundingClientRect();n=a.right-a.left,i=a.bottom-a.top}o.width=r*n,o.height=r*i,t(o.style,{width:n+"px",height:i+"px"})}return t(o.style,{border:0,margin:0,padding:0,top:0,left:0}),e.appendChild(o),e===document.body&&(o.style.position="absolute",t(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(e):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:function(){i?i.disconnect():window.removeEventListener("resize",a),e.removeChild(o)}}}(r||document.body,0,h);if(!g)return null;i=g.canvas,v=g.onDestroy}void 0===l.premultipliedAlpha&&(l.premultipliedAlpha=!0),o=function(e,t){function n(n){try{return e.getContext(n,t)}catch(e){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}(i,l)}return o?{gl:o,canvas:i,container:r,extensions:c,optionalExtensions:f,pixelRatio:h,profile:p,onDone:d,onDestroy:v}:(v(),d("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function B(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}function D(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function U(){var e=B(8,(function(){return[]}));function t(t){var n=function(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}(t),r=e[D(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[D(t.byteLength)>>2].push(t)}return{alloc:t,free:n,allocType:function(e,n){var r=null;switch(e){case 5120:r=new Int8Array(t(n),0,n);break;case 5121:r=new Uint8Array(t(n),0,n);break;case 5122:r=new Int16Array(t(2*n),0,n);break;case 5123:r=new Uint16Array(t(2*n),0,n);break;case 5124:r=new Int32Array(t(4*n),0,n);break;case 5125:r=new Uint32Array(t(4*n),0,n);break;case 5126:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r},freeType:function(e){n(e.buffer)}}}var F=U();F.zero=U();var z=3553,G=6408,V=5126,j=36160;function H(t){return!!t&&"object"===a(t)&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var W=function(e){return Object.keys(e).map((function(t){return e[t]}))},X={shape:function(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t},flatten:function(e,t,n,r){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;var a=r||F.allocType(n,i);switch(t.length){case 0:break;case 1:!function(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}(e,t[0],a);break;case 2:!function(e,t,n,r){for(var i=0,o=0;o<t;++o)for(var a=e[o],s=0;s<n;++s)r[i++]=a[s]}(e,t[0],t[1],a);break;case 3:Z(e,t[0],t[1],t[2],a,0);break;default:Y(e,t,0,a,0)}return a}};function Z(e,t,n,r,i,o){for(var a=o,s=0;s<t;++s)for(var u=e[s],l=0;l<n;++l)for(var c=u[l],f=0;f<r;++f)i[a++]=c[f]}function Y(e,t,n,r,i){for(var o=1,a=n+1;a<t.length;++a)o*=t[a];var s=t[n];if(t.length-n==4){var u=t[n+1],l=t[n+2],c=t[n+3];for(a=0;a<s;++a)Z(e[a],u,l,c,r,i),i+=o}else for(a=0;a<s;++a)Y(e[a],t,n+1,r,i),i+=o}var q={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},K={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Q={dynamic:35048,stream:35040,static:35044},$=X.flatten,J=X.shape,ee=5121,te=5126,ne=[];function re(e){return 0|q[Object.prototype.toString.call(e)]}function ie(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function oe(e,t,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var l=0;l<r;++l)e[s++]=t[i*u+o*l+a]}ne[5120]=1,ne[5122]=2,ne[5124]=4,ne[5121]=1,ne[5123]=2,ne[5125]=4,ne[5126]=4;var ae={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},se=5121,ue=5123,le=5125,ce=34963,fe=new Float32Array(1),he=new Uint32Array(fe.buffer);function pe(e){for(var t=F.allocType(5123,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{fe[0]=e[n];var r=he[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)t[n]=i;else if(o<-14){var s=-14-o;t[n]=i+(a+1024>>s)}else t[n]=o>15?i+31744:i+(o+15<<10)+a}return t}function de(t){return Array.isArray(t)||e(t)}var ve=function(e){return!(e&e-1||!e)},ge=3553,me=34069,ye=6408,_e=6406,be=6407,xe=6409,Ee=6410,Te=32855,Ae=6402,Se=34041,Ce=35904,Re=35906,we=36193,Me=33776,ke=33777,Le=33778,Oe=33779,Ie=5121,Pe=5123,Ne=5125,Be=5126,De=33071,Ue=9728,Fe=9984,ze=9987,Ge=4352,Ve=33984,je=[Fe,9986,9985,ze],He=[0,xe,Ee,be,ye],We={};function Xe(e){return"[object "+e+"]"}We[6409]=We[6406]=We[6402]=1,We[34041]=We[6410]=2,We[6407]=We[35904]=3,We[6408]=We[35906]=4;var Ze=Xe("HTMLCanvasElement"),Ye=Xe("OffscreenCanvas"),qe=Xe("CanvasRenderingContext2D"),Ke=Xe("ImageBitmap"),Qe=Xe("HTMLImageElement"),$e=Xe("HTMLVideoElement"),Je=Object.keys(q).concat([Ze,Ye,qe,Ke,Qe,$e]),et=[];et[5121]=1,et[5126]=4,et[36193]=2,et[5123]=2,et[5125]=4;var tt=[];function nt(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function rt(e){return!!Array.isArray(e)&&!(0===e.length||!de(e[0]))}function it(e){return Object.prototype.toString.call(e)}function ot(e){return it(e)===Ze}function at(e){return it(e)===Ye}function st(e){if(!e)return!1;var t=it(e);return Je.indexOf(t)>=0||nt(e)||rt(e)||H(e)}function ut(e){return 0|q[Object.prototype.toString.call(e)]}function lt(e,t){return F.allocType(e.type===we?Be:e.type,t)}function ct(e,t){e.type===we?(e.data=pe(t),F.freeType(t)):e.data=t}function ft(e,t,n,r,i,o){var a;if(a=void 0!==tt[e]?tt[e]:We[e]*et[t],o&&(a*=6),i){for(var s=0,u=n;u>=1;)s+=a*u*u,u/=2;return s}return a*n*r}function ht(n,r,i,o,s,u,l){var c={"don't care":Ge,"dont care":Ge,nice:4354,fast:4353},f={repeat:10497,clamp:De,mirror:33648},h={nearest:Ue,linear:9729},p=t({mipmap:ze,"nearest mipmap nearest":Fe,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":ze},h),d={none:0,browser:37444},v={uint8:Ie,rgba4:32819,rgb565:33635,"rgb5 a1":32820},g={alpha:_e,luminance:xe,"luminance alpha":Ee,rgb:be,rgba:ye,rgba4:32854,"rgb5 a1":Te,rgb565:36194},m={};r.ext_srgb&&(g.srgb=Ce,g.srgba=Re),r.oes_texture_float&&(v.float32=v.float=Be),r.oes_texture_half_float&&(v.float16=v["half float"]=we),r.webgl_depth_texture&&(t(g,{depth:Ae,"depth stencil":Se}),t(v,{uint16:Pe,uint32:Ne,"depth stencil":34042})),r.webgl_compressed_texture_s3tc&&t(m,{"rgb s3tc dxt1":Me,"rgba s3tc dxt1":ke,"rgba s3tc dxt3":Le,"rgba s3tc dxt5":Oe}),r.webgl_compressed_texture_atc&&t(m,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),r.webgl_compressed_texture_pvrtc&&t(m,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),r.webgl_compressed_texture_etc1&&(m["rgb etc1"]=36196);var y=Array.prototype.slice.call(n.getParameter(34467));Object.keys(m).forEach((function(e){var t=m[e];y.indexOf(t)>=0&&(g[e]=t)}));var _=Object.keys(g);i.textureFormats=_;var b=[];Object.keys(g).forEach((function(e){var t=g[e];b[t]=e}));var x=[];Object.keys(v).forEach((function(e){var t=v[e];x[t]=e}));var E=[];Object.keys(h).forEach((function(e){E[h[e]]=e}));var T=[];Object.keys(p).forEach((function(e){var t=p[e];T[t]=e}));var S=[];Object.keys(f).forEach((function(e){S[f[e]]=e}));var C=_.reduce((function(e,t){var n=g[t];return n===xe||n===_e||n===xe||n===Ee||n===Ae||n===Se||r.ext_srgb&&(n===Ce||n===Re)?e[n]=n:n===Te||t.indexOf("rgba")>=0?e[n]=ye:e[n]=be,e}),{});function R(){this.internalformat=ye,this.format=ye,this.type=Ie,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=37444,this.width=0,this.height=0,this.channels=0}function w(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function M(e,t){if("object"===a(t)&&t){if("premultiplyAlpha"in t&&(A.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(A.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(A.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(A.parameter(t.colorSpace,d,"invalid colorSpace"),e.colorSpace=d[t.colorSpace]),"type"in t){var n=t.type;A(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),A(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),A(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),A.parameter(n,v,"invalid texture type"),e.type=v[n]}var o=e.width,s=e.height,u=e.channels,l=!1;"shape"in t?(A(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),o=t.shape[0],s=t.shape[1],3===t.shape.length&&(u=t.shape[2],A(u>0&&u<=4,"invalid number of channels"),l=!0),A(o>=0&&o<=i.maxTextureSize,"invalid width"),A(s>=0&&s<=i.maxTextureSize,"invalid height")):("radius"in t&&(o=s=t.radius,A(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in t&&(o=t.width,A(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in t&&(s=t.height,A(s>=0&&s<=i.maxTextureSize,"invalid height")),"channels"in t&&(u=t.channels,A(u>0&&u<=4,"invalid number of channels"),l=!0)),e.width=0|o,e.height=0|s,e.channels=0|u;var c=!1;if("format"in t){var f=t.format;A(r.webgl_depth_texture||!("depth"===f||"depth stencil"===f),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),A.parameter(f,g,"invalid texture format");var h=e.internalformat=g[f];e.format=C[h],f in v&&("type"in t||(e.type=v[f])),f in m&&(e.compressed=!0),c=!0}!l&&c?e.channels=We[e.format]:l&&!c?e.channels!==He[e.format]&&(e.format=e.internalformat=He[e.channels]):c&&l&&A(e.channels===We[e.format],"number of channels inconsistent with specified format")}}function k(e){n.pixelStorei(37440,e.flipY),n.pixelStorei(37441,e.premultiplyAlpha),n.pixelStorei(37443,e.colorSpace),n.pixelStorei(3317,e.unpackAlignment)}function L(){R.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function O(t,n){var r=null;if(st(n)?r=n:n&&(A.type(n,"object","invalid pixel data type"),M(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),st(n.data)&&(r=n.data)),A(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){A(!r,"can not specify copy and data field for the same texture");var o=s.viewportWidth,a=s.viewportHeight;t.width=t.width||o-t.xOffset,t.height=t.height||a-t.yOffset,t.needsCopy=!0,A(t.xOffset>=0&&t.xOffset<o&&t.yOffset>=0&&t.yOffset<a&&t.width>0&&t.width<=o&&t.height>0&&t.height<=a,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||t.type!==Ie||(t.type=ut(r));else if(nt(r))t.channels=t.channels||4,function(e,t){var n=t.length;switch(e.type){case Ie:case Pe:case Ne:case Be:var r=F.allocType(e.type,n);r.set(t),e.data=r;break;case we:e.data=pe(t);break;default:A.raise("unsupported texture type, must specify a typed array")}}(t,r),t.alignment=1,t.needsFree=!0;else if(H(r)){var u=r.data;Array.isArray(u)||t.type!==Ie||(t.type=ut(u));var l,c,f,h,p,d,v=r.shape,g=r.stride;3===v.length?(f=v[2],d=g[2]):(A(2===v.length,"invalid ndarray pixel data, must be 2 or 3D"),f=1,d=1),l=v[0],c=v[1],h=g[0],p=g[1],t.alignment=1,t.width=l,t.height=c,t.channels=f,t.format=t.internalformat=He[f],t.needsFree=!0,function(e,t,n,r,i,o){for(var a=e.width,s=e.height,u=e.channels,l=lt(e,a*s*u),c=0,f=0;f<s;++f)for(var h=0;h<a;++h)for(var p=0;p<u;++p)l[c++]=t[n*h+r*f+i*p+o];ct(e,l)}(t,u,h,p,d,r.offset)}else if(ot(r)||at(r)||it(r)===qe)ot(r)||at(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(function(e){return it(e)===Ke}(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(function(e){return it(e)===Qe}(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(function(e){return it(e)===$e}(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(rt(r)){var m=t.width||r[0].length,y=t.height||r.length,_=t.channels;_=de(r[0][0])?_||r[0][0].length:_||1;for(var b=X.shape(r),x=1,E=0;E<b.length;++E)x*=b[E];var T=lt(t,x);X.flatten(r,b,"",T),ct(t,T),t.alignment=1,t.width=m,t.height=y,t.channels=_,t.format=t.internalformat=He[_],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===Be?A(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===we&&A(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function I(e,t,r){var i=e.element,a=e.data,s=e.internalformat,u=e.format,l=e.type,c=e.width,f=e.height;k(e),i?n.texImage2D(t,r,u,u,l,i):e.compressed?n.compressedTexImage2D(t,r,s,c,f,0,a):e.needsCopy?(o(),n.copyTexImage2D(t,r,u,e.xOffset,e.yOffset,c,f,0)):n.texImage2D(t,r,u,c,f,0,u,l,a||null)}function P(e,t,r,i,a){var s=e.element,u=e.data,l=e.internalformat,c=e.format,f=e.type,h=e.width,p=e.height;k(e),s?n.texSubImage2D(t,a,r,i,c,f,s):e.compressed?n.compressedTexSubImage2D(t,a,r,i,l,h,p,u):e.needsCopy?(o(),n.copyTexSubImage2D(t,a,r,i,e.xOffset,e.yOffset,h,p)):n.texSubImage2D(t,a,r,i,h,p,c,f,u)}var N=[];function B(){return N.pop()||new L}function D(e){e.needsFree&&F.freeType(e.data),L.call(e),N.push(e)}function U(){R.call(this),this.genMipmaps=!1,this.mipmapHint=Ge,this.mipmask=0,this.images=Array(16)}function z(e,t,n){var r=e.images[0]=B();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function G(e,t){var n=null;if(st(t))w(n=e.images[0]=B(),e),O(n,t),e.mipmask=1;else if(M(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)w(n=e.images[i]=B(),e),n.width>>=i,n.height>>=i,O(n,r[i]),e.mipmask|=1<<i;else w(n=e.images[0]=B(),e),O(n,t),e.mipmask=1;w(e,e.images[0]),!e.compressed||e.internalformat!==Me&&e.internalformat!==ke&&e.internalformat!==Le&&e.internalformat!==Oe||A(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function V(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;I(n[r],t,r)}}var j=[];function Z(){var e=j.pop()||new U;R.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function Y(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&D(t[n]),t[n]=null;j.push(e)}function q(){this.minFilter=Ue,this.magFilter=Ue,this.wrapS=De,this.wrapT=De,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Ge}function K(e,t){if("min"in t){var n=t.min;A.parameter(n,p),e.minFilter=p[n],je.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;A.parameter(r,h),e.magFilter=h[r]}var o=e.wrapS,s=e.wrapT;if("wrap"in t){var u=t.wrap;"string"==typeof u?(A.parameter(u,f),o=s=f[u]):Array.isArray(u)&&(A.parameter(u[0],f),A.parameter(u[1],f),o=f[u[0]],s=f[u[1]])}else{if("wrapS"in t){var l=t.wrapS;A.parameter(l,f),o=f[l]}if("wrapT"in t){var d=t.wrapT;A.parameter(d,f),s=f[d]}}if(e.wrapS=o,e.wrapT=s,"anisotropic"in t){var v=t.anisotropic;A("number"==typeof v&&v>=1&&v<=i.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var g=!1;switch(a(t.mipmap)){case"string":A.parameter(t.mipmap,c,"invalid mipmap hint"),e.mipmapHint=c[t.mipmap],e.genMipmaps=!0,g=!0;break;case"boolean":g=e.genMipmaps=t.mipmap;break;case"object":A(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,g=!0;break;default:A.raise("invalid mipmap type")}g&&!("min"in t)&&(e.minFilter=Fe)}}function Q(e,t){n.texParameteri(t,10241,e.minFilter),n.texParameteri(t,10240,e.magFilter),n.texParameteri(t,10242,e.wrapS),n.texParameteri(t,10243,e.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(t,34046,e.anisotropic),e.genMipmaps&&(n.hint(33170,e.mipmapHint),n.generateMipmap(t))}var $=0,J={},ee=i.maxTextureUnits,te=Array(ee).map((function(){return null}));function ne(e){R.call(this),this.mipmask=0,this.internalformat=ye,this.id=$++,this.refCount=1,this.target=e,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new q,l.profile&&(this.stats={size:0})}function re(e){n.activeTexture(Ve),n.bindTexture(e.target,e.texture)}function ie(){var e=te[0];e?n.bindTexture(e.target,e.texture):n.bindTexture(ge,null)}function oe(e){var t=e.texture;A(t,"must not double destroy texture");var r=e.unit,i=e.target;r>=0&&(n.activeTexture(Ve+r),n.bindTexture(i,null),te[r]=null),n.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete J[e.id],u.textureCount--}return t(ne.prototype,{bind:function(){var e=this;e.bindCount+=1;var t=e.unit;if(t<0){for(var r=0;r<ee;++r){var i=te[r];if(i){if(i.bindCount>0)continue;i.unit=-1}te[r]=e,t=r;break}t>=ee&&A.raise("insufficient number of texture units"),l.profile&&u.maxTextureUnits<t+1&&(u.maxTextureUnits=t+1),e.unit=t,n.activeTexture(Ve+t),n.bindTexture(e.target,e.texture)}return t},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&oe(this)}}),l.profile&&(u.getTotalTextureSize=function(){var e=0;return Object.keys(J).forEach((function(t){e+=J[t].stats.size})),e}),{create2D:function(e,t){var r=new ne(ge);function o(e,t){var n=r.texInfo;q.call(n);var a=Z();return"number"==typeof e?z(a,0|e,"number"==typeof t?0|t:0|e):e?(A.type(e,"object","invalid arguments to regl.texture"),K(n,e),G(a,e)):z(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,w(r,a),A.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,re(r),V(a,ge),Q(n,ge),ie(),Y(a),l.profile&&(r.stats.size=ft(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=b[r.internalformat],o.type=x[r.type],o.mag=E[n.magFilter],o.min=T[n.minFilter],o.wrapS=S[n.wrapS],o.wrapT=S[n.wrapT],o}return J[r.id]=r,u.textureCount++,o(e,t),o.subimage=function(e,t,n,i){A(!!e,"must specify image data");var a=0|t,s=0|n,u=0|i,l=B();return w(l,r),l.width=0,l.height=0,O(l,e),l.width=l.width||(r.width>>u)-a,l.height=l.height||(r.height>>u)-s,A(r.type===l.type&&r.format===l.format&&r.internalformat===l.internalformat,"incompatible format for texture.subimage"),A(a>=0&&s>=0&&a+l.width<=r.width&&s+l.height<=r.height,"texture.subimage write out of bounds"),A(r.mipmask&1<<u,"missing mipmap data"),A(l.data||l.element||l.needsCopy,"missing image data"),re(r),P(l,ge,a,s,u),ie(),D(l),o},o.resize=function(e,t){var i=0|e,a=0|t||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,re(r);for(var s=0;r.mipmask>>s;++s){var u=i>>s,c=a>>s;if(!u||!c)break;n.texImage2D(ge,s,r.format,u,c,0,r.format,r.type,null)}return ie(),l.profile&&(r.stats.size=ft(r.internalformat,r.type,i,a,!1,!1)),o},o._reglType="texture2d",o._texture=r,l.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o},createCube:function(e,t,r,o,s,c){var f=new ne(34067);J[f.id]=f,u.cubeCount++;var h=new Array(6);function p(e,t,n,r,o,s){var u,c=f.texInfo;for(q.call(c),u=0;u<6;++u)h[u]=Z();if("number"!=typeof e&&e)if("object"===a(e))if(t)G(h[0],e),G(h[1],t),G(h[2],n),G(h[3],r),G(h[4],o),G(h[5],s);else if(K(c,e),M(f,e),"faces"in e){var d=e.faces;for(A(Array.isArray(d)&&6===d.length,"cube faces must be a length 6 array"),u=0;u<6;++u)A("object"===a(d[u])&&!!d[u],"invalid input for cube map face"),w(h[u],f),G(h[u],d[u])}else for(u=0;u<6;++u)G(h[u],e);else A.raise("invalid arguments to cube map");else{var v=0|e||1;for(u=0;u<6;++u)z(h[u],v,v)}for(w(f,h[0]),i.npotTextureCube||A(ve(f.width)&&ve(f.height),"your browser does not support non power or two texture dimensions"),c.genMipmaps?f.mipmask=(h[0].width<<1)-1:f.mipmask=h[0].mipmask,A.textureCube(f,c,h,i),f.internalformat=h[0].internalformat,p.width=h[0].width,p.height=h[0].height,re(f),u=0;u<6;++u)V(h[u],me+u);for(Q(c,34067),ie(),l.profile&&(f.stats.size=ft(f.internalformat,f.type,p.width,p.height,c.genMipmaps,!0)),p.format=b[f.internalformat],p.type=x[f.type],p.mag=E[c.magFilter],p.min=T[c.minFilter],p.wrapS=S[c.wrapS],p.wrapT=S[c.wrapT],u=0;u<6;++u)Y(h[u]);return p}return p(e,t,r,o,s,c),p.subimage=function(e,t,n,r,i){A(!!t,"must specify image data"),A("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=B();return w(u,f),u.width=0,u.height=0,O(u,t),u.width=u.width||(f.width>>s)-o,u.height=u.height||(f.height>>s)-a,A(f.type===u.type&&f.format===u.format&&f.internalformat===u.internalformat,"incompatible format for texture.subimage"),A(o>=0&&a>=0&&o+u.width<=f.width&&a+u.height<=f.height,"texture.subimage write out of bounds"),A(f.mipmask&1<<s,"missing mipmap data"),A(u.data||u.element||u.needsCopy,"missing image data"),re(f),P(u,me+e,o,a,s),ie(),D(u),p},p.resize=function(e){var t=0|e;if(t!==f.width){p.width=f.width=t,p.height=f.height=t,re(f);for(var r=0;r<6;++r)for(var i=0;f.mipmask>>i;++i)n.texImage2D(me+r,i,f.format,t>>i,t>>i,0,f.format,f.type,null);return ie(),l.profile&&(f.stats.size=ft(f.internalformat,f.type,p.width,p.height,!1,!0)),p}},p._reglType="textureCube",p._texture=f,l.profile&&(p.stats=f.stats),p.destroy=function(){f.decRef()},p},clear:function(){for(var e=0;e<ee;++e)n.activeTexture(Ve+e),n.bindTexture(ge,null),te[e]=null;W(J).forEach(oe),u.cubeCount=0,u.textureCount=0},getTexture:function(e){return null},restore:function(){for(var e=0;e<ee;++e){var t=te[e];t&&(t.bindCount=0,t.unit=-1,te[e]=null)}W(J).forEach((function(e){e.texture=n.createTexture(),n.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(e.target===ge)n.texImage2D(ge,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)n.texImage2D(me+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);Q(e.texInfo,e.target)}))}}}tt[32854]=2,tt[32855]=2,tt[36194]=2,tt[34041]=4,tt[33776]=.5,tt[33777]=.5,tt[33778]=1,tt[33779]=1,tt[35986]=.5,tt[35987]=1,tt[34798]=1,tt[35840]=.5,tt[35841]=.25,tt[35842]=.5,tt[35843]=.25,tt[36196]=.5;var pt=36161,dt=32854,vt=[];function gt(e,t,n){return vt[e]*t*n}vt[32854]=2,vt[32855]=2,vt[36194]=2,vt[33189]=2,vt[36168]=1,vt[34041]=4,vt[35907]=4,vt[34836]=16,vt[34842]=8,vt[34843]=6;var mt=36160,yt=36161,_t=3553,bt=34069,xt=[6407,6408],Et=[];Et[6408]=4,Et[6407]=3;var Tt=[];Tt[5121]=1,Tt[5126]=4,Tt[36193]=2;var At=[32854,32855,36194,35907,34842,34843,34836],St={};function Ct(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.offset=0,this.stride=0,this.divisor=0}St[36053]="complete",St[36054]="incomplete attachment",St[36057]="incomplete dimensions",St[36055]="incomplete, missing attachment",St[36061]="unsupported";var Rt=5121,wt=5126;function Mt(t,n,r,i,o,a,s){function u(u){var l;null===n.next?(A(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),l=Rt):(A(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),l=n.next.colorAttachments[0].texture._texture.type,a.oes_texture_float?(A(l===Rt||l===wt,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),l===wt&&A(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):A(l===Rt,"Reading from a framebuffer is only allowed for the type 'uint8'"));var c=0,f=0,h=i.framebufferWidth,p=i.framebufferHeight,d=null;e(u)?d=u:u&&(A.type(u,"object","invalid arguments to regl.read()"),c=0|u.x,f=0|u.y,A(c>=0&&c<i.framebufferWidth,"invalid x offset for regl.read"),A(f>=0&&f<i.framebufferHeight,"invalid y offset for regl.read"),h=0|(u.width||i.framebufferWidth-c),p=0|(u.height||i.framebufferHeight-f),d=u.data||null),d&&(l===Rt?A(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):l===wt&&A(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),A(h>0&&h+c<=i.framebufferWidth,"invalid width for read pixels"),A(p>0&&p+f<=i.framebufferHeight,"invalid height for read pixels"),r();var v=h*p*4;return d||(l===Rt?d=new Uint8Array(v):l===wt&&(d=d||new Float32Array(v))),A.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),A(d.byteLength>=v,"data buffer for regl.read() too small"),t.pixelStorei(3333,4),t.readPixels(c,f,h,p,6408,l,d),d}return function(e){return e&&"framebuffer"in e?function(e){var t;return n.setFBO({framebuffer:e.framebuffer},(function(){t=u(e)})),t}(e):u(e)}}function kt(e){return Array.prototype.slice.call(e)}function Lt(e){return kt(e).join("")}var Ot="xyzw".split(""),It="dither",Pt="blend.enable",Nt="blend.color",Bt="blend.equation",Dt="blend.func",Ut="depth.enable",Ft="depth.func",zt="depth.range",Gt="depth.mask",Vt="colorMask",jt="cull.enable",Ht="cull.face",Wt="frontFace",Xt="lineWidth",Zt="polygonOffset.enable",Yt="polygonOffset.offset",qt="sample.alpha",Kt="sample.enable",Qt="sample.coverage",$t="stencil.enable",Jt="stencil.mask",en="stencil.func",tn="stencil.opFront",nn="stencil.opBack",rn="scissor.enable",on="scissor.box",an="viewport",sn="profile",un="framebuffer",ln="vert",cn="frag",fn="elements",hn="primitive",pn="count",dn="offset",vn="instances",gn="vao",mn="Width",yn="Height",_n=un+mn,bn=un+yn,xn=an+mn,En=an+yn,Tn="drawingBuffer",An=Tn+mn,Sn=Tn+yn,Cn=[Dt,Bt,en,tn,nn,Qt,an,on,Yt],Rn=34962,wn=5126,Mn=35664,kn=35665,Ln=35666,On=5124,In=35667,Pn=35668,Nn=35669,Bn=35670,Dn=35671,Un=35672,Fn=35673,zn=35674,Gn=35675,Vn=35676,jn=35678,Hn=35680,Wn=1028,Xn=1029,Zn=2305,Yn=7680,qn={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Kn=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Qn={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},$n={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Jn={frag:35632,vert:35633},er={cw:2304,ccw:Zn};function tr(t){return Array.isArray(t)||e(t)||H(t)}function nr(e){return e.sort((function(e,t){return e===an?-1:t===an?1:e<t?-1:1}))}function rr(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function ir(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function or(e){return new rr(!1,!1,!1,e)}function ar(e,t){var n=e.type;if(0===n){var r=e.data.length;return new rr(!0,r>=1,r>=2,t)}if(4===n){var i=e.data;return new rr(i.thisDep,i.contextDep,i.propDep,t)}return new rr(3===n,2===n,1===n,t)}var sr=new rr(!1,!1,!1,(function(){}));function ur(e,n,r,i,o,s,u,l,c,f,h,p,d,v,g){var m=f.Record,y={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(y.min=32775,y.max=32776);var _=r.angle_instanced_arrays,b=r.webgl_draw_buffers,x={dirty:!0,profile:g.profile},E={},T=[],S={},C={};function R(e){return e.replace(".","_")}function w(e,t,n){var r=R(e);T.push(e),E[r]=x[r]=!!n,S[r]=t}function M(e,t,n){var r=R(e);T.push(e),Array.isArray(n)?(x[r]=n.slice(),E[r]=n.slice()):x[r]=E[r]=n,C[r]=t}w(It,3024),w(Pt,3042),M(Nt,"blendColor",[0,0,0,0]),M(Bt,"blendEquationSeparate",[32774,32774]),M(Dt,"blendFuncSeparate",[1,0,1,0]),w(Ut,2929,!0),M(Ft,"depthFunc",513),M(zt,"depthRange",[0,1]),M(Gt,"depthMask",!0),M(Vt,Vt,[!0,!0,!0,!0]),w(jt,2884),M(Ht,"cullFace",Xn),M(Wt,Wt,Zn),M(Xt,Xt,1),w(Zt,32823),M(Yt,"polygonOffset",[0,0]),w(qt,32926),w(Kt,32928),M(Qt,"sampleCoverage",[1,!1]),w($t,2960),M(Jt,"stencilMask",-1),M(en,"stencilFunc",[519,0,-1]),M(tn,"stencilOpSeparate",[Wn,Yn,Yn,Yn]),M(nn,"stencilOpSeparate",[Xn,Yn,Yn,Yn]),w(rn,3089),M(on,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),M(an,an,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var L={gl:e,context:d,strings:n,next:E,current:x,draw:p,elements:s,buffer:o,shader:h,attributes:f.state,vao:f,uniforms:c,framebuffer:l,extensions:r,timer:v,isBufferArgs:tr},O={primTypes:ae,compareFuncs:Qn,blendFuncs:qn,blendEquations:y,stencilOps:$n,glTypes:K,orientationType:er};A.optional((function(){L.isArrayLike=de})),b&&(O.backBuffer=[Xn],O.drawBuffer=B(i.maxDrawbuffers,(function(e){return 0===e?[0]:B(e,(function(e){return 36064+e}))})));var I=0;function P(){var e=function(){var e=0,n=[],r=[];function i(){var n=[],r=[];return t((function(){n.push.apply(n,kt(arguments))}),{def:function(){var t="v"+e++;return r.push(t),arguments.length>0&&(n.push(t,"="),n.push.apply(n,kt(arguments)),n.push(";")),t},toString:function(){return Lt([r.length>0?"var "+r.join(",")+";":"",Lt(n)])}})}function o(){var e=i(),n=i(),r=e.toString,o=n.toString;function a(t,r){n(t,r,"=",e.def(t,r),";")}return t((function(){e.apply(e,kt(arguments))}),{def:e.def,entry:e,exit:n,save:a,set:function(t,n,r){a(t,n),e(t,n,"=",r,";")},toString:function(){return r()+o()}})}var a=i(),s={};return{global:a,link:function(t){for(var i=0;i<r.length;++i)if(r[i]===t)return n[i];var o="g"+e++;return n.push(o),r.push(t),o},block:i,proc:function(e,n){var r=[];function i(){var e="a"+r.length;return r.push(e),e}n=n||0;for(var a=0;a<n;++a)i();var u=o(),l=u.toString;return s[e]=t(u,{arg:i,toString:function(){return Lt(["function(",r.join(),"){",l(),"}"])}})},scope:o,cond:function(){var e=Lt(arguments),n=o(),r=o(),i=n.toString,a=r.toString;return t(n,{then:function(){return n.apply(n,kt(arguments)),this},else:function(){return r.apply(r,kt(arguments)),this},toString:function(){var t=a();return t&&(t="else{"+t+"}"),Lt(["if(",e,"){",i(),"}",t])}})},compile:function(){var e=['"use strict";',a,"return {"];Object.keys(s).forEach((function(t){e.push('"',t,'":',s[t].toString(),",")})),e.push("}");var t=Lt(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(t)).apply(null,r)}}}(),r=e.link,i=e.global;e.id=I++,e.batchId="0";var o=r(L),a=e.shared={props:"a0"};Object.keys(L).forEach((function(e){a[e]=i.def(o,".",e)})),A.optional((function(){e.CHECK=r(A),e.commandStr=A.guessCommand(),e.command=r(e.commandStr),e.assert=function(e,t,n){e("if(!(",t,"))",this.CHECK,".commandRaise(",r(n),",",this.command,");")},O.invalidBlendCombinations=Kn}));var s=e.next={},u=e.current={};Object.keys(C).forEach((function(e){Array.isArray(x[e])&&(s[e]=i.def(a.next,".",e),u[e]=i.def(a.current,".",e))}));var l=e.constants={};Object.keys(O).forEach((function(e){l[e]=i.def(JSON.stringify(O[e]))})),e.invoke=function(t,n){switch(n.type){case 0:var i=["this",a.context,a.props,e.batchId];return t.def(r(n.data),".call(",i.slice(0,Math.max(n.data.length+1,4)),")");case 1:return t.def(a.props,n.data);case 2:return t.def(a.context,n.data);case 3:return t.def("this",n.data);case 4:return n.data.append(e,t),n.data.ref}},e.attribCache={};var c={};return e.scopeAttrib=function(e){var t=n.id(e);if(t in c)return c[t];var i=f.scope[t];return i||(i=f.scope[t]=new m),c[t]=r(i)},e}function N(e,t,u,c,p){var d=e.static,v=e.dynamic;A.optional((function(){var e=[un,ln,cn,fn,hn,dn,pn,vn,sn,gn].concat(T);function t(t){Object.keys(t).forEach((function(t){A.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',p.commandStr)}))}t(d),t(v)}));var g=function(e,t){var n=e.static;if("string"==typeof n[cn]&&"string"==typeof n[ln]){if(Object.keys(t.dynamic).length>0)return null;var r=t.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)A("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}(e,t),b=function(e,t){var n=e.static,r=e.dynamic;if(un in n){var i=n[un];return i?(i=l.getFramebuffer(i),A.command(i,"invalid framebuffer object"),or((function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,".next",n);var o=r.context;return t.set(o,"."+_n,n+".width"),t.set(o,"."+bn,n+".height"),n}))):or((function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+_n,r+"."+An),t.set(r,"."+bn,r+"."+Sn),"null"}))}if(un in r){var o=r[un];return ar(o,(function(e,t){var n=e.invoke(t,o),r=e.shared,i=r.framebuffer,a=t.def(i,".getFramebuffer(",n,")");A.optional((function(){e.assert(t,"!"+n+"||"+a,"invalid framebuffer object")})),t.set(i,".next",a);var s=r.context;return t.set(s,"."+_n,a+"?"+a+".width:"+s+"."+An),t.set(s,"."+bn,a+"?"+a+".height:"+s+"."+Sn),a}))}return null}(e),x=function(e,t,n){var r=e.static,i=e.dynamic;function o(e){if(e in r){var o=r[e];A.commandType(o,"object","invalid "+e,n.commandStr);var a,s,u=!0,l=0|o.x,c=0|o.y;return"width"in o?(a=0|o.width,A.command(a>=0,"invalid "+e,n.commandStr)):u=!1,"height"in o?(s=0|o.height,A.command(s>=0,"invalid "+e,n.commandStr)):u=!1,new rr(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,(function(e,t){var n=e.shared.context,r=a;"width"in o||(r=t.def(n,".",_n,"-",l));var i=s;return"height"in o||(i=t.def(n,".",bn,"-",c)),[l,c,r,i]}))}if(e in i){var f=i[e],h=ar(f,(function(t,n){var r=t.invoke(n,f);A.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}));var i=t.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",_n,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",bn,"-",a,")");return A.optional((function(){t.assert(n,s+">=0&&"+u+">=0","invalid "+e)})),[o,a,s,u]}));return t&&(h.thisDep=h.thisDep||t.thisDep,h.contextDep=h.contextDep||t.contextDep,h.propDep=h.propDep||t.propDep),h}return t?new rr(t.thisDep,t.contextDep,t.propDep,(function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",_n),t.def(n,".",bn)]})):null}var a=o(an);if(a){var s=a;a=new rr(a.thisDep,a.contextDep,a.propDep,(function(e,t){var n=s.append(e,t),r=e.shared.context;return t.set(r,"."+xn,n[2]),t.set(r,"."+En,n[3]),n}))}return{viewport:a,scissor_box:o(on)}}(e,b,p),E=function(e,t){var n=e.static,r=e.dynamic,i=function(){if(fn in n){var e=n[fn];tr(e)?e=s.getElements(s.create(e,!0)):e&&(e=s.getElements(e),A.command(e,"invalid elements",t.commandStr));var i=or((function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null}));return i.value=e,i}if(fn in r){var o=r[fn];return ar(o,(function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,a=e.invoke(t,o),s=t.def("null"),u=t.def(r,"(",a,")"),l=e.cond(u).then(s,"=",i,".createStream(",a,");").else(s,"=",i,".getElements(",a,");");return A.optional((function(){e.assert(l.else,"!"+a+"||"+s,"invalid elements")})),t.entry(l),t.exit(e.cond(u).then(i,".destroyStream(",s,");")),e.ELEMENTS=s,s}))}return null}();function o(e,o){if(e in n){var a=0|n[e];return A.command(!o||a>=0,"invalid "+e,t.commandStr),or((function(e,t){return o&&(e.OFFSET=a),a}))}if(e in r){var s=r[e];return ar(s,(function(t,n){var r=t.invoke(n,s);return o&&(t.OFFSET=r,A.optional((function(){t.assert(n,r+">=0","invalid "+e)}))),r}))}return o&&i?or((function(e,t){return e.OFFSET="0",0})):null}var a=o(dn,!0);return{elements:i,primitive:function(){if(hn in n){var e=n[hn];return A.commandParameter(e,ae,"invalid primitve",t.commandStr),or((function(t,n){return ae[e]}))}if(hn in r){var o=r[hn];return ar(o,(function(e,t){var n=e.constants.primTypes,r=e.invoke(t,o);return A.optional((function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys(ae))})),t.def(n,"[",r,"]")}))}return i?ir(i)?i.value?or((function(e,t){return t.def(e.ELEMENTS,".primType")})):or((function(){return 4})):new rr(i.thisDep,i.contextDep,i.propDep,(function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",4)})):null}(),count:function(){if(pn in n){var e=0|n[pn];return A.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),or((function(){return e}))}if(pn in r){var o=r[pn];return ar(o,(function(e,t){var n=e.invoke(t,o);return A.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(i){if(ir(i)){if(i)return a?new rr(a.thisDep,a.contextDep,a.propDep,(function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return A.optional((function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")})),n})):or((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var s=or((function(){return-1}));return A.optional((function(){s.MISSING=!0})),s}var u=new rr(i.thisDep||a.thisDep,i.contextDep||a.contextDep,i.propDep||a.propDep,(function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")}));return A.optional((function(){u.DYNAMIC=!0})),u}return null}(),instances:o(vn,!1),offset:a}}(e,p),S=function(e,t){var n=e.static,r=e.dynamic,o={};return T.forEach((function(e){var s=R(e);function u(t,i){if(e in n){var a=t(n[e]);o[s]=or((function(){return a}))}else if(e in r){var u=r[e];o[s]=ar(u,(function(e,t){return i(e,t,e.invoke(t,u))}))}}switch(e){case jt:case Pt:case It:case $t:case Ut:case rn:case Zt:case qt:case Kt:case Gt:return u((function(n){return A.commandType(n,"boolean",e,t.commandStr),n}),(function(t,n,r){return A.optional((function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)})),r}));case Ft:return u((function(n){return A.commandParameter(n,Qn,"invalid "+e,t.commandStr),Qn[n]}),(function(t,n,r){var i=t.constants.compareFuncs;return A.optional((function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys(Qn))})),n.def(i,"[",r,"]")}));case zt:return u((function(e){return A.command(de(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,n){return A.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]}));case Dt:return u((function(e){A.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,o="dstAlpha"in e?e.dstAlpha:e.dst;return A.commandParameter(n,qn,s+".srcRGB",t.commandStr),A.commandParameter(r,qn,s+".srcAlpha",t.commandStr),A.commandParameter(i,qn,s+".dstRGB",t.commandStr),A.commandParameter(o,qn,s+".dstAlpha",t.commandStr),A.command(-1===Kn.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",t.commandStr),[qn[n],qn[i],qn[r],qn[o]]}),(function(t,n,r){var i=t.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return A.optional((function(){t.assert(n,s+" in "+i,"invalid "+e+"."+o+a+", must be one of "+Object.keys(qn))})),s}A.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");A.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",a,"]"),l=n.def(i,"[",o("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),l,n.def(i,"[",o("dst","Alpha"),"]")]}));case Bt:return u((function(n){return"string"==typeof n?(A.commandParameter(n,y,"invalid "+e,t.commandStr),[y[n],y[n]]):"object"===a(n)?(A.commandParameter(n.rgb,y,e+".rgb",t.commandStr),A.commandParameter(n.alpha,y,e+".alpha",t.commandStr),[y[n.rgb],y[n.alpha]]):void A.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,n,r){var i=t.constants.blendEquations,o=n.def(),a=n.def(),s=t.cond("typeof ",r,'==="string"');return A.optional((function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(y))}n(s.then,e,r),t.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(s.else,e+".rgb",r+".rgb"),n(s.else,e+".alpha",r+".alpha")})),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]}));case Nt:return u((function(e){return A.command(de(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),B(4,(function(t){return+e[t]}))}),(function(e,t,n){return A.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),B(4,(function(e){return t.def("+",n,"[",e,"]")}))}));case Jt:return u((function(e){return A.commandType(e,"number",s,t.commandStr),0|e}),(function(e,t,n){return A.optional((function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")})),t.def(n,"|0")}));case en:return u((function(n){A.commandType(n,"object",s,t.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return A.commandParameter(r,Qn,e+".cmp",t.commandStr),A.commandType(i,"number",e+".ref",t.commandStr),A.commandType(o,"number",e+".mask",t.commandStr),[Qn[r],i,o]}),(function(e,t,n){var r=e.constants.compareFuncs;return A.optional((function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Yn),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case tn:case nn:return u((function(n){A.commandType(n,"object",s,t.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return A.commandParameter(r,$n,e+".fail",t.commandStr),A.commandParameter(i,$n,e+".zfail",t.commandStr),A.commandParameter(o,$n,e+".zpass",t.commandStr),[e===nn?Xn:Wn,$n[r],$n[i],$n[o]]}),(function(t,n,r){var i=t.constants.stencilOps;function o(o){return A.optional((function(){t.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+e+"."+o+", must be one of "+Object.keys($n))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",Yn)}return A.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[e===nn?Xn:Wn,o("fail"),o("zfail"),o("zpass")]}));case Yt:return u((function(e){A.commandType(e,"object",s,t.commandStr);var n=0|e.factor,r=0|e.units;return A.commandType(n,"number",s+".factor",t.commandStr),A.commandType(r,"number",s+".units",t.commandStr),[n,r]}),(function(t,n,r){return A.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case Ht:return u((function(e){var n=0;return"front"===e?n=Wn:"back"===e&&(n=Xn),A.command(!!n,s,t.commandStr),n}),(function(e,t,n){return A.optional((function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),t.def(n,'==="front"?',Wn,":",Xn)}));case Xt:return u((function(e){return A.command("number"==typeof e&&e>=i.lineWidthDims[0]&&e<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],t.commandStr),e}),(function(e,t,n){return A.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case Wt:return u((function(e){return A.commandParameter(e,er,s,t.commandStr),er[e]}),(function(e,t,n){return A.optional((function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(n+'==="cw"?2304:'+Zn)}));case Vt:return u((function(e){return A.command(de(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,n){return A.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),B(4,(function(e){return"!!"+n+"["+e+"]"}))}));case Qt:return u((function(e){A.command("object"===a(e)&&e,s,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return A.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]}),(function(e,t,n){return A.optional((function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]}))}})),o}(e,p),C=function(e,t,r){var i=e.static,o=e.dynamic;function a(e){if(e in i){var t=n.id(i[e]);A.optional((function(){h.shader(Jn[e],t,A.guessCommand())}));var r=or((function(){return t}));return r.id=t,r}if(e in o){var a=o[e];return ar(a,(function(t,n){var r=t.invoke(n,a),i=n.def(t.shared.strings,".id(",r,")");return A.optional((function(){n(t.shared.shader,".shader(",Jn[e],",",i,",",t.command,");")})),i}))}return null}var s,u=a(cn),l=a(ln),c=null;return ir(u)&&ir(l)?(c=h.program(l.id,u.id,null,r),s=or((function(e,t){return e.link(c)}))):s=new rr(u&&u.thisDep||l&&l.thisDep,u&&u.contextDep||l&&l.contextDep,u&&u.propDep||l&&l.propDep,(function(e,t){var n,r=e.shared.shader;n=u?u.append(e,t):t.def(r,".",cn);var i=r+".program("+(l?l.append(e,t):t.def(r,".",ln))+","+n;return A.optional((function(){i+=","+e.command})),t.def(i+")")})),{frag:u,vert:l,progVar:s,program:c}}(e,0,g);function w(e){var t=x[e];t&&(S[e]=t)}w(an),w(R(on));var M=Object.keys(S).length>0,k={framebuffer:b,draw:E,shader:C,state:S,dirty:M,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(k.profile=function(e){var t,n=e.static,r=e.dynamic;if(sn in n){var i=!!n[sn];(t=or((function(e,t){return i}))).enable=i}else if(sn in r){var o=r[sn];t=ar(o,(function(e,t){return e.invoke(t,o)}))}return t}(e),k.uniforms=function(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach((function(e){var r,o=n[e];if("number"==typeof o||"boolean"==typeof o)r=or((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=or((function(e){return e.link(o)})):"framebuffer"===a||"framebufferCube"===a?(A.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=or((function(e){return e.link(o.color[0])}))):A.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else de(o)?r=or((function(t){return t.global.def("[",B(o.length,(function(n){return A.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+e,t.commandStr),o[n]})),"]")})):A.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=o,i[e]=r})),Object.keys(r).forEach((function(e){var t=r[e];i[e]=ar(t,(function(e,n){return e.invoke(n,t)}))})),i}(u,p),k.drawVAO=k.scopeVAO=function(e,t){var n=e.static,r=e.dynamic;if(gn in n){var i=n[gn];return null!==i&&null===f.getVAO(i)&&(i=f.createVAO(i)),or((function(e){return e.link(f.getVAO(i))}))}if(gn in r){var o=r[gn];return ar(o,(function(e,t){var n=e.invoke(t,o);return t.def(e.shared.vao+".getVAO("+n+")")}))}return null}(e),!k.drawVAO&&C.program&&!g&&r.angle_instanced_arrays){var L=!0,O=C.program.attributes.map((function(e){var n=t.static[e];return L=L&&!!n,n}));if(L&&O.length>0){var I=f.getVAO(f.createVAO(O));k.drawVAO=new rr(null,null,null,(function(e,t){return e.link(I)})),k.useVAO=!0}}return g?k.useVAO=!0:k.attributes=function(e,t){var r=e.static,i=e.dynamic,s={};return Object.keys(r).forEach((function(e){var i=r[e],u=n.id(e),l=new m;if(tr(i))l.state=1,l.buffer=o.getBuffer(o.create(i,Rn,!1,!0)),l.type=0;else{var c=o.getBuffer(i);if(c)l.state=1,l.buffer=c,l.type=0;else if(A.command("object"===a(i)&&i,"invalid data for attribute "+e,t.commandStr),"constant"in i){var f=i.constant;l.buffer="null",l.state=2,"number"==typeof f?l.x=f:(A.command(de(f)&&f.length>0&&f.length<=4,"invalid constant for attribute "+e,t.commandStr),Ot.forEach((function(e,t){t<f.length&&(l[e]=f[t])})))}else{c=tr(i.buffer)?o.getBuffer(o.create(i.buffer,Rn,!1,!0)):o.getBuffer(i.buffer),A.command(!!c,'missing buffer for attribute "'+e+'"',t.commandStr);var h=0|i.offset;A.command(h>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var p=0|i.stride;A.command(p>=0&&p<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var d=0|i.size;A.command(!("size"in i)||d>0&&d<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var v=!!i.normalized,g=0;"type"in i&&(A.commandParameter(i.type,K,"invalid type for attribute "+e,t.commandStr),g=K[i.type]);var y=0|i.divisor;"divisor"in i&&(A.command(0===y||_,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),A.command(y>=0,'invalid divisor for attribute "'+e+'"',t.commandStr)),A.optional((function(){var n=t.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(t){A.command(r.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",n)}))})),l.buffer=c,l.state=1,l.size=d,l.normalized=v,l.type=g||c.dtype,l.offset=h,l.stride=p,l.divisor=y}}s[e]=or((function(e,t){var n=e.attribCache;if(u in n)return n[u];var r={isStream:!1};return Object.keys(l).forEach((function(e){r[e]=l[e]})),l.buffer&&(r.buffer=e.link(l.buffer),r.type=r.type||r.buffer+".dtype"),n[u]=r,r}))})),Object.keys(i).forEach((function(e){var t=i[e];s[e]=ar(t,(function(n,r){var i=n.invoke(r,t),o=n.shared,a=n.constants,s=o.isBufferArgs,u=o.buffer;A.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')}));var l={isStream:r.def(!1)},c=new m;c.state=1,Object.keys(c).forEach((function(e){l[e]=r.def(""+c[e])}));var f=l.buffer,h=l.type;function p(e){r(l[e],"=",i,".",e,"|0;")}return r("if(",s,"(",i,")){",l.isStream,"=true;",f,"=",u,".createStream(",Rn,",",i,");",h,"=",f,".dtype;","}else{",f,"=",u,".getBuffer(",i,");","if(",f,"){",h,"=",f,".dtype;",'}else if("constant" in ',i,"){",l.state,"=",2,";","if(typeof "+i+'.constant === "number"){',l[Ot[0]],"=",i,".constant;",Ot.slice(1).map((function(e){return l[e]})).join("="),"=0;","}else{",Ot.map((function(e,t){return l[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",f,"=",u,".createStream(",Rn,",",i,".buffer);","}else{",f,"=",u,".getBuffer(",i,".buffer);","}",h,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",f,".dtype;",l.normalized,"=!!",i,".normalized;"),p("size"),p("offset"),p("stride"),p("divisor"),r("}}"),r.exit("if(",l.isStream,"){",u,".destroyStream(",f,");","}"),l}))})),s}(t,p),k.context=function(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach((function(e){var n=t[e];r[e]=or((function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)}))})),Object.keys(n).forEach((function(e){var t=n[e];r[e]=ar(t,(function(e,n){return e.invoke(n,t)}))})),r}(c),k}function D(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach((function(o){t.save(r,"."+o);var a=n[o];i(r,".",o,"=",a.append(e,t),";")})),t(i)}function U(e,t,n,r){var i,o=e.shared,a=o.gl,s=o.framebuffer;b&&(i=t.def(o.extensions,".webgl_draw_buffers"));var u,l=e.constants,c=l.drawBuffer,f=l.backBuffer;u=n?n.append(e,t):t.def(s,".next"),r||t("if(",u,"!==",s,".cur){"),t("if(",u,"){",a,".bindFramebuffer(",36160,",",u,".framebuffer);"),b&&t(i,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",36160,",null);"),b&&t(i,".drawBuffersWEBGL(",f,");"),t("}",s,".cur=",u,";"),r||t("}")}function F(e,t,n){var r=e.shared,i=r.gl,o=e.current,a=e.next,s=r.current,u=r.next,l=e.cond(s,".dirty");T.forEach((function(t){var r,c,f=R(t);if(!(f in n.state))if(f in a){r=a[f],c=o[f];var h=B(x[f].length,(function(e){return l.def(r,"[",e,"]")}));l(e.cond(h.map((function(e,t){return e+"!=="+c+"["+t+"]"})).join("||")).then(i,".",C[f],"(",h,");",h.map((function(e,t){return c+"["+t+"]="+e})).join(";"),";"))}else{r=l.def(u,".",f);var p=e.cond(r,"!==",s,".",f);l(p),f in S?p(e.cond(r).then(i,".enable(",S[f],");").else(i,".disable(",S[f],");"),s,".",f,"=",r,";"):p(i,".",C[f],"(",r,");",s,".",f,"=",r,";")}})),0===Object.keys(n.state).length&&l(s,".dirty=false;"),t(l)}function z(e,t,n,r){var i=e.shared,o=e.current,a=i.current,s=i.gl;nr(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var l=u.append(e,t);if(S[i]){var c=S[i];ir(u)?t(s,l?".enable(":".disable(",c,");"):t(e.cond(l).then(s,".enable(",c,");").else(s,".disable(",c,");")),t(a,".",i,"=",l,";")}else if(de(l)){var f=o[i];t(s,".",C[i],"(",l,");",l.map((function(e,t){return f+"["+t+"]="+e})).join(";"),";")}else t(s,".",C[i],"(",l,");",a,".",i,"=",l,";")}}))}function G(e,t){_&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function V(e,t,n,r,i){var o,a,s,u=e.shared,l=e.stats,c=u.current,f=u.timer,h=n.profile;function p(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function d(e){e(o=t.def(),"=",p(),";"),"string"==typeof i?e(l,".count+=",i,";"):e(l,".count++;"),v&&(r?e(a=t.def(),"=",f,".getNumPendingQueries();"):e(f,".beginQuery(",l,");"))}function g(e){e(l,".cpuTime+=",p(),"-",o,";"),v&&(r?e(f,".pushScopeStats(",a,",",f,".getNumPendingQueries(),",l,");"):e(f,".endQuery();"))}function m(e){var n=t.def(c,".profile");t(c,".profile=",e,";"),t.exit(c,".profile=",n,";")}if(h){if(ir(h))return void(h.enable?(d(t),g(t.exit),m("true")):m("false"));m(s=h.append(e,t))}else s=t.def(c,".profile");var y=e.block();d(y),t("if(",s,"){",y,"}");var _=e.block();g(_),t.exit("if(",s,"){",_,"}")}function j(e,t,n,r,i){var o=e.shared;r.forEach((function(r){var a,s=r.name,u=n.attributes[s];if(u){if(!i(u))return;a=u.append(e,t)}else{if(!i(sr))return;var l=e.scopeAttrib(s);A.optional((function(){e.assert(t,l+".state","missing attribute "+s)})),a={},Object.keys(new m).forEach((function(e){a[e]=t.def(l,".",e)}))}!function(n,r,i){var a=o.gl,s=t.def(n,".location"),u=t.def(o.attributes,"[",s,"]"),l=i.state,c=i.buffer,f=[i.x,i.y,i.z,i.w],h=["buffer","normalized","offset","stride"];function p(){t("if(!",u,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",u,".type!==",o,"||",u,".size!==",n,"||",h.map((function(e){return u+"."+e+"!=="+i[e]})).join("||"),"){",a,".bindBuffer(",Rn,",",c,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",u,".type=",o,";",u,".size=",n,";",h.map((function(e){return u+"."+e+"="+i[e]+";"})).join(""),"}"),_){var l=i.divisor;t("if(",u,".divisor!==",l,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,l],");",u,".divisor=",l,";}")}}function d(){t("if(",u,".buffer){",a,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",Ot.map((function(e,t){return u+"."+e+"!=="+f[t]})).join("||"),"){",a,".vertexAttrib4f(",s,",",f,");",Ot.map((function(e,t){return u+"."+e+"="+f[t]+";"})).join(""),"}")}1===l?p():2===l?d():(t("if(",l,"===",1,"){"),p(),t("}else{"),d(),t("}"))}(e.link(r),function(e){switch(e){case Mn:case In:case Dn:return 2;case kn:case Pn:case Un:return 3;case Ln:case Nn:case Fn:return 4;default:return 1}}(r.info.type),a)}))}function H(e,t,r,i,o){for(var a,s=e.shared,u=s.gl,l=0;l<i.length;++l){var c,f=i[l],h=f.name,p=f.info.type,d=r.uniforms[h],v=e.link(f)+".location";if(d){if(!o(d))continue;if(ir(d)){var g=d.value;if(A.command(null!=g,'missing uniform "'+h+'"',e.commandStr),p===jn||p===Hn){A.command("function"==typeof g&&(p===jn&&("texture2d"===g._reglType||"framebuffer"===g._reglType)||p===Hn&&("textureCube"===g._reglType||"framebufferCube"===g._reglType)),"invalid texture for uniform "+h,e.commandStr);var m=e.link(g._texture||g.color[0]._texture);t(u,".uniform1i(",v,",",m+".bind());"),t.exit(m,".unbind();")}else if(p===zn||p===Gn||p===Vn){A.optional((function(){A.command(de(g),"invalid matrix for uniform "+h,e.commandStr),A.command(p===zn&&4===g.length||p===Gn&&9===g.length||p===Vn&&16===g.length,"invalid length for matrix uniform "+h,e.commandStr)}));var y=e.global.def("new Float32Array(["+Array.prototype.slice.call(g)+"])"),_=2;p===Gn?_=3:p===Vn&&(_=4),t(u,".uniformMatrix",_,"fv(",v,",false,",y,");")}else{switch(p){case wn:A.commandType(g,"number","uniform "+h,e.commandStr),a="1f";break;case Mn:A.command(de(g)&&2===g.length,"uniform "+h,e.commandStr),a="2f";break;case kn:A.command(de(g)&&3===g.length,"uniform "+h,e.commandStr),a="3f";break;case Ln:A.command(de(g)&&4===g.length,"uniform "+h,e.commandStr),a="4f";break;case Bn:A.commandType(g,"boolean","uniform "+h,e.commandStr),a="1i";break;case On:A.commandType(g,"number","uniform "+h,e.commandStr),a="1i";break;case Dn:case In:A.command(de(g)&&2===g.length,"uniform "+h,e.commandStr),a="2i";break;case Un:case Pn:A.command(de(g)&&3===g.length,"uniform "+h,e.commandStr),a="3i";break;case Fn:case Nn:A.command(de(g)&&4===g.length,"uniform "+h,e.commandStr),a="4i"}t(u,".uniform",a,"(",v,",",de(g)?Array.prototype.slice.call(g):g,");")}continue}c=d.append(e,t)}else{if(!o(sr))continue;c=t.def(s.uniforms,"[",n.id(h),"]")}p===jn?t("if(",c,"&&",c,'._reglType==="framebuffer"){',c,"=",c,".color[0];","}"):p===Hn&&t("if(",c,"&&",c,'._reglType==="framebufferCube"){',c,"=",c,".color[0];","}"),A.optional((function(){function n(n,r){e.assert(t,n,'bad data or missing for uniform "'+h+'".  '+r)}function r(e){n("typeof "+c+'==="'+e+'"',"invalid type, expected "+e)}function i(t,r){n(s.isArrayLike+"("+c+")&&"+c+".length==="+t,"invalid vector, should have length "+t,e.commandStr)}function o(t){n("typeof "+c+'==="function"&&'+c+'._reglType==="texture'+(3553===t?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(p){case On:r("number");break;case In:i(2);break;case Pn:i(3);break;case Nn:i(4);break;case wn:r("number");break;case Mn:i(2);break;case kn:i(3);break;case Ln:i(4);break;case Bn:r("boolean");break;case Dn:i(2);break;case Un:i(3);break;case Fn:case zn:i(4);break;case Gn:i(9);break;case Vn:i(16);break;case jn:o(3553);break;case Hn:o(34067)}}));var b=1;switch(p){case jn:case Hn:var x=t.def(c,"._texture");t(u,".uniform1i(",v,",",x,".bind());"),t.exit(x,".unbind();");continue;case On:case Bn:a="1i";break;case In:case Dn:a="2i",b=2;break;case Pn:case Un:a="3i",b=3;break;case Nn:case Fn:a="4i",b=4;break;case wn:a="1f";break;case Mn:a="2f",b=2;break;case kn:a="3f",b=3;break;case Ln:a="4f",b=4;break;case zn:a="Matrix2fv";break;case Gn:a="Matrix3fv";break;case Vn:a="Matrix4fv"}if(t(u,".uniform",a,"(",v,","),"M"===a.charAt(0)){var E=Math.pow(p-zn+2,2),T=e.global.def("new Float32Array(",E,")");t("false,(Array.isArray(",c,")||",c," instanceof Float32Array)?",c,":(",B(E,(function(e){return T+"["+e+"]="+c+"["+e+"]"})),",",T,")")}else t(b>1?B(b,(function(e){return c+"["+e+"]"})):c);t(");")}}function W(e,t,n,r){var i=e.shared,o=i.gl,a=i.draw,s=r.draw,u=function(){var i,u=s.elements,l=t;return u?((u.contextDep&&r.contextDynamic||u.propDep)&&(l=n),i=u.append(e,l)):i=l.def(a,".",fn),i&&l("if("+i+")"+o+".bindBuffer(34963,"+i+".buffer.buffer);"),i}();function l(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(e,n):o.append(e,t):t.def(a,".",i)}var c,f,h=l(hn),p=l(dn),d=function(){var i,o=s.count,u=t;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(e,u),A.optional((function(){o.MISSING&&e.assert(t,"false","missing vertex count"),o.DYNAMIC&&e.assert(u,i+">=0","missing vertex count")}))):(i=u.def(a,".",pn),A.optional((function(){e.assert(u,i+">=0","missing vertex count")}))),i}();if("number"==typeof d){if(0===d)return}else n("if(",d,"){"),n.exit("}");_&&(c=l(vn),f=e.instancing);var v=u+".type",g=s.elements&&ir(s.elements);function m(){function e(){n(f,".drawElementsInstancedANGLE(",[h,d,v,p+"<<(("+v+"-5121)>>1)",c],");")}function t(){n(f,".drawArraysInstancedANGLE(",[h,p,d,c],");")}u?g?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}function y(){function e(){n(o+".drawElements("+[h,d,v,p+"<<(("+v+"-5121)>>1)"]+");")}function t(){n(o+".drawArrays("+[h,p,d]+");")}u?g?e():(n("if(",u,"){"),e(),n("}else{"),t(),n("}")):t()}_&&("number"!=typeof c||c>=0)?"string"==typeof c?(n("if(",c,">0){"),m(),n("}else if(",c,"<0){"),y(),n("}")):m():y()}function X(e,t,n,r,i){var o=P(),a=o.proc("body",i);return A.optional((function(){o.commandStr=t.commandStr,o.command=o.link(t.commandStr)})),_&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),e(o,a,n,r),o.compile().body}function Z(e,t,n,r){G(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,".setVAO(",n.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),j(e,t,n,r.attributes,(function(){return!0}))),H(e,t,n,r.uniforms,(function(){return!0})),W(e,t,t,n)}function Y(e,t,n,r){function i(){return!0}e.batchId="a1",G(e,t),j(e,t,n,r.attributes,i),H(e,t,n,r.uniforms,i),W(e,t,t,n)}function q(e,t,n,r){G(e,t);var i=n.contextDep,o=t.def(),a=t.def();e.shared.props=a,e.batchId=o;var s=e.scope(),u=e.scope();function l(e){return e.contextDep&&i||e.propDep}function c(e){return!l(e)}if(t(s.entry,"for(",o,"=0;",o,"<","a1",";++",o,"){",a,"=","a0","[",o,"];",u,"}",s.exit),n.needsContext&&D(e,u,n.context),n.needsFramebuffer&&U(e,u,n.framebuffer),z(e,u,n.state,l),n.profile&&l(n.profile)&&V(e,u,n,!1,!0),r)n.useVAO?n.drawVAO?l(n.drawVAO)?u(e.shared.vao,".setVAO(",n.drawVAO.append(e,u),");"):s(e.shared.vao,".setVAO(",n.drawVAO.append(e,s),");"):s(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(s(e.shared.vao,".setVAO(null);"),j(e,s,n,r.attributes,c),j(e,u,n,r.attributes,l)),H(e,s,n,r.uniforms,c),H(e,u,n,r.uniforms,l),W(e,s,u,n);else{var f=e.global.def("{}"),h=n.shader.progVar.append(e,u),p=u.def(h,".id"),d=u.def(f,"[",p,"]");u(e.shared.gl,".useProgram(",h,".program);","if(!",d,"){",d,"=",f,"[",p,"]=",e.link((function(t){return X(Y,e,n,t,2)})),"(",h,");}",d,".call(this,a0[",o,"],",o,");")}}function Q(e,t,n){var r=t.static[n];if(r&&function(e){if("object"===a(e)&&!de(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(k.isDynamic(e[t[n]]))return!0;return!1}}(r)){var i=e.global,o=Object.keys(r),s=!1,u=!1,l=!1,c=e.global.def("{}");o.forEach((function(t){var n=r[t];if(k.isDynamic(n)){"function"==typeof n&&(n=r[t]=k.unbox(n));var o=ar(n,null);s=s||o.thisDep,l=l||o.propDep,u=u||o.contextDep}else{switch(i(c,".",t,"="),a(n)){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}})),t.dynamic[n]=new k.DynamicVariable(4,{thisDep:s,contextDep:u,propDep:l,ref:c,append:function(e,t){o.forEach((function(n){var i=r[n];if(k.isDynamic(i)){var o=e.invoke(t,i);t(c,".",n,"=",o,";")}}))}}),delete t.static[n]}}return{next:E,current:x,procs:function(){var e=P(),t=e.proc("poll"),n=e.proc("refresh"),o=e.block();t(o),n(o);var a,s=e.shared,u=s.gl,l=s.next,c=s.current;o(c,".dirty=false;"),U(e,t),U(e,n,null,!0),_&&(a=e.link(_)),r.oes_vertex_array_object&&n(e.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var f=0;f<i.maxAttributes;++f){var h=n.def(s.attributes,"[",f,"]"),p=e.cond(h,".buffer");p.then(u,".enableVertexAttribArray(",f,");",u,".bindBuffer(",Rn,",",h,".buffer.buffer);",u,".vertexAttribPointer(",f,",",h,".size,",h,".type,",h,".normalized,",h,".stride,",h,".offset);").else(u,".disableVertexAttribArray(",f,");",u,".vertexAttrib4f(",f,",",h,".x,",h,".y,",h,".z,",h,".w);",h,".buffer=null;"),n(p),_&&n(a,".vertexAttribDivisorANGLE(",f,",",h,".divisor);")}return n(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(S).forEach((function(r){var i=S[r],a=o.def(l,".",r),s=e.block();s("if(",a,"){",u,".enable(",i,")}else{",u,".disable(",i,")}",c,".",r,"=",a,";"),n(s),t("if(",a,"!==",c,".",r,"){",s,"}")})),Object.keys(C).forEach((function(r){var i,a,s=C[r],f=x[r],h=e.block();if(h(u,".",s,"("),de(f)){var p=f.length;i=e.global.def(l,".",r),a=e.global.def(c,".",r),h(B(p,(function(e){return i+"["+e+"]"})),");",B(p,(function(e){return a+"["+e+"]="+i+"["+e+"];"})).join("")),t("if(",B(p,(function(e){return i+"["+e+"]!=="+a+"["+e+"]"})).join("||"),"){",h,"}")}else i=o.def(l,".",r),a=o.def(c,".",r),h(i,");",c,".",r,"=",i,";"),t("if(",i,"!==",a,"){",h,"}");n(h)})),e.compile()}(),compile:function(e,t,r,i,o){var a=P();a.stats=a.link(o),Object.keys(t.static).forEach((function(e){Q(a,t,e)})),Cn.forEach((function(t){Q(a,e,t)}));var s=N(e,t,r,i,a);return function(e,t){var n=e.proc("draw",1);G(e,n),D(e,n,t.context),U(e,n,t.framebuffer),F(e,n,t),z(e,n,t.state),V(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)Z(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var i=e.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(e.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",e.link((function(n){return X(Z,e,t,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(a,s),function(e,t){var r=e.proc("scope",3);e.batchId="a2";var i=e.shared,o=i.current;function a(n){var o=t.shader[n];o&&r.set(i.shader,"."+n,o.append(e,r))}D(e,r,t.context),t.framebuffer&&t.framebuffer.append(e,r),nr(Object.keys(t.state)).forEach((function(n){var o=t.state[n].append(e,r);de(o)?o.forEach((function(t,i){r.set(e.next[n],"["+i+"]",t)})):r.set(i.next,"."+n,o)})),V(e,r,t,!0,!0),[fn,dn,pn,vn,hn].forEach((function(n){var o=t.draw[n];o&&r.set(i.draw,"."+n,""+o.append(e,r))})),Object.keys(t.uniforms).forEach((function(o){r.set(i.uniforms,"["+n.id(o)+"]",t.uniforms[o].append(e,r))})),Object.keys(t.attributes).forEach((function(n){var i=t.attributes[n].append(e,r),o=e.scopeAttrib(n);Object.keys(new m).forEach((function(e){r.set(o,"."+e,i[e])}))})),t.scopeVAO&&r.set(i.vao,".targetVAO",t.scopeVAO.append(e,r)),a(ln),a(cn),Object.keys(t.state).length>0&&(r(o,".dirty=true;"),r.exit(o,".dirty=true;")),r("a1(",e.shared.context,",a0,",e.batchId,");")}(a,s),function(e,t){var n=e.proc("batch",2);e.batchId="0",G(e,n);var r=!1,i=!0;Object.keys(t.context).forEach((function(e){r=r||t.context[e].propDep})),r||(D(e,n,t.context),i=!1);var o=t.framebuffer,a=!1;function s(e){return e.contextDep&&r||e.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||U(e,n,o)):U(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),F(e,n,t),z(e,n,t.state,(function(e){return!s(e)})),t.profile&&s(t.profile)||V(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=a;var u=t.shader.progVar;if(u.contextDep&&r||u.propDep)q(e,n,t,null);else{var l=u.append(e,n);if(n(e.shared.gl,".useProgram(",l,".program);"),t.shader.program)q(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var c=e.global.def("{}"),f=n.def(l,".id"),h=n.def(c,"[",f,"]");n(e.cond(h).then(h,".call(this,a0,a1);").else(h,"=",c,"[",f,"]=",e.link((function(n){return X(q,e,t,n,2)})),"(",l,");",h,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;")}(a,s),a.compile()}}}var lr=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(e){n.push(e)}var i=[];function o(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var a=[];function s(e){a.push(e)}var u=[];function l(e,t,n){var r=a.pop()||new o;r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,u.push(r)}var c=[],f=[];return{beginQuery:function(e){var r=n.pop()||t.ext_disjoint_timer_query.createQueryEXT();t.ext_disjoint_timer_query.beginQueryEXT(35007,r),i.push(r),l(i.length-1,i.length,e)},endQuery:function(){t.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:l,update:function(){var e,n,o=i.length;if(0!==o){f.length=Math.max(f.length,o+1),c.length=Math.max(c.length,o+1),c[0]=0,f[0]=0;var a=0;for(e=0,n=0;n<i.length;++n){var l=i[n];t.ext_disjoint_timer_query.getQueryObjectEXT(l,34919)?(a+=t.ext_disjoint_timer_query.getQueryObjectEXT(l,34918),r(l)):i[e++]=l,c[n+1]=a,f[n+1]=e}for(i.length=e,e=0,n=0;n<u.length;++n){var h=u[n],p=h.startQueryIndex,d=h.endQueryIndex;h.sum+=c[d]-c[p];var v=f[p],g=f[d];g===v?(h.stats.gpuTime+=h.sum/1e6,s(h)):(h.startQueryIndex=v,h.endQueryIndex=g,u[e++]=h)}u.length=e}},getNumPendingQueries:function(){return i.length},clear:function(){n.push.apply(n,i);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);i.length=0,n.length=0},restore:function(){i.length=0,n.length=0}}},cr="webglcontextlost",fr="webglcontextrestored";function hr(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}return function(n){var r=N(n);if(!r)return null;var i=r.gl,o=i.getContextAttributes(),s=i.isContextLost(),u=function(e,t){var n={};function r(t){A.type(t,"string","extension name must be string");var r,i=t.toLowerCase();try{r=n[i]=e.getExtension(i)}catch(e){}return!!r}for(var i=0;i<t.extensions.length;++i){var o=t.extensions[i];if(!r(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)}))}}}(i,r);if(!u)return null;var l,c,f=(l={"":0},c=[""],{id:function(e){var t=l[e];return t||(t=l[e]=c.length,c.push(e),t)},str:function(e){return c[e]}}),h={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},p=u.extensions,d=lr(0,p),v=O(),g=i.drawingBufferWidth,m=i.drawingBufferHeight,y={tick:0,time:0,viewportWidth:g,viewportHeight:m,framebufferWidth:g,framebufferHeight:m,drawingBufferWidth:g,drawingBufferHeight:m,pixelRatio:r.pixelRatio},_=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(34047));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(34852),i=e.getParameter(36063));var o=!!t.oes_texture_float;if(o){var a=e.createTexture();e.bindTexture(z,a),e.texImage2D(z,0,G,1,1,0,G,V,null);var s=e.createFramebuffer();if(e.bindFramebuffer(j,s),e.framebufferTexture2D(j,36064,z,a,0),e.bindTexture(z,null),36053!==e.checkFramebufferStatus(j))o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(16384);var u=F.allocType(V,4);e.readPixels(0,0,1,1,G,V,u),e.getError()?o=!1:(e.deleteFramebuffer(s),e.deleteTexture(a),o=1===u[0]),F.freeType(u)}}var l=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var c=e.createTexture(),f=F.allocType(5121,36);e.activeTexture(33984),e.bindTexture(34067,c),e.texImage2D(34069,0,G,3,3,0,G,5121,f),F.freeType(f),e.bindTexture(34067,null),e.deleteTexture(c),l=!e.getError()}return{colorBits:[e.getParameter(3410),e.getParameter(3411),e.getParameter(3412),e.getParameter(3413)],depthBits:e.getParameter(3414),stencilBits:e.getParameter(3415),subpixelBits:e.getParameter(3408),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(33901),lineWidthDims:e.getParameter(33902),maxViewportDims:e.getParameter(3386),maxCombinedTextureUnits:e.getParameter(35661),maxCubeMapSize:e.getParameter(34076),maxRenderbufferSize:e.getParameter(34024),maxTextureUnits:e.getParameter(34930),maxTextureSize:e.getParameter(3379),maxAttributes:e.getParameter(34921),maxVertexUniforms:e.getParameter(36347),maxVertexTextureUnits:e.getParameter(35660),maxVaryingVectors:e.getParameter(36348),maxFragmentUniforms:e.getParameter(36349),glsl:e.getParameter(35724),renderer:e.getParameter(7937),vendor:e.getParameter(7936),version:e.getParameter(7938),readFloat:o,npotTextureCube:l}}(i,p),b=function(t,n,r,i){var o=0,a={};function s(e){this.id=o++,this.buffer=t.createBuffer(),this.type=e,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=ee,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){f(this)};var u=[];function l(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function c(t,n,r,i,o,a){var s,u;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||te,n.length>0)if(Array.isArray(n[0])){s=J(n);for(var c=1,f=1;f<s.length;++f)c*=s[f];t.dimension=c,l(t,u=$(n,s,t.dtype),r),a?t.persistentData=u:F.freeType(u)}else if("number"==typeof n[0]){t.dimension=o;var h=F.allocType(t.dtype,n.length);ie(h,n),l(t,h,r),a?t.persistentData=h:F.freeType(h)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||re(n[0])||te,l(t,u=$(n,[n.length,n[0].length],t.dtype),r),a?t.persistentData=u:F.freeType(u)):A.raise("invalid buffer data")}else if(e(n))t.dtype=i||re(n),t.dimension=o,l(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(H(n)){s=n.shape;var p=n.stride,d=n.offset,v=0,g=0,m=0,y=0;1===s.length?(v=s[0],g=1,m=p[0],y=0):2===s.length?(v=s[0],g=s[1],m=p[0],y=p[1]):A.raise("invalid shape"),t.dtype=i||re(n.data)||te,t.dimension=g;var _=F.allocType(t.dtype,v*g);oe(_,n.data,v,g,m,y,d),l(t,_,r),a?t.persistentData=_:F.freeType(_)}else n instanceof ArrayBuffer?(t.dtype=ee,t.dimension=o,l(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):A.raise("invalid buffer data")}function f(e){n.bufferCount--,i(e);var r=e.buffer;A(r,"buffer must not be deleted already"),t.deleteBuffer(r),e.buffer=null,delete a[e.id]}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(a).forEach((function(t){e+=a[t].stats.size})),e}),{create:function(i,o,u,l){n.bufferCount++;var h=new s(o);function p(n){var i=35044,o=null,a=0,s=0,u=1;return Array.isArray(n)||e(n)||H(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(A.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(A(null===o||Array.isArray(o)||e(o)||H(o),"invalid data for buffer"),o=n.data),"usage"in n&&(A.parameter(n.usage,Q,"invalid buffer usage"),i=Q[n.usage]),"type"in n&&(A.parameter(n.type,K,"invalid buffer type"),s=K[n.type]),"dimension"in n&&(A.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(A.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),h.bind(),o?c(h,o,i,s,u,l):(a&&t.bufferData(h.type,a,i),h.dtype=s||ee,h.usage=i,h.dimension=u,h.byteLength=a),r.profile&&(h.stats.size=h.byteLength*ne[h.dtype]),p}function d(e,n){A(n+e.byteLength<=h.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+h.byteLength),t.bufferSubData(h.type,n,e)}return a[h.id]=h,u||p(i),p._reglType="buffer",p._buffer=h,p.subdata=function(t,n){var r,i=0|(n||0);if(h.bind(),e(t)||t instanceof ArrayBuffer)d(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var o=F.allocType(h.dtype,t.length);ie(o,t),d(o,i),F.freeType(o)}else if(Array.isArray(t[0])||e(t[0])){r=J(t);var a=$(t,r,h.dtype);d(a,i),F.freeType(a)}else A.raise("invalid buffer data")}else if(H(t)){r=t.shape;var s=t.stride,u=0,l=0,c=0,f=0;1===r.length?(u=r[0],l=1,c=s[0],f=0):2===r.length?(u=r[0],l=r[1],c=s[0],f=s[1]):A.raise("invalid shape");var v=Array.isArray(t.data)?h.dtype:re(t.data),g=F.allocType(v,u*l);oe(g,t.data,u,l,c,f,t.offset),d(g,i),F.freeType(g)}else A.raise("invalid data for buffer subdata");return p},r.profile&&(p.stats=h.stats),p.destroy=function(){f(h)},p},createStream:function(e,t){var n=u.pop();return n||(n=new s(e)),n.bind(),c(n,t,35040,0,1,!1),n},destroyStream:function(e){u.push(e)},clear:function(){W(a).forEach(f),u.forEach(f)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:function(){W(a).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))},_initBuffer:c}}(i,h,r,(function(e){return x.destroyBuffer(e)})),x=function(t,n,r,i,o){for(var a=r.maxAttributes,s=new Array(a),u=0;u<a;++u)s[u]=new Ct;var l=0,c={},f={Record:Ct,scope:{},state:s,currentVAO:null,targetVAO:null,restore:h()?function(){h()&&W(c).forEach((function(e){e.refresh()}))}:function(){},createVAO:function(t){var r=new d;function s(t){A(Array.isArray(t),"arguments to vertex array constructor must be an array"),A(t.length<a,"too many attributes"),A(t.length>0,"must specify at least one attribute");for(var i=0;i<r.buffers.length;++i)r.buffers[i].destroy();r.buffers.length=0;var u=r.attributes;u.length=t.length;for(var l=0;l<t.length;++l){var c=t[l],f=u[l]=new Ct;if(Array.isArray(c)||e(c)||H(c)){var h=o.create(c,34962,!1,!0);f.buffer=o.getBuffer(h),f.size=0|f.buffer.dimension,f.normalized=!1,f.type=f.buffer.dtype,f.offset=0,f.stride=0,f.divisor=0,f.state=1,r.buffers.push(h)}else o.getBuffer(c)?(f.buffer=o.getBuffer(c),f.size=0|f.buffer.dimension,f.normalized=!1,f.type=f.buffer.dtype,f.offset=0,f.stride=0,f.divisor=0,f.state=1):o.getBuffer(c.buffer)?(f.buffer=o.getBuffer(c.buffer),f.size=0|(+c.size||f.buffer.dimension),f.normalized=!!c.normalized||!1,"type"in c?(A.parameter(c.type,K,"invalid buffer type"),f.type=K[c.type]):f.type=f.buffer.dtype,f.offset=0|(c.offset||0),f.stride=0|(c.stride||0),f.divisor=0|(c.divisor||0),f.state=1,A(f.size>=1&&f.size<=4,"size must be between 1 and 4"),A(f.offset>=0,"invalid offset"),A(f.stride>=0&&f.stride<=255,"stride must be between 0 and 255"),A(f.divisor>=0,"divisor must be positive"),A(!f.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in c?(A(l>0,"first attribute must not be a constant"),f.x=+c.x||0,f.y=+c.y||0,f.z=+c.z||0,f.w=+c.w||0,f.state=2):A(!1,"invalid attribute spec for location "+l)}return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){r.destroy()},s._vao=r,s._reglType="vao",s(t)},getVAO:function(e){return"function"==typeof e&&e._vao?e._vao:null},destroyBuffer:function(e){for(var n=0;n<s.length;++n){var r=s[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}},setVAO:h()?function(e){if(e!==f.currentVAO){var t=h();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),f.currentVAO=e}}:function(e){if(e!==f.currentVAO){if(e)e.bindAttrs();else for(var n=p(),r=0;r<s.length;++r){var i=s[r];i.buffer?(t.enableVertexAttribArray(r),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&n.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}f.currentVAO=e}},clear:h()?function(){W(c).forEach((function(e){e.destroy()}))}:function(){}};function h(){return n.oes_vertex_array_object}function p(){return n.angle_instanced_arrays}function d(){this.id=++l,this.attributes=[];var e=h();this.vao=e?e.createVertexArrayOES():null,c[this.id]=this,this.buffers=[]}return d.prototype.bindAttrs=function(){for(var e=p(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(34962,i.buffer.buffer),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),e&&e.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<a;++o)t.disableVertexAttribArray(o)},d.prototype.refresh=function(){var e=h();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),f.currentVAO=this)},d.prototype.destroy=function(){if(this.vao){var e=h();this===f.currentVAO&&(f.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}c[this.id]&&(delete c[this.id],i.vaoCount-=1)},f}(i,p,_,h,b),E=function(t,n,r,i){var o={},a=0,s={uint8:se,uint16:ue};function u(e){this.id=a++,o[this.id]=this,this.buffer=e,this.primType=4,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=le),u.prototype.bind=function(){this.buffer.bind()};var l=[];function c(i,o,a,s,u,l,c){var f;if(i.buffer.bind(),o){var h=c;c||e(o)&&(!H(o)||e(o.data))||(h=n.oes_element_index_uint?le:ue),r._initBuffer(i.buffer,o,a,h,3)}else t.bufferData(ce,l,a),i.buffer.dtype=f||se,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=l;if(f=c,!c){switch(i.buffer.dtype){case se:case 5120:f=se;break;case ue:case 5122:f=ue;break;case le:case 5124:f=le;break;default:A.raise("unsupported type for element array")}i.buffer.dtype=f}i.type=f,A(f!==le||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var p=u;p<0&&(p=i.buffer.byteLength,f===ue?p>>=1:f===le&&(p>>=2)),i.vertCount=p;var d=s;if(s<0){d=4;var v=i.buffer.dimension;1===v&&(d=0),2===v&&(d=1),3===v&&(d=4)}i.primType=d}function f(e){i.elementsCount--,A(null!==e.buffer,"must not double destroy elements"),delete o[e.id],e.buffer.destroy(),e.buffer=null}return{create:function(t,n){var o=r.create(null,ce,!0),a=new u(o._buffer);function l(t){if(t)if("number"==typeof t)o(t),a.primType=4,a.vertCount=0|t,a.type=se;else{var n=null,r=35044,i=-1,u=-1,f=0,h=0;Array.isArray(t)||e(t)||H(t)?n=t:(A.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,A(Array.isArray(n)||e(n)||H(n),"invalid data for element buffer")),"usage"in t&&(A.parameter(t.usage,Q,"invalid element buffer usage"),r=Q[t.usage]),"primitive"in t&&(A.parameter(t.primitive,ae,"invalid element buffer primitive"),i=ae[t.primitive]),"count"in t&&(A("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),u=0|t.count),"type"in t&&(A.parameter(t.type,s,"invalid buffer type"),h=s[t.type]),"length"in t?f=0|t.length:(f=u,h===ue||5122===h?f*=2:h!==le&&5124!==h||(f*=4))),c(a,n,r,i,u,f,h)}else o(),a.primType=4,a.vertCount=0,a.type=se;return l}return i.elementsCount++,l(t),l._reglType="elements",l._elements=a,l.subdata=function(e,t){return o.subdata(e,t),l},l.destroy=function(){f(a)},l},createStream:function(e){var t=l.pop();return t||(t=new u(r.create(null,ce,!0,!1)._buffer)),c(t,e,35040,-1,-1,0,0),t},destroyStream:function(e){l.push(e)},getElements:function(e){return"function"==typeof e&&e._elements instanceof u?e._elements:null},clear:function(){W(o).forEach(f)}}}(i,p,b,h),T=function(e,t,n,r){var i={},o={};function a(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function s(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function u(n,r,a){var s=35632===n?i:o,u=s[r];if(!u){var l=t.str(r);u=e.createShader(n),e.shaderSource(u,l),e.compileShader(u),A.shaderError(e,u,l,n,a),s[r]=u}return u}var l={},c=[],f=0;function h(e,t){this.id=f++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],r.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function p(n,i,o){var l,c,f=u(35632,n.fragId),h=u(35633,n.vertId),p=n.program=e.createProgram();if(e.attachShader(p,f),e.attachShader(p,h),o)for(l=0;l<o.length;++l){var d=o[l];e.bindAttribLocation(p,d[0],d[1])}e.linkProgram(p),A.linkError(e,p,t.str(n.fragId),t.str(n.vertId),i);var v=e.getProgramParameter(p,35718);r.profile&&(n.stats.uniformsCount=v);var g=n.uniforms;for(l=0;l<v;++l)if(c=e.getActiveUniform(p,l))if(c.size>1)for(var m=0;m<c.size;++m){var y=c.name.replace("[0]","["+m+"]");s(g,new a(y,t.id(y),e.getUniformLocation(p,y),c))}else s(g,new a(c.name,t.id(c.name),e.getUniformLocation(p,c.name),c));var _=e.getProgramParameter(p,35721);r.profile&&(n.stats.attributesCount=_);var b=n.attributes;for(l=0;l<_;++l)(c=e.getActiveAttrib(p,l))&&s(b,new a(c.name,t.id(c.name),e.getAttribLocation(p,c.name),c))}return r.profile&&(n.getMaxUniformsCount=function(){var e=0;return c.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},n.getMaxAttributesCount=function(){var e=0;return c.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);W(i).forEach(t),i={},W(o).forEach(t),o={},c.forEach((function(t){e.deleteProgram(t.program)})),c.length=0,l={},n.shaderCount=0},program:function(e,t,r,i){A.command(e>=0,"missing vertex shader",r),A.command(t>=0,"missing fragment shader",r);var o=l[t];o||(o=l[t]={});var a=o[e];if(a&&!i)return a;var s=new h(t,e);return n.shaderCount++,p(s,r,i),a||(o[e]=s),c.push(s),s},restore:function(){i={},o={};for(var e=0;e<c.length;++e)p(c[e],null,c[e].attributes.map((function(e){return[e.location,e.name]})))},shader:u,frag:-1,vert:-1}}(i,f,h,r),S=ht(i,p,_,(function(){w.procs.poll()}),y,h,r),C=function(e,t,n,r,i){var o={rgba4:dt,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041};t.ext_srgb&&(o.srgba=35907),t.ext_color_buffer_half_float&&(o.rgba16f=34842,o.rgb16f=34843),t.webgl_color_buffer_float&&(o.rgba32f=34836);var s=[];Object.keys(o).forEach((function(e){var t=o[e];s[t]=e}));var u=0,l={};function c(e){this.id=u++,this.refCount=1,this.renderbuffer=e,this.format=dt,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function f(t){var n=t.renderbuffer;A(n,"must not double destroy renderbuffer"),e.bindRenderbuffer(pt,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete l[t.id],r.renderbufferCount--}return c.prototype.decRef=function(){--this.refCount<=0&&f(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(l).forEach((function(t){e+=l[t].stats.size})),e}),{create:function(t,u){var f=new c(e.createRenderbuffer());function h(t,r){var u=0,l=0,c=dt;if("object"===a(t)&&t){var p=t;if("shape"in p){var d=p.shape;A(Array.isArray(d)&&d.length>=2,"invalid renderbuffer shape"),u=0|d[0],l=0|d[1]}else"radius"in p&&(u=l=0|p.radius),"width"in p&&(u=0|p.width),"height"in p&&(l=0|p.height);"format"in p&&(A.parameter(p.format,o,"invalid renderbuffer format"),c=o[p.format])}else"number"==typeof t?(u=0|t,l="number"==typeof r?0|r:u):t?A.raise("invalid arguments to renderbuffer constructor"):u=l=1;if(A(u>0&&l>0&&u<=n.maxRenderbufferSize&&l<=n.maxRenderbufferSize,"invalid renderbuffer size"),u!==f.width||l!==f.height||c!==f.format)return h.width=f.width=u,h.height=f.height=l,f.format=c,e.bindRenderbuffer(pt,f.renderbuffer),e.renderbufferStorage(pt,c,u,l),A(0===e.getError(),"invalid render buffer format"),i.profile&&(f.stats.size=gt(f.format,f.width,f.height)),h.format=s[f.format],h}return l[f.id]=f,r.renderbufferCount++,h(t,u),h.resize=function(t,r){var o=0|t,a=0|r||o;return o===f.width&&a===f.height||(A(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),h.width=f.width=o,h.height=f.height=a,e.bindRenderbuffer(pt,f.renderbuffer),e.renderbufferStorage(pt,f.format,o,a),A(0===e.getError(),"invalid render buffer format"),i.profile&&(f.stats.size=gt(f.format,f.width,f.height))),h},h._reglType="renderbuffer",h._renderbuffer=f,i.profile&&(h.stats=f.stats),h.destroy=function(){f.decRef()},h},clear:function(){W(l).forEach(f)},restore:function(){W(l).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(pt,t.renderbuffer),e.renderbufferStorage(pt,t.format,t.width,t.height)})),e.bindRenderbuffer(pt,null)}}}(i,p,_,h,r),R=function(e,n,r,i,o,s){var u={cur:null,next:null,dirty:!1,setFBO:null},l=["rgba"],c=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&c.push("srgba"),n.ext_color_buffer_half_float&&c.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&c.push("rgba32f");var f=["uint8"];function h(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function p(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function d(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);A(i===t&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=e.renderbuffer._renderbuffer;A(a.width===t&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function v(t,n){n&&(n.texture?e.framebufferTexture2D(mt,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(mt,t,yt,n.renderbuffer._renderbuffer.renderbuffer))}function g(e){var t=_t,n=null,r=null,i=e;"object"===a(e)&&(i=e.data,"target"in e&&(t=0|e.target)),A.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,A(t===_t)):"textureCube"===o?(n=i,A(t>=bt&&t<34075,"invalid cube map target")):"renderbuffer"===o?(r=i,t=yt):A.raise("invalid regl object for attachment"),new h(t,n,r)}function m(e,t,n,r,a){if(n){var s=i.create2D({width:e,height:t,format:r,type:a});return s._texture.refCount=0,new h(_t,s,null)}var u=o.create({width:e,height:t,format:r});return u._renderbuffer.refCount=0,new h(yt,null,u)}function y(e){return e&&(e.texture||e.renderbuffer)}function _(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}n.oes_texture_half_float&&f.push("half float","float16"),n.oes_texture_float&&f.push("float","float32");var b=0,x={};function E(){this.id=b++,x[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function T(e){e.colorAttachments.forEach(p),p(e.depthAttachment),p(e.stencilAttachment),p(e.depthStencilAttachment)}function S(t){var n=t.framebuffer;A(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,s.framebufferCount--,delete x[t.id]}function C(t){var n;e.bindFramebuffer(mt,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)v(36064+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(mt,36064+n,_t,null,0);e.framebufferTexture2D(mt,33306,_t,null,0),e.framebufferTexture2D(mt,36096,_t,null,0),e.framebufferTexture2D(mt,36128,_t,null,0),v(36096,t.depthAttachment),v(36128,t.stencilAttachment),v(33306,t.depthStencilAttachment);var o=e.checkFramebufferStatus(mt);e.isContextLost()||36053===o||A.raise("framebuffer configuration not supported, status = "+St[o]),e.bindFramebuffer(mt,u.next?u.next.framebuffer:null),u.cur=u.next,e.getError()}function R(e,i){var o=new E;function a(e,t){var i;A(u.next!==o,"can not update framebuffer which is currently in use");var s=0,h=0,p=!0,v=!0,_=null,b=!0,x="rgba",E="uint8",S=1,R=null,w=null,M=null,k=!1;if("number"==typeof e)s=0|e,h=0|t||s;else if(e){A.type(e,"object","invalid arguments for framebuffer");var L=e;if("shape"in L){var O=L.shape;A(Array.isArray(O)&&O.length>=2,"invalid shape for framebuffer"),s=O[0],h=O[1]}else"radius"in L&&(s=h=L.radius),"width"in L&&(s=L.width),"height"in L&&(h=L.height);("color"in L||"colors"in L)&&(_=L.color||L.colors,Array.isArray(_)&&A(1===_.length||n.webgl_draw_buffers,"multiple render targets not supported")),_||("colorCount"in L&&(S=0|L.colorCount,A(S>0,"invalid color buffer count")),"colorTexture"in L&&(b=!!L.colorTexture,x="rgba4"),"colorType"in L&&(E=L.colorType,b?(A(n.oes_texture_float||!("float"===E||"float32"===E),"you must enable OES_texture_float in order to use floating point framebuffer objects"),A(n.oes_texture_half_float||!("half float"===E||"float16"===E),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===E||"float16"===E?(A(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),x="rgba16f"):"float"!==E&&"float32"!==E||(A(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),x="rgba32f"),A.oneOf(E,f,"invalid color type")),"colorFormat"in L&&(x=L.colorFormat,l.indexOf(x)>=0?b=!0:c.indexOf(x)>=0?b=!1:b?A.oneOf(L.colorFormat,l,"invalid color format for texture"):A.oneOf(L.colorFormat,c,"invalid color format for renderbuffer"))),("depthTexture"in L||"depthStencilTexture"in L)&&(k=!(!L.depthTexture&&!L.depthStencilTexture),A(!k||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in L&&("boolean"==typeof L.depth?p=L.depth:(R=L.depth,v=!1)),"stencil"in L&&("boolean"==typeof L.stencil?v=L.stencil:(w=L.stencil,p=!1)),"depthStencil"in L&&("boolean"==typeof L.depthStencil?p=v=L.depthStencil:(M=L.depthStencil,p=!1,v=!1))}else s=h=1;var I=null,P=null,N=null,B=null;if(Array.isArray(_))I=_.map(g);else if(_)I=[g(_)];else for(I=new Array(S),i=0;i<S;++i)I[i]=m(s,h,b,x,E);A(n.webgl_draw_buffers||I.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),A(I.length<=r.maxColorAttachments,"too many color attachments, not supported"),s=s||I[0].width,h=h||I[0].height,R?P=g(R):p&&!v&&(P=m(s,h,k,"depth","uint32")),w?N=g(w):v&&!p&&(N=m(s,h,!1,"stencil","uint8")),M?B=g(M):!R&&!w&&v&&p&&(B=m(s,h,k,"depth stencil","depth stencil")),A(!!R+!!w+!!M<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var D=null;for(i=0;i<I.length;++i)if(d(I[i],s,h),A(!I[i]||I[i].texture&&xt.indexOf(I[i].texture._texture.format)>=0||I[i].renderbuffer&&At.indexOf(I[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),I[i]&&I[i].texture){var U=Et[I[i].texture._texture.format]*Tt[I[i].texture._texture.type];null===D?D=U:A(D===U,"all color attachments much have the same number of bits per pixel.")}return d(P,s,h),A(!P||P.texture&&6402===P.texture._texture.format||P.renderbuffer&&33189===P.renderbuffer._renderbuffer.format,"invalid depth attachment for framebuffer object"),d(N,s,h),A(!N||N.renderbuffer&&36168===N.renderbuffer._renderbuffer.format,"invalid stencil attachment for framebuffer object"),d(B,s,h),A(!B||B.texture&&34041===B.texture._texture.format||B.renderbuffer&&34041===B.renderbuffer._renderbuffer.format,"invalid depth-stencil attachment for framebuffer object"),T(o),o.width=s,o.height=h,o.colorAttachments=I,o.depthAttachment=P,o.stencilAttachment=N,o.depthStencilAttachment=B,a.color=I.map(y),a.depth=y(P),a.stencil=y(N),a.depthStencil=y(B),a.width=o.width,a.height=o.height,C(o),a}return s.framebufferCount++,a(e,i),t(a,{resize:function(e,t){A(u.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===o.width&&r===o.height)return a;for(var i=o.colorAttachments,s=0;s<i.length;++s)_(i[s],n,r);return _(o.depthAttachment,n,r),_(o.stencilAttachment,n,r),_(o.depthStencilAttachment,n,r),o.width=a.width=n,o.height=a.height=r,C(o),a},_reglType:"framebuffer",_framebuffer:o,destroy:function(){S(o),T(o)},use:function(e){u.setFBO({framebuffer:a},e)}})}return t(u,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof E)return t}return null},create:R,createCube:function(e){var o=Array(6);function a(e){var r;A(o.indexOf(u.next)<0,"can not update framebuffer which is currently in use");var s,c={color:null},h=0,p=null,d="rgba",v="uint8",g=1;if("number"==typeof e)h=0|e;else if(e){A.type(e,"object","invalid arguments for framebuffer");var m=e;if("shape"in m){var y=m.shape;A(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),A(y[0]===y[1],"cube framebuffer must be square"),h=y[0]}else"radius"in m&&(h=0|m.radius),"width"in m?(h=0|m.width,"height"in m&&A(m.height===h,"must be square")):"height"in m&&(h=0|m.height);("color"in m||"colors"in m)&&(p=m.color||m.colors,Array.isArray(p)&&A(1===p.length||n.webgl_draw_buffers,"multiple render targets not supported")),p||("colorCount"in m&&(g=0|m.colorCount,A(g>0,"invalid color buffer count")),"colorType"in m&&(A.oneOf(m.colorType,f,"invalid color type"),v=m.colorType),"colorFormat"in m&&(d=m.colorFormat,A.oneOf(m.colorFormat,l,"invalid color format for texture"))),"depth"in m&&(c.depth=m.depth),"stencil"in m&&(c.stencil=m.stencil),"depthStencil"in m&&(c.depthStencil=m.depthStencil)}else h=1;if(p)if(Array.isArray(p))for(s=[],r=0;r<p.length;++r)s[r]=p[r];else s=[p];else{s=Array(g);var _={radius:h,format:d,type:v};for(r=0;r<g;++r)s[r]=i.createCube(_)}for(c.color=Array(s.length),r=0;r<s.length;++r){var b=s[r];A("function"==typeof b&&"textureCube"===b._reglType,"invalid cube map"),h=h||b.width,A(b.width===h&&b.height===h,"invalid cube map shape"),c.color[r]={target:bt,data:s[r]}}for(r=0;r<6;++r){for(var x=0;x<s.length;++x)c.color[x].target=bt+r;r>0&&(c.depth=o[0].depth,c.stencil=o[0].stencil,c.depthStencil=o[0].depthStencil),o[r]?o[r](c):o[r]=R(c)}return t(a,{width:h,height:h,color:s})}return a(e),t(a,{faces:o,resize:function(e){var t,n=0|e;if(A(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;t<6;++t)o[t].resize(n);return a.width=a.height=n,a},_reglType:"framebufferCube",destroy:function(){o.forEach((function(e){e.destroy()}))}})},clear:function(){W(x).forEach(S)},restore:function(){u.cur=null,u.next=null,u.dirty=!0,W(x).forEach((function(t){t.framebuffer=e.createFramebuffer(),C(t)}))}})}(i,p,_,S,C,h),w=ur(i,f,p,_,b,E,0,R,{},x,T,{elements:null,primitive:4,count:-1,offset:0,instances:-1},y,d,r),M=Mt(i,R,w.procs.poll,y,o,p,_),I=w.next,P=i.canvas,B=[],D=[],U=[],X=[r.onDestroy],Z=null;function Y(){if(0===B.length)return d&&d.update(),void(Z=null);Z=L.next(Y),_e();for(var e=B.length-1;e>=0;--e){var t=B[e];t&&t(y,null,0)}i.flush(),d&&d.update()}function q(){!Z&&B.length>0&&(Z=L.next(Y))}function fe(){Z&&(L.cancel(Y),Z=null)}function he(e){e.preventDefault(),s=!0,fe(),D.forEach((function(e){e()}))}function pe(e){i.getError(),s=!1,u.restore(),T.restore(),b.restore(),S.restore(),C.restore(),R.restore(),x.restore(),d&&d.restore(),w.procs.refresh(),q(),U.forEach((function(e){e()}))}function de(e){function n(e){var t={},n={};return Object.keys(e).forEach((function(r){var i=e[r];k.isDynamic(i)?n[r]=k.unbox(i,r):t[r]=i})),{dynamic:n,static:t}}A(!!e,"invalid args to regl({...})"),A.type(e,"object","invalid args to regl({...})");var r=n(e.context||{}),i=n(e.uniforms||{}),o=n(e.attributes||{}),a=n(function(e){var n=t({},e);function r(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach((function(r){n[e+"."+r]=t[r]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in e&&(n.vao=e.vao),n}(e)),u={gpuTime:0,cpuTime:0,count:0},l=w.compile(a,o,i,r,u),c=l.draw,f=l.batch,h=l.scope,p=[];return t((function(e,t){var n;if(s&&A.raise("context lost"),"function"==typeof e)return h.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(n=0;n<e;++n)h.call(this,null,t,n);else{if(!Array.isArray(e))return h.call(this,e,t,0);for(n=0;n<e.length;++n)h.call(this,e[n],t,n)}else if("number"==typeof e){if(e>0)return f.call(this,function(e){for(;p.length<e;)p.push(null);return p}(0|e),0|e)}else{if(!Array.isArray(e))return c.call(this,e);if(e.length)return f.call(this,e,e.length)}}),{stats:u})}P&&(P.addEventListener(cr,he,!1),P.addEventListener(fr,pe,!1));var ve=R.setFBO=de({framebuffer:k.define.call(null,1,"framebuffer")});function ge(e,t){var n=0;w.procs.poll();var r=t.color;r&&(i.clearColor(+r[0]||0,+r[1]||0,+r[2]||0,+r[3]||0),n|=16384),"depth"in t&&(i.clearDepth(+t.depth),n|=256),"stencil"in t&&(i.clearStencil(0|t.stencil),n|=1024),A(!!n,"called regl.clear with no buffer specified"),i.clear(n)}function me(e){return A.type(e,"function","regl.frame() callback must be a function"),B.push(e),q(),{cancel:function(){var t=hr(B,e);A(t>=0,"cannot cancel a frame twice"),B[t]=function e(){var t=hr(B,e);B[t]=B[B.length-1],B.length-=1,B.length<=0&&fe()}}}}function ye(){var e=I.viewport,t=I.scissor_box;e[0]=e[1]=t[0]=t[1]=0,y.viewportWidth=y.framebufferWidth=y.drawingBufferWidth=e[2]=t[2]=i.drawingBufferWidth,y.viewportHeight=y.framebufferHeight=y.drawingBufferHeight=e[3]=t[3]=i.drawingBufferHeight}function _e(){y.tick+=1,y.time=xe(),ye(),w.procs.poll()}function be(){ye(),w.procs.refresh(),d&&d.update()}function xe(){return(O()-v)/1e3}be();var Ee=t(de,{clear:function(e){if(A("object"===a(e)&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var n=0;n<6;++n)ve(t({framebuffer:e.framebuffer.faces[n]},e),ge);else ve(e,ge);else ge(0,e)},prop:k.define.bind(null,1),context:k.define.bind(null,2),this:k.define.bind(null,3),draw:de({}),buffer:function(e){return b.create(e,34962,!1,!1)},elements:function(e){return E.create(e,!1)},texture:S.create2D,cube:S.createCube,renderbuffer:C.create,framebuffer:R.create,framebufferCube:R.createCube,vao:x.createVAO,attributes:o,frame:me,on:function(e,t){var n;switch(A.type(t,"function","listener callback must be a function"),e){case"frame":return me(t);case"lost":n=D;break;case"restore":n=U;break;case"destroy":n=X;break;default:A.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}},limits:_,hasExtension:function(e){return _.extensions.indexOf(e.toLowerCase())>=0},read:M,destroy:function(){B.length=0,fe(),P&&(P.removeEventListener(cr,he),P.removeEventListener(fr,pe)),T.clear(),R.clear(),C.clear(),S.clear(),E.clear(),b.clear(),x.clear(),d&&d.clear(),X.forEach((function(e){e()}))},_gl:i,_refresh:be,poll:function(){_e(),d&&d.update()},now:xe,stats:h});return r.onDone(null,Ee),Ee}},"object"===a(t)?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)},5947:function(e,t,n){var r,i,o,a=n(5116).default;o=function(){"use strict";function e(n,r,i,o,a,s){if(!(a-o<=i)){var u=o+a>>1;t(n,r,u,o,a,s%2),e(n,r,i,o,u-1,s+1),e(n,r,i,u+1,a,s+1)}}function t(e,r,i,o,a,s){for(;a>o;){if(a-o>600){var u=a-o+1,l=i-o+1,c=Math.log(u),f=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*f*(u-f)/u)*(l-u/2<0?-1:1);t(e,r,i,Math.max(o,Math.floor(i-l*f/u+h)),Math.min(a,Math.floor(i+(u-l)*f/u+h)),s)}var p=r[2*i+s],d=o,v=a;for(n(e,r,o,i),r[2*a+s]>p&&n(e,r,o,a);d<v;){for(n(e,r,d,v),d++,v--;r[2*d+s]<p;)d++;for(;r[2*v+s]>p;)v--}r[2*o+s]===p?n(e,r,o,v):n(e,r,++v,a),v<=i&&(o=v+1),i<=v&&(a=v-1)}}function n(e,t,n,i){r(e,n,i),r(t,2*n,2*i),r(t,2*n+1,2*i+1)}function r(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function i(e,t,n,r){var i=e-n,o=t-r;return i*i+o*o}var o=function(e){return e[0]},a=function(e){return e[1]},s=function(t,n,r,i,s){void 0===n&&(n=o),void 0===r&&(r=a),void 0===i&&(i=64),void 0===s&&(s=Float64Array),this.nodeSize=i,this.points=t;for(var u=t.length<65536?Uint16Array:Uint32Array,l=this.ids=new u(t.length),c=this.coords=new s(2*t.length),f=0;f<t.length;f++)l[f]=f,c[2*f]=n(t[f]),c[2*f+1]=r(t[f]);e(l,c,i,0,l.length-1,0)};s.prototype.range=function(e,t,n,r){return function(e,t,n,r,i,o,a){for(var s,u,l=[0,e.length-1,0],c=[];l.length;){var f=l.pop(),h=l.pop(),p=l.pop();if(h-p<=a)for(var d=p;d<=h;d++)s=t[2*d],u=t[2*d+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(e[d]);else{var v=Math.floor((p+h)/2);s=t[2*v],u=t[2*v+1],s>=n&&s<=i&&u>=r&&u<=o&&c.push(e[v]);var g=(f+1)%2;(0===f?n<=s:r<=u)&&(l.push(p),l.push(v-1),l.push(g)),(0===f?i>=s:o>=u)&&(l.push(v+1),l.push(h),l.push(g))}}return c}(this.ids,this.coords,e,t,n,r,this.nodeSize)},s.prototype.within=function(e,t,n){return function(e,t,n,r,o,a){for(var s=[0,e.length-1,0],u=[],l=o*o;s.length;){var c=s.pop(),f=s.pop(),h=s.pop();if(f-h<=a)for(var p=h;p<=f;p++)i(t[2*p],t[2*p+1],n,r)<=l&&u.push(e[p]);else{var d=Math.floor((h+f)/2),v=t[2*d],g=t[2*d+1];i(v,g,n,r)<=l&&u.push(e[d]);var m=(c+1)%2;(0===c?n-o<=v:r-o<=g)&&(s.push(h),s.push(d-1),s.push(m)),(0===c?n+o>=v:r+o>=g)&&(s.push(d+1),s.push(f),s.push(m))}}return u}(this.ids,this.coords,e,t,n,this.nodeSize)};var u,l={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},c=Math.fround||(u=new Float32Array(1),function(e){return u[0]=+e,u[0]}),f=function(e){this.options=y(Object.create(l),e),this.trees=new Array(this.options.maxZoom+1)};function h(e,t,n,r,i){return{x:c(e),y:c(t),zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function p(e,t){var n=e.geometry.coordinates,r=n[0],i=n[1];return{x:c(g(r)),y:c(m(i)),zoom:1/0,index:t,parentId:-1}}function d(e){return{type:"Feature",id:e.id,properties:v(e),geometry:{type:"Point",coordinates:[(r=e.x,360*(r-.5)),(t=e.y,n=(180-360*t)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var t,n,r}function v(e){var t=e.numPoints,n=t>=1e4?Math.round(t/1e3)+"k":t>=1e3?Math.round(t/100)/10+"k":t;return y(y({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:n})}function g(e){return e/360+.5}function m(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function y(e,t){for(var n in t)e[n]=t[n];return e}function _(e){return e.x}function b(e){return e.y}return f.prototype.load=function(e){var t=this.options,n=t.log,r=t.minZoom,i=t.maxZoom,o=t.nodeSize;n&&console.time("total time");var a="prepare "+e.length+" points";n&&console.time(a),this.points=e;for(var u=[],l=0;l<e.length;l++)e[l].geometry&&u.push(p(e[l],l));this.trees[i+1]=new s(u,_,b,o,Float32Array),n&&console.timeEnd(a);for(var c=i;c>=r;c--){var f=+Date.now();u=this._cluster(u,c),this.trees[c]=new s(u,_,b,o,Float32Array),n&&console.log("z%d: %d clusters in %dms",c,u.length,+Date.now()-f)}return n&&console.timeEnd("total time"),this},f.prototype.getClusters=function(e,t){var n=((e[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[1])),i=180===e[2]?180:((e[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],t),s=this.getClusters([-180,r,i,o],t);return a.concat(s)}for(var u=this.trees[this._limitZoom(t)],l=[],c=0,f=u.range(g(n),m(o),g(i),m(r));c<f.length;c+=1){var h=f[c],p=u.points[h];l.push(p.numPoints?d(p):this.points[p.index])}return l},f.prototype.getChildren=function(e){var t=this._getOriginId(e),n=this._getOriginZoom(e),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[t];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,l=i.within(o.x,o.y,a);u<l.length;u+=1){var c=l[u],f=i.points[c];f.parentId===e&&s.push(f.numPoints?d(f):this.points[f.index])}if(0===s.length)throw new Error(r);return s},f.prototype.getLeaves=function(e,t,n){t=t||10,n=n||0;var r=[];return this._appendLeaves(r,e,t,n,0),r},f.prototype.getTile=function(e,t,n){var r=this.trees[this._limitZoom(e)],i=Math.pow(2,e),o=this.options,a=o.extent,s=o.radius/a,u=(n-s)/i,l=(n+1+s)/i,c={features:[]};return this._addTileFeatures(r.range((t-s)/i,u,(t+1+s)/i,l),r.points,t,n,i,c),0===t&&this._addTileFeatures(r.range(1-s/i,u,1,l),r.points,i,n,i,c),t===i-1&&this._addTileFeatures(r.range(0,u,s/i,l),r.points,-1,n,i,c),c.features.length?c:null},f.prototype.getClusterExpansionZoom=function(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t},f.prototype._appendLeaves=function(e,t,n,r,i){for(var o=0,a=this.getChildren(t);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(e,u.cluster_id,n,r,i):i<r?i++:e.push(s),e.length===n)break}return i},f.prototype._addTileFeatures=function(e,t,n,r,i,o){for(var a=0,s=e;a<s.length;a+=1){var u=t[s[a]],l=u.numPoints,c=void 0,f=void 0,h=void 0;if(l)c=v(u),f=u.x,h=u.y;else{var p=this.points[u.index];c=p.properties,f=g(p.geometry.coordinates[0]),h=m(p.geometry.coordinates[1])}var d={type:1,geometry:[[Math.round(this.options.extent*(f*i-n)),Math.round(this.options.extent*(h*i-r))]],tags:c},y=void 0;l?y=u.id:this.options.generateId?y=u.index:this.points[u.index].id&&(y=this.points[u.index].id),void 0!==y&&(d.id=y),o.features.push(d)}},f.prototype._limitZoom=function(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))},f.prototype._cluster=function(e,t){for(var n=[],r=this.options,i=r.radius,o=r.extent,a=r.reduce,s=r.minPoints,u=i/(o*Math.pow(2,t)),l=0;l<e.length;l++){var c=e[l];if(!(c.zoom<=t)){c.zoom=t;for(var f=this.trees[t+1],p=f.within(c.x,c.y,u),d=c.numPoints||1,v=d,g=0,m=p;g<m.length;g+=1){var y=m[g],_=f.points[y];_.zoom>t&&(v+=_.numPoints||1)}if(v>d&&v>=s){for(var b=c.x*d,x=c.y*d,E=a&&d>1?this._map(c,!0):null,T=(l<<5)+(t+1)+this.points.length,A=0,S=p;A<S.length;A+=1){var C=S[A],R=f.points[C];if(!(R.zoom<=t)){R.zoom=t;var w=R.numPoints||1;b+=R.x*w,x+=R.y*w,R.parentId=T,a&&(E||(E=this._map(c,!0)),a(E,this._map(R)))}}c.parentId=T,n.push(h(b/v,x/v,T,v,E))}else if(n.push(c),v>1)for(var M=0,k=p;M<k.length;M+=1){var L=k[M],O=f.points[L];O.zoom<=t||(O.zoom=t,n.push(O))}}}return n},f.prototype._getOriginId=function(e){return e-this.points.length>>5},f.prototype._getOriginZoom=function(e){return(e-this.points.length)%32},f.prototype._map=function(e,t){if(e.numPoints)return t?y({},e.properties):e.properties;var n=this.points[e.index].properties,r=this.options.map(n);return t&&r===n?y({},r):r},f},"object"===a(t)?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)},6325:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(e){try{var t,n=(t=(t=document.getElementsByTagName("script"))[t.length-1]).getAttribute("data-injectcss");if(!(t=t.getAttribute("data-disable-injectsvg"))){var r,i,o,a,s;if(n&&!e.__iconfont__svg__cssinject__){e.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(t){console&&console.log(t)}}r=function(){var t,n=document.createElement("div");n.innerHTML=e._iconfont_svg_string_3580659,(n=n.getElementsByTagName("svg")[0])&&(n.setAttribute("aria-hidden","true"),n.style.position="absolute",n.style.width=0,n.style.height=0,n.style.overflow="hidden",(t=document.body).firstChild?function(e,t){t.parentNode.insertBefore(e,t)}(n,t.firstChild):t.appendChild(n))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(r,0):(i=function(){document.removeEventListener("DOMContentLoaded",i,!1),r()},document.addEventListener("DOMContentLoaded",i,!1)):document.attachEvent&&(o=r,a=e.document,s=!1,function e(){try{a.documentElement.doScroll("left")}catch(t){return void setTimeout(e,50)}u()}(),a.onreadystatechange=function(){"complete"==a.readyState&&(a.onreadystatechange=null,u())})}function u(){s||(s=!0,o())}}catch(i){}}(window)},5012:function(t){"use strict";t.exports=e},9427:function(e){"use strict";e.exports=t},1996:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},1349:function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},9958:function(e,t,n){var r=n(1996);e.exports=function(e){if(Array.isArray(e))return r(e)},e.exports.__esModule=!0,e.exports.default=e.exports},1119:function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.__esModule=!0,e.exports.default=e.exports},4351:function(e){function t(e,t,n,r,i,o,a){try{var s=e[o](a),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}e.exports=function(e){return function(){var n=this,r=arguments;return new Promise((function(i,o){var a=e.apply(n,r);function s(e){t(a,i,o,s,u,"next",e)}function u(e){t(a,i,o,s,u,"throw",e)}s(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},8025:function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},6805:function(e,t,n){var r=n(1442),i=n(8588);function o(t,n,a){return i()?(e.exports=o=Reflect.construct.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=o=function(e,t,n){var i=[null];i.push.apply(i,t);var o=new(Function.bind.apply(e,i));return n&&r(o,n.prototype),o},e.exports.__esModule=!0,e.exports.default=e.exports),o.apply(null,arguments)}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},1133:function(e,t,n){var r=n(779);function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}e.exports=function(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},2729:function(e,t,n){var r=n(9095);e.exports=function(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,a=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw a}}}},e.exports.__esModule=!0,e.exports.default=e.exports},2060:function(e,t,n){var r=n(5757),i=n(8588),o=n(4127);e.exports=function(e){var t=i();return function(){var n,i=r(e);if(t){var a=r(this).constructor;n=Reflect.construct(i,arguments,a)}else n=i.apply(this,arguments);return o(this,n)}},e.exports.__esModule=!0,e.exports.default=e.exports},3769:function(e,t,n){var r=n(779);e.exports=function(e,t,n){return(t=r(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e},e.exports.__esModule=!0,e.exports.default=e.exports},6413:function(e,t,n){var r=n(7970);function i(){return"undefined"!=typeof Reflect&&Reflect.get?(e.exports=i=Reflect.get.bind(),e.exports.__esModule=!0,e.exports.default=e.exports):(e.exports=i=function(e,t,n){var i=r(e,t);if(i){var o=Object.getOwnPropertyDescriptor(i,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},e.exports.__esModule=!0,e.exports.default=e.exports),i.apply(this,arguments)}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},5757:function(e){function t(n){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},3491:function(e,t,n){var r=n(1442);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&r(e,t)},e.exports.__esModule=!0,e.exports.default=e.exports},4496:function(e){e.exports=function(e){try{return-1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}},e.exports.__esModule=!0,e.exports.default=e.exports},8588:function(e){e.exports=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}},e.exports.__esModule=!0,e.exports.default=e.exports},6811:function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.__esModule=!0,e.exports.default=e.exports},2414:function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,l=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==t);u=!0);}catch(e){l=!0,i=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(l)throw i}}return s}},e.exports.__esModule=!0,e.exports.default=e.exports},1039:function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},6179:function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},4450:function(e,t,n){var r=n(3769);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e},e.exports.__esModule=!0,e.exports.default=e.exports},1409:function(e,t,n){var r=n(136);e.exports=function(e,t){if(null==e)return{};var n,i,o=r(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o},e.exports.__esModule=!0,e.exports.default=e.exports},136:function(e){e.exports=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i},e.exports.__esModule=!0,e.exports.default=e.exports},4127:function(e,t,n){var r=n(5116).default,i=n(1119);e.exports=function(e,t){if(t&&("object"===r(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return i(e)},e.exports.__esModule=!0,e.exports.default=e.exports},6502:function(e,t,n){var r=n(5116).default;function i(){"use strict";e.exports=i=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var t,n={},o=Object.prototype,a=o.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},u="function"==typeof Symbol?Symbol:{},l=u.iterator||"@@iterator",c=u.asyncIterator||"@@asyncIterator",f=u.toStringTag||"@@toStringTag";function h(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{h({},"")}catch(t){h=function(e,t,n){return e[t]=n}}function p(e,t,n,r){var i=t&&t.prototype instanceof _?t:_,o=Object.create(i.prototype),a=new O(r||[]);return s(o,"_invoke",{value:w(e,n,a)}),o}function d(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}n.wrap=p;var v="suspendedStart",g="executing",m="completed",y={};function _(){}function b(){}function x(){}var E={};h(E,l,(function(){return this}));var T=Object.getPrototypeOf,A=T&&T(T(I([])));A&&A!==o&&a.call(A,l)&&(E=A);var S=x.prototype=_.prototype=Object.create(E);function C(e){["next","throw","return"].forEach((function(t){h(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function n(i,o,s,u){var l=d(e[i],e,o);if("throw"!==l.type){var c=l.arg,f=c.value;return f&&"object"==r(f)&&a.call(f,"__await")?t.resolve(f.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(f).then((function(e){c.value=e,s(c)}),(function(e){return n("throw",e,s,u)}))}u(l.arg)}var i;s(this,"_invoke",{value:function(e,r){function o(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(o,o):o()}})}function w(e,n,r){var i=v;return function(o,a){if(i===g)throw new Error("Generator is already running");if(i===m){if("throw"===o)throw a;return{value:t,done:!0}}for(r.method=o,r.arg=a;;){var s=r.delegate;if(s){var u=M(s,r);if(u){if(u===y)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===v)throw i=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=g;var l=d(e,n,r);if("normal"===l.type){if(i=r.done?m:"suspendedYield",l.arg===y)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i=m,r.method="throw",r.arg=l.arg)}}}function M(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,"throw"===r&&e.iterator.return&&(n.method="return",n.arg=t,M(e,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),y;var o=d(i,e.iterator,n.arg);if("throw"===o.type)return n.method="throw",n.arg=o.arg,n.delegate=null,y;var a=o.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,y):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,y)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function L(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function I(e){if(e||""===e){var n=e[l];if(n)return n.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(a.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}throw new TypeError(r(e)+" is not iterable")}return b.prototype=x,s(S,"constructor",{value:x,configurable:!0}),s(x,"constructor",{value:b,configurable:!0}),b.displayName=h(x,f,"GeneratorFunction"),n.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,x):(e.__proto__=x,h(e,f,"GeneratorFunction")),e.prototype=Object.create(S),e},n.awrap=function(e){return{__await:e}},C(R.prototype),h(R.prototype,c,(function(){return this})),n.AsyncIterator=R,n.async=function(e,t,r,i,o){void 0===o&&(o=Promise);var a=new R(p(e,t,r,i),o);return n.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},C(S),h(S,f,"Generator"),h(S,l,(function(){return this})),h(S,"toString",(function(){return"[object Generator]"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=I,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(L),!e)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var o=this.tryEntries[i],s=o.completion;if("root"===o.tryLoc)return r("end");if(o.tryLoc<=this.prev){var u=a.call(o,"catchLoc"),l=a.call(o,"finallyLoc");if(u&&l){if(this.prev<o.catchLoc)return r(o.catchLoc,!0);if(this.prev<o.finallyLoc)return r(o.finallyLoc)}else if(u){if(this.prev<o.catchLoc)return r(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return r(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),L(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;L(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:I(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),y}},n}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},1442:function(e){function t(n,r){return e.exports=t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n,r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},3420:function(e,t,n){var r=n(1349),i=n(2414),o=n(9095),a=n(1039);e.exports=function(e,t){return r(e)||i(e,t)||o(e,t)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},7970:function(e,t,n){var r=n(5757);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e},e.exports.__esModule=!0,e.exports.default=e.exports},2786:function(e,t,n){var r=n(9958),i=n(6811),o=n(9095),a=n(6179);e.exports=function(e){return r(e)||i(e)||o(e)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},7653:function(e,t,n){var r=n(5116).default;e.exports=function(e,t){if("object"!=r(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},779:function(e,t,n){var r=n(5116).default,i=n(7653);e.exports=function(e){var t=i(e,"string");return"symbol"==r(t)?t:String(t)},e.exports.__esModule=!0,e.exports.default=e.exports},5116:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},9095:function(e,t,n){var r=n(1996);e.exports=function(e,t){if(e){if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},4692:function(e,t,n){var r=n(5757),i=n(1442),o=n(4496),a=n(6805);function s(t){var n="function"==typeof Map?new Map:void 0;return e.exports=s=function(e){if(null===e||!o(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return a(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},e.exports.__esModule=!0,e.exports.default=e.exports,s(t)}e.exports=s,e.exports.__esModule=!0,e.exports.default=e.exports},23:function(e,t,n){"use strict";n.d(t,{DL:function(){return c},Ht:function(){return h},Tu:function(){return s},tw:function(){return l},uf:function(){return u},vi:function(){return f},yu:function(){return a},zL:function(){return o}});n(5116);var r=6371008.8,i={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*r,kilometers:6371.0088,kilometres:6371.0088,meters:r,metres:r,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:r/1852,radians:1,yards:6967335.223679999};function o(e,t,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function a(e,t,n){void 0===n&&(n={});for(var r=0,i=e;r<i.length;r++){var a=i[r];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}return o({type:"Polygon",coordinates:e},t,n)}function s(e,t,n){if(void 0===n&&(n={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");return o({type:"LineString",coordinates:e},t,n)}function u(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function l(e,t,n){return void 0===n&&(n={}),o({type:"MultiPolygon",coordinates:e},t,n)}function c(e,t){void 0===t&&(t="kilometers");var n=i[t];if(!n)throw new Error(t+" units is invalid");return e*n}function f(e){return 180*(e%(2*Math.PI))/Math.PI}function h(e){return e%360*Math.PI/180}},7436:function(e,t,n){"use strict";n.d(t,{r7:function(){return r},wA:function(){return i}});n(23);function r(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function i(e){return"Feature"===e.type?e.geometry:e}},4612:function(e,t,n){"use strict";n.d(t,{nG:function(){return a},pZ:function(){return i}});var r=n(23);function i(e,t,n){if(null!==e)for(var r,o,a,s,u,l,c,f,h=0,p=0,d=e.type,v="FeatureCollection"===d,g="Feature"===d,m=v?e.features.length:1,y=0;y<m;y++){u=(f=!!(c=v?e.features[y].geometry:g?e.geometry:e)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var _=0;_<u;_++){var b=0,x=0;if(null!==(s=f?c.geometries[_]:c)){l=s.coordinates;var E=s.type;switch(h=!n||"Polygon"!==E&&"MultiPolygon"!==E?0:1,E){case null:break;case"Point":if(!1===t(l,p,y,b,x))return!1;p++,b++;break;case"LineString":case"MultiPoint":for(r=0;r<l.length;r++){if(!1===t(l[r],p,y,b,x))return!1;p++,"MultiPoint"===E&&b++}"LineString"===E&&b++;break;case"Polygon":case"MultiLineString":for(r=0;r<l.length;r++){for(o=0;o<l[r].length-h;o++){if(!1===t(l[r][o],p,y,b,x))return!1;p++}"MultiLineString"===E&&b++,"Polygon"===E&&x++}"Polygon"===E&&b++;break;case"MultiPolygon":for(r=0;r<l.length;r++){for(x=0,o=0;o<l[r].length;o++){for(a=0;a<l[r][o].length-h;a++){if(!1===t(l[r][o][a],p,y,b,x))return!1;p++}x++}b++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===i(s.geometries[r],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function o(e,t){var n,r,i,o,a,s,u,l,c,f,h=0,p="FeatureCollection"===e.type,d="Feature"===e.type,v=p?e.features.length:1;for(n=0;n<v;n++){for(s=p?e.features[n].geometry:d?e.geometry:e,l=p?e.features[n].properties:d?e.properties:{},c=p?e.features[n].bbox:d?e.bbox:void 0,f=p?e.features[n].id:d?e.id:void 0,a=(u=!!s&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;i<a;i++)if(null!==(o=u?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,h,l,c,f))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],h,l,c,f))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,h,l,c,f))return!1;h++}}function a(e,t){o(e,(function(e,n,i,o,a){var s,u=null===e?null:e.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return!1!==t((0,r.zL)(e,i,{bbox:o,id:a}),n,0)&&void 0}switch(u){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<e.coordinates.length;l++){var c={type:s,coordinates:e.coordinates[l]};if(!1===t((0,r.zL)(c,i),n,l))return!1}}))}}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={id:e,loaded:!1,exports:{}};return n[e].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e};var o={};return function(){"use strict";i.r(o),i.d(o,{AJAXError:function(){return c.Uj},BKDRHash:function(){return c.e2},BaiduMap:function(){return u.Gp},BaseLayer:function(){return s.zi},BaseMapService:function(){return u.zr},BaseMapWrapper:function(){return u.rh},BaseModel:function(){return s.gq},CanvasLayer:function(){return s.mM},CanvasUpdateType:function(){return s.Fy},CityBuildingLayer:function(){return s.Rf},DOM:function(){return c.SO},Earth:function(){return u.IY},EarthLayer:function(){return s.fJ},FrequencyController:function(){return c.iH},GaodeMap:function(){return u.lg},GaodeMapV1:function(){return u.nb},GaodeMapV2:function(){return u.DP},GeometryLayer:function(){return s.VR},GoogleMap:function(){return u.b6},HeatmapLayer:function(){return s.zP},ImageLayer:function(){return s.Q8},LRUCache:function(){return c.z6},LineLayer:function(){return s.Ie},LinearDir:function(){return s.cA},LoadTileDataStatus:function(){return c.Qj},Map:function(){return u.D5},MapLibre:function(){return u.H0},Mapbox:function(){return u.pc},MaskLayer:function(){return s.$1},PointLayer:function(){return s.ns},PolygonLayer:function(){return s.dW},RasterLayer:function(){return s.YY},Satistics:function(){return c.a5},Scene:function(){return l.x},SceneConifg:function(){return c.SA},SizeUnitType:function(){return s.xg},Source:function(){return e.default},SourceTile:function(){return c.LZ},TMap:function(){return u.Qs},TencentMap:function(){return u.yh},TextureBlend:function(){return s.qy},TileDebugLayer:function(){return s.sh},TileLayer:function(){return s.Im},TilesetManager:function(){return c.nx},UpdateTileStrategy:function(){return c.dD},WindLayer:function(){return s.vo},aProjectFlat:function(){return c.Z},amap2Project:function(){return c.TG},amap2UnProject:function(){return c.S8},anchorTranslate:function(){return c.rQ},anchorType:function(){return c.bV},applyAnchorClass:function(){return c.zi},bBoxToBounds:function(){return c.ds},bindAll:function(){return c.Ev},boundsContains:function(){return c.oO},calAngle:function(){return c.mt},calDistance:function(){return c.Lw},calculateCentroid:function(){return c.SI},calculatePointsCenterAndRadius:function(){return c.Rx},decodePickingColor:function(){return c.W0},defaultValue:function(){return c.LS},djb2hash:function(){return c.h8},encodePickingColor:function(){return c.Z6},expandUrl:function(){return c.Gk},extent:function(){return c.We},flow:function(){return c.ls},formatImage:function(){return c.Co},fp64LowPart:function(){return c.Ks},generateCatRamp:function(){return c.hj},generateColorRamp:function(){return c.Cl},generateCustomRamp:function(){return c.Oc},generateLinearRamp:function(){return c.M4},generateQuantizeRamp:function(){return c.NJ},getAngle:function(){return c._O},getArrayBuffer:function(){return c.ks},getBBoxFromPoints:function(){return c.Ol},getData:function(){return c.Yu},getDefaultDomain:function(){return c.ZB},getImage:function(){return c.gJ},getJSON:function(){return c.xA},getProtocolAction:function(){return c.Y3},getReferrer:function(){return c.an},getTileIndices:function(){return c.rJ},getTileWarpXY:function(){return c.qD},getURLFromTemplate:function(){return c.z0},getWMTSURLFromTemplate:function(){return c.jG},guid:function(){return c.M8},isAndroid:function(){return c.Dt},isColor:function(){return c.D5},isImageBitmap:function(){return c.fg},isNumber:function(){return c.Id},isPC:function(){return c.Ro},isURLTemplate:function(){return c.Xj},isWorker:function(){return c.hJ},isiOS:function(){return c.Tt},latitude:function(){return c.pq},lineAtOffset:function(){return c.LT},lineAtOffsetAsyc:function(){return c.wj},lineStyleType:function(){return s.zW},lngLatInExtent:function(){return c.if},lngLatToMeters:function(){return c.vP},lnglatDistance:function(){return c.yM},lodashUtil:function(){return c.rU},longitude:function(){return c.MS},makeXMLHttpRequestPromise:function(){return c.LF},metersToLngLat:function(){return c.Uv},normalize:function(){return c.Fv},osmLonLat2TileXY:function(){return c.RV},osmTileXY2LonLat:function(){return c.cN},padBounds:function(){return c.yA},postData:function(){return c.qC},project:function(){return c.iV},rgb2arr:function(){return c.CI},sameOrigin:function(){return c._0},tileToBounds:function(){return c.Dv},tranfrormCoord:function(){return c.Jo},unProjectFlat:function(){return c.ih},validateLngLat:function(){return c.Fb},version:function(){return f.i}});var e=i(946),t=i(8168),n={};for(var r in t)["default","Source"].indexOf(r)<0&&(n[r]=function(e){return t[e]}.bind(0,r));i.d(o,n);var a=i(7033);n={};for(var r in a)["default","Source","ExportImage","Fullscreen","GeoLocate","LayerSwitch","Logo","MapTheme","MouseLocation","Scale","Swipe","Zoom","LayerPopup","Popup","Marker","MarkerLayer","ButtonControl","Control","PopperControl","PositionType","SelectControl"].indexOf(r)<0&&(n[r]=function(e){return a[e]}.bind(0,r));i.d(o,n);var s=i(2422),u=i(1819),l=i(4230),c=i(7193),f=i(8909)}(),o}()}));