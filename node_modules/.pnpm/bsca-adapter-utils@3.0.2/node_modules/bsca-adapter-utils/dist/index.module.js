import{Workbook as e}from"exceljs";import t from"axios";import r from"dayjs";function s(e){if(!e)return[0,0];let t=e.offsetLeft,r=e.offsetTop,s=e.offsetParent;for(;null!==s;)t+=s.offsetLeft,r+=s.offsetTop,s=s.offsetParent;return[t,r]}async function o(t,r,s="export.xlsx",o,a){const n=new e,i=n.addWorksheet();i.columns=r.map((e=>({header:e.header||e.dataIndex}))),t.forEach(((e,t)=>{const s=r.map((r=>{const s=e[r.dataIndex];if("index"===r.type)return t+1;if(r.computeMethod)try{return r.computeMethod(s,e)}catch(e){console.error(`函数调用错误（${r.header}，${r.dataIndex}）`,e)}return s}));i.addRow(s)}));let d=s;return d.match(/\.xlsx$/)||(d+=".xlsx"),a&&a(i),n.xlsx.writeBuffer().then((e=>{const t=document.createElement("a"),r=new Blob([e],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),s=window.URL.createObjectURL(r);t.href=s,t.download=d,document.body.appendChild(t),t.click(),setTimeout((()=>{document.body.removeChild(t),window.URL.revokeObjectURL(s)}))}))}async function a(t){return new Promise(((r,s)=>{const o=new FileReader;o.onload=async()=>{const t=(await(new e).xlsx.load(o.result)).worksheets[0],s=[];t.eachRow((e=>{const t=[];e.eachCell({includeEmpty:!0},(e=>{t.push(e.text)})),s.push(t)})),r(s)},o.onerror=s,o.readAsArrayBuffer(t)}))}const n=e=>e,i=e=>Promise.reject(e),d=e=>e.data&&e.data.result?e:Promise.reject(e),l=e=>e.response?Promise.reject(e.response):Promise.reject({data:{result:!1,debugMessage:e.massage||"UNKNOWN ERROR"}});class c{constructor(e){this.axios=t.create(e),this.init()}init(){this.axios.interceptors.request.use(n,i),this.axios.interceptors.response.use(d,l)}parseUrlString(e){return e.replace(/([A-Z])/g,(e=>`/${e.toLowerCase()}`)).replace(/\/\//g,"/")}getModelBaseUrl(e,t,r){return this.parseUrlString(`/${e}/${t}/${r}`)}doRequest(e,t){return this.axios(e,{...t})}getModel(e,t,r,s,...o){let a=this.getModelBaseUrl(e,t,r),n=null;switch(s){case"list":[n]=o;break;case"detail":a=`${a}/single`,[n]=o;break;default:return Promise.reject()}return this.doRequest(a,{params:n})}postModel(e,t,r,s,...o){const a=this.getModelBaseUrl(e,t,r);let n=null;switch(s){case"post":[n]=o;break;default:return Promise.reject()}return this.doRequest(a,{method:"post",data:n})}patchModel(e,t,r,s,...o){const a=this.getModelBaseUrl(e,t,r);let n=null;switch(s){case"patch":[n]=o;break;default:return Promise.reject()}return this.doRequest(a,{method:"patch",data:n})}deleteModel(e,t,r,s,...o){const a=this.getModelBaseUrl(e,t,r);let n=null;switch(s){case"delete":[n]=o;break;default:return Promise.reject()}return this.doRequest(a,{method:"delete",params:n})}filterModel(e,t,r,s){const o=`${this.getModelBaseUrl(e,t,r)}/filter`;return this.doRequest(o,{method:"get",params:s})}}function u(e){return new c(e)}const m={date:"YYYY-MM-DD",datetime:"YYYY-MM-DD HH:mm:ss",time:"HH:mm:ss",datetimeNS:"YYYY-MM-DD HH:mm",timeNS:"HH:mm"};function h(e,t="datetime"){const s=m[t];if(!s)throw new Error(`错误的格式化类型：${t}`);return e?r(e).format(s):"-"}export{c as Request,u as createRequest,o as exportJsonToExcel,s as getElementPosition,a as importExcelToJson,h as timeFormat};
